(function(h,p,k){"use awesome";if(h.trackJs)h.console&&h.console.warn&&h.console.warn("TrackJS global conflict");else{var l=function(a,b,c,d,e){this.util=a;this.onError=b;this.onFault=c;this.options=e;e.enabled&&this.initialize(d)};l.prototype={initialize:function(a){a.addEventListener&&(this.wrapAndCatch(a.Element.prototype,"addEventListener",1),this.wrapAndCatch(a.XMLHttpRequest.prototype,"addEventListener",1),this.wrapRemoveEventListener(a.Element.prototype),this.wrapRemoveEventListener(a.XMLHttpRequest.prototype));this.wrapAndCatch(a,"setTimeout",0);this.wrapAndCatch(a,"setInterval",0)},wrapAndCatch:function(a,b,c){var d=this,e=a[b];d.util.hasFunction(e,"apply")&&(a[b]=function(){try{var f=Array.prototype.slice.call(arguments),g=f[c],u,h;if(d.options.bindStack)try{throw Error()}catch(k){h=k.stack,u=d.util.isoNow()}if("addEventListener"===b&&(this._trackJsEvt||(this._trackJsEvt=new m),this._trackJsEvt.getWrapped(f[0],g,f[2])))return;g&&d.util.hasFunction(g,"apply")&&(f[c]=function(){try{return g.apply(this,arguments)}catch(a){throw d.onError("catch",a,{bindTime:u,bindStack:h}),d.util.wrapError(a)}},"addEventListener"===b&&this._trackJsEvt.add(f[0],g,f[2],f[c]));return e.apply(this,f)}catch(l){a[b]=e,d.onFault(l)}})},wrapRemoveEventListener:function(a){if(a&&a.removeEventListener&&this.util.hasFunction(a.removeEventListener,"call")){var b=a.removeEventListener;a.removeEventListener=function(a,d,e){if(this._trackJsEvt){var f=this._trackJsEvt.getWrapped(a,d,e);f&&this._trackJsEvt.remove(a,d,e);return b.call(this,a,f,e)}return b.call(this,a,d,e)}}}};var m=function(){this.events=[]};m.prototype={add:function(a,b,c,d){-1>=this.indexOf(a,b,c)&&this.events.push([a,b,!!c,d])},remove:function(a,b,c){a=this.indexOf(a,b,!!c);0<=a&&this.events.splice(a,1)},getWrapped:function(a,b,c){a=this.indexOf(a,b,!!c);return 0<=a?this.events[a][3]:k},indexOf:function(a,b,c){for(var d=0;d<this.events.length;d++)if(this.events[d][0]===a&&this.events[d][1]===b&&this.events[d][2]===!!c)return d;return-1}};var t=function(a,b){this.util=a;this.initCurrent(b)};t.prototype={current:{},initOnly:{application:"",enabled:!0,token:!0,callback:{enabled:!0},console:{enabled:!0},network:{enabled:!0},visitor:{enabled:!0},window:{enabled:!0}},defaults:{application:"",enabled:!0,onError:function(){return!0},serialize:function(a){return a===k?"undefined":null===a?"null":"number"===typeof a&&isNaN(a)?"NaN":""===a?"Empty String":0===a?"0":!1===a?"false":a&&a.toString?a.toString():"unknown"},sessionId:"",token:"",userId:"",version:"",callback:{enabled:!0,bindStack:!1},console:{enabled:!0,display:!0,error:!0,watch:["log","debug","info","warn","error"]},network:{enabled:!0,error:!0},visitor:{enabled:!0},window:{enabled:!0}},initCurrent:function(a){if(this.validate(a,this.defaults,"config",{}))return this.current=this.util.extend(this.current,this.defaults,a),!0;this.current=this.util.extend(this.current,this.defaults);return!1},setCurrent:function(a){return this.validate(a,this.defaults,"config",this.initOnly)?(this.current=this.util.extend(this.current,a),!0):!1},validate:function(a,b,c,d){var e=!0;c=c||"";d=d||{};for(var f in a)if(a.hasOwnProperty(f))if(b.hasOwnProperty(f)){var g=typeof b[f];g!==typeof a[f]?(console.warn(c+"."+f+": property must be type "+g+"."),e=!1):"[object Array]"!==Object.prototype.toString.call(a[f])||this.validateArray(a[f],b[f],c+"."+f)?"[object Object]"===Object.prototype.toString.call(a[f])?e=this.validate(a[f],b[f],c+"."+f,d[f]):d.hasOwnProperty(f)&&(console.warn(c+"."+f+": property cannot be set after load."),e=!1):e=!1}else console.warn(c+"."+f+": property not supported."),e=!1;return e},validateArray:function(a,b,c){var d=!0;c=c||"";for(var e=0;e<a.length;e++)this.util.contains(b,a[e])||(console.warn(c+"["+e+"]: invalid value: "+a[e]+"."),d=!1);return d}};var q=function(a,b,c,d,e,f,g){this.util=a;this.log=b;this.onError=c;this.onFault=d;this.serialize=e;g.enabled&&(f.console=this.wrapConsoleObject(f.console,g))};q.prototype={wrapConsoleObject:function(a,b){a=a||{};var c=a.log||function(){},d=this,e;for(e=0;e<b.watch.length;e++)(function(e){var g=a[e]||c;a[e]=function(){try{var a=Array.prototype.slice.call(arguments);d.log.add("c",{timestamp:d.util.isoNow(),severity:e,message:d.serialize(a)});if(b.error&&"error"===e)try{throw Error(a[0])}catch(c){d.onError("console",c)}b.display&&(d.util.hasFunction(g,"apply")?g.apply(this,a):g(a[0],a[1],a[2]))}catch(h){d.onFault(h)}}})(b.watch[e]);return a},report:function(){return this.log.all("c")}};var r=function(a,b,c,d,e){this.config=a;this.util=b;this.log=c;this.window=d;this.document=e;this.correlationId=this.token=null;this.initialize()};r.prototype={initialize:function(){this.token=this.getCustomerToken();this.correlationId=this.getCorrelationId()},getCustomerToken:function(){if(this.config.current.token)return this.config.current.token;var a=this.document.getElementsByTagName("script");return a[a.length-1].getAttribute("data-token")},getCorrelationId:function(){var a;try{a=this.document.cookie.replace(/(?:(?:^|.*;\s*)TrackJS\s*\=\s*([^;]*).*$)|^.*$/,"$1"),a||(a=this.util.uuid(),this.document.cookie="TrackJS="+a+"; expires=Fri, 31 Dec 9999 23:59:59 GMT; path=/")}catch(b){a=this.util.uuid()}return a},report:function(){return{application:this.config.current.application,correlationId:this.correlationId,sessionId:this.config.current.sessionId,token:this.token,userId:this.config.current.userId,version:this.config.current.version}}};var s=function(a){this.loadedOn=(new Date).getTime();this.window=a};s.prototype={discoverDependencies:function(){var a,b={};this.window.jQuery&&(this.window.jQuery.fn&&this.window.jQuery.fn.jquery)&&(b.jQuery=this.window.jQuery.fn.jquery);this.window.jQuery&&(this.window.jQuery.ui&&this.window.jQuery.ui.version)&&(b.jQueryUI=this.window.jQuery.ui.version);this.window.angular&&(this.window.angular.version&&this.window.angular.version.full)&&(b.angular=this.window.angular.version.full);for(a in this.window)if("_trackJs"!==a&&"_trackJS"!==a&&"_trackjs"!==a&&"webkitStorageInfo"!==a)try{if(this.window[a]){var c=this.window[a].version||this.window[a].Version||this.window[a].VERSION;"string"===typeof c&&(b[a]=c)}}catch(d){}return b},report:function(){return{age:(new Date).getTime()-this.loadedOn,dependencies:this.discoverDependencies(),userAgent:this.window.navigator.userAgent,viewportHeight:this.window.document.documentElement.clientHeight,viewportWidth:this.window.document.documentElement.clientWidth}}};var v=function(a){this.util=a;this.appender=[];this.maxLength=30};v.prototype={all:function(a){var b=[],c,d;for(d=0;d<this.appender.length;d++)(c=this.appender[d])&&c.category===a&&b.push(c.value);return b},clear:function(){this.appender.length=0},truncate:function(){this.appender.length>this.maxLength&&(this.appender=this.appender.slice(Math.max(this.appender.length-this.maxLength,0)))},add:function(a,b){var c=this.util.uuid();this.appender.push({key:c,category:a,value:b});this.truncate();return c},get:function(a,b){var c,d;for(d=0;d<this.appender.length;d++)if(c=this.appender[d],c.category===a&&c.key===b)return c.value;return!1}};var w=function(a,b,c,d,e,f){this.util=a;this.log=b;this.onError=c;this.onFault=d;this.window=e;this.options=f;f.enabled&&this.initialize(e)};w.prototype={initialize:function(a){a.XMLHttpRequest&&this.util.hasFunction(a.XMLHttpRequest.prototype.open,"apply")&&this.watchNetworkObject(a.XMLHttpRequest);a.XDomainRequest&&this.util.hasFunction(a.XDomainRequest.prototype.open,"apply")&&this.watchNetworkObject(a.XDomainRequest)},watchNetworkObject:function(a){var b=this,c=a.prototype.open,d=a.prototype.send;a.prototype.open=function(a,b){this._trackJs={method:a,url:b};return c.apply(this,arguments)};a.prototype.send=function(){try{if(!this._trackJs)return d.apply(this,arguments);this._trackJs.logId=b.log.add("n",{startedOn:b.util.isoNow(),method:this._trackJs.method,url:this._trackJs.url});b.listenForNetworkComplete(this)}catch(a){b.onFault(a)}return d.apply(this,arguments)};return a},listenForNetworkComplete:function(a){var b=this;b.window.ProgressEvent&&a.addEventListener&&a.addEventListener("readystatechange",function(){4===a.readyState&&b.finalizeNetworkEvent(a)},!0);a.addEventListener?a.addEventListener("load",function(){b.finalizeNetworkEvent(a);b.checkNetworkFault(a)},!0):setTimeout(function(){try{var c=a.onload;a.onload=function(){b.finalizeNetworkEvent(a);b.checkNetworkFault(a);"function"===typeof c&&b.util.hasFunction(c,"apply")&&c.apply(a,arguments)};var d=a.onerror;a.onerror=function(){b.finalizeNetworkEvent(a);b.checkNetworkFault(a);"function"===typeof oldOnError&&d.apply(a,arguments)}}catch(e){b.onFault(e)}},0)},finalizeNetworkEvent:function(a){if(a._trackJs){var b=this.log.get("n",a._trackJs.logId);b&&(b.completedOn=this.util.isoNow(),b.statusCode=1223==a.status?204:a.status,b.statusText=1223==a.status?"No Content":a.statusText,a._trackJs=k)}},checkNetworkFault:function(a){if(this.options.error&&400<=a.status&&1223!=a.status)this.onError("ajax",a.status+" "+a.statusText)},report:function(){return this.log.all("n")}};var n=function(a){this.util=a;this.disabled=!1;this.throttleStats={attemptCount:0,throttledCount:0,lastAttempt:(new Date).getTime()};h.JSON&&h.JSON.stringify||(this.disabled=!0)};n.prototype={errorEndpoint:function(a,b){b=(b||"https://capture.trackjs.com/capture")+("?token="+a);return this.util.isBrowserIE()?"//"+b.split("://")[1]:b},usageEndpoint:function(a){return this.appendObjectAsQuery(a,"https://usage.trackjs.com/usage.gif")},trackerFaultEndpoint:function(a){return this.appendObjectAsQuery(a,"https://usage.trackjs.com/fault.gif")},appendObjectAsQuery:function(a,b){b+="?";for(var c in a)a.hasOwnProperty(c)&&(b+=encodeURIComponent(c)+"="+encodeURIComponent(a[c])+"&");return b},getCORSRequest:function(a,b){var c=new h.XMLHttpRequest;"withCredentials"in c?(c.open(a,b),c.setRequestHeader("Content-Type","text/plain")):"undefined"!==typeof h.XDomainRequest?(c=new h.XDomainRequest,c.open(a,b)):c=null;return c},sendTrackerFault:function(a){this.throttle(a)||((new Image).src=this.trackerFaultEndpoint(a))},sendUsage:function(a){(new Image).src=this.usageEndpoint(a)},sendError:function(a,b){var c=this;if(!this.disabled&&!this.throttle(a))try{var d=this.getCORSRequest("POST",this.errorEndpoint(b));d.onreadystatechange=function(){4===d.readyState&&200!==d.status&&(c.disabled=!0)};d._trackJs=k;d.send(h.JSON.stringify(a))}catch(e){throw this.disabled=!0,e}},throttle:function(a){var b=(new Date).getTime();this.throttleStats.attemptCount++;if(this.throttleStats.lastAttempt+1e3>=b){if(this.throttleStats.lastAttempt=b,10<this.throttleStats.attemptCount)return this.throttleStats.throttledCount++,!0}else a.throttled=this.throttleStats.throttledCount,this.throttleStats.attemptCount=0,this.throttleStats.lastAttempt=b,this.throttleStats.throttledCount=0;return!1}};var x=function(a){this.window=a};x.prototype={bind:function(a,b){return function(){return a.apply(b,Array.prototype.slice.call(arguments))}},contains:function(a,b){var c;for(c=0;c<a.length;c++)if(a[c]===b)return!0;return!1},defer:function(a,b){setTimeout(function(){a.apply(b)})},extend:function(a){for(var b,c=Array.prototype.slice.call(arguments,1),d=0;d<c.length;d++)for(b in c[d])null===c[d][b]||c[d][b]===k?a[b]=c[d][b]:"[object Object]"===Object.prototype.toString.call(c[d][b])?(a[b]=a[b]||{},this.extend(a[b],c[d][b])):a[b]=c[d][b];return a},hasFunction:function(a,b){try{return!!a[b]}catch(c){return!1}},isBrowserIE:function(){var a=this.window.navigator.userAgent,b=a.match(/Trident\/([\d.]+)/);return b&&"7.0"===b[1]?11:(a=a.match(/MSIE ([\d.]+)/))?parseInt(a[1],10):!1},isBrowserSupported:function(){var a=this.isBrowserIE();return!a||8<=a},isoNow:function(){var a=new Date;return a.toISOString?a.toISOString():a.getUTCFullYear()+"-"+this.pad(a.getUTCMonth()+1)+"-"+this.pad(a.getUTCDate())+"T"+this.pad(a.getUTCHours())+":"+this.pad(a.getUTCMinutes())+":"+this.pad(a.getUTCSeconds())+"."+String((a.getUTCMilliseconds()/1e3).toFixed(3)).slice(2,5)+"Z"},pad:function(a){a=String(a);1===a.length&&(a="0"+a);return a},uuid:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0;return("x"==a?b:b&3|8).toString(16)})},wrapError:function(a){if(a.innerError)return a;var b=Error("TrackJS Caught: "+(a.message||a));b.description="TrackJS Caught: "+a.description;b.file=a.file;b.line=a.line||a.lineNumber;b.column=a.column||a.columnNumber;b.stack=a.stack;b.innerError=a;return b}};var y=function(a,b,c,d,e,f){this.util=a;this.log=b;this.onError=c;this.onFault=d;this.options=f;this.document=e;f.enabled&&this.initialize(e)};y.prototype={initialize:function(a){var b=this.util.bind(this.onDocumentClicked,this),c=this.util.bind(this.onInputChanged,this);a.addEventListener?(a.addEventListener("click",b,!0),a.addEventListener("blur",c,!0)):a.attachEvent&&(a.attachEvent("onclick",b),a.attachEvent("onfocusout",c))},onDocumentClicked:function(a){try{var b=this.getElementFromEvent(a);b&&b.tagName&&(this.isDescribedElement(b,"a")||this.isDescribedElement(b,"button")||this.isDescribedElement(b,"input",["button","submit"])?this.writeVisitorEvent(b,"click"):this.isDescribedElement(b,"input",["checkbox","radio"])&&this.writeVisitorEvent(b,"input",b.value,b.checked))}catch(c){this.onFault(c)}},onInputChanged:function(a){try{var b=this.getElementFromEvent(a);if(b&&b.tagName)if(this.isDescribedElement(b,"textarea"))this.writeVisitorEvent(b,"input",b.value);else if(this.isDescribedElement(b,"select")&&b.options&&b.options.length)this.onSelectInputChanged(b);else this.isDescribedElement(b,"input")&&!this.isDescribedElement(b,"input",["button","submit","hidden","checkbox","radio"])&&this.writeVisitorEvent(b,"input",b.value)}catch(c){this.onFault(c)}},onSelectInputChanged:function(a){if(a.multiple)for(var b=0;b<a.options.length;b++)a.options[b].selected&&this.writeVisitorEvent(a,"input",a.options[b].value);else 0<=a.selectedIndex&&a.options[a.selectedIndex]&&this.writeVisitorEvent(a,"input",a.options[a.selectedIndex].value)},writeVisitorEvent:function(a,b,c,d){"password"===this.getElementType(a)&&(c=k);this.log.add("v",{timestamp:this.util.isoNow(),action:b,element:{tag:a.tagName.toLowerCase(),attributes:this.getElementAttributes(a),value:this.getMetaValue(c,d)}})},getElementFromEvent:function(a){return a.target||p.elementFromPoint(a.clientX,a.clientY)},isDescribedElement:function(a,b,c){if(a.tagName.toLowerCase()!==b.toLowerCase())return!1;if(!c)return!0;a=this.getElementType(a);for(b=0;b<c.length;b++)if(c[b]===a)return!0;return!1},getElementType:function(a){return(a.getAttribute("type")||"").toLowerCase()},getElementAttributes:function(a){for(var b={},c=0;c<a.attributes.length;c++)"value"!==a.attributes[c].name.toLowerCase()&&(b[a.attributes[c].name]=a.attributes[c].value);return b},getMetaValue:function(a,b){return a===k?k:{length:a.length,pattern:this.matchInputPattern(a),checked:b}},matchInputPattern:function(a){return""===a?"empty":/^[a-z0-9!#$%&'*+=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?$/.test(a)?"email":/^(0?[1-9]|[12][0-9]|3[01])[\/\-](0?[1-9]|1[012])[\/\-]\d{4}$/.test(a)||/^(\d{4}[\/\-](0?[1-9]|1[012])[\/\-]0?[1-9]|[12][0-9]|3[01])$/.test(a)?"date":/^(?:(?:\+?1\s*(?:[.-]\s*)?)?(?:\(\s*([2-9]1[02-9]|[2-9][02-8]1|[2-9][02-8][02-9])\s*\)|([2-9]1[02-9]|[2-9][02-8]1|[2-9][02-8][02-9]))\s*(?:[.-]\s*)?)?([2-9]1[02-9]|[2-9][02-9]1|[2-9][02-9]{2})\s*(?:[.-]\s*)?([0-9]{4})(?:\s*(?:#|x\.?|ext\.?|extension)\s*(\d+))?$/.test(a)?"usphone":/^\s*$/.test(a)?"whitespace":/^\d*$/.test(a)?"numeric":/^[a-zA-Z]*$/.test(a)?"alpha":/^[a-zA-Z0-9]*$/.test(a)?"alphanumeric":"characters"},report:function(){return this.log.all("v")}};var z=function(a,b,c,d,e){this.onError=a;this.onFault=b;this.serialize=c;e.enabled&&this.watchWindowErrors(d)};z.prototype={watchWindowErrors:function(a){var b=this;a.onerror=function(a,d,e,f,g){try{g=g||{},g.message=g.message||b.serialize(a),g.file=g.file||b.serialize(d),g.line=g.line||parseInt(e,10)||null,g.column=g.column||parseInt(f,10)||null,b.onError("window",g)}catch(h){b.onFault(h)}}}};var A=function(a,b,c,d,e,f,g,h,k,l,m,n,p,t,q,r){try{this.window=q,this.document=r,this.util=new m(this.window),this.onError=this.util.bind(this.onError,this),this.onFault=this.util.bind(this.onFault,this),this.serialize=this.util.bind(this.serialize,this),this.transmitter=new l(this.util),this.config=new d(this.util,a),this.log=new h(this.util),this.api=new b(this.config,this.util,this.onError),this.environment=new g(this.window),this.customer=new f(this.config,this.util,this.log,this.window,this.document),this.customer.token&&(this.transmitter.sendUsage({token:this.customer.token,correlationId:this.customer.correlationId,application:this.config.current.application,x:this.util.uuid()}),this.apiConsoleWatcher=new e(this.util,this.log,this.onError,this.onFault,this.serialize,this.api,this.config.defaults.console),this.windowConsoleWatcher=new e(this.util,this.log,this.onError,this.onFault,this.serialize,this.window,this.config.current.console),this.util.isBrowserSupported()&&this.config.current.enabled&&(this.callbackWatcher=new c(this.util,this.onError,this.onFault,this.window,this.config.current.callback),this.visitorWatcher=new n(this.util,this.log,this.onError,this.onFault,this.document,this.config.current.visitor),this.networkWatcher=new k(this.util,this.log,this.onError,this.onFault,this.window,this.config.current.network),this.windowWatcher=new p(this.onError,this.onFault,this.serialize,this.window,this.config.current.window)))}catch(s){this.onFault(s)}};A.prototype={reveal:function(){if(this.customer.token)return this.api;this.window.console&&this.window.console.warn&&this.window.console.warn("TrackJS could not find a token");return k},onError:function(a,b,c){if(this.util.isBrowserSupported()&&this.config.current.enabled)try{b=b||{};c=c||{bindStack:null,bindTime:null,force:!1};var d=b.message||b;if(!d||!d.indexOf||-1===d.indexOf("TrackJS Caught")){var e=this.util.extend({},{bindStack:c.bindStack,bindTime:c.bindTime,column:b.column||b.columnNumber,console:this.windowConsoleWatcher.report(),customer:this.customer.report(),entry:a,environment:this.environment.report(),file:b.file||b.fileName,line:b.line||b.lineNumber,message:c.force?d:this.serialize(d),network:this.networkWatcher.report(),url:(h.location||"").toString(),stack:b.stack,timestamp:this.util.isoNow(),visitor:this.visitorWatcher.report(),version:"2.1.6"});if(!c.force)try{if(!this.config.current.onError(e,b))return}catch(f){e.console.push({timestamp:this.util.isoNow(),severity:"error",message:f.message});var g=this;setTimeout(function(){g.onError("catch",f,{force:!0})},0)}this.log.clear();this.transmitter.sendError(e,this.customer.token)}}catch(k){console.log(k),this.onFault(k)}},onFault:function(a){var b=this.transmitter||new n;a=a||{};a={token:this.customer.token,file:a.file||a.fileName,msg:a.message||"unknown",stack:(a.stack||"unknown").substr(0,500),url:this.window.location,v:"2.1.6",x:this.util.uuid()};b.sendTrackerFault(a)},serialize:function(a){if(this.config&&this.config.current&&this.config.current.serialize)try{return this.config.current.serialize(a)}catch(b){return this.onError("catch",b,{force:!0}),this.util&&this.util.hasFunction(a,"toString")?a.toString():"unknown"}}};l=new A(h._trackJs||h._trackJS||h._trackjs||{},function(a,b,c){return{attempt:function(a,e){try{var f=Array.prototype.slice.call(arguments,2);return a.apply(e||this,f)}catch(g){throw c("catch",g),b.wrapError(g)}},configure:function(b){return a.setCurrent(b)},track:function(a){a=a||{};if(!a.stack)try{throw Error(a)}catch(b){a=b}c("direct",a)},watch:function(a,e){return function(){try{var f=Array.prototype.slice.call(arguments,0);return a.apply(e||this,f)}catch(g){throw c("catch",g),b.wrapError(g)}}},watchAll:function(a){var e=Array.prototype.slice.call(arguments,1),f;for(f in a)"function"===typeof a[f]&&(b.contains(e,f)||function(){var e=a[f];a[f]=function(){try{var a=Array.prototype.slice.call(arguments,0);return e.apply(this,a)}catch(d){throw c("catch",d),b.wrapError(d)}}}());return a},version:"2.1.6"}},l,t,q,r,s,v,w,n,x,y,z,m,h,p);h.trackJs=l.reveal()}})(window,document);window.Modernizr=function(a,b,c){function x(a){i.cssText=a}function y(a,b){return x(prefixes.join(a+";")+(b||""))}function z(a,b){return typeof a===b}function A(a,b){return!!~(""+a).indexOf(b)}function B(a,b){for(var d in a){var e=a[d];if(!A(e,"-")&&i[e]!==c)return b=="pfx"?e:!0}return!1}function C(a,b,d){for(var e in a){var f=b[a[e]];if(f!==c)return d===!1?a[e]:z(f,"function")?f.bind(d||b):f}return!1}function D(a,b,c){var d=a.charAt(0).toUpperCase()+a.slice(1),e=(a+" "+n.join(d+" ")+d).split(" ");return z(b,"string")||z(b,"undefined")?B(e,b):(e=(a+" "+o.join(d+" ")+d).split(" "),C(e,b,c))}function E(){e.input=function(c){for(var d=0,e=c.length;d<e;d++)r[c[d]]=c[d]in j;return r.list&&(r.list=!!b.createElement("datalist")&&!!a.HTMLDataListElement),r}("autocomplete autofocus list placeholder max min multiple pattern required step".split(" ")),e.inputtypes=function(a){for(var d=0,e,g,h,i=a.length;d<i;d++)j.setAttribute("type",g=a[d]),e=j.type!=="text",e&&(j.value=k,j.style.cssText="position:absolute;visibility:hidden;",/^range$/.test(g)&&j.style.WebkitAppearance!==c?(f.appendChild(j),h=b.defaultView,e=h.getComputedStyle&&h.getComputedStyle(j,null).WebkitAppearance!=="textfield"&&j.offsetHeight!==0,f.removeChild(j)):/^(search|tel)$/.test(g)||(/^(url|email)$/.test(g)?e=j.checkValidity&&j.checkValidity()===!1:e=j.value!=k)),q[a[d]]=!!e;return q}("search tel url email datetime date month week time datetime-local number range color".split(" "))}var d="2.7.1",e={},f=b.documentElement,g="modernizr",h=b.createElement(g),i=h.style,j=b.createElement("input"),k=":)",l={}.toString,m="Webkit Moz O ms",n=m.split(" "),o=m.toLowerCase().split(" "),p={},q={},r={},s=[],t=s.slice,u,v={}.hasOwnProperty,w;!z(v,"undefined")&&!z(v.call,"undefined")?w=function(a,b){return v.call(a,b)}:w=function(a,b){return b in a&&z(a.constructor.prototype[b],"undefined")},Function.prototype.bind||(Function.prototype.bind=function(b){var c=this;if(typeof c!="function")throw new TypeError;var d=t.call(arguments,1),e=function(){if(this instanceof e){var a=function(){};a.prototype=c.prototype;var f=new a,g=c.apply(f,d.concat(t.call(arguments)));return Object(g)===g?g:f}return c.apply(b,d.concat(t.call(arguments)))};return e}),p.csstransforms=function(){return!!D("transform")};for(var F in p)w(p,F)&&(u=F.toLowerCase(),e[u]=p[F](),s.push((e[u]?"":"no-")+u));return e.input||E(),e.addTest=function(a,b){if(typeof a=="object")for(var d in a)w(a,d)&&e.addTest(d,a[d]);else{a=a.toLowerCase();if(e[a]!==c)return e;b=typeof b=="function"?b():b,typeof enableClasses!="undefined"&&enableClasses&&(f.className+=" "+(b?"":"no-")+a),e[a]=b}return e},x(""),h=j=null,e._version=d,e._domPrefixes=o,e._cssomPrefixes=n,e.testProp=function(a){return B([a])},e.testAllProps=D,e}(this,this.document),function(a,b,c){function d(a){return"[object Function]"==o.call(a)}function e(a){return"string"==typeof a}function f(){}function g(a){return!a||"loaded"==a||"complete"==a||"uninitialized"==a}function h(){var a=p.shift();q=1,a?a.t?m(function(){("c"==a.t?B.injectCss:B.injectJs)(a.s,0,a.a,a.x,a.e,1)},0):(a(),h()):q=0}function i(a,c,d,e,f,i,j){function k(b){if(!o&&g(l.readyState)&&(u.r=o=1,!q&&h(),l.onload=l.onreadystatechange=null,b)){"img"!=a&&m(function(){t.removeChild(l)},50);for(var d in y[c])y[c].hasOwnProperty(d)&&y[c][d].onload()}}var j=j||B.errorTimeout,l=b.createElement(a),o=0,r=0,u={t:d,s:c,e:f,a:i,x:j};1===y[c]&&(r=1,y[c]=[]),"object"==a?l.data=c:(l.src=c,l.type=a),l.width=l.height="0",l.onerror=l.onload=l.onreadystatechange=function(){k.call(this,r)},p.splice(e,0,u),"img"!=a&&(r||2===y[c]?(t.insertBefore(l,s?null:n),m(k,j)):y[c].push(l))}function j(a,b,c,d,f){return q=0,b=b||"j",e(a)?i("c"==b?v:u,a,b,this.i++,c,d,f):(p.splice(this.i++,0,a),1==p.length&&h()),this}function k(){var a=B;return a.loader={load:j,i:0},a}var l=b.documentElement,m=a.setTimeout,n=b.getElementsByTagName("script")[0],o={}.toString,p=[],q=0,r="MozAppearance"in l.style,s=r&&!!b.createRange().compareNode,t=s?l:n.parentNode,l=a.opera&&"[object Opera]"==o.call(a.opera),l=!!b.attachEvent&&!l,u=r?"object":l?"script":"img",v=l?"script":u,w=Array.isArray||function(a){return"[object Array]"==o.call(a)},x=[],y={},z={timeout:function(a,b){return b.length&&(a.timeout=b[0]),a}},A,B;B=function(a){function b(a){var a=a.split("!"),b=x.length,c=a.pop(),d=a.length,c={url:c,origUrl:c,prefixes:a},e,f,g;for(f=0;f<d;f++)g=a[f].split("="),(e=z[g.shift()])&&(c=e(c,g));for(f=0;f<b;f++)c=x[f](c);return c}function g(a,e,f,g,h){var i=b(a),j=i.autoCallback;i.url.split(".").pop().split("?").shift(),i.bypass||(e&&(e=d(e)?e:e[a]||e[g]||e[a.split("/").pop().split("?")[0]]),i.instead?i.instead(a,e,f,g,h):(y[i.url]?i.noexec=!0:y[i.url]=1,f.load(i.url,i.forceCSS||!i.forceJS&&"css"==i.url.split(".").pop().split("?").shift()?"c":c,i.noexec,i.attrs,i.timeout),(d(e)||d(j))&&f.load(function(){k(),e&&e(i.origUrl,h,g),j&&j(i.origUrl,h,g),y[i.url]=2})))}function h(a,b){function c(a,c){if(a){if(e(a))c||(j=function(){var a=[].slice.call(arguments);k.apply(this,a),l()}),g(a,j,b,0,h);else if(Object(a)===a)for(n in m=function(){var b=0,c;for(c in a)a.hasOwnProperty(c)&&b++;return b}(),a)a.hasOwnProperty(n)&&(!c&&!--m&&(d(j)?j=function(){var a=[].slice.call(arguments);k.apply(this,a),l()}:j[n]=function(a){return function(){var b=[].slice.call(arguments);a&&a.apply(this,b),l()}}(k[n])),g(a[n],j,b,n,h))}else!c&&l()}var h=!!a.test,i=a.load||a.both,j=a.callback||f,k=j,l=a.complete||f,m,n;c(h?a.yep:a.nope,!!i),i&&c(i)}var i,j,l=this.yepnope.loader;if(e(a))g(a,0,l,0);else if(w(a))for(i=0;i<a.length;i++)j=a[i],e(j)?g(j,0,l,0):w(j)?B(j):Object(j)===j&&h(j,l);else Object(a)===a&&h(a,l)},B.addPrefix=function(a,b){z[a]=b},B.addFilter=function(a){x.push(a)},B.errorTimeout=1e4,null==b.readyState&&b.addEventListener&&(b.readyState="loading",b.addEventListener("DOMContentLoaded",A=function(){b.removeEventListener("DOMContentLoaded",A,0),b.readyState="complete"},0)),a.yepnope=k(),a.yepnope.executeStack=h,a.yepnope.injectJs=function(a,c,d,e,i,j){var k=b.createElement("script"),l,o,e=e||B.errorTimeout;k.src=a;for(o in d)k.setAttribute(o,d[o]);c=j?h:c||f,k.onreadystatechange=k.onload=function(){!l&&g(k.readyState)&&(l=1,c(),k.onload=k.onreadystatechange=null)},m(function(){l||(l=1,c(1))},e),i?k.onload():n.parentNode.insertBefore(k,n)},a.yepnope.injectCss=function(a,c,d,e,g,i){var e=b.createElement("link"),j,c=i?h:c||f;e.href=a,e.rel="stylesheet",e.type="text/css";for(j in d)e.setAttribute(j,d[j]);g||(n.parentNode.insertBefore(e,n),m(c,0))}}(this,document),Modernizr.load=function(){yepnope.apply(window,[].slice.call(arguments,0))};(function(e,t){var n,r,i=typeof t,o=e.document,a=e.location,s=e.jQuery,u=e.$,l={},c=[],p="1.9.1",f=c.concat,d=c.push,h=c.slice,g=c.indexOf,m=l.toString,y=l.hasOwnProperty,v=p.trim,b=function(e,t){return new b.fn.init(e,t,r)},x=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,w=/\S+/g,T=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,N=/^(?:(<[\w\W]+>)[^>]*|#([\w-]*))$/,C=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,k=/^[\],:{}\s]*$/,E=/(?:^|:|,)(?:\s*\[)+/g,S=/\\(?:["\\\/bfnrt]|u[\da-fA-F]{4})/g,A=/"[^"\\\r\n]*"|true|false|null|-?(?:\d+\.|)\d+(?:[eE][+-]?\d+|)/g,j=/^-ms-/,D=/-([\da-z])/gi,L=function(e,t){return t.toUpperCase()},H=function(e){(o.addEventListener||"load"===e.type||"complete"===o.readyState)&&(q(),b.ready())},q=function(){o.addEventListener?(o.removeEventListener("DOMContentLoaded",H,!1),e.removeEventListener("load",H,!1)):(o.detachEvent("onreadystatechange",H),e.detachEvent("onload",H))};b.fn=b.prototype={jquery:p,constructor:b,init:function(e,n,r){var i,a;if(!e)return this;if("string"==typeof e){if(i="<"===e.charAt(0)&&">"===e.charAt(e.length-1)&&e.length>=3?[null,e,null]:N.exec(e),!i||!i[1]&&n)return!n||n.jquery?(n||r).find(e):this.constructor(n).find(e);if(i[1]){if(n=n instanceof b?n[0]:n,b.merge(this,b.parseHTML(i[1],n&&n.nodeType?n.ownerDocument||n:o,!0)),C.test(i[1])&&b.isPlainObject(n))for(i in n)b.isFunction(this[i])?this[i](n[i]):this.attr(i,n[i]);return this}if(a=o.getElementById(i[2]),a&&a.parentNode){if(a.id!==i[2])return r.find(e);this.length=1,this[0]=a}return this.context=o,this.selector=e,this}return e.nodeType?(this.context=this[0]=e,this.length=1,this):b.isFunction(e)?r.ready(e):(e.selector!==t&&(this.selector=e.selector,this.context=e.context),b.makeArray(e,this))},selector:"",length:0,size:function(){return this.length},toArray:function(){return h.call(this)},get:function(e){return null==e?this.toArray():0>e?this[this.length+e]:this[e]},pushStack:function(e){var t=b.merge(this.constructor(),e);return t.prevObject=this,t.context=this.context,t},each:function(e,t){return b.each(this,e,t)},ready:function(e){return b.ready.promise().done(e),this},slice:function(){return this.pushStack(h.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(e){var t=this.length,n=+e+(0>e?t:0);return this.pushStack(n>=0&&t>n?[this[n]]:[])},map:function(e){return this.pushStack(b.map(this,function(t,n){return e.call(t,n,t)}))},end:function(){return this.prevObject||this.constructor(null)},push:d,sort:[].sort,splice:[].splice},b.fn.init.prototype=b.fn,b.extend=b.fn.extend=function(){var e,n,r,i,o,a,s=arguments[0]||{},u=1,l=arguments.length,c=!1;for("boolean"==typeof s&&(c=s,s=arguments[1]||{},u=2),"object"==typeof s||b.isFunction(s)||(s={}),l===u&&(s=this,--u);l>u;u++)if(null!=(o=arguments[u]))for(i in o)e=s[i],r=o[i],s!==r&&(c&&r&&(b.isPlainObject(r)||(n=b.isArray(r)))?(n?(n=!1,a=e&&b.isArray(e)?e:[]):a=e&&b.isPlainObject(e)?e:{},s[i]=b.extend(c,a,r)):r!==t&&(s[i]=r));return s},b.extend({noConflict:function(t){return e.$===b&&(e.$=u),t&&e.jQuery===b&&(e.jQuery=s),b},isReady:!1,readyWait:1,holdReady:function(e){e?b.readyWait++:b.ready(!0)},ready:function(e){if(e===!0?!--b.readyWait:!b.isReady){if(!o.body)return setTimeout(b.ready);b.isReady=!0,e!==!0&&--b.readyWait>0||(n.resolveWith(o,[b]),b.fn.trigger&&b(o).trigger("ready").off("ready"))}},isFunction:function(e){return"function"===b.type(e)},isArray:Array.isArray||function(e){return"array"===b.type(e)},isWindow:function(e){return null!=e&&e==e.window},isNumeric:function(e){return!isNaN(parseFloat(e))&&isFinite(e)},type:function(e){return null==e?e+"":"object"==typeof e||"function"==typeof e?l[m.call(e)]||"object":typeof e},isPlainObject:function(e){if(!e||"object"!==b.type(e)||e.nodeType||b.isWindow(e))return!1;try{if(e.constructor&&!y.call(e,"constructor")&&!y.call(e.constructor.prototype,"isPrototypeOf"))return!1}catch(n){return!1}var r;for(r in e);return r===t||y.call(e,r)},isEmptyObject:function(e){var t;for(t in e)return!1;return!0},error:function(e){throw Error(e)},parseHTML:function(e,t,n){if(!e||"string"!=typeof e)return null;"boolean"==typeof t&&(n=t,t=!1),t=t||o;var r=C.exec(e),i=!n&&[];return r?[t.createElement(r[1])]:(r=b.buildFragment([e],t,i),i&&b(i).remove(),b.merge([],r.childNodes))},parseJSON:function(n){return e.JSON&&e.JSON.parse?e.JSON.parse(n):null===n?n:"string"==typeof n&&(n=b.trim(n),n&&k.test(n.replace(S,"@").replace(A,"]").replace(E,"")))?Function("return "+n)():(b.error("Invalid JSON: "+n),t)},parseXML:function(n){var r,i;if(!n||"string"!=typeof n)return null;try{e.DOMParser?(i=new DOMParser,r=i.parseFromString(n,"text/xml")):(r=new ActiveXObject("Microsoft.XMLDOM"),r.async="false",r.loadXML(n))}catch(o){r=t}return r&&r.documentElement&&!r.getElementsByTagName("parsererror").length||b.error("Invalid XML: "+n),r},noop:function(){},globalEval:function(t){t&&b.trim(t)&&(e.execScript||function(t){e.eval.call(e,t)})(t)},camelCase:function(e){return e.replace(j,"ms-").replace(D,L)},nodeName:function(e,t){return e.nodeName&&e.nodeName.toLowerCase()===t.toLowerCase()},each:function(e,t,n){var r,i=0,o=e.length,a=M(e);if(n){if(a){for(;o>i;i++)if(r=t.apply(e[i],n),r===!1)break}else for(i in e)if(r=t.apply(e[i],n),r===!1)break
}else if(a){for(;o>i;i++)if(r=t.call(e[i],i,e[i]),r===!1)break}else for(i in e)if(r=t.call(e[i],i,e[i]),r===!1)break;return e},trim:v&&!v.call("﻿ ")?function(e){return null==e?"":v.call(e)}:function(e){return null==e?"":(e+"").replace(T,"")},makeArray:function(e,t){var n=t||[];return null!=e&&(M(Object(e))?b.merge(n,"string"==typeof e?[e]:e):d.call(n,e)),n},inArray:function(e,t,n){var r;if(t){if(g)return g.call(t,e,n);for(r=t.length,n=n?0>n?Math.max(0,r+n):n:0;r>n;n++)if(n in t&&t[n]===e)return n}return-1},merge:function(e,n){var r=n.length,i=e.length,o=0;if("number"==typeof r)for(;r>o;o++)e[i++]=n[o];else while(n[o]!==t)e[i++]=n[o++];return e.length=i,e},grep:function(e,t,n){var r,i=[],o=0,a=e.length;for(n=!!n;a>o;o++)r=!!t(e[o],o),n!==r&&i.push(e[o]);return i},map:function(e,t,n){var r,i=0,o=e.length,a=M(e),s=[];if(a)for(;o>i;i++)r=t(e[i],i,n),null!=r&&(s[s.length]=r);else for(i in e)r=t(e[i],i,n),null!=r&&(s[s.length]=r);return f.apply([],s)},guid:1,proxy:function(e,n){var r,i,o;return"string"==typeof n&&(o=e[n],n=e,e=o),b.isFunction(e)?(r=h.call(arguments,2),i=function(){return e.apply(n||this,r.concat(h.call(arguments)))},i.guid=e.guid=e.guid||b.guid++,i):t},access:function(e,n,r,i,o,a,s){var u=0,l=e.length,c=null==r;if("object"===b.type(r)){o=!0;for(u in r)b.access(e,n,u,r[u],!0,a,s)}else if(i!==t&&(o=!0,b.isFunction(i)||(s=!0),c&&(s?(n.call(e,i),n=null):(c=n,n=function(e,t,n){return c.call(b(e),n)})),n))for(;l>u;u++)n(e[u],r,s?i:i.call(e[u],u,n(e[u],r)));return o?e:c?n.call(e):l?n(e[0],r):a},now:function(){return(new Date).getTime()}}),b.ready.promise=function(t){if(!n)if(n=b.Deferred(),"complete"===o.readyState)setTimeout(b.ready);else if(o.addEventListener)o.addEventListener("DOMContentLoaded",H,!1),e.addEventListener("load",H,!1);else{o.attachEvent("onreadystatechange",H),e.attachEvent("onload",H);var r=!1;try{r=null==e.frameElement&&o.documentElement}catch(i){}r&&r.doScroll&&function a(){if(!b.isReady){try{r.doScroll("left")}catch(e){return setTimeout(a,50)}q(),b.ready()}}()}return n.promise(t)},b.each("Boolean Number String Function Array Date RegExp Object Error".split(" "),function(e,t){l["[object "+t+"]"]=t.toLowerCase()});function M(e){var t=e.length,n=b.type(e);return b.isWindow(e)?!1:1===e.nodeType&&t?!0:"array"===n||"function"!==n&&(0===t||"number"==typeof t&&t>0&&t-1 in e)}r=b(o);var _={};function F(e){var t=_[e]={};return b.each(e.match(w)||[],function(e,n){t[n]=!0}),t}b.Callbacks=function(e){e="string"==typeof e?_[e]||F(e):b.extend({},e);var n,r,i,o,a,s,u=[],l=!e.once&&[],c=function(t){for(r=e.memory&&t,i=!0,a=s||0,s=0,o=u.length,n=!0;u&&o>a;a++)if(u[a].apply(t[0],t[1])===!1&&e.stopOnFalse){r=!1;break}n=!1,u&&(l?l.length&&c(l.shift()):r?u=[]:p.disable())},p={add:function(){if(u){var t=u.length;(function i(t){b.each(t,function(t,n){var r=b.type(n);"function"===r?e.unique&&p.has(n)||u.push(n):n&&n.length&&"string"!==r&&i(n)})})(arguments),n?o=u.length:r&&(s=t,c(r))}return this},remove:function(){return u&&b.each(arguments,function(e,t){var r;while((r=b.inArray(t,u,r))>-1)u.splice(r,1),n&&(o>=r&&o--,a>=r&&a--)}),this},has:function(e){return e?b.inArray(e,u)>-1:!(!u||!u.length)},empty:function(){return u=[],this},disable:function(){return u=l=r=t,this},disabled:function(){return!u},lock:function(){return l=t,r||p.disable(),this},locked:function(){return!l},fireWith:function(e,t){return t=t||[],t=[e,t.slice?t.slice():t],!u||i&&!l||(n?l.push(t):c(t)),this},fire:function(){return p.fireWith(this,arguments),this},fired:function(){return!!i}};return p},b.extend({Deferred:function(e){var t=[["resolve","done",b.Callbacks("once memory"),"resolved"],["reject","fail",b.Callbacks("once memory"),"rejected"],["notify","progress",b.Callbacks("memory")]],n="pending",r={state:function(){return n},always:function(){return i.done(arguments).fail(arguments),this},then:function(){var e=arguments;return b.Deferred(function(n){b.each(t,function(t,o){var a=o[0],s=b.isFunction(e[t])&&e[t];i[o[1]](function(){var e=s&&s.apply(this,arguments);e&&b.isFunction(e.promise)?e.promise().done(n.resolve).fail(n.reject).progress(n.notify):n[a+"With"](this===r?n.promise():this,s?[e]:arguments)})}),e=null}).promise()},promise:function(e){return null!=e?b.extend(e,r):r}},i={};return r.pipe=r.then,b.each(t,function(e,o){var a=o[2],s=o[3];r[o[1]]=a.add,s&&a.add(function(){n=s},t[1^e][2].disable,t[2][2].lock),i[o[0]]=function(){return i[o[0]+"With"](this===i?r:this,arguments),this},i[o[0]+"With"]=a.fireWith}),r.promise(i),e&&e.call(i,i),i},when:function(e){var t=0,n=h.call(arguments),r=n.length,i=1!==r||e&&b.isFunction(e.promise)?r:0,o=1===i?e:b.Deferred(),a=function(e,t,n){return function(r){t[e]=this,n[e]=arguments.length>1?h.call(arguments):r,n===s?o.notifyWith(t,n):--i||o.resolveWith(t,n)}},s,u,l;if(r>1)for(s=Array(r),u=Array(r),l=Array(r);r>t;t++)n[t]&&b.isFunction(n[t].promise)?n[t].promise().done(a(t,l,n)).fail(o.reject).progress(a(t,u,s)):--i;return i||o.resolveWith(l,n),o.promise()}}),b.support=function(){var t,n,r,a,s,u,l,c,p,f,d=o.createElement("div");if(d.setAttribute("className","t"),d.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>",n=d.getElementsByTagName("*"),r=d.getElementsByTagName("a")[0],!n||!r||!n.length)return{};s=o.createElement("select"),l=s.appendChild(o.createElement("option")),a=d.getElementsByTagName("input")[0],r.style.cssText="top:1px;float:left;opacity:.5",t={getSetAttribute:"t"!==d.className,leadingWhitespace:3===d.firstChild.nodeType,tbody:!d.getElementsByTagName("tbody").length,htmlSerialize:!!d.getElementsByTagName("link").length,style:/top/.test(r.getAttribute("style")),hrefNormalized:"/a"===r.getAttribute("href"),opacity:/^0.5/.test(r.style.opacity),cssFloat:!!r.style.cssFloat,checkOn:!!a.value,optSelected:l.selected,enctype:!!o.createElement("form").enctype,html5Clone:"<:nav></:nav>"!==o.createElement("nav").cloneNode(!0).outerHTML,boxModel:"CSS1Compat"===o.compatMode,deleteExpando:!0,noCloneEvent:!0,inlineBlockNeedsLayout:!1,shrinkWrapBlocks:!1,reliableMarginRight:!0,boxSizingReliable:!0,pixelPosition:!1},a.checked=!0,t.noCloneChecked=a.cloneNode(!0).checked,s.disabled=!0,t.optDisabled=!l.disabled;try{delete d.test}catch(h){t.deleteExpando=!1}a=o.createElement("input"),a.setAttribute("value",""),t.input=""===a.getAttribute("value"),a.value="t",a.setAttribute("type","radio"),t.radioValue="t"===a.value,a.setAttribute("checked","t"),a.setAttribute("name","t"),u=o.createDocumentFragment(),u.appendChild(a),t.appendChecked=a.checked,t.checkClone=u.cloneNode(!0).cloneNode(!0).lastChild.checked,d.attachEvent&&(d.attachEvent("onclick",function(){t.noCloneEvent=!1}),d.cloneNode(!0).click());for(f in{submit:!0,change:!0,focusin:!0})d.setAttribute(c="on"+f,"t"),t[f+"Bubbles"]=c in e||d.attributes[c].expando===!1;return d.style.backgroundClip="content-box",d.cloneNode(!0).style.backgroundClip="",t.clearCloneStyle="content-box"===d.style.backgroundClip,b(function(){var n,r,a,s="padding:0;margin:0;border:0;display:block;box-sizing:content-box;-moz-box-sizing:content-box;-webkit-box-sizing:content-box;",u=o.getElementsByTagName("body")[0];u&&(n=o.createElement("div"),n.style.cssText="border:0;width:0;height:0;position:absolute;top:0;left:-9999px;margin-top:1px",u.appendChild(n).appendChild(d),d.innerHTML="<table><tr><td></td><td>t</td></tr></table>",a=d.getElementsByTagName("td"),a[0].style.cssText="padding:0;margin:0;border:0;display:none",p=0===a[0].offsetHeight,a[0].style.display="",a[1].style.display="none",t.reliableHiddenOffsets=p&&0===a[0].offsetHeight,d.innerHTML="",d.style.cssText="box-sizing:border-box;-moz-box-sizing:border-box;-webkit-box-sizing:border-box;padding:1px;border:1px;display:block;width:4px;margin-top:1%;position:absolute;top:1%;",t.boxSizing=4===d.offsetWidth,t.doesNotIncludeMarginInBodyOffset=1!==u.offsetTop,e.getComputedStyle&&(t.pixelPosition="1%"!==(e.getComputedStyle(d,null)||{}).top,t.boxSizingReliable="4px"===(e.getComputedStyle(d,null)||{width:"4px"}).width,r=d.appendChild(o.createElement("div")),r.style.cssText=d.style.cssText=s,r.style.marginRight=r.style.width="0",d.style.width="1px",t.reliableMarginRight=!parseFloat((e.getComputedStyle(r,null)||{}).marginRight)),typeof d.style.zoom!==i&&(d.innerHTML="",d.style.cssText=s+"width:1px;padding:1px;display:inline;zoom:1",t.inlineBlockNeedsLayout=3===d.offsetWidth,d.style.display="block",d.innerHTML="<div></div>",d.firstChild.style.width="5px",t.shrinkWrapBlocks=3!==d.offsetWidth,t.inlineBlockNeedsLayout&&(u.style.zoom=1)),u.removeChild(n),n=d=a=r=null)}),n=s=u=l=r=a=null,t}();var O=/(?:\{[\s\S]*\}|\[[\s\S]*\])$/,B=/([A-Z])/g;function P(e,n,r,i){if(b.acceptData(e)){var o,a,s=b.expando,u="string"==typeof n,l=e.nodeType,p=l?b.cache:e,f=l?e[s]:e[s]&&s;if(f&&p[f]&&(i||p[f].data)||!u||r!==t)return f||(l?e[s]=f=c.pop()||b.guid++:f=s),p[f]||(p[f]={},l||(p[f].toJSON=b.noop)),("object"==typeof n||"function"==typeof n)&&(i?p[f]=b.extend(p[f],n):p[f].data=b.extend(p[f].data,n)),o=p[f],i||(o.data||(o.data={}),o=o.data),r!==t&&(o[b.camelCase(n)]=r),u?(a=o[n],null==a&&(a=o[b.camelCase(n)])):a=o,a}}function R(e,t,n){if(b.acceptData(e)){var r,i,o,a=e.nodeType,s=a?b.cache:e,u=a?e[b.expando]:b.expando;if(s[u]){if(t&&(o=n?s[u]:s[u].data)){b.isArray(t)?t=t.concat(b.map(t,b.camelCase)):t in o?t=[t]:(t=b.camelCase(t),t=t in o?[t]:t.split(" "));for(r=0,i=t.length;i>r;r++)delete o[t[r]];if(!(n?$:b.isEmptyObject)(o))return}(n||(delete s[u].data,$(s[u])))&&(a?b.cleanData([e],!0):b.support.deleteExpando||s!=s.window?delete s[u]:s[u]=null)}}}b.extend({cache:{},expando:"jQuery"+(p+Math.random()).replace(/\D/g,""),noData:{embed:!0,object:"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000",applet:!0},hasData:function(e){return e=e.nodeType?b.cache[e[b.expando]]:e[b.expando],!!e&&!$(e)},data:function(e,t,n){return P(e,t,n)},removeData:function(e,t){return R(e,t)},_data:function(e,t,n){return P(e,t,n,!0)},_removeData:function(e,t){return R(e,t,!0)},acceptData:function(e){if(e.nodeType&&1!==e.nodeType&&9!==e.nodeType)return!1;var t=e.nodeName&&b.noData[e.nodeName.toLowerCase()];return!t||t!==!0&&e.getAttribute("classid")===t}}),b.fn.extend({data:function(e,n){var r,i,o=this[0],a=0,s=null;if(e===t){if(this.length&&(s=b.data(o),1===o.nodeType&&!b._data(o,"parsedAttrs"))){for(r=o.attributes;r.length>a;a++)i=r[a].name,i.indexOf("data-")||(i=b.camelCase(i.slice(5)),W(o,i,s[i]));b._data(o,"parsedAttrs",!0)}return s}return"object"==typeof e?this.each(function(){b.data(this,e)}):b.access(this,function(n){return n===t?o?W(o,e,b.data(o,e)):null:(this.each(function(){b.data(this,e,n)}),t)},null,n,arguments.length>1,null,!0)},removeData:function(e){return this.each(function(){b.removeData(this,e)})}});function W(e,n,r){if(r===t&&1===e.nodeType){var i="data-"+n.replace(B,"-$1").toLowerCase();if(r=e.getAttribute(i),"string"==typeof r){try{r="true"===r?!0:"false"===r?!1:"null"===r?null:+r+""===r?+r:O.test(r)?b.parseJSON(r):r}catch(o){}b.data(e,n,r)}else r=t}return r}function $(e){var t;for(t in e)if(("data"!==t||!b.isEmptyObject(e[t]))&&"toJSON"!==t)return!1;return!0}b.extend({queue:function(e,n,r){var i;return e?(n=(n||"fx")+"queue",i=b._data(e,n),r&&(!i||b.isArray(r)?i=b._data(e,n,b.makeArray(r)):i.push(r)),i||[]):t},dequeue:function(e,t){t=t||"fx";var n=b.queue(e,t),r=n.length,i=n.shift(),o=b._queueHooks(e,t),a=function(){b.dequeue(e,t)};"inprogress"===i&&(i=n.shift(),r--),o.cur=i,i&&("fx"===t&&n.unshift("inprogress"),delete o.stop,i.call(e,a,o)),!r&&o&&o.empty.fire()},_queueHooks:function(e,t){var n=t+"queueHooks";return b._data(e,n)||b._data(e,n,{empty:b.Callbacks("once memory").add(function(){b._removeData(e,t+"queue"),b._removeData(e,n)})})}}),b.fn.extend({queue:function(e,n){var r=2;return"string"!=typeof e&&(n=e,e="fx",r--),r>arguments.length?b.queue(this[0],e):n===t?this:this.each(function(){var t=b.queue(this,e,n);b._queueHooks(this,e),"fx"===e&&"inprogress"!==t[0]&&b.dequeue(this,e)})},dequeue:function(e){return this.each(function(){b.dequeue(this,e)})},delay:function(e,t){return e=b.fx?b.fx.speeds[e]||e:e,t=t||"fx",this.queue(t,function(t,n){var r=setTimeout(t,e);n.stop=function(){clearTimeout(r)}})},clearQueue:function(e){return this.queue(e||"fx",[])},promise:function(e,n){var r,i=1,o=b.Deferred(),a=this,s=this.length,u=function(){--i||o.resolveWith(a,[a])};"string"!=typeof e&&(n=e,e=t),e=e||"fx";while(s--)r=b._data(a[s],e+"queueHooks"),r&&r.empty&&(i++,r.empty.add(u));return u(),o.promise(n)}});var I,z,X=/[\t\r\n]/g,U=/\r/g,V=/^(?:input|select|textarea|button|object)$/i,Y=/^(?:a|area)$/i,J=/^(?:checked|selected|autofocus|autoplay|async|controls|defer|disabled|hidden|loop|multiple|open|readonly|required|scoped)$/i,G=/^(?:checked|selected)$/i,Q=b.support.getSetAttribute,K=b.support.input;b.fn.extend({attr:function(e,t){return b.access(this,b.attr,e,t,arguments.length>1)},removeAttr:function(e){return this.each(function(){b.removeAttr(this,e)})},prop:function(e,t){return b.access(this,b.prop,e,t,arguments.length>1)},removeProp:function(e){return e=b.propFix[e]||e,this.each(function(){try{this[e]=t,delete this[e]}catch(n){}})},addClass:function(e){var t,n,r,i,o,a=0,s=this.length,u="string"==typeof e&&e;if(b.isFunction(e))return this.each(function(t){b(this).addClass(e.call(this,t,this.className))});if(u)for(t=(e||"").match(w)||[];s>a;a++)if(n=this[a],r=1===n.nodeType&&(n.className?(" "+n.className+" ").replace(X," "):" ")){o=0;while(i=t[o++])0>r.indexOf(" "+i+" ")&&(r+=i+" ");n.className=b.trim(r)}return this},removeClass:function(e){var t,n,r,i,o,a=0,s=this.length,u=0===arguments.length||"string"==typeof e&&e;if(b.isFunction(e))return this.each(function(t){b(this).removeClass(e.call(this,t,this.className))});if(u)for(t=(e||"").match(w)||[];s>a;a++)if(n=this[a],r=1===n.nodeType&&(n.className?(" "+n.className+" ").replace(X," "):"")){o=0;while(i=t[o++])while(r.indexOf(" "+i+" ")>=0)r=r.replace(" "+i+" "," ");n.className=e?b.trim(r):""}return this},toggleClass:function(e,t){var n=typeof e,r="boolean"==typeof t;return b.isFunction(e)?this.each(function(n){b(this).toggleClass(e.call(this,n,this.className,t),t)}):this.each(function(){if("string"===n){var o,a=0,s=b(this),u=t,l=e.match(w)||[];while(o=l[a++])u=r?u:!s.hasClass(o),s[u?"addClass":"removeClass"](o)}else(n===i||"boolean"===n)&&(this.className&&b._data(this,"__className__",this.className),this.className=this.className||e===!1?"":b._data(this,"__className__")||"")})},hasClass:function(e){var t=" "+e+" ",n=0,r=this.length;for(;r>n;n++)if(1===this[n].nodeType&&(" "+this[n].className+" ").replace(X," ").indexOf(t)>=0)return!0;return!1},val:function(e){var n,r,i,o=this[0];{if(arguments.length)return i=b.isFunction(e),this.each(function(n){var o,a=b(this);1===this.nodeType&&(o=i?e.call(this,n,a.val()):e,null==o?o="":"number"==typeof o?o+="":b.isArray(o)&&(o=b.map(o,function(e){return null==e?"":e+""})),r=b.valHooks[this.type]||b.valHooks[this.nodeName.toLowerCase()],r&&"set"in r&&r.set(this,o,"value")!==t||(this.value=o))});if(o)return r=b.valHooks[o.type]||b.valHooks[o.nodeName.toLowerCase()],r&&"get"in r&&(n=r.get(o,"value"))!==t?n:(n=o.value,"string"==typeof n?n.replace(U,""):null==n?"":n)}}}),b.extend({valHooks:{option:{get:function(e){var t=e.attributes.value;return!t||t.specified?e.value:e.text}},select:{get:function(e){var t,n,r=e.options,i=e.selectedIndex,o="select-one"===e.type||0>i,a=o?null:[],s=o?i+1:r.length,u=0>i?s:o?i:0;for(;s>u;u++)if(n=r[u],!(!n.selected&&u!==i||(b.support.optDisabled?n.disabled:null!==n.getAttribute("disabled"))||n.parentNode.disabled&&b.nodeName(n.parentNode,"optgroup"))){if(t=b(n).val(),o)return t;a.push(t)}return a},set:function(e,t){var n=b.makeArray(t);return b(e).find("option").each(function(){this.selected=b.inArray(b(this).val(),n)>=0}),n.length||(e.selectedIndex=-1),n}}},attr:function(e,n,r){var o,a,s,u=e.nodeType;if(e&&3!==u&&8!==u&&2!==u)return typeof e.getAttribute===i?b.prop(e,n,r):(a=1!==u||!b.isXMLDoc(e),a&&(n=n.toLowerCase(),o=b.attrHooks[n]||(J.test(n)?z:I)),r===t?o&&a&&"get"in o&&null!==(s=o.get(e,n))?s:(typeof e.getAttribute!==i&&(s=e.getAttribute(n)),null==s?t:s):null!==r?o&&a&&"set"in o&&(s=o.set(e,r,n))!==t?s:(e.setAttribute(n,r+""),r):(b.removeAttr(e,n),t))},removeAttr:function(e,t){var n,r,i=0,o=t&&t.match(w);if(o&&1===e.nodeType)while(n=o[i++])r=b.propFix[n]||n,J.test(n)?!Q&&G.test(n)?e[b.camelCase("default-"+n)]=e[r]=!1:e[r]=!1:b.attr(e,n,""),e.removeAttribute(Q?n:r)},attrHooks:{type:{set:function(e,t){if(!b.support.radioValue&&"radio"===t&&b.nodeName(e,"input")){var n=e.value;return e.setAttribute("type",t),n&&(e.value=n),t}}}},propFix:{tabindex:"tabIndex",readonly:"readOnly","for":"htmlFor","class":"className",maxlength:"maxLength",cellspacing:"cellSpacing",cellpadding:"cellPadding",rowspan:"rowSpan",colspan:"colSpan",usemap:"useMap",frameborder:"frameBorder",contenteditable:"contentEditable"},prop:function(e,n,r){var i,o,a,s=e.nodeType;if(e&&3!==s&&8!==s&&2!==s)return a=1!==s||!b.isXMLDoc(e),a&&(n=b.propFix[n]||n,o=b.propHooks[n]),r!==t?o&&"set"in o&&(i=o.set(e,r,n))!==t?i:e[n]=r:o&&"get"in o&&null!==(i=o.get(e,n))?i:e[n]},propHooks:{tabIndex:{get:function(e){var n=e.getAttributeNode("tabindex");return n&&n.specified?parseInt(n.value,10):V.test(e.nodeName)||Y.test(e.nodeName)&&e.href?0:t}}}}),z={get:function(e,n){var r=b.prop(e,n),i="boolean"==typeof r&&e.getAttribute(n),o="boolean"==typeof r?K&&Q?null!=i:G.test(n)?e[b.camelCase("default-"+n)]:!!i:e.getAttributeNode(n);return o&&o.value!==!1?n.toLowerCase():t},set:function(e,t,n){return t===!1?b.removeAttr(e,n):K&&Q||!G.test(n)?e.setAttribute(!Q&&b.propFix[n]||n,n):e[b.camelCase("default-"+n)]=e[n]=!0,n}},K&&Q||(b.attrHooks.value={get:function(e,n){var r=e.getAttributeNode(n);return b.nodeName(e,"input")?e.defaultValue:r&&r.specified?r.value:t},set:function(e,n,r){return b.nodeName(e,"input")?(e.defaultValue=n,t):I&&I.set(e,n,r)}}),Q||(I=b.valHooks.button={get:function(e,n){var r=e.getAttributeNode(n);return r&&("id"===n||"name"===n||"coords"===n?""!==r.value:r.specified)?r.value:t},set:function(e,n,r){var i=e.getAttributeNode(r);return i||e.setAttributeNode(i=e.ownerDocument.createAttribute(r)),i.value=n+="","value"===r||n===e.getAttribute(r)?n:t}},b.attrHooks.contenteditable={get:I.get,set:function(e,t,n){I.set(e,""===t?!1:t,n)}},b.each(["width","height"],function(e,n){b.attrHooks[n]=b.extend(b.attrHooks[n],{set:function(e,r){return""===r?(e.setAttribute(n,"auto"),r):t}})})),b.support.hrefNormalized||(b.each(["href","src","width","height"],function(e,n){b.attrHooks[n]=b.extend(b.attrHooks[n],{get:function(e){var r=e.getAttribute(n,2);return null==r?t:r}})}),b.each(["href","src"],function(e,t){b.propHooks[t]={get:function(e){return e.getAttribute(t,4)}}})),b.support.style||(b.attrHooks.style={get:function(e){return e.style.cssText||t},set:function(e,t){return e.style.cssText=t+""}}),b.support.optSelected||(b.propHooks.selected=b.extend(b.propHooks.selected,{get:function(e){var t=e.parentNode;return t&&(t.selectedIndex,t.parentNode&&t.parentNode.selectedIndex),null}})),b.support.enctype||(b.propFix.enctype="encoding"),b.support.checkOn||b.each(["radio","checkbox"],function(){b.valHooks[this]={get:function(e){return null===e.getAttribute("value")?"on":e.value}}}),b.each(["radio","checkbox"],function(){b.valHooks[this]=b.extend(b.valHooks[this],{set:function(e,n){return b.isArray(n)?e.checked=b.inArray(b(e).val(),n)>=0:t}})});var Z=/^(?:input|select|textarea)$/i,et=/^key/,tt=/^(?:mouse|contextmenu)|click/,nt=/^(?:focusinfocus|focusoutblur)$/,rt=/^([^.]*)(?:\.(.+)|)$/;function it(){return!0}function ot(){return!1}b.event={global:{},add:function(e,n,r,o,a){var s,u,l,c,p,f,d,h,g,m,y,v=b._data(e);if(v){r.handler&&(c=r,r=c.handler,a=c.selector),r.guid||(r.guid=b.guid++),(u=v.events)||(u=v.events={}),(f=v.handle)||(f=v.handle=function(e){return typeof b===i||e&&b.event.triggered===e.type?t:b.event.dispatch.apply(f.elem,arguments)},f.elem=e),n=(n||"").match(w)||[""],l=n.length;while(l--)s=rt.exec(n[l])||[],g=y=s[1],m=(s[2]||"").split(".").sort(),p=b.event.special[g]||{},g=(a?p.delegateType:p.bindType)||g,p=b.event.special[g]||{},d=b.extend({type:g,origType:y,data:o,handler:r,guid:r.guid,selector:a,needsContext:a&&b.expr.match.needsContext.test(a),namespace:m.join(".")},c),(h=u[g])||(h=u[g]=[],h.delegateCount=0,p.setup&&p.setup.call(e,o,m,f)!==!1||(e.addEventListener?e.addEventListener(g,f,!1):e.attachEvent&&e.attachEvent("on"+g,f))),p.add&&(p.add.call(e,d),d.handler.guid||(d.handler.guid=r.guid)),a?h.splice(h.delegateCount++,0,d):h.push(d),b.event.global[g]=!0;e=null}},remove:function(e,t,n,r,i){var o,a,s,u,l,c,p,f,d,h,g,m=b.hasData(e)&&b._data(e);if(m&&(c=m.events)){t=(t||"").match(w)||[""],l=t.length;while(l--)if(s=rt.exec(t[l])||[],d=g=s[1],h=(s[2]||"").split(".").sort(),d){p=b.event.special[d]||{},d=(r?p.delegateType:p.bindType)||d,f=c[d]||[],s=s[2]&&RegExp("(^|\\.)"+h.join("\\.(?:.*\\.|)")+"(\\.|$)"),u=o=f.length;while(o--)a=f[o],!i&&g!==a.origType||n&&n.guid!==a.guid||s&&!s.test(a.namespace)||r&&r!==a.selector&&("**"!==r||!a.selector)||(f.splice(o,1),a.selector&&f.delegateCount--,p.remove&&p.remove.call(e,a));u&&!f.length&&(p.teardown&&p.teardown.call(e,h,m.handle)!==!1||b.removeEvent(e,d,m.handle),delete c[d])}else for(d in c)b.event.remove(e,d+t[l],n,r,!0);b.isEmptyObject(c)&&(delete m.handle,b._removeData(e,"events"))}},trigger:function(n,r,i,a){var s,u,l,c,p,f,d,h=[i||o],g=y.call(n,"type")?n.type:n,m=y.call(n,"namespace")?n.namespace.split("."):[];if(l=f=i=i||o,3!==i.nodeType&&8!==i.nodeType&&!nt.test(g+b.event.triggered)&&(g.indexOf(".")>=0&&(m=g.split("."),g=m.shift(),m.sort()),u=0>g.indexOf(":")&&"on"+g,n=n[b.expando]?n:new b.Event(g,"object"==typeof n&&n),n.isTrigger=!0,n.namespace=m.join("."),n.namespace_re=n.namespace?RegExp("(^|\\.)"+m.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,n.result=t,n.target||(n.target=i),r=null==r?[n]:b.makeArray(r,[n]),p=b.event.special[g]||{},a||!p.trigger||p.trigger.apply(i,r)!==!1)){if(!a&&!p.noBubble&&!b.isWindow(i)){for(c=p.delegateType||g,nt.test(c+g)||(l=l.parentNode);l;l=l.parentNode)h.push(l),f=l;f===(i.ownerDocument||o)&&h.push(f.defaultView||f.parentWindow||e)}d=0;while((l=h[d++])&&!n.isPropagationStopped())n.type=d>1?c:p.bindType||g,s=(b._data(l,"events")||{})[n.type]&&b._data(l,"handle"),s&&s.apply(l,r),s=u&&l[u],s&&b.acceptData(l)&&s.apply&&s.apply(l,r)===!1&&n.preventDefault();if(n.type=g,!(a||n.isDefaultPrevented()||p._default&&p._default.apply(i.ownerDocument,r)!==!1||"click"===g&&b.nodeName(i,"a")||!b.acceptData(i)||!u||!i[g]||b.isWindow(i))){f=i[u],f&&(i[u]=null),b.event.triggered=g;try{i[g]()}catch(v){}b.event.triggered=t,f&&(i[u]=f)}return n.result}},dispatch:function(e){e=b.event.fix(e);var n,r,i,o,a,s=[],u=h.call(arguments),l=(b._data(this,"events")||{})[e.type]||[],c=b.event.special[e.type]||{};if(u[0]=e,e.delegateTarget=this,!c.preDispatch||c.preDispatch.call(this,e)!==!1){s=b.event.handlers.call(this,e,l),n=0;while((o=s[n++])&&!e.isPropagationStopped()){e.currentTarget=o.elem,a=0;while((i=o.handlers[a++])&&!e.isImmediatePropagationStopped())(!e.namespace_re||e.namespace_re.test(i.namespace))&&(e.handleObj=i,e.data=i.data,r=((b.event.special[i.origType]||{}).handle||i.handler).apply(o.elem,u),r!==t&&(e.result=r)===!1&&(e.preventDefault(),e.stopPropagation()))}return c.postDispatch&&c.postDispatch.call(this,e),e.result}},handlers:function(e,n){var r,i,o,a,s=[],u=n.delegateCount,l=e.target;if(u&&l.nodeType&&(!e.button||"click"!==e.type))for(;l!=this;l=l.parentNode||this)if(1===l.nodeType&&(l.disabled!==!0||"click"!==e.type)){for(o=[],a=0;u>a;a++)i=n[a],r=i.selector+" ",o[r]===t&&(o[r]=i.needsContext?b(r,this).index(l)>=0:b.find(r,this,null,[l]).length),o[r]&&o.push(i);o.length&&s.push({elem:l,handlers:o})}return n.length>u&&s.push({elem:this,handlers:n.slice(u)}),s},fix:function(e){if(e[b.expando])return e;var t,n,r,i=e.type,a=e,s=this.fixHooks[i];s||(this.fixHooks[i]=s=tt.test(i)?this.mouseHooks:et.test(i)?this.keyHooks:{}),r=s.props?this.props.concat(s.props):this.props,e=new b.Event(a),t=r.length;while(t--)n=r[t],e[n]=a[n];return e.target||(e.target=a.srcElement||o),3===e.target.nodeType&&(e.target=e.target.parentNode),e.metaKey=!!e.metaKey,s.filter?s.filter(e,a):e},props:"altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(e,t){return null==e.which&&(e.which=null!=t.charCode?t.charCode:t.keyCode),e}},mouseHooks:{props:"button buttons clientX clientY fromElement offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(e,n){var r,i,a,s=n.button,u=n.fromElement;return null==e.pageX&&null!=n.clientX&&(i=e.target.ownerDocument||o,a=i.documentElement,r=i.body,e.pageX=n.clientX+(a&&a.scrollLeft||r&&r.scrollLeft||0)-(a&&a.clientLeft||r&&r.clientLeft||0),e.pageY=n.clientY+(a&&a.scrollTop||r&&r.scrollTop||0)-(a&&a.clientTop||r&&r.clientTop||0)),!e.relatedTarget&&u&&(e.relatedTarget=u===e.target?n.toElement:u),e.which||s===t||(e.which=1&s?1:2&s?3:4&s?2:0),e}},special:{load:{noBubble:!0},click:{trigger:function(){return b.nodeName(this,"input")&&"checkbox"===this.type&&this.click?(this.click(),!1):t}},focus:{trigger:function(){if(this!==o.activeElement&&this.focus)try{return this.focus(),!1}catch(e){}},delegateType:"focusin"},blur:{trigger:function(){return this===o.activeElement&&this.blur?(this.blur(),!1):t},delegateType:"focusout"},beforeunload:{postDispatch:function(e){e.result!==t&&(e.originalEvent.returnValue=e.result)}}},simulate:function(e,t,n,r){var i=b.extend(new b.Event,n,{type:e,isSimulated:!0,originalEvent:{}});r?b.event.trigger(i,null,t):b.event.dispatch.call(t,i),i.isDefaultPrevented()&&n.preventDefault()}},b.removeEvent=o.removeEventListener?function(e,t,n){e.removeEventListener&&e.removeEventListener(t,n,!1)}:function(e,t,n){var r="on"+t;e.detachEvent&&(typeof e[r]===i&&(e[r]=null),e.detachEvent(r,n))},b.Event=function(e,n){return this instanceof b.Event?(e&&e.type?(this.originalEvent=e,this.type=e.type,this.isDefaultPrevented=e.defaultPrevented||e.returnValue===!1||e.getPreventDefault&&e.getPreventDefault()?it:ot):this.type=e,n&&b.extend(this,n),this.timeStamp=e&&e.timeStamp||b.now(),this[b.expando]=!0,t):new b.Event(e,n)},b.Event.prototype={isDefaultPrevented:ot,isPropagationStopped:ot,isImmediatePropagationStopped:ot,preventDefault:function(){var e=this.originalEvent;this.isDefaultPrevented=it,e&&(e.preventDefault?e.preventDefault():e.returnValue=!1)},stopPropagation:function(){var e=this.originalEvent;this.isPropagationStopped=it,e&&(e.stopPropagation&&e.stopPropagation(),e.cancelBubble=!0)},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=it,this.stopPropagation()}},b.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(e,t){b.event.special[e]={delegateType:t,bindType:t,handle:function(e){var n,r=this,i=e.relatedTarget,o=e.handleObj;return(!i||i!==r&&!b.contains(r,i))&&(e.type=o.origType,n=o.handler.apply(this,arguments),e.type=t),n}}}),b.support.submitBubbles||(b.event.special.submit={setup:function(){return b.nodeName(this,"form")?!1:(b.event.add(this,"click._submit keypress._submit",function(e){var n=e.target,r=b.nodeName(n,"input")||b.nodeName(n,"button")?n.form:t;r&&!b._data(r,"submitBubbles")&&(b.event.add(r,"submit._submit",function(e){e._submit_bubble=!0}),b._data(r,"submitBubbles",!0))}),t)},postDispatch:function(e){e._submit_bubble&&(delete e._submit_bubble,this.parentNode&&!e.isTrigger&&b.event.simulate("submit",this.parentNode,e,!0))},teardown:function(){return b.nodeName(this,"form")?!1:(b.event.remove(this,"._submit"),t)}}),b.support.changeBubbles||(b.event.special.change={setup:function(){return Z.test(this.nodeName)?(("checkbox"===this.type||"radio"===this.type)&&(b.event.add(this,"propertychange._change",function(e){"checked"===e.originalEvent.propertyName&&(this._just_changed=!0)}),b.event.add(this,"click._change",function(e){this._just_changed&&!e.isTrigger&&(this._just_changed=!1),b.event.simulate("change",this,e,!0)})),!1):(b.event.add(this,"beforeactivate._change",function(e){var t=e.target;Z.test(t.nodeName)&&!b._data(t,"changeBubbles")&&(b.event.add(t,"change._change",function(e){!this.parentNode||e.isSimulated||e.isTrigger||b.event.simulate("change",this.parentNode,e,!0)}),b._data(t,"changeBubbles",!0))}),t)},handle:function(e){var n=e.target;return this!==n||e.isSimulated||e.isTrigger||"radio"!==n.type&&"checkbox"!==n.type?e.handleObj.handler.apply(this,arguments):t},teardown:function(){return b.event.remove(this,"._change"),!Z.test(this.nodeName)}}),b.support.focusinBubbles||b.each({focus:"focusin",blur:"focusout"},function(e,t){var n=0,r=function(e){b.event.simulate(t,e.target,b.event.fix(e),!0)};b.event.special[t]={setup:function(){0===n++&&o.addEventListener(e,r,!0)},teardown:function(){0===--n&&o.removeEventListener(e,r,!0)}}}),b.fn.extend({on:function(e,n,r,i,o){var a,s;if("object"==typeof e){"string"!=typeof n&&(r=r||n,n=t);for(a in e)this.on(a,n,r,e[a],o);return this}if(null==r&&null==i?(i=n,r=n=t):null==i&&("string"==typeof n?(i=r,r=t):(i=r,r=n,n=t)),i===!1)i=ot;else if(!i)return this;return 1===o&&(s=i,i=function(e){return b().off(e),s.apply(this,arguments)},i.guid=s.guid||(s.guid=b.guid++)),this.each(function(){b.event.add(this,e,i,r,n)})},one:function(e,t,n,r){return this.on(e,t,n,r,1)},off:function(e,n,r){var i,o;if(e&&e.preventDefault&&e.handleObj)return i=e.handleObj,b(e.delegateTarget).off(i.namespace?i.origType+"."+i.namespace:i.origType,i.selector,i.handler),this;if("object"==typeof e){for(o in e)this.off(o,n,e[o]);return this}return(n===!1||"function"==typeof n)&&(r=n,n=t),r===!1&&(r=ot),this.each(function(){b.event.remove(this,e,r,n)})},bind:function(e,t,n){return this.on(e,null,t,n)},unbind:function(e,t){return this.off(e,null,t)},delegate:function(e,t,n,r){return this.on(t,e,n,r)},undelegate:function(e,t,n){return 1===arguments.length?this.off(e,"**"):this.off(t,e||"**",n)},trigger:function(e,t){return this.each(function(){b.event.trigger(e,t,this)})},triggerHandler:function(e,n){var r=this[0];return r?b.event.trigger(e,n,r,!0):t}}),function(e,t){var n,r,i,o,a,s,u,l,c,p,f,d,h,g,m,y,v,x="sizzle"+-new Date,w=e.document,T={},N=0,C=0,k=it(),E=it(),S=it(),A=typeof t,j=1<<31,D=[],L=D.pop,H=D.push,q=D.slice,M=D.indexOf||function(e){var t=0,n=this.length;for(;n>t;t++)if(this[t]===e)return t;return-1},_="[\\x20\\t\\r\\n\\f]",F="(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+",O=F.replace("w","w#"),B="([*^$|!~]?=)",P="\\["+_+"*("+F+")"+_+"*(?:"+B+_+"*(?:(['\"])((?:\\\\.|[^\\\\])*?)\\3|("+O+")|)|)"+_+"*\\]",R=":("+F+")(?:\\(((['\"])((?:\\\\.|[^\\\\])*?)\\3|((?:\\\\.|[^\\\\()[\\]]|"+P.replace(3,8)+")*)|.*)\\)|)",W=RegExp("^"+_+"+|((?:^|[^\\\\])(?:\\\\.)*)"+_+"+$","g"),$=RegExp("^"+_+"*,"+_+"*"),I=RegExp("^"+_+"*([\\x20\\t\\r\\n\\f>+~])"+_+"*"),z=RegExp(R),X=RegExp("^"+O+"$"),U={ID:RegExp("^#("+F+")"),CLASS:RegExp("^\\.("+F+")"),NAME:RegExp("^\\[name=['\"]?("+F+")['\"]?\\]"),TAG:RegExp("^("+F.replace("w","w*")+")"),ATTR:RegExp("^"+P),PSEUDO:RegExp("^"+R),CHILD:RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+_+"*(even|odd|(([+-]|)(\\d*)n|)"+_+"*(?:([+-]|)"+_+"*(\\d+)|))"+_+"*\\)|)","i"),needsContext:RegExp("^"+_+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+_+"*((?:-\\d)?\\d*)"+_+"*\\)|)(?=[^-]|$)","i")},V=/[\x20\t\r\n\f]*[+~]/,Y=/^[^{]+\{\s*\[native code/,J=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,G=/^(?:input|select|textarea|button)$/i,Q=/^h\d$/i,K=/'|\\/g,Z=/\=[\x20\t\r\n\f]*([^'"\]]*)[\x20\t\r\n\f]*\]/g,et=/\\([\da-fA-F]{1,6}[\x20\t\r\n\f]?|.)/g,tt=function(e,t){var n="0x"+t-65536;return n!==n?t:0>n?String.fromCharCode(n+65536):String.fromCharCode(55296|n>>10,56320|1023&n)};try{q.call(w.documentElement.childNodes,0)[0].nodeType}catch(nt){q=function(e){var t,n=[];while(t=this[e++])n.push(t);return n}}function rt(e){return Y.test(e+"")}function it(){var e,t=[];return e=function(n,r){return t.push(n+=" ")>i.cacheLength&&delete e[t.shift()],e[n]=r}}function ot(e){return e[x]=!0,e}function at(e){var t=p.createElement("div");try{return e(t)}catch(n){return!1
}finally{t=null}}function st(e,t,n,r){var i,o,a,s,u,l,f,g,m,v;if((t?t.ownerDocument||t:w)!==p&&c(t),t=t||p,n=n||[],!e||"string"!=typeof e)return n;if(1!==(s=t.nodeType)&&9!==s)return[];if(!d&&!r){if(i=J.exec(e))if(a=i[1]){if(9===s){if(o=t.getElementById(a),!o||!o.parentNode)return n;if(o.id===a)return n.push(o),n}else if(t.ownerDocument&&(o=t.ownerDocument.getElementById(a))&&y(t,o)&&o.id===a)return n.push(o),n}else{if(i[2])return H.apply(n,q.call(t.getElementsByTagName(e),0)),n;if((a=i[3])&&T.getByClassName&&t.getElementsByClassName)return H.apply(n,q.call(t.getElementsByClassName(a),0)),n}if(T.qsa&&!h.test(e)){if(f=!0,g=x,m=t,v=9===s&&e,1===s&&"object"!==t.nodeName.toLowerCase()){l=ft(e),(f=t.getAttribute("id"))?g=f.replace(K,"\\$&"):t.setAttribute("id",g),g="[id='"+g+"'] ",u=l.length;while(u--)l[u]=g+dt(l[u]);m=V.test(e)&&t.parentNode||t,v=l.join(",")}if(v)try{return H.apply(n,q.call(m.querySelectorAll(v),0)),n}catch(b){}finally{f||t.removeAttribute("id")}}}return wt(e.replace(W,"$1"),t,n,r)}a=st.isXML=function(e){var t=e&&(e.ownerDocument||e).documentElement;return t?"HTML"!==t.nodeName:!1},c=st.setDocument=function(e){var n=e?e.ownerDocument||e:w;return n!==p&&9===n.nodeType&&n.documentElement?(p=n,f=n.documentElement,d=a(n),T.tagNameNoComments=at(function(e){return e.appendChild(n.createComment("")),!e.getElementsByTagName("*").length}),T.attributes=at(function(e){e.innerHTML="<select></select>";var t=typeof e.lastChild.getAttribute("multiple");return"boolean"!==t&&"string"!==t}),T.getByClassName=at(function(e){return e.innerHTML="<div class='hidden e'></div><div class='hidden'></div>",e.getElementsByClassName&&e.getElementsByClassName("e").length?(e.lastChild.className="e",2===e.getElementsByClassName("e").length):!1}),T.getByName=at(function(e){e.id=x+0,e.innerHTML="<a name='"+x+"'></a><div name='"+x+"'></div>",f.insertBefore(e,f.firstChild);var t=n.getElementsByName&&n.getElementsByName(x).length===2+n.getElementsByName(x+0).length;return T.getIdNotName=!n.getElementById(x),f.removeChild(e),t}),i.attrHandle=at(function(e){return e.innerHTML="<a href='#'></a>",e.firstChild&&typeof e.firstChild.getAttribute!==A&&"#"===e.firstChild.getAttribute("href")})?{}:{href:function(e){return e.getAttribute("href",2)},type:function(e){return e.getAttribute("type")}},T.getIdNotName?(i.find.ID=function(e,t){if(typeof t.getElementById!==A&&!d){var n=t.getElementById(e);return n&&n.parentNode?[n]:[]}},i.filter.ID=function(e){var t=e.replace(et,tt);return function(e){return e.getAttribute("id")===t}}):(i.find.ID=function(e,n){if(typeof n.getElementById!==A&&!d){var r=n.getElementById(e);return r?r.id===e||typeof r.getAttributeNode!==A&&r.getAttributeNode("id").value===e?[r]:t:[]}},i.filter.ID=function(e){var t=e.replace(et,tt);return function(e){var n=typeof e.getAttributeNode!==A&&e.getAttributeNode("id");return n&&n.value===t}}),i.find.TAG=T.tagNameNoComments?function(e,n){return typeof n.getElementsByTagName!==A?n.getElementsByTagName(e):t}:function(e,t){var n,r=[],i=0,o=t.getElementsByTagName(e);if("*"===e){while(n=o[i++])1===n.nodeType&&r.push(n);return r}return o},i.find.NAME=T.getByName&&function(e,n){return typeof n.getElementsByName!==A?n.getElementsByName(name):t},i.find.CLASS=T.getByClassName&&function(e,n){return typeof n.getElementsByClassName===A||d?t:n.getElementsByClassName(e)},g=[],h=[":focus"],(T.qsa=rt(n.querySelectorAll))&&(at(function(e){e.innerHTML="<select><option selected=''></option></select>",e.querySelectorAll("[selected]").length||h.push("\\["+_+"*(?:checked|disabled|ismap|multiple|readonly|selected|value)"),e.querySelectorAll(":checked").length||h.push(":checked")}),at(function(e){e.innerHTML="<input type='hidden' i=''/>",e.querySelectorAll("[i^='']").length&&h.push("[*^$]="+_+"*(?:\"\"|'')"),e.querySelectorAll(":enabled").length||h.push(":enabled",":disabled"),e.querySelectorAll("*,:x"),h.push(",.*:")})),(T.matchesSelector=rt(m=f.matchesSelector||f.mozMatchesSelector||f.webkitMatchesSelector||f.oMatchesSelector||f.msMatchesSelector))&&at(function(e){T.disconnectedMatch=m.call(e,"div"),m.call(e,"[s!='']:x"),g.push("!=",R)}),h=RegExp(h.join("|")),g=RegExp(g.join("|")),y=rt(f.contains)||f.compareDocumentPosition?function(e,t){var n=9===e.nodeType?e.documentElement:e,r=t&&t.parentNode;return e===r||!(!r||1!==r.nodeType||!(n.contains?n.contains(r):e.compareDocumentPosition&&16&e.compareDocumentPosition(r)))}:function(e,t){if(t)while(t=t.parentNode)if(t===e)return!0;return!1},v=f.compareDocumentPosition?function(e,t){var r;return e===t?(u=!0,0):(r=t.compareDocumentPosition&&e.compareDocumentPosition&&e.compareDocumentPosition(t))?1&r||e.parentNode&&11===e.parentNode.nodeType?e===n||y(w,e)?-1:t===n||y(w,t)?1:0:4&r?-1:1:e.compareDocumentPosition?-1:1}:function(e,t){var r,i=0,o=e.parentNode,a=t.parentNode,s=[e],l=[t];if(e===t)return u=!0,0;if(!o||!a)return e===n?-1:t===n?1:o?-1:a?1:0;if(o===a)return ut(e,t);r=e;while(r=r.parentNode)s.unshift(r);r=t;while(r=r.parentNode)l.unshift(r);while(s[i]===l[i])i++;return i?ut(s[i],l[i]):s[i]===w?-1:l[i]===w?1:0},u=!1,[0,0].sort(v),T.detectDuplicates=u,p):p},st.matches=function(e,t){return st(e,null,null,t)},st.matchesSelector=function(e,t){if((e.ownerDocument||e)!==p&&c(e),t=t.replace(Z,"='$1']"),!(!T.matchesSelector||d||g&&g.test(t)||h.test(t)))try{var n=m.call(e,t);if(n||T.disconnectedMatch||e.document&&11!==e.document.nodeType)return n}catch(r){}return st(t,p,null,[e]).length>0},st.contains=function(e,t){return(e.ownerDocument||e)!==p&&c(e),y(e,t)},st.attr=function(e,t){var n;return(e.ownerDocument||e)!==p&&c(e),d||(t=t.toLowerCase()),(n=i.attrHandle[t])?n(e):d||T.attributes?e.getAttribute(t):((n=e.getAttributeNode(t))||e.getAttribute(t))&&e[t]===!0?t:n&&n.specified?n.value:null},st.error=function(e){throw Error("Syntax error, unrecognized expression: "+e)},st.uniqueSort=function(e){var t,n=[],r=1,i=0;if(u=!T.detectDuplicates,e.sort(v),u){for(;t=e[r];r++)t===e[r-1]&&(i=n.push(r));while(i--)e.splice(n[i],1)}return e};function ut(e,t){var n=t&&e,r=n&&(~t.sourceIndex||j)-(~e.sourceIndex||j);if(r)return r;if(n)while(n=n.nextSibling)if(n===t)return-1;return e?1:-1}function lt(e){return function(t){var n=t.nodeName.toLowerCase();return"input"===n&&t.type===e}}function ct(e){return function(t){var n=t.nodeName.toLowerCase();return("input"===n||"button"===n)&&t.type===e}}function pt(e){return ot(function(t){return t=+t,ot(function(n,r){var i,o=e([],n.length,t),a=o.length;while(a--)n[i=o[a]]&&(n[i]=!(r[i]=n[i]))})})}o=st.getText=function(e){var t,n="",r=0,i=e.nodeType;if(i){if(1===i||9===i||11===i){if("string"==typeof e.textContent)return e.textContent;for(e=e.firstChild;e;e=e.nextSibling)n+=o(e)}else if(3===i||4===i)return e.nodeValue}else for(;t=e[r];r++)n+=o(t);return n},i=st.selectors={cacheLength:50,createPseudo:ot,match:U,find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(e){return e[1]=e[1].replace(et,tt),e[3]=(e[4]||e[5]||"").replace(et,tt),"~="===e[2]&&(e[3]=" "+e[3]+" "),e.slice(0,4)},CHILD:function(e){return e[1]=e[1].toLowerCase(),"nth"===e[1].slice(0,3)?(e[3]||st.error(e[0]),e[4]=+(e[4]?e[5]+(e[6]||1):2*("even"===e[3]||"odd"===e[3])),e[5]=+(e[7]+e[8]||"odd"===e[3])):e[3]&&st.error(e[0]),e},PSEUDO:function(e){var t,n=!e[5]&&e[2];return U.CHILD.test(e[0])?null:(e[4]?e[2]=e[4]:n&&z.test(n)&&(t=ft(n,!0))&&(t=n.indexOf(")",n.length-t)-n.length)&&(e[0]=e[0].slice(0,t),e[2]=n.slice(0,t)),e.slice(0,3))}},filter:{TAG:function(e){return"*"===e?function(){return!0}:(e=e.replace(et,tt).toLowerCase(),function(t){return t.nodeName&&t.nodeName.toLowerCase()===e})},CLASS:function(e){var t=k[e+" "];return t||(t=RegExp("(^|"+_+")"+e+"("+_+"|$)"))&&k(e,function(e){return t.test(e.className||typeof e.getAttribute!==A&&e.getAttribute("class")||"")})},ATTR:function(e,t,n){return function(r){var i=st.attr(r,e);return null==i?"!="===t:t?(i+="","="===t?i===n:"!="===t?i!==n:"^="===t?n&&0===i.indexOf(n):"*="===t?n&&i.indexOf(n)>-1:"$="===t?n&&i.slice(-n.length)===n:"~="===t?(" "+i+" ").indexOf(n)>-1:"|="===t?i===n||i.slice(0,n.length+1)===n+"-":!1):!0}},CHILD:function(e,t,n,r,i){var o="nth"!==e.slice(0,3),a="last"!==e.slice(-4),s="of-type"===t;return 1===r&&0===i?function(e){return!!e.parentNode}:function(t,n,u){var l,c,p,f,d,h,g=o!==a?"nextSibling":"previousSibling",m=t.parentNode,y=s&&t.nodeName.toLowerCase(),v=!u&&!s;if(m){if(o){while(g){p=t;while(p=p[g])if(s?p.nodeName.toLowerCase()===y:1===p.nodeType)return!1;h=g="only"===e&&!h&&"nextSibling"}return!0}if(h=[a?m.firstChild:m.lastChild],a&&v){c=m[x]||(m[x]={}),l=c[e]||[],d=l[0]===N&&l[1],f=l[0]===N&&l[2],p=d&&m.childNodes[d];while(p=++d&&p&&p[g]||(f=d=0)||h.pop())if(1===p.nodeType&&++f&&p===t){c[e]=[N,d,f];break}}else if(v&&(l=(t[x]||(t[x]={}))[e])&&l[0]===N)f=l[1];else while(p=++d&&p&&p[g]||(f=d=0)||h.pop())if((s?p.nodeName.toLowerCase()===y:1===p.nodeType)&&++f&&(v&&((p[x]||(p[x]={}))[e]=[N,f]),p===t))break;return f-=i,f===r||0===f%r&&f/r>=0}}},PSEUDO:function(e,t){var n,r=i.pseudos[e]||i.setFilters[e.toLowerCase()]||st.error("unsupported pseudo: "+e);return r[x]?r(t):r.length>1?(n=[e,e,"",t],i.setFilters.hasOwnProperty(e.toLowerCase())?ot(function(e,n){var i,o=r(e,t),a=o.length;while(a--)i=M.call(e,o[a]),e[i]=!(n[i]=o[a])}):function(e){return r(e,0,n)}):r}},pseudos:{not:ot(function(e){var t=[],n=[],r=s(e.replace(W,"$1"));return r[x]?ot(function(e,t,n,i){var o,a=r(e,null,i,[]),s=e.length;while(s--)(o=a[s])&&(e[s]=!(t[s]=o))}):function(e,i,o){return t[0]=e,r(t,null,o,n),!n.pop()}}),has:ot(function(e){return function(t){return st(e,t).length>0}}),contains:ot(function(e){return function(t){return(t.textContent||t.innerText||o(t)).indexOf(e)>-1}}),lang:ot(function(e){return X.test(e||"")||st.error("unsupported lang: "+e),e=e.replace(et,tt).toLowerCase(),function(t){var n;do if(n=d?t.getAttribute("xml:lang")||t.getAttribute("lang"):t.lang)return n=n.toLowerCase(),n===e||0===n.indexOf(e+"-");while((t=t.parentNode)&&1===t.nodeType);return!1}}),target:function(t){var n=e.location&&e.location.hash;return n&&n.slice(1)===t.id},root:function(e){return e===f},focus:function(e){return e===p.activeElement&&(!p.hasFocus||p.hasFocus())&&!!(e.type||e.href||~e.tabIndex)},enabled:function(e){return e.disabled===!1},disabled:function(e){return e.disabled===!0},checked:function(e){if(!e.nodeName||typeof e.nodeName=="function")return false;var t=e.nodeName.toLowerCase();return"input"===t&&!!e.checked||"option"===t&&!!e.selected},selected:function(e){return e.parentNode&&e.parentNode.selectedIndex,e.selected===!0},empty:function(e){for(e=e.firstChild;e;e=e.nextSibling)if(e.nodeName>"@"||3===e.nodeType||4===e.nodeType)return!1;return!0},parent:function(e){return!i.pseudos.empty(e)},header:function(e){return Q.test(e.nodeName)},input:function(e){return G.test(e.nodeName)},button:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&"button"===e.type||"button"===t},text:function(e){var t;return"input"===e.nodeName.toLowerCase()&&"text"===e.type&&(null==(t=e.getAttribute("type"))||t.toLowerCase()===e.type)},first:pt(function(){return[0]}),last:pt(function(e,t){return[t-1]}),eq:pt(function(e,t,n){return[0>n?n+t:n]}),even:pt(function(e,t){var n=0;for(;t>n;n+=2)e.push(n);return e}),odd:pt(function(e,t){var n=1;for(;t>n;n+=2)e.push(n);return e}),lt:pt(function(e,t,n){var r=0>n?n+t:n;for(;--r>=0;)e.push(r);return e}),gt:pt(function(e,t,n){var r=0>n?n+t:n;for(;t>++r;)e.push(r);return e})}};for(n in{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})i.pseudos[n]=lt(n);for(n in{submit:!0,reset:!0})i.pseudos[n]=ct(n);function ft(e,t){var n,r,o,a,s,u,l,c=E[e+" "];if(c)return t?0:c.slice(0);s=e,u=[],l=i.preFilter;while(s){(!n||(r=$.exec(s)))&&(r&&(s=s.slice(r[0].length)||s),u.push(o=[])),n=!1,(r=I.exec(s))&&(n=r.shift(),o.push({value:n,type:r[0].replace(W," ")}),s=s.slice(n.length));for(a in i.filter)!(r=U[a].exec(s))||l[a]&&!(r=l[a](r))||(n=r.shift(),o.push({value:n,type:a,matches:r}),s=s.slice(n.length));if(!n)break}return t?s.length:s?st.error(e):E(e,u).slice(0)}function dt(e){var t=0,n=e.length,r="";for(;n>t;t++)r+=e[t].value;return r}function ht(e,t,n){var i=t.dir,o=n&&"parentNode"===i,a=C++;return t.first?function(t,n,r){while(t=t[i])if(1===t.nodeType||o)return e(t,n,r)}:function(t,n,s){var u,l,c,p=N+" "+a;if(s){while(t=t[i])if((1===t.nodeType||o)&&e(t,n,s))return!0}else while(t=t[i])if(1===t.nodeType||o)if(c=t[x]||(t[x]={}),(l=c[i])&&l[0]===p){if((u=l[1])===!0||u===r)return u===!0}else if(l=c[i]=[p],l[1]=e(t,n,s)||r,l[1]===!0)return!0}}function gt(e){return e.length>1?function(t,n,r){var i=e.length;while(i--)if(!e[i](t,n,r))return!1;return!0}:e[0]}function mt(e,t,n,r,i){var o,a=[],s=0,u=e.length,l=null!=t;for(;u>s;s++)(o=e[s])&&(!n||n(o,r,i))&&(a.push(o),l&&t.push(s));return a}function yt(e,t,n,r,i,o){return r&&!r[x]&&(r=yt(r)),i&&!i[x]&&(i=yt(i,o)),ot(function(o,a,s,u){var l,c,p,f=[],d=[],h=a.length,g=o||xt(t||"*",s.nodeType?[s]:s,[]),m=!e||!o&&t?g:mt(g,f,e,s,u),y=n?i||(o?e:h||r)?[]:a:m;if(n&&n(m,y,s,u),r){l=mt(y,d),r(l,[],s,u),c=l.length;while(c--)(p=l[c])&&(y[d[c]]=!(m[d[c]]=p))}if(o){if(i||e){if(i){l=[],c=y.length;while(c--)(p=y[c])&&l.push(m[c]=p);i(null,y=[],l,u)}c=y.length;while(c--)(p=y[c])&&(l=i?M.call(o,p):f[c])>-1&&(o[l]=!(a[l]=p))}}else y=mt(y===a?y.splice(h,y.length):y),i?i(null,a,y,u):H.apply(a,y)})}function vt(e){var t,n,r,o=e.length,a=i.relative[e[0].type],s=a||i.relative[" "],u=a?1:0,c=ht(function(e){return e===t},s,!0),p=ht(function(e){return M.call(t,e)>-1},s,!0),f=[function(e,n,r){return!a&&(r||n!==l)||((t=n).nodeType?c(e,n,r):p(e,n,r))}];for(;o>u;u++)if(n=i.relative[e[u].type])f=[ht(gt(f),n)];else{if(n=i.filter[e[u].type].apply(null,e[u].matches),n[x]){for(r=++u;o>r;r++)if(i.relative[e[r].type])break;return yt(u>1&&gt(f),u>1&&dt(e.slice(0,u-1)).replace(W,"$1"),n,r>u&&vt(e.slice(u,r)),o>r&&vt(e=e.slice(r)),o>r&&dt(e))}f.push(n)}return gt(f)}function bt(e,t){var n=0,o=t.length>0,a=e.length>0,s=function(s,u,c,f,d){var h,g,m,y=[],v=0,b="0",x=s&&[],w=null!=d,T=l,C=s||a&&i.find.TAG("*",d&&u.parentNode||u),k=N+=null==T?1:Math.random()||.1;for(w&&(l=u!==p&&u,r=n);null!=(h=C[b]);b++){if(a&&h){g=0;while(m=e[g++])if(m(h,u,c)){f.push(h);break}w&&(N=k,r=++n)}o&&((h=!m&&h)&&v--,s&&x.push(h))}if(v+=b,o&&b!==v){g=0;while(m=t[g++])m(x,y,u,c);if(s){if(v>0)while(b--)x[b]||y[b]||(y[b]=L.call(f));y=mt(y)}H.apply(f,y),w&&!s&&y.length>0&&v+t.length>1&&st.uniqueSort(f)}return w&&(N=k,l=T),x};return o?ot(s):s}s=st.compile=function(e,t){var n,r=[],i=[],o=S[e+" "];if(!o){t||(t=ft(e)),n=t.length;while(n--)o=vt(t[n]),o[x]?r.push(o):i.push(o);o=S(e,bt(i,r))}return o};function xt(e,t,n){var r=0,i=t.length;for(;i>r;r++)st(e,t[r],n);return n}function wt(e,t,n,r){var o,a,u,l,c,p=ft(e);if(!r&&1===p.length){if(a=p[0]=p[0].slice(0),a.length>2&&"ID"===(u=a[0]).type&&9===t.nodeType&&!d&&i.relative[a[1].type]){if(t=i.find.ID(u.matches[0].replace(et,tt),t)[0],!t)return n;e=e.slice(a.shift().value.length)}o=U.needsContext.test(e)?0:a.length;while(o--){if(u=a[o],i.relative[l=u.type])break;if((c=i.find[l])&&(r=c(u.matches[0].replace(et,tt),V.test(a[0].type)&&t.parentNode||t))){if(a.splice(o,1),e=r.length&&dt(a),!e)return H.apply(n,q.call(r,0)),n;break}}}return s(e,p)(r,t,d,n,V.test(e)),n}i.pseudos.nth=i.pseudos.eq;function Tt(){}i.filters=Tt.prototype=i.pseudos,i.setFilters=new Tt,c(),st.attr=b.attr,b.find=st,b.expr=st.selectors,b.expr[":"]=b.expr.pseudos,b.unique=st.uniqueSort,b.text=st.getText,b.isXMLDoc=st.isXML,b.contains=st.contains}(e);var at=/Until$/,st=/^(?:parents|prev(?:Until|All))/,ut=/^.[^:#\[\.,]*$/,lt=b.expr.match.needsContext,ct={children:!0,contents:!0,next:!0,prev:!0};b.fn.extend({find:function(e){var t,n,r,i=this.length;if("string"!=typeof e)return r=this,this.pushStack(b(e).filter(function(){for(t=0;i>t;t++)if(b.contains(r[t],this))return!0}));for(n=[],t=0;i>t;t++)b.find(e,this[t],n);return n=this.pushStack(i>1?b.unique(n):n),n.selector=(this.selector?this.selector+" ":"")+e,n},has:function(e){var t,n=b(e,this),r=n.length;return this.filter(function(){for(t=0;r>t;t++)if(b.contains(this,n[t]))return!0})},not:function(e){return this.pushStack(ft(this,e,!1))},filter:function(e){return this.pushStack(ft(this,e,!0))},is:function(e){return!!e&&("string"==typeof e?lt.test(e)?b(e,this.context).index(this[0])>=0:b.filter(e,this).length>0:this.filter(e).length>0)},closest:function(e,t){var n,r=0,i=this.length,o=[],a=lt.test(e)||"string"!=typeof e?b(e,t||this.context):0;for(;i>r;r++){n=this[r];while(n&&n.ownerDocument&&n!==t&&11!==n.nodeType){if(a?a.index(n)>-1:b.find.matchesSelector(n,e)){o.push(n);break}n=n.parentNode}}return this.pushStack(o.length>1?b.unique(o):o)},index:function(e){return e?"string"==typeof e?b.inArray(this[0],b(e)):b.inArray(e.jquery?e[0]:e,this):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(e,t){var n="string"==typeof e?b(e,t):b.makeArray(e&&e.nodeType?[e]:e),r=b.merge(this.get(),n);return this.pushStack(b.unique(r))},addBack:function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}}),b.fn.andSelf=b.fn.addBack;function pt(e,t){do e=e[t];while(e&&1!==e.nodeType);return e}b.each({parent:function(e){var t=e.parentNode;return t&&11!==t.nodeType?t:null},parents:function(e){return b.dir(e,"parentNode")},parentsUntil:function(e,t,n){return b.dir(e,"parentNode",n)},next:function(e){return pt(e,"nextSibling")},prev:function(e){return pt(e,"previousSibling")},nextAll:function(e){return b.dir(e,"nextSibling")},prevAll:function(e){return b.dir(e,"previousSibling")},nextUntil:function(e,t,n){return b.dir(e,"nextSibling",n)},prevUntil:function(e,t,n){return b.dir(e,"previousSibling",n)},siblings:function(e){return b.sibling((e.parentNode||{}).firstChild,e)},children:function(e){return b.sibling(e.firstChild)},contents:function(e){return b.nodeName(e,"iframe")?e.contentDocument||e.contentWindow.document:b.merge([],e.childNodes)}},function(e,t){b.fn[e]=function(n,r){var i=b.map(this,t,n);return at.test(e)||(r=n),r&&"string"==typeof r&&(i=b.filter(r,i)),i=this.length>1&&!ct[e]?b.unique(i):i,this.length>1&&st.test(e)&&(i=i.reverse()),this.pushStack(i)}}),b.extend({filter:function(e,t,n){return n&&(e=":not("+e+")"),1===t.length?b.find.matchesSelector(t[0],e)?[t[0]]:[]:b.find.matches(e,t)},dir:function(e,n,r){var i=[],o=e[n];while(o&&9!==o.nodeType&&(r===t||1!==o.nodeType||!b(o).is(r)))1===o.nodeType&&i.push(o),o=o[n];return i},sibling:function(e,t){var n=[];for(;e;e=e.nextSibling)1===e.nodeType&&e!==t&&n.push(e);return n}});function ft(e,t,n){if(t=t||0,b.isFunction(t))return b.grep(e,function(e,r){var i=!!t.call(e,r,e);return i===n});if(t.nodeType)return b.grep(e,function(e){return e===t===n});if("string"==typeof t){var r=b.grep(e,function(e){return 1===e.nodeType});if(ut.test(t))return b.filter(t,r,!n);t=b.filter(t,r)}return b.grep(e,function(e){return b.inArray(e,t)>=0===n})}function dt(e){var t=ht.split("|"),n=e.createDocumentFragment();if(n.createElement)while(t.length)n.createElement(t.pop());return n}var ht="abbr|article|aside|audio|bdi|canvas|data|datalist|details|figcaption|figure|footer|header|hgroup|mark|meter|nav|output|progress|section|summary|time|video",gt=/ jQuery\d+="(?:null|\d+)"/g,mt=RegExp("<(?:"+ht+")[\\s/>]","i"),yt=/^\s+/,vt=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,bt=/<([\w:]+)/,xt=/<tbody/i,wt=/<|&#?\w+;/,Tt=/<(?:script|style|link)/i,Nt=/^(?:checkbox|radio)$/i,Ct=/checked\s*(?:[^=]|=\s*.checked.)/i,kt=/^$|\/(?:java|ecma)script/i,Et=/^true\/(.*)/,St=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g,At={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],area:[1,"<map>","</map>"],param:[1,"<object>","</object>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:b.support.htmlSerialize?[0,"",""]:[1,"X<div>","</div>"]},jt=dt(o),Dt=jt.appendChild(o.createElement("div"));At.optgroup=At.option,At.tbody=At.tfoot=At.colgroup=At.caption=At.thead,At.th=At.td,b.fn.extend({text:function(e){return b.access(this,function(e){return e===t?b.text(this):this.empty().append((this[0]&&this[0].ownerDocument||o).createTextNode(e))},null,e,arguments.length)},wrapAll:function(e){if(b.isFunction(e))return this.each(function(t){b(this).wrapAll(e.call(this,t))});if(this[0]){var t=b(e,this[0].ownerDocument).eq(0).clone(!0);this[0].parentNode&&t.insertBefore(this[0]),t.map(function(){var e=this;while(e.firstChild&&1===e.firstChild.nodeType)e=e.firstChild;return e}).append(this)}return this},wrapInner:function(e){return b.isFunction(e)?this.each(function(t){b(this).wrapInner(e.call(this,t))}):this.each(function(){var t=b(this),n=t.contents();n.length?n.wrapAll(e):t.append(e)})},wrap:function(e){var t=b.isFunction(e);return this.each(function(n){b(this).wrapAll(t?e.call(this,n):e)})},unwrap:function(){return this.parent().each(function(){b.nodeName(this,"body")||b(this).replaceWith(this.childNodes)}).end()},append:function(){return this.domManip(arguments,!0,function(e){(1===this.nodeType||11===this.nodeType||9===this.nodeType)&&this.appendChild(e)})},prepend:function(){return this.domManip(arguments,!0,function(e){(1===this.nodeType||11===this.nodeType||9===this.nodeType)&&this.insertBefore(e,this.firstChild)})},before:function(){return this.domManip(arguments,!1,function(e){this.parentNode&&this.parentNode.insertBefore(e,this)})},after:function(){return this.domManip(arguments,!1,function(e){this.parentNode&&this.parentNode.insertBefore(e,this.nextSibling)})},remove:function(e,t){var n,r=0;for(;null!=(n=this[r]);r++)(!e||b.filter(e,[n]).length>0)&&(t||1!==n.nodeType||b.cleanData(Ot(n)),n.parentNode&&(t&&b.contains(n.ownerDocument,n)&&Mt(Ot(n,"script")),n.parentNode.removeChild(n)));return this},empty:function(){var e,t=0;for(;null!=(e=this[t]);t++){1===e.nodeType&&b.cleanData(Ot(e,!1));while(e.firstChild)e.removeChild(e.firstChild);e.options&&b.nodeName(e,"select")&&(e.options.length=0)}return this},clone:function(e,t){return e=null==e?!1:e,t=null==t?e:t,this.map(function(){return b.clone(this,e,t)})},html:function(e){return b.access(this,function(e){var n=this[0]||{},r=0,i=this.length;if(e===t)return 1===n.nodeType?n.innerHTML.replace(gt,""):t;if(!("string"!=typeof e||Tt.test(e)||!b.support.htmlSerialize&&mt.test(e)||!b.support.leadingWhitespace&&yt.test(e)||At[(bt.exec(e)||["",""])[1].toLowerCase()])){e=e.replace(vt,"<$1></$2>");try{for(;i>r;r++)n=this[r]||{},1===n.nodeType&&(b.cleanData(Ot(n,!1)),n.innerHTML=e);n=0}catch(o){}}n&&this.empty().append(e)},null,e,arguments.length)},replaceWith:function(e){var t=b.isFunction(e);return t||"string"==typeof e||(e=b(e).not(this).detach()),this.domManip([e],!0,function(e){var t=this.nextSibling,n=this.parentNode;n&&(b(this).remove(),n.insertBefore(e,t))})},detach:function(e){return this.remove(e,!0)},domManip:function(e,n,r){e=f.apply([],e);var i,o,a,s,u,l,c=0,p=this.length,d=this,h=p-1,g=e[0],m=b.isFunction(g);if(m||!(1>=p||"string"!=typeof g||b.support.checkClone)&&Ct.test(g))return this.each(function(i){var o=d.eq(i);m&&(e[0]=g.call(this,i,n?o.html():t)),o.domManip(e,n,r)});if(p&&(l=b.buildFragment(e,this[0].ownerDocument,!1,this),i=l.firstChild,1===l.childNodes.length&&(l=i),i)){for(n=n&&b.nodeName(i,"tr"),s=b.map(Ot(l,"script"),Ht),a=s.length;p>c;c++)o=l,c!==h&&(o=b.clone(o,!0,!0),a&&b.merge(s,Ot(o,"script"))),r.call(n&&b.nodeName(this[c],"table")?Lt(this[c],"tbody"):this[c],o,c);if(a)for(u=s[s.length-1].ownerDocument,b.map(s,qt),c=0;a>c;c++)o=s[c],kt.test(o.type||"")&&!b._data(o,"globalEval")&&b.contains(u,o)&&(o.src?b.ajax({url:o.src,type:"GET",dataType:"script",async:!1,global:!1,"throws":!0}):b.globalEval((o.text||o.textContent||o.innerHTML||"").replace(St,"")));l=i=null}return this}});function Lt(e,t){return e.getElementsByTagName(t)[0]||e.appendChild(e.ownerDocument.createElement(t))}function Ht(e){var t=e.getAttributeNode("type");return e.type=(t&&t.specified)+"/"+e.type,e}function qt(e){var t=Et.exec(e.type);return t?e.type=t[1]:e.removeAttribute("type"),e}function Mt(e,t){var n,r=0;for(;null!=(n=e[r]);r++)b._data(n,"globalEval",!t||b._data(t[r],"globalEval"))}function _t(e,t){if(1===t.nodeType&&b.hasData(e)){var n,r,i,o=b._data(e),a=b._data(t,o),s=o.events;if(s){delete a.handle,a.events={};for(n in s)for(r=0,i=s[n].length;i>r;r++)b.event.add(t,n,s[n][r])}a.data&&(a.data=b.extend({},a.data))}}function Ft(e,t){var n,r,i;if(1===t.nodeType){if(n=t.nodeName.toLowerCase(),!b.support.noCloneEvent&&t[b.expando]){i=b._data(t);for(r in i.events)b.removeEvent(t,r,i.handle);t.removeAttribute(b.expando)}"script"===n&&t.text!==e.text?(Ht(t).text=e.text,qt(t)):"object"===n?(t.parentNode&&(t.outerHTML=e.outerHTML),b.support.html5Clone&&e.innerHTML&&!b.trim(t.innerHTML)&&(t.innerHTML=e.innerHTML)):"input"===n&&Nt.test(e.type)?(t.defaultChecked=t.checked=e.checked,t.value!==e.value&&(t.value=e.value)):"option"===n?t.defaultSelected=t.selected=e.defaultSelected:("input"===n||"textarea"===n)&&(t.defaultValue=e.defaultValue)}}b.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(e,t){b.fn[e]=function(e){var n,r=0,i=[],o=b(e),a=o.length-1;for(;a>=r;r++)n=r===a?this:this.clone(!0),b(o[r])[t](n),d.apply(i,n.get());return this.pushStack(i)}});function Ot(e,n){var r,o,a=0,s=typeof e.getElementsByTagName!==i?e.getElementsByTagName(n||"*"):typeof e.querySelectorAll!==i?e.querySelectorAll(n||"*"):t;if(!s)for(s=[],r=e.childNodes||e;null!=(o=r[a]);a++)!n||b.nodeName(o,n)?s.push(o):b.merge(s,Ot(o,n));return n===t||n&&b.nodeName(e,n)?b.merge([e],s):s}function Bt(e){Nt.test(e.type)&&(e.defaultChecked=e.checked)}b.extend({clone:function(e,t,n){var r,i,o,a,s,u=b.contains(e.ownerDocument,e);if(b.support.html5Clone||b.isXMLDoc(e)||!mt.test("<"+e.nodeName+">")?o=e.cloneNode(!0):(Dt.innerHTML=e.outerHTML,Dt.removeChild(o=Dt.firstChild)),!(b.support.noCloneEvent&&b.support.noCloneChecked||1!==e.nodeType&&11!==e.nodeType||b.isXMLDoc(e)))for(r=Ot(o),s=Ot(e),a=0;null!=(i=s[a]);++a)r[a]&&Ft(i,r[a]);if(t)if(n)for(s=s||Ot(e),r=r||Ot(o),a=0;null!=(i=s[a]);a++)_t(i,r[a]);else _t(e,o);return r=Ot(o,"script"),r.length>0&&Mt(r,!u&&Ot(e,"script")),r=s=i=null,o},buildFragment:function(e,t,n,r){var i,o,a,s,u,l,c,p=e.length,f=dt(t),d=[],h=0;for(;p>h;h++)if(o=e[h],o||0===o)if("object"===b.type(o))b.merge(d,o.nodeType?[o]:o);else if(wt.test(o)){s=s||f.appendChild(t.createElement("div")),u=(bt.exec(o)||["",""])[1].toLowerCase(),c=At[u]||At._default,s.innerHTML=c[1]+o.replace(vt,"<$1></$2>")+c[2],i=c[0];while(i--)s=s.lastChild;if(!b.support.leadingWhitespace&&yt.test(o)&&d.push(t.createTextNode(yt.exec(o)[0])),!b.support.tbody){o="table"!==u||xt.test(o)?"<table>"!==c[1]||xt.test(o)?0:s:s.firstChild,i=o&&o.childNodes.length;while(i--)b.nodeName(l=o.childNodes[i],"tbody")&&!l.childNodes.length&&o.removeChild(l)}b.merge(d,s.childNodes),s.textContent="";while(s.firstChild)s.removeChild(s.firstChild);s=f.lastChild}else d.push(t.createTextNode(o));s&&f.removeChild(s),b.support.appendChecked||b.grep(Ot(d,"input"),Bt),h=0;while(o=d[h++])if((!r||-1===b.inArray(o,r))&&(a=b.contains(o.ownerDocument,o),s=Ot(f.appendChild(o),"script"),a&&Mt(s),n)){i=0;while(o=s[i++])kt.test(o.type||"")&&n.push(o)}return s=null,f},cleanData:function(e,t){var n,r,o,a,s=0,u=b.expando,l=b.cache,p=b.support.deleteExpando,f=b.event.special;for(;null!=(n=e[s]);s++)if((t||b.acceptData(n))&&(o=n[u],a=o&&l[o])){if(a.events)for(r in a.events)f[r]?b.event.remove(n,r):b.removeEvent(n,r,a.handle);l[o]&&(delete l[o],p?delete n[u]:typeof n.removeAttribute!==i?n.removeAttribute(u):n[u]=null,c.push(o))}}});var Pt,Rt,Wt,$t=/alpha\([^)]*\)/i,It=/opacity\s*=\s*([^)]*)/,zt=/^(top|right|bottom|left)$/,Xt=/^(none|table(?!-c[ea]).+)/,Ut=/^margin/,Vt=RegExp("^("+x+")(.*)$","i"),Yt=RegExp("^("+x+")(?!px)[a-z%]+$","i"),Jt=RegExp("^([+-])=("+x+")","i"),Gt={BODY:"block"},Qt={position:"absolute",visibility:"hidden",display:"block"},Kt={letterSpacing:0,fontWeight:400},Zt=["Top","Right","Bottom","Left"],en=["Webkit","O","Moz","ms"];function tn(e,t){if(t in e)return t;var n=t.charAt(0).toUpperCase()+t.slice(1),r=t,i=en.length;while(i--)if(t=en[i]+n,t in e)return t;return r}function nn(e,t){return e=t||e,"none"===b.css(e,"display")||!b.contains(e.ownerDocument,e)}function rn(e,t){var n,r,i,o=[],a=0,s=e.length;for(;s>a;a++)r=e[a],r.style&&(o[a]=b._data(r,"olddisplay"),n=r.style.display,t?(o[a]||"none"!==n||(r.style.display=""),""===r.style.display&&nn(r)&&(o[a]=b._data(r,"olddisplay",un(r.nodeName)))):o[a]||(i=nn(r),(n&&"none"!==n||!i)&&b._data(r,"olddisplay",i?n:b.css(r,"display"))));for(a=0;s>a;a++)r=e[a],r.style&&(t&&"none"!==r.style.display&&""!==r.style.display||(r.style.display=t?o[a]||"":"none"));return e}b.fn.extend({css:function(e,n){return b.access(this,function(e,n,r){var i,o,a={},s=0;if(b.isArray(n)){for(o=Rt(e),i=n.length;i>s;s++)a[n[s]]=b.css(e,n[s],!1,o);return a}return r!==t?b.style(e,n,r):b.css(e,n)},e,n,arguments.length>1)},show:function(){return rn(this,!0)},hide:function(){return rn(this)},toggle:function(e){var t="boolean"==typeof e;return this.each(function(){(t?e:nn(this))?b(this).show():b(this).hide()})}}),b.extend({cssHooks:{opacity:{get:function(e,t){if(t){var n=Wt(e,"opacity");return""===n?"1":n}}}},cssNumber:{columnCount:!0,fillOpacity:!0,fontWeight:!0,lineHeight:!0,opacity:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{"float":b.support.cssFloat?"cssFloat":"styleFloat"},style:function(e,n,r,i){if(e&&3!==e.nodeType&&8!==e.nodeType&&e.style){var o,a,s,u=b.camelCase(n),l=e.style;if(n=b.cssProps[u]||(b.cssProps[u]=tn(l,u)),s=b.cssHooks[n]||b.cssHooks[u],r===t)return s&&"get"in s&&(o=s.get(e,!1,i))!==t?o:l[n];if(a=typeof r,"string"===a&&(o=Jt.exec(r))&&(r=(o[1]+1)*o[2]+parseFloat(b.css(e,n)),a="number"),!(null==r||"number"===a&&isNaN(r)||("number"!==a||b.cssNumber[u]||(r+="px"),b.support.clearCloneStyle||""!==r||0!==n.indexOf("background")||(l[n]="inherit"),s&&"set"in s&&(r=s.set(e,r,i))===t)))try{l[n]=r}catch(c){}}},css:function(e,n,r,i){var o,a,s,u=b.camelCase(n);return n=b.cssProps[u]||(b.cssProps[u]=tn(e.style,u)),s=b.cssHooks[n]||b.cssHooks[u],s&&"get"in s&&(a=s.get(e,!0,r)),a===t&&(a=Wt(e,n,i)),"normal"===a&&n in Kt&&(a=Kt[n]),""===r||r?(o=parseFloat(a),r===!0||b.isNumeric(o)?o||0:a):a},swap:function(e,t,n,r){var i,o,a={};for(o in t)a[o]=e.style[o],e.style[o]=t[o];i=n.apply(e,r||[]);for(o in t)e.style[o]=a[o];return i}}),e.getComputedStyle?(Rt=function(t){return e.getComputedStyle(t,null)},Wt=function(e,n,r){var i,o,a,s=r||Rt(e),u=s?s.getPropertyValue(n)||s[n]:t,l=e.style;return s&&(""!==u||b.contains(e.ownerDocument,e)||(u=b.style(e,n)),Yt.test(u)&&Ut.test(n)&&(i=l.width,o=l.minWidth,a=l.maxWidth,l.minWidth=l.maxWidth=l.width=u,u=s.width,l.width=i,l.minWidth=o,l.maxWidth=a)),u}):o.documentElement.currentStyle&&(Rt=function(e){return e.currentStyle},Wt=function(e,n,r){var i,o,a,s=r||Rt(e),u=s?s[n]:t,l=e.style;return null==u&&l&&l[n]&&(u=l[n]),Yt.test(u)&&!zt.test(n)&&(i=l.left,o=e.runtimeStyle,a=o&&o.left,a&&(o.left=e.currentStyle.left),l.left="fontSize"===n?"1em":u,u=l.pixelLeft+"px",l.left=i,a&&(o.left=a)),""===u?"auto":u});function on(e,t,n){var r=Vt.exec(t);return r?Math.max(0,r[1]-(n||0))+(r[2]||"px"):t}function an(e,t,n,r,i){var o=n===(r?"border":"content")?4:"width"===t?1:0,a=0;for(;4>o;o+=2)"margin"===n&&(a+=b.css(e,n+Zt[o],!0,i)),r?("content"===n&&(a-=b.css(e,"padding"+Zt[o],!0,i)),"margin"!==n&&(a-=b.css(e,"border"+Zt[o]+"Width",!0,i))):(a+=b.css(e,"padding"+Zt[o],!0,i),"padding"!==n&&(a+=b.css(e,"border"+Zt[o]+"Width",!0,i)));return a}function sn(e,t,n){var r=!0,i="width"===t?e.offsetWidth:e.offsetHeight,o=Rt(e),a=b.support.boxSizing&&"border-box"===b.css(e,"boxSizing",!1,o);if(0>=i||null==i){if(i=Wt(e,t,o),(0>i||null==i)&&(i=e.style[t]),Yt.test(i))return i;r=a&&(b.support.boxSizingReliable||i===e.style[t]),i=parseFloat(i)||0}return i+an(e,t,n||(a?"border":"content"),r,o)+"px"}function un(e){var t=o,n=Gt[e];return n||(n=ln(e,t),"none"!==n&&n||(Pt=(Pt||b("<iframe frameborder='0' width='0' height='0'/>").css("cssText","display:block !important")).appendTo(t.documentElement),t=(Pt[0].contentWindow||Pt[0].contentDocument).document,t.write("<!doctype html><html><body>"),t.close(),n=ln(e,t),Pt.detach()),Gt[e]=n),n
}function ln(e,t){var n=b(t.createElement(e)).appendTo(t.body),r=b.css(n[0],"display");return n.remove(),r}b.each(["height","width"],function(e,n){b.cssHooks[n]={get:function(e,r,i){return r?0===e.offsetWidth&&Xt.test(b.css(e,"display"))?b.swap(e,Qt,function(){return sn(e,n,i)}):sn(e,n,i):t},set:function(e,t,r){var i=r&&Rt(e);return on(e,t,r?an(e,n,r,b.support.boxSizing&&"border-box"===b.css(e,"boxSizing",!1,i),i):0)}}}),b.support.opacity||(b.cssHooks.opacity={get:function(e,t){return It.test((t&&e.currentStyle?e.currentStyle.filter:e.style.filter)||"")?.01*parseFloat(RegExp.$1)+"":t?"1":""},set:function(e,t){var n=e.style,r=e.currentStyle,i=b.isNumeric(t)?"alpha(opacity="+100*t+")":"",o=r&&r.filter||n.filter||"";n.zoom=1,(t>=1||""===t)&&""===b.trim(o.replace($t,""))&&n.removeAttribute&&(n.removeAttribute("filter"),""===t||r&&!r.filter)||(n.filter=$t.test(o)?o.replace($t,i):o+" "+i)}}),b(function(){b.support.reliableMarginRight||(b.cssHooks.marginRight={get:function(e,n){return n?b.swap(e,{display:"inline-block"},Wt,[e,"marginRight"]):t}}),!b.support.pixelPosition&&b.fn.position&&b.each(["top","left"],function(e,n){b.cssHooks[n]={get:function(e,r){return r?(r=Wt(e,n),Yt.test(r)?b(e).position()[n]+"px":r):t}}})}),b.expr&&b.expr.filters&&(b.expr.filters.hidden=function(e){return 0>=e.offsetWidth&&0>=e.offsetHeight||!b.support.reliableHiddenOffsets&&"none"===(e.style&&e.style.display||b.css(e,"display"))},b.expr.filters.visible=function(e){return!b.expr.filters.hidden(e)}),b.each({margin:"",padding:"",border:"Width"},function(e,t){b.cssHooks[e+t]={expand:function(n){var r=0,i={},o="string"==typeof n?n.split(" "):[n];for(;4>r;r++)i[e+Zt[r]+t]=o[r]||o[r-2]||o[0];return i}},Ut.test(e)||(b.cssHooks[e+t].set=on)});var cn=/%20/g,pn=/\[\]$/,fn=/\r?\n/g,dn=/^(?:submit|button|image|reset|file)$/i,hn=/^(?:input|select|textarea|keygen)/i;b.fn.extend({serialize:function(){return b.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var e=b.prop(this,"elements");return e?b.makeArray(e):this}).filter(function(){var e=this.type;return this.name&&!b(this).is(":disabled")&&hn.test(this.nodeName)&&!dn.test(e)&&(this.checked||!Nt.test(e))}).map(function(e,t){var n=b(this).val();return null==n?null:b.isArray(n)?b.map(n,function(e){return{name:t.name,value:e.replace(fn,"\r\n")}}):{name:t.name,value:n.replace(fn,"\r\n")}}).get()}}),b.param=function(e,n){var r,i=[],o=function(e,t){t=b.isFunction(t)?t():null==t?"":t,i[i.length]=encodeURIComponent(e)+"="+encodeURIComponent(t)};if(n===t&&(n=b.ajaxSettings&&b.ajaxSettings.traditional),b.isArray(e)||e.jquery&&!b.isPlainObject(e))b.each(e,function(){o(this.name,this.value)});else for(r in e)gn(r,e[r],n,o);return i.join("&").replace(cn,"+")};function gn(e,t,n,r){var i;if(b.isArray(t))b.each(t,function(t,i){n||pn.test(e)?r(e,i):gn(e+"["+("object"==typeof i?t:"")+"]",i,n,r)});else if(n||"object"!==b.type(t))r(e,t);else for(i in t)gn(e+"["+i+"]",t[i],n,r)}b.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(e,t){b.fn[t]=function(e,n){return arguments.length>0?this.on(t,null,e,n):this.trigger(t)}}),b.fn.hover=function(e,t){return this.mouseenter(e).mouseleave(t||e)};var mn,yn,vn=b.now(),bn=/\?/,xn=/#.*$/,wn=/([?&])_=[^&]*/,Tn=/^(.*?):[ \t]*([^\r\n]*)\r?$/gm,Nn=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,Cn=/^(?:GET|HEAD)$/,kn=/^\/\//,En=/^([\w.+-]+:)(?:\/\/([^\/?#:]*)(?::(\d+)|)|)/,Sn=b.fn.load,An={},jn={},Dn="*/".concat("*");try{yn=a.href}catch(Ln){yn=o.createElement("a"),yn.href="",yn=yn.href}mn=En.exec(yn.toLowerCase())||[];function Hn(e){return function(t,n){"string"!=typeof t&&(n=t,t="*");var r,i=0,o=t.toLowerCase().match(w)||[];if(b.isFunction(n))while(r=o[i++])"+"===r[0]?(r=r.slice(1)||"*",(e[r]=e[r]||[]).unshift(n)):(e[r]=e[r]||[]).push(n)}}function qn(e,n,r,i){var o={},a=e===jn;function s(u){var l;return o[u]=!0,b.each(e[u]||[],function(e,u){var c=u(n,r,i);return"string"!=typeof c||a||o[c]?a?!(l=c):t:(n.dataTypes.unshift(c),s(c),!1)}),l}return s(n.dataTypes[0])||!o["*"]&&s("*")}function Mn(e,n){var r,i,o=b.ajaxSettings.flatOptions||{};for(i in n)n[i]!==t&&((o[i]?e:r||(r={}))[i]=n[i]);return r&&b.extend(!0,e,r),e}b.fn.load=function(e,n,r){if("string"!=typeof e&&Sn)return Sn.apply(this,arguments);var i,o,a,s=this,u=e.indexOf(" ");return u>=0&&(i=e.slice(u,e.length),e=e.slice(0,u)),b.isFunction(n)?(r=n,n=t):n&&"object"==typeof n&&(a="POST"),s.length>0&&b.ajax({url:e,type:a,dataType:"html",data:n}).done(function(e){o=arguments,s.html(i?b("<div>").append(b.parseHTML(e)).find(i):e)}).complete(r&&function(e,t){s.each(r,o||[e.responseText,t,e])}),this},b.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(e,t){b.fn[t]=function(e){return this.on(t,e)}}),b.each(["get","post"],function(e,n){b[n]=function(e,r,i,o){return b.isFunction(r)&&(o=o||i,i=r,r=t),b.ajax({url:e,type:n,dataType:o,data:r,success:i})}}),b.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:yn,type:"GET",isLocal:Nn.test(mn[1]),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":Dn,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText"},converters:{"* text":e.String,"text html":!0,"text json":b.parseJSON,"text xml":b.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(e,t){return t?Mn(Mn(e,b.ajaxSettings),t):Mn(b.ajaxSettings,e)},ajaxPrefilter:Hn(An),ajaxTransport:Hn(jn),ajax:function(e,n){"object"==typeof e&&(n=e,e=t),n=n||{};var r,i,o,a,s,u,l,c,p=b.ajaxSetup({},n),f=p.context||p,d=p.context&&(f.nodeType||f.jquery)?b(f):b.event,h=b.Deferred(),g=b.Callbacks("once memory"),m=p.statusCode||{},y={},v={},x=0,T="canceled",N={readyState:0,getResponseHeader:function(e){var t;if(2===x){if(!c){c={};while(t=Tn.exec(a))c[t[1].toLowerCase()]=t[2]}t=c[e.toLowerCase()]}return null==t?null:t},getAllResponseHeaders:function(){return 2===x?a:null},setRequestHeader:function(e,t){var n=e.toLowerCase();return x||(e=v[n]=v[n]||e,y[e]=t),this},overrideMimeType:function(e){return x||(p.mimeType=e),this},statusCode:function(e){var t;if(e)if(2>x)for(t in e)m[t]=[m[t],e[t]];else N.always(e[N.status]);return this},abort:function(e){var t=e||T;return l&&l.abort(t),k(0,t),this}};if(h.promise(N).complete=g.add,N.success=N.done,N.error=N.fail,p.url=((e||p.url||yn)+"").replace(xn,"").replace(kn,mn[1]+"//"),p.type=n.method||n.type||p.method||p.type,p.dataTypes=b.trim(p.dataType||"*").toLowerCase().match(w)||[""],null==p.crossDomain&&(r=En.exec(p.url.toLowerCase()),p.crossDomain=!(!r||r[1]===mn[1]&&r[2]===mn[2]&&(r[3]||("http:"===r[1]?80:443))==(mn[3]||("http:"===mn[1]?80:443)))),p.data&&p.processData&&"string"!=typeof p.data&&(p.data=b.param(p.data,p.traditional)),qn(An,p,n,N),2===x)return N;u=p.global,u&&0===b.active++&&b.event.trigger("ajaxStart"),p.type=p.type.toUpperCase(),p.hasContent=!Cn.test(p.type),o=p.url,p.hasContent||(p.data&&(o=p.url+=(bn.test(o)?"&":"?")+p.data,delete p.data),p.cache===!1&&(p.url=wn.test(o)?o.replace(wn,"$1_="+vn++):o+(bn.test(o)?"&":"?")+"_="+vn++)),p.ifModified&&(b.lastModified[o]&&N.setRequestHeader("If-Modified-Since",b.lastModified[o]),b.etag[o]&&N.setRequestHeader("If-None-Match",b.etag[o])),(p.data&&p.hasContent&&p.contentType!==!1||n.contentType)&&N.setRequestHeader("Content-Type",p.contentType),N.setRequestHeader("Accept",p.dataTypes[0]&&p.accepts[p.dataTypes[0]]?p.accepts[p.dataTypes[0]]+("*"!==p.dataTypes[0]?", "+Dn+"; q=0.01":""):p.accepts["*"]);for(i in p.headers)N.setRequestHeader(i,p.headers[i]);if(p.beforeSend&&(p.beforeSend.call(f,N,p)===!1||2===x))return N.abort();T="abort";for(i in{success:1,error:1,complete:1})N[i](p[i]);if(l=qn(jn,p,n,N)){N.readyState=1,u&&d.trigger("ajaxSend",[N,p]),p.async&&p.timeout>0&&(s=setTimeout(function(){N.abort("timeout")},p.timeout));try{x=1,l.send(y,k)}catch(C){if(!(2>x))throw C;k(-1,C)}}else k(-1,"No Transport");function k(e,n,r,i){var c,y,v,w,T,C=n;2!==x&&(x=2,s&&clearTimeout(s),l=t,a=i||"",N.readyState=e>0?4:0,r&&(w=_n(p,N,r)),e>=200&&300>e||304===e?(p.ifModified&&(T=N.getResponseHeader("Last-Modified"),T&&(b.lastModified[o]=T),T=N.getResponseHeader("etag"),T&&(b.etag[o]=T)),204===e?(c=!0,C="nocontent"):304===e?(c=!0,C="notmodified"):(c=Fn(p,w),C=c.state,y=c.data,v=c.error,c=!v)):(v=C,(e||!C)&&(C="error",0>e&&(e=0))),N.status=e,N.statusText=(n||C)+"",c?h.resolveWith(f,[y,C,N]):h.rejectWith(f,[N,C,v]),N.statusCode(m),m=t,u&&d.trigger(c?"ajaxSuccess":"ajaxError",[N,p,c?y:v]),g.fireWith(f,[N,C]),u&&(d.trigger("ajaxComplete",[N,p]),--b.active||b.event.trigger("ajaxStop")))}return N},getScript:function(e,n){return b.get(e,t,n,"script")},getJSON:function(e,t,n){return b.get(e,t,n,"json")}});function _n(e,n,r){var i,o,a,s,u=e.contents,l=e.dataTypes,c=e.responseFields;for(s in c)s in r&&(n[c[s]]=r[s]);while("*"===l[0])l.shift(),o===t&&(o=e.mimeType||n.getResponseHeader("Content-Type"));if(o)for(s in u)if(u[s]&&u[s].test(o)){l.unshift(s);break}if(l[0]in r)a=l[0];else{for(s in r){if(!l[0]||e.converters[s+" "+l[0]]){a=s;break}i||(i=s)}a=a||i}return a?(a!==l[0]&&l.unshift(a),r[a]):t}function Fn(e,t){var n,r,i,o,a={},s=0,u=e.dataTypes.slice(),l=u[0];if(e.dataFilter&&(t=e.dataFilter(t,e.dataType)),u[1])for(i in e.converters)a[i.toLowerCase()]=e.converters[i];for(;r=u[++s];)if("*"!==r){if("*"!==l&&l!==r){if(i=a[l+" "+r]||a["* "+r],!i)for(n in a)if(o=n.split(" "),o[1]===r&&(i=a[l+" "+o[0]]||a["* "+o[0]])){i===!0?i=a[n]:a[n]!==!0&&(r=o[0],u.splice(s--,0,r));break}if(i!==!0)if(i&&e["throws"])t=i(t);else try{t=i(t)}catch(c){return{state:"parsererror",error:i?c:"No conversion from "+l+" to "+r}}}l=r}return{state:"success",data:t}}b.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/(?:java|ecma)script/},converters:{"text script":function(e){return b.globalEval(e),e}}}),b.ajaxPrefilter("script",function(e){e.cache===t&&(e.cache=!1),e.crossDomain&&(e.type="GET",e.global=!1)}),b.ajaxTransport("script",function(e){if(e.crossDomain){var n,r=o.head||b("head")[0]||o.documentElement;return{send:function(t,i){n=o.createElement("script"),n.async=!0,e.scriptCharset&&(n.charset=e.scriptCharset),n.src=e.url,n.onload=n.onreadystatechange=function(e,t){(t||!n.readyState||/loaded|complete/.test(n.readyState))&&(n.onload=n.onreadystatechange=null,n.parentNode&&n.parentNode.removeChild(n),n=null,t||i(200,"success"))},r.insertBefore(n,r.firstChild)},abort:function(){n&&n.onload(t,!0)}}}});var On=[],Bn=/(=)\?(?=&|$)|\?\?/;b.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var e=On.pop()||b.expando+"_"+vn++;return this[e]=!0,e}}),b.ajaxPrefilter("json jsonp",function(n,r,i){var o,a,s,u=n.jsonp!==!1&&(Bn.test(n.url)?"url":"string"==typeof n.data&&!(n.contentType||"").indexOf("application/x-www-form-urlencoded")&&Bn.test(n.data)&&"data");return u||"jsonp"===n.dataTypes[0]?(o=n.jsonpCallback=b.isFunction(n.jsonpCallback)?n.jsonpCallback():n.jsonpCallback,u?n[u]=n[u].replace(Bn,"$1"+o):n.jsonp!==!1&&(n.url+=(bn.test(n.url)?"&":"?")+n.jsonp+"="+o),n.converters["script json"]=function(){return s||b.error(o+" was not called"),s[0]},n.dataTypes[0]="json",a=e[o],e[o]=function(){s=arguments},i.always(function(){e[o]=a,n[o]&&(n.jsonpCallback=r.jsonpCallback,On.push(o)),s&&b.isFunction(a)&&a(s[0]),s=a=t}),"script"):t});var Pn,Rn,Wn=0,$n=e.ActiveXObject&&function(){var e;for(e in Pn)Pn[e](t,!0)};function In(){try{return new e.XMLHttpRequest}catch(t){}}function zn(){try{return new e.ActiveXObject("Microsoft.XMLHTTP")}catch(t){}}b.ajaxSettings.xhr=e.ActiveXObject?function(){return!this.isLocal&&In()||zn()}:In,Rn=b.ajaxSettings.xhr(),b.support.cors=!!Rn&&"withCredentials"in Rn,Rn=b.support.ajax=!!Rn,Rn&&b.ajaxTransport(function(n){if(!n.crossDomain||b.support.cors){var r;return{send:function(i,o){var a,s,u=n.xhr();if(n.username?u.open(n.type,n.url,n.async,n.username,n.password):u.open(n.type,n.url,n.async),n.xhrFields)for(s in n.xhrFields)u[s]=n.xhrFields[s];n.mimeType&&u.overrideMimeType&&u.overrideMimeType(n.mimeType),n.crossDomain||i["X-Requested-With"]||(i["X-Requested-With"]="XMLHttpRequest");try{for(s in i)u.setRequestHeader(s,i[s])}catch(l){}u.send(n.hasContent&&n.data||null),r=function(e,i){var s,l,c,p;try{if(r&&(i||4===u.readyState))if(r=t,a&&(u.onreadystatechange=b.noop,$n&&delete Pn[a]),i)4!==u.readyState&&u.abort();else{p={},s=u.status,l=u.getAllResponseHeaders(),"string"==typeof u.responseText&&(p.text=u.responseText);try{c=u.statusText}catch(f){c=""}s||!n.isLocal||n.crossDomain?1223===s&&(s=204):s=p.text?200:404}}catch(d){i||o(-1,d)}p&&o(s,c,p,l)},n.async?4===u.readyState?setTimeout(r):(a=++Wn,$n&&(Pn||(Pn={},b(e).unload($n)),Pn[a]=r),u.onreadystatechange=r):r()},abort:function(){r&&r(t,!0)}}}});var Xn,Un,Vn=/^(?:toggle|show|hide)$/,Yn=RegExp("^(?:([+-])=|)("+x+")([a-z%]*)$","i"),Jn=/queueHooks$/,Gn=[nr],Qn={"*":[function(e,t){var n,r,i=this.createTween(e,t),o=Yn.exec(t),a=i.cur(),s=+a||0,u=1,l=20;if(o){if(n=+o[2],r=o[3]||(b.cssNumber[e]?"":"px"),"px"!==r&&s){s=b.css(i.elem,e,!0)||n||1;do u=u||".5",s/=u,b.style(i.elem,e,s+r);while(u!==(u=i.cur()/a)&&1!==u&&--l)}i.unit=r,i.start=s,i.end=o[1]?s+(o[1]+1)*n:n}return i}]};function Kn(){return setTimeout(function(){Xn=t}),Xn=b.now()}function Zn(e,t){b.each(t,function(t,n){var r=(Qn[t]||[]).concat(Qn["*"]),i=0,o=r.length;for(;o>i;i++)if(r[i].call(e,t,n))return})}function er(e,t,n){var r,i,o=0,a=Gn.length,s=b.Deferred().always(function(){delete u.elem}),u=function(){if(i)return!1;var t=Xn||Kn(),n=Math.max(0,l.startTime+l.duration-t),r=n/l.duration||0,o=1-r,a=0,u=l.tweens.length;for(;u>a;a++)l.tweens[a].run(o);return s.notifyWith(e,[l,o,n]),1>o&&u?n:(s.resolveWith(e,[l]),!1)},l=s.promise({elem:e,props:b.extend({},t),opts:b.extend(!0,{specialEasing:{}},n),originalProperties:t,originalOptions:n,startTime:Xn||Kn(),duration:n.duration,tweens:[],createTween:function(t,n){var r=b.Tween(e,l.opts,t,n,l.opts.specialEasing[t]||l.opts.easing);return l.tweens.push(r),r},stop:function(t){var n=0,r=t?l.tweens.length:0;if(i)return this;for(i=!0;r>n;n++)l.tweens[n].run(1);return t?s.resolveWith(e,[l,t]):s.rejectWith(e,[l,t]),this}}),c=l.props;for(tr(c,l.opts.specialEasing);a>o;o++)if(r=Gn[o].call(l,e,c,l.opts))return r;return Zn(l,c),b.isFunction(l.opts.start)&&l.opts.start.call(e,l),b.fx.timer(b.extend(u,{elem:e,anim:l,queue:l.opts.queue})),l.progress(l.opts.progress).done(l.opts.done,l.opts.complete).fail(l.opts.fail).always(l.opts.always)}function tr(e,t){var n,r,i,o,a;for(i in e)if(r=b.camelCase(i),o=t[r],n=e[i],b.isArray(n)&&(o=n[1],n=e[i]=n[0]),i!==r&&(e[r]=n,delete e[i]),a=b.cssHooks[r],a&&"expand"in a){n=a.expand(n),delete e[r];for(i in n)i in e||(e[i]=n[i],t[i]=o)}else t[r]=o}b.Animation=b.extend(er,{tweener:function(e,t){b.isFunction(e)?(t=e,e=["*"]):e=e.split(" ");var n,r=0,i=e.length;for(;i>r;r++)n=e[r],Qn[n]=Qn[n]||[],Qn[n].unshift(t)},prefilter:function(e,t){t?Gn.unshift(e):Gn.push(e)}});function nr(e,t,n){var r,i,o,a,s,u,l,c,p,f=this,d=e.style,h={},g=[],m=e.nodeType&&nn(e);n.queue||(c=b._queueHooks(e,"fx"),null==c.unqueued&&(c.unqueued=0,p=c.empty.fire,c.empty.fire=function(){c.unqueued||p()}),c.unqueued++,f.always(function(){f.always(function(){c.unqueued--,b.queue(e,"fx").length||c.empty.fire()})})),1===e.nodeType&&("height"in t||"width"in t)&&(n.overflow=[d.overflow,d.overflowX,d.overflowY],"inline"===b.css(e,"display")&&"none"===b.css(e,"float")&&(b.support.inlineBlockNeedsLayout&&"inline"!==un(e.nodeName)?d.zoom=1:d.display="inline-block")),n.overflow&&(d.overflow="hidden",b.support.shrinkWrapBlocks||f.always(function(){d.overflow=n.overflow[0],d.overflowX=n.overflow[1],d.overflowY=n.overflow[2]}));for(i in t)if(a=t[i],Vn.exec(a)){if(delete t[i],u=u||"toggle"===a,a===(m?"hide":"show"))continue;g.push(i)}if(o=g.length){s=b._data(e,"fxshow")||b._data(e,"fxshow",{}),"hidden"in s&&(m=s.hidden),u&&(s.hidden=!m),m?b(e).show():f.done(function(){b(e).hide()}),f.done(function(){var t;b._removeData(e,"fxshow");for(t in h)b.style(e,t,h[t])});for(i=0;o>i;i++)r=g[i],l=f.createTween(r,m?s[r]:0),h[r]=s[r]||b.style(e,r),r in s||(s[r]=l.start,m&&(l.end=l.start,l.start="width"===r||"height"===r?1:0))}}function rr(e,t,n,r,i){return new rr.prototype.init(e,t,n,r,i)}b.Tween=rr,rr.prototype={constructor:rr,init:function(e,t,n,r,i,o){this.elem=e,this.prop=n,this.easing=i||"swing",this.options=t,this.start=this.now=this.cur(),this.end=r,this.unit=o||(b.cssNumber[n]?"":"px")},cur:function(){var e=rr.propHooks[this.prop];return e&&e.get?e.get(this):rr.propHooks._default.get(this)},run:function(e){var t,n=rr.propHooks[this.prop];return this.pos=t=this.options.duration?b.easing[this.easing](e,this.options.duration*e,0,1,this.options.duration):e,this.now=(this.end-this.start)*t+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),n&&n.set?n.set(this):rr.propHooks._default.set(this),this}},rr.prototype.init.prototype=rr.prototype,rr.propHooks={_default:{get:function(e){var t;return null==e.elem[e.prop]||e.elem.style&&null!=e.elem.style[e.prop]?(t=b.css(e.elem,e.prop,""),t&&"auto"!==t?t:0):e.elem[e.prop]},set:function(e){b.fx.step[e.prop]?b.fx.step[e.prop](e):e.elem.style&&(null!=e.elem.style[b.cssProps[e.prop]]||b.cssHooks[e.prop])?b.style(e.elem,e.prop,e.now+e.unit):e.elem[e.prop]=e.now}}},rr.propHooks.scrollTop=rr.propHooks.scrollLeft={set:function(e){e.elem.nodeType&&e.elem.parentNode&&(e.elem[e.prop]=e.now)}},b.each(["toggle","show","hide"],function(e,t){var n=b.fn[t];b.fn[t]=function(e,r,i){return null==e||"boolean"==typeof e?n.apply(this,arguments):this.animate(ir(t,!0),e,r,i)}}),b.fn.extend({fadeTo:function(e,t,n,r){return this.filter(nn).css("opacity",0).show().end().animate({opacity:t},e,n,r)},animate:function(e,t,n,r){var i=b.isEmptyObject(e),o=b.speed(t,n,r),a=function(){var t=er(this,b.extend({},e),o);a.finish=function(){t.stop(!0)},(i||b._data(this,"finish"))&&t.stop(!0)};return a.finish=a,i||o.queue===!1?this.each(a):this.queue(o.queue,a)},stop:function(e,n,r){var i=function(e){var t=e.stop;delete e.stop,t(r)};return"string"!=typeof e&&(r=n,n=e,e=t),n&&e!==!1&&this.queue(e||"fx",[]),this.each(function(){var t=!0,n=null!=e&&e+"queueHooks",o=b.timers,a=b._data(this);if(n)a[n]&&a[n].stop&&i(a[n]);else for(n in a)a[n]&&a[n].stop&&Jn.test(n)&&i(a[n]);for(n=o.length;n--;)o[n].elem!==this||null!=e&&o[n].queue!==e||(o[n].anim.stop(r),t=!1,o.splice(n,1));(t||!r)&&b.dequeue(this,e)})},finish:function(e){return e!==!1&&(e=e||"fx"),this.each(function(){var t,n=b._data(this),r=n[e+"queue"],i=n[e+"queueHooks"],o=b.timers,a=r?r.length:0;for(n.finish=!0,b.queue(this,e,[]),i&&i.cur&&i.cur.finish&&i.cur.finish.call(this),t=o.length;t--;)o[t].elem===this&&o[t].queue===e&&(o[t].anim.stop(!0),o.splice(t,1));for(t=0;a>t;t++)r[t]&&r[t].finish&&r[t].finish.call(this);delete n.finish})}});function ir(e,t){var n,r={height:e},i=0;for(t=t?1:0;4>i;i+=2-t)n=Zt[i],r["margin"+n]=r["padding"+n]=e;return t&&(r.opacity=r.width=e),r}b.each({slideDown:ir("show"),slideUp:ir("hide"),slideToggle:ir("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(e,t){b.fn[e]=function(e,n,r){return this.animate(t,e,n,r)}}),b.speed=function(e,t,n){var r=e&&"object"==typeof e?b.extend({},e):{complete:n||!n&&t||b.isFunction(e)&&e,duration:e,easing:n&&t||t&&!b.isFunction(t)&&t};return r.duration=b.fx.off?0:"number"==typeof r.duration?r.duration:r.duration in b.fx.speeds?b.fx.speeds[r.duration]:b.fx.speeds._default,(null==r.queue||r.queue===!0)&&(r.queue="fx"),r.old=r.complete,r.complete=function(){b.isFunction(r.old)&&r.old.call(this),r.queue&&b.dequeue(this,r.queue)},r},b.easing={linear:function(e){return e},swing:function(e){return.5-Math.cos(e*Math.PI)/2}},b.timers=[],b.fx=rr.prototype.init,b.fx.tick=function(){var e,n=b.timers,r=0;for(Xn=b.now();n.length>r;r++)e=n[r],e()||n[r]!==e||n.splice(r--,1);n.length||b.fx.stop(),Xn=t},b.fx.timer=function(e){e()&&b.timers.push(e)&&b.fx.start()},b.fx.interval=13,b.fx.start=function(){Un||(Un=setInterval(b.fx.tick,b.fx.interval))},b.fx.stop=function(){clearInterval(Un),Un=null},b.fx.speeds={slow:600,fast:200,_default:400},b.fx.step={},b.expr&&b.expr.filters&&(b.expr.filters.animated=function(e){return b.grep(b.timers,function(t){return e===t.elem}).length}),b.fn.offset=function(e){if(arguments.length)return e===t?this:this.each(function(t){b.offset.setOffset(this,e,t)});var n,r,o={top:0,left:0},a=this[0],s=a&&a.ownerDocument;if(s)return n=s.documentElement,b.contains(n,a)?(typeof a.getBoundingClientRect!==i&&(o=a.getBoundingClientRect()),r=or(s),{top:o.top+(r.pageYOffset||n.scrollTop)-(n.clientTop||0),left:o.left+(r.pageXOffset||n.scrollLeft)-(n.clientLeft||0)}):o},b.offset={setOffset:function(e,t,n){var r=b.css(e,"position");"static"===r&&(e.style.position="relative");var i=b(e),o=i.offset(),a=b.css(e,"top"),s=b.css(e,"left"),u=("absolute"===r||"fixed"===r)&&b.inArray("auto",[a,s])>-1,l={},c={},p,f;u?(c=i.position(),p=c.top,f=c.left):(p=parseFloat(a)||0,f=parseFloat(s)||0),b.isFunction(t)&&(t=t.call(e,n,o)),null!=t.top&&(l.top=t.top-o.top+p),null!=t.left&&(l.left=t.left-o.left+f),"using"in t?t.using.call(e,l):i.css(l)}},b.fn.extend({position:function(){if(this[0]){var e,t,n={top:0,left:0},r=this[0];return"fixed"===b.css(r,"position")?t=r.getBoundingClientRect():(e=this.offsetParent(),t=this.offset(),b.nodeName(e[0],"html")||(n=e.offset()),n.top+=b.css(e[0],"borderTopWidth",!0),n.left+=b.css(e[0],"borderLeftWidth",!0)),{top:t.top-n.top-b.css(r,"marginTop",!0),left:t.left-n.left-b.css(r,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){var e=this.offsetParent||o.documentElement;while(e&&!b.nodeName(e,"html")&&"static"===b.css(e,"position"))e=e.offsetParent;return e||o.documentElement})}}),b.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(e,n){var r=/Y/.test(n);b.fn[e]=function(i){return b.access(this,function(e,i,o){var a=or(e);return o===t?a?n in a?a[n]:a.document.documentElement[i]:e[i]:(a?a.scrollTo(r?b(a).scrollLeft():o,r?o:b(a).scrollTop()):e[i]=o,t)},e,i,arguments.length,null)}});function or(e){return b.isWindow(e)?e:9===e.nodeType?e.defaultView||e.parentWindow:!1}b.each({Height:"height",Width:"width"},function(e,n){b.each({padding:"inner"+e,content:n,"":"outer"+e},function(r,i){b.fn[i]=function(i,o){var a=arguments.length&&(r||"boolean"!=typeof i),s=r||(i===!0||o===!0?"margin":"border");return b.access(this,function(n,r,i){var o;return b.isWindow(n)?n.document.documentElement["client"+e]:9===n.nodeType?(o=n.documentElement,Math.max(n.body["scroll"+e],o["scroll"+e],n.body["offset"+e],o["offset"+e],o["client"+e])):i===t?b.css(n,r,s):b.style(n,r,i,s)},n,a?i:t,a,null)}})}),e.jQuery=e.$=b,"function"==typeof define&&define.amd&&define.amd.jQuery&&define("jquery",[],function(){return b})})(window);+function($){"use strict";var dismiss='[data-dismiss="alert"]';var Alert=function(el){$(el).on("click",dismiss,this.close)};Alert.prototype.close=function(e){var $this=$(this);var selector=$this.attr("data-target");if(!selector){selector=$this.attr("href");selector=selector&&selector.replace(/.*(?=#[^\s]*$)/,"")}var $parent=$(selector);if(e)e.preventDefault();if(!$parent.length){$parent=$this.hasClass("alert")?$this:$this.parent()}$parent.trigger(e=$.Event("close.bs.alert"));if(e.isDefaultPrevented())return;$parent.removeClass("in");function removeElement(){$parent.trigger("closed.bs.alert").remove()}$.support.transition&&$parent.hasClass("fade")?$parent.one($.support.transition.end,removeElement).emulateTransitionEnd(150):removeElement()};var old=$.fn.alert;$.fn.alert=function(option){return this.each(function(){var $this=$(this);var data=$this.data("bs.alert");if(!data)$this.data("bs.alert",data=new Alert(this));if(typeof option=="string")data[option].call($this)})};$.fn.alert.Constructor=Alert;$.fn.alert.noConflict=function(){$.fn.alert=old;return this};$(document).on("click.bs.alert.data-api",dismiss,Alert.prototype.close)}(jQuery);+function($){"use strict";var Button=function(element,options){this.$element=$(element);this.options=$.extend({},Button.DEFAULTS,options);this.isLoading=false};Button.DEFAULTS={loadingText:"loading..."};Button.prototype.setState=function(state){var d="disabled";var $el=this.$element;var val=$el.is("input")?"val":"html";var data=$el.data();state=state+"Text";if(!data.resetText)$el.data("resetText",$el[val]());$el[val](data[state]||this.options[state]);setTimeout($.proxy(function(){if(state=="loadingText"){this.isLoading=true;$el.addClass(d).attr(d,d)}else if(this.isLoading){this.isLoading=false;$el.removeClass(d).removeAttr(d)}},this),0)};Button.prototype.toggle=function(){var changed=true;var $parent=this.$element.closest('[data-toggle="buttons"]');if($parent.length){var $input=this.$element.find("input");if($input.prop("type")=="radio"){if($input.prop("checked")&&this.$element.hasClass("active"))changed=false;else $parent.find(".active").removeClass("active")}if(changed)$input.prop("checked",!this.$element.hasClass("active")).trigger("change")}if(changed)this.$element.toggleClass("active")};var old=$.fn.button;$.fn.button=function(option){return this.each(function(){var $this=$(this);var data=$this.data("bs.button");var options=typeof option=="object"&&option;if(!data)$this.data("bs.button",data=new Button(this,options));if(option=="toggle")data.toggle();else if(option)data.setState(option)})};$.fn.button.Constructor=Button;$.fn.button.noConflict=function(){$.fn.button=old;return this};$(document).on("click.bs.button.data-api","[data-toggle^=button]",function(e){var $btn=$(e.target);if(!$btn.hasClass("btn"))$btn=$btn.closest(".btn");$btn.button("toggle");e.preventDefault()})}(jQuery);+function($){"use strict";var backdrop=".dropdown-backdrop";var toggle="[data-toggle=dropdown]";var Dropdown=function(element){$(element).on("click.bs.dropdown",this.toggle)};Dropdown.prototype.toggle=function(e){var $this=$(this);if($this.is(".disabled, :disabled"))return;var $parent=getParent($this);var isActive=$parent.hasClass("open");clearMenus();if(!isActive){if("ontouchstart"in document.documentElement&&!$parent.closest(".navbar-nav").length){$('<div class="dropdown-backdrop"/>').insertAfter($(this)).on("click",clearMenus)}var relatedTarget={relatedTarget:this};$parent.trigger(e=$.Event("show.bs.dropdown",relatedTarget));if(e.isDefaultPrevented())return;$parent.toggleClass("open").trigger("shown.bs.dropdown",relatedTarget);$this.focus()}return false};Dropdown.prototype.keydown=function(e){if(!/(38|40|27)/.test(e.keyCode))return;var $this=$(this);e.preventDefault();e.stopPropagation();if($this.is(".disabled, :disabled"))return;var $parent=getParent($this);var isActive=$parent.hasClass("open");if(!isActive||isActive&&e.keyCode==27){if(e.which==27)$parent.find(toggle).focus();return $this.click()}var desc=" li:not(.divider):visible a";var $items=$parent.find("[role=menu]"+desc+", [role=listbox]"+desc);if(!$items.length)return;var index=$items.index($items.filter(":focus"));if(e.keyCode==38&&index>0)index--;if(e.keyCode==40&&index<$items.length-1)index++;if(!~index)index=0;$items.eq(index).focus()};function clearMenus(e){$(backdrop).remove();$(toggle).each(function(){var $parent=getParent($(this));var relatedTarget={relatedTarget:this};if(!$parent.hasClass("open"))return;$parent.trigger(e=$.Event("hide.bs.dropdown",relatedTarget));if(e.isDefaultPrevented())return;$parent.removeClass("open").trigger("hidden.bs.dropdown",relatedTarget)})}function getParent($this){var selector=$this.attr("data-target");if(!selector){selector=$this.attr("href");selector=selector&&/#[A-Za-z]/.test(selector)&&selector.replace(/.*(?=#[^\s]*$)/,"")}var $parent=selector&&$(selector);return $parent&&$parent.length?$parent:$this.parent()}var old=$.fn.dropdown;$.fn.dropdown=function(option){return this.each(function(){var $this=$(this);var data=$this.data("bs.dropdown");if(!data)$this.data("bs.dropdown",data=new Dropdown(this));if(typeof option=="string")data[option].call($this)})};$.fn.dropdown.Constructor=Dropdown;$.fn.dropdown.noConflict=function(){$.fn.dropdown=old;return this};$(document).on("click.bs.dropdown.data-api",clearMenus).on("click.bs.dropdown.data-api",".dropdown form",function(e){e.stopPropagation()}).on("click.bs.dropdown.data-api",toggle,Dropdown.prototype.toggle).on("keydown.bs.dropdown.data-api",toggle+", [role=menu], [role=listbox]",Dropdown.prototype.keydown)}(jQuery);+function($){"use strict";var Tooltip=function(element,options){this.type=this.options=this.enabled=this.timeout=this.hoverState=this.$element=null;this.init("tooltip",element,options)};Tooltip.DEFAULTS={animation:true,placement:"top",selector:false,template:'<div class="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>',trigger:"hover focus",title:"",delay:0,html:false,container:false};Tooltip.prototype.init=function(type,element,options){this.enabled=true;this.type=type;this.$element=$(element);this.options=this.getOptions(options);var triggers=this.options.trigger.split(" ");for(var i=triggers.length;i--;){var trigger=triggers[i];if(trigger=="click"){this.$element.on("click."+this.type,this.options.selector,$.proxy(this.toggle,this))}else if(trigger!="manual"){var eventIn=trigger=="hover"?"mouseenter":"focusin";var eventOut=trigger=="hover"?"mouseleave":"focusout";this.$element.on(eventIn+"."+this.type,this.options.selector,$.proxy(this.enter,this));this.$element.on(eventOut+"."+this.type,this.options.selector,$.proxy(this.leave,this))}}this.options.selector?this._options=$.extend({},this.options,{trigger:"manual",selector:""}):this.fixTitle()};Tooltip.prototype.getDefaults=function(){return Tooltip.DEFAULTS};Tooltip.prototype.getOptions=function(options){options=$.extend({},this.getDefaults(),this.$element.data(),options);if(options.delay&&typeof options.delay=="number"){options.delay={show:options.delay,hide:options.delay}}return options};Tooltip.prototype.getDelegateOptions=function(){var options={};var defaults=this.getDefaults();this._options&&$.each(this._options,function(key,value){if(defaults[key]!=value)options[key]=value});return options};Tooltip.prototype.enter=function(obj){var self=obj instanceof this.constructor?obj:$(obj.currentTarget)[this.type](this.getDelegateOptions()).data("bs."+this.type);clearTimeout(self.timeout);self.hoverState="in";if(!self.options.delay||!self.options.delay.show)return self.show();self.timeout=setTimeout(function(){if(self.hoverState=="in")self.show()},self.options.delay.show)};Tooltip.prototype.leave=function(obj){var self=obj instanceof this.constructor?obj:$(obj.currentTarget)[this.type](this.getDelegateOptions()).data("bs."+this.type);clearTimeout(self.timeout);self.hoverState="out";if(!self.options.delay||!self.options.delay.hide)return self.hide();self.timeout=setTimeout(function(){if(self.hoverState=="out")self.hide()},self.options.delay.hide)};Tooltip.prototype.show=function(){var e=$.Event("show.bs."+this.type);if(this.hasContent()&&this.enabled){this.$element.trigger(e);if(e.isDefaultPrevented())return;var that=this;var $tip=this.tip();this.setContent();if(this.options.animation)$tip.addClass("fade");var placement=typeof this.options.placement=="function"?this.options.placement.call(this,$tip[0],this.$element[0]):this.options.placement;var autoToken=/\s?auto?\s?/i;var autoPlace=autoToken.test(placement);if(autoPlace)placement=placement.replace(autoToken,"")||"top";$tip.detach().css({top:0,left:0,display:"block"}).addClass(placement);this.options.container?$tip.appendTo(this.options.container):$tip.insertAfter(this.$element);var pos=this.getPosition();var actualWidth=$tip[0].offsetWidth;var actualHeight=$tip[0].offsetHeight;if(autoPlace){var $parent=this.$element.parent();var orgPlacement=placement;var docScroll=document.documentElement.scrollTop||document.body.scrollTop;
var parentWidth=this.options.container=="body"?window.innerWidth:$parent.outerWidth();var parentHeight=this.options.container=="body"?window.innerHeight:$parent.outerHeight();var parentLeft=this.options.container=="body"?0:$parent.offset().left;placement=placement=="bottom"&&pos.top+pos.height+actualHeight-docScroll>parentHeight?"top":placement=="top"&&pos.top-docScroll-actualHeight<0?"bottom":placement=="right"&&pos.right+actualWidth>parentWidth?"left":placement=="left"&&pos.left-actualWidth<parentLeft?"right":placement;$tip.removeClass(orgPlacement).addClass(placement)}var calculatedOffset=this.getCalculatedOffset(placement,pos,actualWidth,actualHeight);this.applyPlacement(calculatedOffset,placement);this.hoverState=null;var complete=function(){that.$element.trigger("shown.bs."+that.type)};$.support.transition&&this.$tip.hasClass("fade")?$tip.one($.support.transition.end,complete).emulateTransitionEnd(150):complete()}};Tooltip.prototype.applyPlacement=function(offset,placement){var replace;var $tip=this.tip();var width=$tip[0].offsetWidth;var height=$tip[0].offsetHeight;var marginTop=parseInt($tip.css("margin-top"),10);var marginLeft=parseInt($tip.css("margin-left"),10);if(isNaN(marginTop))marginTop=0;if(isNaN(marginLeft))marginLeft=0;offset.top=offset.top+marginTop;offset.left=offset.left+marginLeft;$.offset.setOffset($tip[0],$.extend({using:function(props){$tip.css({top:Math.round(props.top),left:Math.round(props.left)})}},offset),0);$tip.addClass("in");var actualWidth=$tip[0].offsetWidth;var actualHeight=$tip[0].offsetHeight;if(placement=="top"&&actualHeight!=height){replace=true;offset.top=offset.top+height-actualHeight}if(/bottom|top/.test(placement)){var delta=0;if(offset.left<0){delta=offset.left*-2;offset.left=0;$tip.offset(offset);actualWidth=$tip[0].offsetWidth;actualHeight=$tip[0].offsetHeight}this.replaceArrow(delta-width+actualWidth,actualWidth,"left")}else{this.replaceArrow(actualHeight-height,actualHeight,"top")}if(replace)$tip.offset(offset)};Tooltip.prototype.replaceArrow=function(delta,dimension,position){this.arrow().css(position,delta?50*(1-delta/dimension)+"%":"")};Tooltip.prototype.setContent=function(){var $tip=this.tip();var title=this.getTitle();$tip.find(".tooltip-inner")[this.options.html?"html":"text"](title);$tip.removeClass("fade in top bottom left right")};Tooltip.prototype.hide=function(){var that=this;var $tip=this.tip();var e=$.Event("hide.bs."+this.type);function complete(){if(that.hoverState!="in")$tip.detach();that.$element.trigger("hidden.bs."+that.type)}this.$element.trigger(e);if(e.isDefaultPrevented())return;$tip.removeClass("in");$.support.transition&&this.$tip.hasClass("fade")?$tip.one($.support.transition.end,complete).emulateTransitionEnd(150):complete();this.hoverState=null;return this};Tooltip.prototype.fixTitle=function(){var $e=this.$element;if($e.attr("title")||typeof $e.attr("data-original-title")!="string"){$e.attr("data-original-title",$e.attr("title")||"").attr("title","")}};Tooltip.prototype.hasContent=function(){return this.getTitle()};Tooltip.prototype.getPosition=function(){var el=this.$element[0];return $.extend({},typeof el.getBoundingClientRect=="function"?el.getBoundingClientRect():{width:el.offsetWidth,height:el.offsetHeight},this.$element.offset())};Tooltip.prototype.getCalculatedOffset=function(placement,pos,actualWidth,actualHeight){return placement=="bottom"?{top:pos.top+pos.height,left:pos.left+pos.width/2-actualWidth/2}:placement=="top"?{top:pos.top-actualHeight,left:pos.left+pos.width/2-actualWidth/2}:placement=="left"?{top:pos.top+pos.height/2-actualHeight/2,left:pos.left-actualWidth}:{top:pos.top+pos.height/2-actualHeight/2,left:pos.left+pos.width}};Tooltip.prototype.getTitle=function(){var title;var $e=this.$element;var o=this.options;title=$e.attr("data-original-title")||(typeof o.title=="function"?o.title.call($e[0]):o.title);return title};Tooltip.prototype.tip=function(){return this.$tip=this.$tip||$(this.options.template)};Tooltip.prototype.arrow=function(){return this.$arrow=this.$arrow||this.tip().find(".tooltip-arrow")};Tooltip.prototype.validate=function(){if(!this.$element[0].parentNode){this.hide();this.$element=null;this.options=null}};Tooltip.prototype.enable=function(){this.enabled=true};Tooltip.prototype.disable=function(){this.enabled=false};Tooltip.prototype.toggleEnabled=function(){this.enabled=!this.enabled};Tooltip.prototype.toggle=function(e){var self=e?$(e.currentTarget)[this.type](this.getDelegateOptions()).data("bs."+this.type):this;self.tip().hasClass("in")?self.leave(self):self.enter(self)};Tooltip.prototype.destroy=function(){clearTimeout(this.timeout);this.hide().$element.off("."+this.type).removeData("bs."+this.type)};var old=$.fn.tooltip;$.fn.tooltip=function(option){return this.each(function(){var $this=$(this);var data=$this.data("bs.tooltip");var options=typeof option=="object"&&option;if(!data&&option=="destroy")return;if(!data)$this.data("bs.tooltip",data=new Tooltip(this,options));if(typeof option=="string")data[option]()})};$.fn.tooltip.Constructor=Tooltip;$.fn.tooltip.noConflict=function(){$.fn.tooltip=old;return this}}(jQuery);+function($){"use strict";var Popover=function(element,options){this.init("popover",element,options)};if(!$.fn.tooltip)throw new Error("Popover requires tooltip.js");Popover.DEFAULTS=$.extend({},$.fn.tooltip.Constructor.DEFAULTS,{placement:"right",trigger:"click",content:"",template:'<div class="popover"><div class="arrow"></div><h3 class="popover-title"></h3><div class="popover-content"></div></div>'});Popover.prototype=$.extend({},$.fn.tooltip.Constructor.prototype);Popover.prototype.constructor=Popover;Popover.prototype.getDefaults=function(){return Popover.DEFAULTS};Popover.prototype.setContent=function(){var $tip=this.tip();var title=this.getTitle();var content=this.getContent();$tip.find(".popover-title")[this.options.html?"html":"text"](title);$tip.find(".popover-content")[this.options.html?typeof content=="string"?"html":"append":"text"](content);$tip.removeClass("fade top bottom left right in");if(!$tip.find(".popover-title").html())$tip.find(".popover-title").hide()};Popover.prototype.hasContent=function(){return this.getTitle()||this.getContent()};Popover.prototype.getContent=function(){var $e=this.$element;var o=this.options;return $e.attr("data-content")||(typeof o.content=="function"?o.content.call($e[0]):o.content)};Popover.prototype.arrow=function(){return this.$arrow=this.$arrow||this.tip().find(".arrow")};Popover.prototype.tip=function(){if(!this.$tip)this.$tip=$(this.options.template);return this.$tip};var old=$.fn.popover;$.fn.popover=function(option){return this.each(function(){var $this=$(this);var data=$this.data("bs.popover");var options=typeof option=="object"&&option;if(!data&&option=="destroy")return;if(!data)$this.data("bs.popover",data=new Popover(this,options));if(typeof option=="string")data[option]()})};$.fn.popover.Constructor=Popover;$.fn.popover.noConflict=function(){$.fn.popover=old;return this}}(jQuery);+function($){"use strict";var Tab=function(element){this.element=$(element)};Tab.prototype.show=function(){var $this=this.element;var $ul=$this.closest("ul:not(.dropdown-menu)");var selector=$this.data("target");if(!selector){selector=$this.attr("href");selector=selector&&selector.replace(/.*(?=#[^\s]*$)/,"")}if($this.parent("li").hasClass("active"))return;var previous=$ul.find(".active:last a")[0];var e=$.Event("show.bs.tab",{relatedTarget:previous});$this.trigger(e);if(e.isDefaultPrevented())return;var $target=$(selector);this.activate($this.parent("li"),$ul);this.activate($target,$target.parent(),function(){$this.trigger({type:"shown.bs.tab",relatedTarget:previous})})};Tab.prototype.activate=function(element,container,callback){var $active=container.find("> .active");var transition=callback&&$.support.transition&&$active.hasClass("fade");function next(){$active.removeClass("active").find("> .dropdown-menu > .active").removeClass("active");element.addClass("active");if(transition){element[0].offsetWidth;element.addClass("in")}else{element.removeClass("fade")}if(element.parent(".dropdown-menu")){element.closest("li.dropdown").addClass("active")}callback&&callback()}transition?$active.one($.support.transition.end,next).emulateTransitionEnd(150):next();$active.removeClass("in")};var old=$.fn.tab;$.fn.tab=function(option){return this.each(function(){var $this=$(this);var data=$this.data("bs.tab");if(!data)$this.data("bs.tab",data=new Tab(this));if(typeof option=="string")data[option]()})};$.fn.tab.Constructor=Tab;$.fn.tab.noConflict=function(){$.fn.tab=old;return this};$(document).on("click.bs.tab.data-api",'[data-toggle="tab"], [data-toggle="pill"]',function(e){e.preventDefault();$(this).tab("show")})}(jQuery);+function($){"use strict";var Collapse=function(element,options){this.$element=$(element);this.options=$.extend({},Collapse.DEFAULTS,options);this.transitioning=null;if(this.options.parent)this.$parent=$(this.options.parent);if(this.options.toggle)this.toggle()};Collapse.DEFAULTS={toggle:true};Collapse.prototype.dimension=function(){var hasWidth=this.$element.hasClass("width");return hasWidth?"width":"height"};Collapse.prototype.show=function(){if(this.transitioning||this.$element.hasClass("in"))return;var startEvent=$.Event("show.bs.collapse");this.$element.trigger(startEvent);if(startEvent.isDefaultPrevented())return;var actives=this.$parent&&this.$parent.find("> .panel > .in");if(actives&&actives.length){var hasData=actives.data("bs.collapse");if(hasData&&hasData.transitioning)return;actives.collapse("hide");hasData||actives.data("bs.collapse",null)}var dimension=this.dimension();this.$element.removeClass("collapse").addClass("collapsing")[dimension](0);this.transitioning=1;var complete=function(){this.$element.removeClass("collapsing").addClass("collapse in")[dimension]("auto");this.transitioning=0;this.$element.trigger("shown.bs.collapse")};if(!$.support.transition)return complete.call(this);var scrollSize=$.camelCase(["scroll",dimension].join("-"));this.$element.one($.support.transition.end,$.proxy(complete,this)).emulateTransitionEnd(350)[dimension](this.$element[0][scrollSize])};Collapse.prototype.hide=function(){if(this.transitioning||!this.$element.hasClass("in"))return;var startEvent=$.Event("hide.bs.collapse");this.$element.trigger(startEvent);if(startEvent.isDefaultPrevented())return;var dimension=this.dimension();this.$element[dimension](this.$element[dimension]())[0].offsetHeight;this.$element.addClass("collapsing").removeClass("collapse").removeClass("in");this.transitioning=1;var complete=function(){this.transitioning=0;this.$element.trigger("hidden.bs.collapse").removeClass("collapsing").addClass("collapse")};if(!$.support.transition)return complete.call(this);this.$element[dimension](0).one($.support.transition.end,$.proxy(complete,this)).emulateTransitionEnd(350)};Collapse.prototype.toggle=function(){this[this.$element.hasClass("in")?"hide":"show"]()};var old=$.fn.collapse;$.fn.collapse=function(option){return this.each(function(){var $this=$(this);var data=$this.data("bs.collapse");var options=$.extend({},Collapse.DEFAULTS,$this.data(),typeof option=="object"&&option);if(!data&&options.toggle&&option=="show")option=!option;if(!data)$this.data("bs.collapse",data=new Collapse(this,options));if(typeof option=="string")data[option]()})};$.fn.collapse.Constructor=Collapse;$.fn.collapse.noConflict=function(){$.fn.collapse=old;return this};$(document).on("click.bs.collapse.data-api","[data-toggle=collapse]",function(e){var $this=$(this),href;var target=$this.attr("data-target")||e.preventDefault()||(href=$this.attr("href"))&&href.replace(/.*(?=#[^\s]+$)/,"");var $target=$(target);var data=$target.data("bs.collapse");var option=data?"toggle":$this.data();var parent=$this.attr("data-parent");var $parent=parent&&$(parent);if(!data||!data.transitioning){if($parent)$parent.find('[data-toggle=collapse][data-parent="'+parent+'"]').not($this).addClass("collapsed");$this[$target.hasClass("in")?"addClass":"removeClass"]("collapsed")}$target.collapse(option)})}(jQuery);+function($){"use strict";function transitionEnd(){var el=document.createElement("bootstrap");var transEndEventNames={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd otransitionend",transition:"transitionend"};for(var name in transEndEventNames){if(el.style[name]!==undefined){return{end:transEndEventNames[name]}}}return false}$.fn.emulateTransitionEnd=function(duration){var called=false,$el=this;$(this).one($.support.transition.end,function(){called=true});var callback=function(){if(!called)$($el).trigger($.support.transition.end)};setTimeout(callback,duration);return this};$(function(){$.support.transition=transitionEnd()})}(jQuery);var addToHome=function(w){var nav=w.navigator,isIDevice="platform"in nav&&/iphone|ipod|ipad/gi.test(nav.platform),isIPad,isRetina,isSafari,isStandalone,OSVersion,startX=0,startY=0,lastVisit=0,isExpired,isSessionActive,isReturningVisitor,balloon,overrideChecks,positionInterval,closeTimeout,options={autostart:true,returningVisitor:false,animationIn:"drop",animationOut:"fade",startDelay:2e3,lifespan:15e3,bottomOffset:14,expire:0,message:"",touchIcon:false,arrow:true,hookOnLoad:true,closeButton:true,iterations:100},intl={ar:'<span dir="rtl">قم بتثبيت هذا التطبيق على <span dir="ltr">%device:</span>انقر<span dir="ltr">%icon</span> ،<strong>ثم اضفه الى الشاشة الرئيسية.</strong></span>',ca_es:"Per instal·lar aquesta aplicació al vostre %device premeu %icon i llavors <strong>Afegir a pantalla d'inici</strong>.",cs_cz:"Pro instalaci aplikace na Váš %device, stiskněte %icon a v nabídce <strong>Přidat na plochu</strong>.",da_dk:"Tilføj denne side til din %device: tryk på %icon og derefter <strong>Føj til hjemmeskærm</strong>.",de_de:"Installieren Sie diese App auf Ihrem %device: %icon antippen und dann <strong>Zum Home-Bildschirm</strong>.",el_gr:"Εγκαταστήσετε αυτήν την Εφαρμογή στήν συσκευή σας %device: %icon μετά πατάτε <strong>Προσθήκη σε Αφετηρία</strong>.",en_us:"Install this web app on your %device: tap %icon and then <strong>Add to Home Screen</strong>.",es_es:"Para instalar esta app en su %device, pulse %icon y seleccione <strong>Añadir a pantalla de inicio</strong>.",fi_fi:"Asenna tämä web-sovellus laitteeseesi %device: paina %icon ja sen jälkeen valitse <strong>Lisää Koti-valikkoon</strong>.",fr_fr:"Ajoutez cette application sur votre %device en cliquant sur %icon, puis <strong>Ajouter à l'écran d'accueil</strong>.",he_il:'<span dir="rtl">התקן אפליקציה זו על ה-%device שלך: הקש %icon ואז <strong>הוסף למסך הבית</strong>.</span>',hr_hr:"Instaliraj ovu aplikaciju na svoj %device: klikni na %icon i odaberi <strong>Dodaj u početni zaslon</strong>.",hu_hu:"Telepítse ezt a web-alkalmazást az Ön %device-jára: nyomjon a %icon-ra majd a <strong>Főképernyőhöz adás</strong> gombra.",it_it:"Installa questa applicazione sul tuo %device: premi su %icon e poi <strong>Aggiungi a Home</strong>.",ja_jp:"このウェブアプリをあなたの%deviceにインストールするには%iconをタップして<strong>ホーム画面に追加</strong>を選んでください。",ko_kr:'%device에 웹앱을 설치하려면 %icon을 터치 후 "홈화면에 추가"를 선택하세요',nb_no:"Installer denne appen på din %device: trykk på %icon og deretter <strong>Legg til på Hjem-skjerm</strong>",nl_nl:"Installeer deze webapp op uw %device: tik %icon en dan <strong>Voeg toe aan beginscherm</strong>.",pl_pl:"Aby zainstalować tę aplikacje na %device: naciśnij %icon a następnie <strong>Dodaj jako ikonę</strong>.",pt_br:"Instale este aplicativo em seu %device: aperte %icon e selecione <strong>Adicionar à Tela Inicio</strong>.",pt_pt:"Para instalar esta aplicação no seu %device, prima o %icon e depois em <strong>Adicionar ao ecrã principal</strong>.",ru_ru:"Установите это веб-приложение на ваш %device: нажмите %icon, затем <strong>Добавить в «Домой»</strong>.",sv_se:"Lägg till denna webbapplikation på din %device: tryck på %icon och därefter <strong>Lägg till på hemskärmen</strong>.",th_th:"ติดตั้งเว็บแอพฯ นี้บน %device ของคุณ: แตะ %icon และ <strong>เพิ่มที่หน้าจอโฮม</strong>",tr_tr:"Bu uygulamayı %device'a eklemek için %icon simgesine sonrasında <strong>Ana Ekrana Ekle</strong> düğmesine basın.",uk_ua:"Встановіть цей веб сайт на Ваш %device: натисніть %icon, а потім <strong>На початковий екран</strong>.",zh_cn:"您可以将此应用程式安装到您的 %device 上。请按 %icon 然后点选<strong>添加至主屏幕</strong>。",zh_tw:"您可以將此應用程式安裝到您的 %device 上。請按 %icon 然後點選<strong>加入主畫面螢幕</strong>。"};function init(){if(!isIDevice)return;var now=Date.now(),i;if(w.addToHomeConfig){for(i in w.addToHomeConfig){options[i]=w.addToHomeConfig[i]}}if(!options.autostart)options.hookOnLoad=false;isIPad=/ipad/gi.test(nav.platform);isRetina=w.devicePixelRatio&&w.devicePixelRatio>1;isSafari=/Safari/i.test(nav.appVersion)&&!/CriOS/i.test(nav.appVersion);isStandalone=nav.standalone;OSVersion=nav.appVersion.match(/OS (\d+_\d+)/i);OSVersion=OSVersion&&OSVersion[1]?+OSVersion[1].replace("_","."):0;try{lastVisit=+w.localStorage.getItem("addToHome")}catch(e){}try{isSessionActive=w.sessionStorage.getItem("addToHomeSession")}catch(e){}isReturningVisitor=options.returningVisitor?lastVisit&&lastVisit+28*24*60*60*1e3>now:true;if(!lastVisit)lastVisit=now;isExpired=isReturningVisitor&&lastVisit<=now;if(options.hookOnLoad)w.addEventListener("load",loaded,false);else if(!options.hookOnLoad&&options.autostart)loaded()}function loaded(){w.removeEventListener("load",loaded,false);try{if(!isReturningVisitor)w.localStorage.setItem("addToHome",Date.now());else if(options.expire&&isExpired)w.localStorage.setItem("addToHome",Date.now()+options.expire*6e4)}catch(e){}if(!overrideChecks&&(!isSafari||!isExpired||isSessionActive||isStandalone||!isReturningVisitor))return;var touchIcon="",platform=nav.platform.split(" ")[0],language=nav.language.replace("-","_");balloon=document.createElement("div");balloon.id="addToHomeScreen";balloon.style.cssText+="left:-9999px;-webkit-transition-property:-webkit-transform,opacity;-webkit-transition-duration:0;-webkit-transform:translate3d(0,0,0);position:"+(OSVersion<5?"absolute":"fixed");if(options.message in intl){language=options.message;options.message=""}if(options.message===""){options.message=language in intl?intl[language]:intl["en_us"]}if(options.touchIcon){touchIcon=isRetina?document.querySelector('head link[rel^=apple-touch-icon][sizes="114x114"],head link[rel^=apple-touch-icon][sizes="144x144"],head link[rel^=apple-touch-icon]'):document.querySelector('head link[rel^=apple-touch-icon][sizes="57x57"],head link[rel^=apple-touch-icon]');if(touchIcon){touchIcon='<span style="background-image:url('+touchIcon.href+')" class="addToHomeTouchIcon"></span>'}}balloon.className=(OSVersion>=7?"addToHomeIOS7 ":"")+(isIPad?"addToHomeIpad":"addToHomeIphone")+(touchIcon?" addToHomeWide":"");balloon.innerHTML=touchIcon+options.message.replace("%device",platform).replace("%icon",OSVersion>=4.2?'<span class="addToHomeShare"></span>':'<span class="addToHomePlus">+</span>')+(options.arrow?'<span class="addToHomeArrow"'+(OSVersion>=7&&isIPad&&touchIcon?' style="margin-left:-32px"':"")+"></span>":"")+(options.closeButton?'<span class="addToHomeClose">x</span>':"");document.body.appendChild(balloon);if(options.closeButton)balloon.addEventListener("click",clicked,false);if(!isIPad&&OSVersion>=6)window.addEventListener("orientationchange",orientationCheck,false);setTimeout(show,options.startDelay)}function show(){var duration,iPadXShift=208;if(isIPad){if(OSVersion<5){startY=w.scrollY;startX=w.scrollX}else if(OSVersion<6){iPadXShift=160}else if(OSVersion>=7){iPadXShift=143}balloon.style.top=startY+options.bottomOffset+"px";balloon.style.left=Math.max(startX+iPadXShift-Math.round(balloon.offsetWidth/2),9)+"px";switch(options.animationIn){case"drop":duration="0.6s";balloon.style.webkitTransform="translate3d(0,"+-(w.scrollY+options.bottomOffset+balloon.offsetHeight)+"px,0)";break;case"bubble":duration="0.6s";balloon.style.opacity="0";balloon.style.webkitTransform="translate3d(0,"+(startY+50)+"px,0)";break;default:duration="1s";balloon.style.opacity="0"}}else{startY=w.innerHeight+w.scrollY;if(OSVersion<5){startX=Math.round((w.innerWidth-balloon.offsetWidth)/2)+w.scrollX;balloon.style.left=startX+"px";balloon.style.top=startY-balloon.offsetHeight-options.bottomOffset+"px"}else{balloon.style.left="50%";balloon.style.marginLeft=-Math.round(balloon.offsetWidth/2)-(w.orientation%180&&OSVersion>=6&&OSVersion<7?40:0)+"px";balloon.style.bottom=options.bottomOffset+"px"}switch(options.animationIn){case"drop":duration="1s";balloon.style.webkitTransform="translate3d(0,"+-(startY+options.bottomOffset)+"px,0)";break;case"bubble":duration="0.6s";balloon.style.webkitTransform="translate3d(0,"+(balloon.offsetHeight+options.bottomOffset+50)+"px,0)";break;default:duration="1s";balloon.style.opacity="0"}}balloon.offsetHeight;balloon.style.webkitTransitionDuration=duration;balloon.style.opacity="1";balloon.style.webkitTransform="translate3d(0,0,0)";balloon.addEventListener("webkitTransitionEnd",transitionEnd,false);closeTimeout=setTimeout(close,options.lifespan)}function manualShow(override){if(!isIDevice||balloon)return;overrideChecks=override;loaded()}function close(){clearInterval(positionInterval);clearTimeout(closeTimeout);closeTimeout=null;if(!balloon)return;var posY=0,posX=0,opacity="1",duration="0";if(options.closeButton)balloon.removeEventListener("click",clicked,false);if(!isIPad&&OSVersion>=6)window.removeEventListener("orientationchange",orientationCheck,false);if(OSVersion<5){posY=isIPad?w.scrollY-startY:w.scrollY+w.innerHeight-startY;posX=isIPad?w.scrollX-startX:w.scrollX+Math.round((w.innerWidth-balloon.offsetWidth)/2)-startX}balloon.style.webkitTransitionProperty="-webkit-transform,opacity";switch(options.animationOut){case"drop":if(isIPad){duration="0.4s";opacity="0";posY+=50}else{duration="0.6s";posY+=balloon.offsetHeight+options.bottomOffset+50}break;case"bubble":if(isIPad){duration="0.8s";posY-=balloon.offsetHeight+options.bottomOffset+50}else{duration="0.4s";opacity="0";posY-=50}break;default:duration="0.8s";opacity="0"}balloon.addEventListener("webkitTransitionEnd",transitionEnd,false);balloon.style.opacity=opacity;balloon.style.webkitTransitionDuration=duration;balloon.style.webkitTransform="translate3d("+posX+"px,"+posY+"px,0)"}function clicked(){try{w.sessionStorage.setItem("addToHomeSession","1")}catch(err){}isSessionActive=true;close()}function transitionEnd(){balloon.removeEventListener("webkitTransitionEnd",transitionEnd,false);balloon.style.webkitTransitionProperty="-webkit-transform";balloon.style.webkitTransitionDuration="0.2s";if(!closeTimeout){balloon.parentNode.removeChild(balloon);balloon=null;return}if(OSVersion<5&&closeTimeout)positionInterval=setInterval(setPosition,options.iterations)}function setPosition(){var matrix=new WebKitCSSMatrix(w.getComputedStyle(balloon,null).webkitTransform),posY=isIPad?w.scrollY-startY:w.scrollY+w.innerHeight-startY,posX=isIPad?w.scrollX-startX:w.scrollX+Math.round((w.innerWidth-balloon.offsetWidth)/2)-startX;if(posY==matrix.m42&&posX==matrix.m41)return;balloon.style.webkitTransform="translate3d("+posX+"px,"+posY+"px,0)"}function reset(){w.localStorage.removeItem("addToHome");w.sessionStorage.removeItem("addToHomeSession")}function orientationCheck(){balloon.style.marginLeft=-Math.round(balloon.offsetWidth/2)-(w.orientation%180&&OSVersion>=6&&OSVersion<7?40:0)+"px"}init();return{show:manualShow,close:close,reset:reset}}(window);(function(a){function n(b){a.each("touchstart touchmove touchend touchcancel".split(/ /),function(d,e){b.addEventListener(e,function(){a(b).trigger(e)},false)});return a(b)}function j(b){function d(){a(e).data(h,true);b.type=f;jQuery.event.handle.apply(e,o)}if(!a(this).data(g)){var e=this,o=arguments;a(this).data(h,false).data(g,setTimeout(d,a(this).data(i)||a.longclick.duration))}}function k(){a(this).data(g,clearTimeout(a(this).data(g))||null)}function l(b){if(a(this).data(h))return b.stopImmediatePropagation()||false}var p=a.fn.click;a.fn.click=function(b,d){if(!d)return p.apply(this,arguments);return a(this).data(i,b||null).bind(f,d)};a.fn.longclick=function(){var b=[].splice.call(arguments,0),d=b.pop();b=b.pop();var e=a(this).data(i,b||null);return d?e.click(b,d):e.trigger(f)};a.longclick={duration:500};a.event.special.longclick={setup:function(){/iphone|ipad|ipod/i.test(navigator.userAgent)?n(this).bind(q,j).bind([r,s,t].join(" "),k).bind(m,l).css({WebkitUserSelect:"none"}):a(this).bind(u,j).bind([v,w,x,y].join(" "),k).bind(m,l)},teardown:function(){a(this).unbind(c)}};var f="longclick",c="."+f,u="mousedown"+c,m="click"+c,v="mousemove"+c,w="mouseup"+c,x="mouseout"+c,y="contextmenu"+c,q="touchstart"+c,r="touchend"+c,s="touchmove"+c,t="touchcancel"+c,i="duration"+c,g="timer"+c,h="fired"+c})(jQuery);(function($){function fnPjax(selector,container,options){var context=this;return this.on("click.pjax",selector,function(event){var opts=$.extend({},optionsFor(container,options));if(!opts.container)opts.container=$(this).attr("data-pjax")||context;handleClick(event,opts)})}function handleClick(event,container,options){options=optionsFor(container,options);var link=event.currentTarget;if(link.tagName.toUpperCase()!=="A")throw"$.fn.pjax or $.pjax.click requires an anchor element";if(event.which>1||event.metaKey||event.ctrlKey||event.shiftKey||event.altKey)return;if(location.protocol!==link.protocol||location.hostname!==link.hostname)return;if(link.href.indexOf("#")>-1&&stripHash(link)==stripHash(location))return;if(event.isDefaultPrevented())return;var defaults={url:link.href,container:$(link).attr("data-pjax"),target:link};var opts=$.extend({},defaults,options);var clickEvent=$.Event("pjax:click");$(link).trigger(clickEvent,[opts]);if(!clickEvent.isDefaultPrevented()){pjax(opts);event.preventDefault();$(link).trigger("pjax:clicked",[opts])}}function handleSubmit(event,container,options){options=optionsFor(container,options);var form=event.currentTarget;var $form=$(form);if(form.tagName.toUpperCase()!=="FORM")throw"$.pjax.submit requires a form element";var defaults={type:($form.attr("method")||"GET").toUpperCase(),url:$form.attr("action"),container:$form.attr("data-pjax"),target:form};if(defaults.type!=="GET"&&window.FormData!==undefined){defaults.data=new FormData(form);defaults.processData=false;defaults.contentType=false}else{if($(form).find(":file").length){return}defaults.data=$(form).serializeArray()}pjax($.extend({},defaults,options));event.preventDefault()}function pjax(options){options=$.extend(true,{},$.ajaxSettings,pjax.defaults,options);if($.isFunction(options.url)){options.url=options.url()}var target=options.target;var hash=parseURL(options.url).hash;var context=options.context=findContainerFor(options.container);if(!options.data)options.data={};if($.isArray(options.data)){options.data.push({name:"_pjax",value:context.selector})}else{options.data._pjax=context.selector}function fire(type,args,props){if(!props)props={};props.relatedTarget=target;var event=$.Event(type,props);context.trigger(event,args);return!event.isDefaultPrevented()}var timeoutTimer;options.beforeSend=function(xhr,settings){if(settings.type!=="GET"){settings.timeout=0}xhr.setRequestHeader("X-PJAX","true");xhr.setRequestHeader("X-PJAX-Container",context.selector);if(!fire("pjax:beforeSend",[xhr,settings]))return false;if(settings.timeout>0){timeoutTimer=setTimeout(function(){if(fire("pjax:timeout",[xhr,options]))xhr.abort("timeout")},settings.timeout);settings.timeout=0}var url=parseURL(settings.url);if(hash)url.hash=hash;options.requestUrl=stripInternalParams(url)};options.complete=function(xhr,textStatus){if(timeoutTimer)clearTimeout(timeoutTimer);fire("pjax:complete",[xhr,textStatus,options]);fire("pjax:end",[xhr,options])};options.error=function(xhr,textStatus,errorThrown){var container=extractContainer("",xhr,options);var allowed=fire("pjax:error",[xhr,textStatus,errorThrown,options]);if(options.type=="GET"&&textStatus!=="abort"&&allowed){locationReplace(container.url)}};options.success=function(data,status,xhr){var previousState=pjax.state;var currentVersion=typeof $.pjax.defaults.version==="function"?$.pjax.defaults.version():$.pjax.defaults.version;var latestVersion=xhr.getResponseHeader("X-PJAX-Version");var container=extractContainer(data,xhr,options);var url=parseURL(container.url);if(hash){url.hash=hash;container.url=url.href}if(currentVersion&&latestVersion&&currentVersion!==latestVersion){locationReplace(container.url);return}if(!container.contents){locationReplace(container.url);return}pjax.state={id:options.id||uniqueId(),url:container.url,title:container.title,container:context.selector,fragment:options.fragment,timeout:options.timeout};if(options.push||options.replace){window.history.replaceState(pjax.state,container.title,container.url)}var blurFocus=$.contains(options.container,document.activeElement);if(blurFocus){try{document.activeElement.blur()}catch(e){}}if(container.title)document.title=container.title;fire("pjax:beforeReplace",[container.contents,options],{state:pjax.state,previousState:previousState});context.html(container.contents);var autofocusEl=context.find("input[autofocus], textarea[autofocus]").last()[0];if(autofocusEl&&document.activeElement!==autofocusEl){autofocusEl.focus()}executeScriptTags(container.scripts);var scrollTo=options.scrollTo;if(hash){var name=decodeURIComponent(hash.slice(1));var target=document.getElementById(name)||document.getElementsByName(name)[0];if(target)scrollTo=$(target).offset().top}if(typeof scrollTo=="number")$(window).scrollTop(scrollTo);fire("pjax:success",[data,status,xhr,options])};if(!pjax.state){pjax.state={id:uniqueId(),url:window.location.href,title:document.title,container:context.selector,fragment:options.fragment,timeout:options.timeout};window.history.replaceState(pjax.state,document.title)}abortXHR(pjax.xhr);pjax.options=options;var xhr=pjax.xhr=$.ajax(options);if(xhr.readyState>0){if(options.push&&!options.replace){cachePush(pjax.state.id,cloneContents(context));window.history.pushState(null,"",options.requestUrl)}fire("pjax:start",[xhr,options]);fire("pjax:send",[xhr,options])}return pjax.xhr}function pjaxReload(container,options){var defaults={url:window.location.href,push:false,replace:true,scrollTo:false};return pjax($.extend(defaults,optionsFor(container,options)))}function locationReplace(url){window.history.replaceState(null,"",pjax.state.url);window.location.replace(url)}var initialPop=true;var initialURL=window.location.href;var initialState=window.history.state;if(initialState&&initialState.container){pjax.state=initialState}if("state"in window.history){initialPop=false}function onPjaxPopstate(event){if(!initialPop){abortXHR(pjax.xhr)}var previousState=pjax.state;var state=event.state;var direction;if(state&&state.container){if(initialPop&&initialURL==state.url)return;if(previousState){if(previousState.id===state.id)return;direction=previousState.id<state.id?"forward":"back"}var cache=cacheMapping[state.id]||[];var container=$(cache[0]||state.container),contents=cache[1];if(container.length){if(previousState){cachePop(direction,previousState.id,cloneContents(container))}var popstateEvent=$.Event("pjax:popstate",{state:state,direction:direction});container.trigger(popstateEvent);var options={id:state.id,url:state.url,container:container,push:false,fragment:state.fragment,timeout:state.timeout,scrollTo:false};if(contents){container.trigger("pjax:start",[null,options]);pjax.state=state;if(state.title)document.title=state.title;var beforeReplaceEvent=$.Event("pjax:beforeReplace",{state:state,previousState:previousState});container.trigger(beforeReplaceEvent,[contents,options]);container.html(contents);container.trigger("pjax:end",[null,options])}else{pjax(options)}container[0].offsetHeight}else{locationReplace(location.href)}}initialPop=false}function fallbackPjax(options){var url=$.isFunction(options.url)?options.url():options.url,method=options.type?options.type.toUpperCase():"GET";var form=$("<form>",{method:method==="GET"?"GET":"POST",action:url,style:"display:none"});if(method!=="GET"&&method!=="POST"){form.append($("<input>",{type:"hidden",name:"_method",value:method.toLowerCase()}))
}var data=options.data;if(typeof data==="string"){$.each(data.split("&"),function(index,value){var pair=value.split("=");form.append($("<input>",{type:"hidden",name:pair[0],value:pair[1]}))})}else if($.isArray(data)){$.each(data,function(index,value){form.append($("<input>",{type:"hidden",name:value.name,value:value.value}))})}else if(typeof data==="object"){var key;for(key in data)form.append($("<input>",{type:"hidden",name:key,value:data[key]}))}$(document.body).append(form);form.submit()}function abortXHR(xhr){if(xhr&&xhr.readyState<4){xhr.onreadystatechange=$.noop;xhr.abort()}}function uniqueId(){return(new Date).getTime()}function cloneContents(container){var cloned=container.clone();cloned.find("script").each(function(){if(!this.src)jQuery._data(this,"globalEval",false)});return[container.selector,cloned.contents()]}function stripInternalParams(url){url.search=url.search.replace(/([?&])(_pjax|_)=[^&]*/g,"");return url.href.replace(/\?($|#)/,"$1")}function parseURL(url){var a=document.createElement("a");a.href=url;return a}function stripHash(location){return location.href.replace(/#.*/,"")}function optionsFor(container,options){if(container&&options)options.container=container;else if($.isPlainObject(container))options=container;else options={container:container};if(options.container)options.container=findContainerFor(options.container);return options}function findContainerFor(container){container=$(container);if(!container.length){throw"no pjax container for "+container.selector}else if(container.selector!==""&&container.context===document){return container}else if(container.attr("id")){return $("#"+container.attr("id"))}else{throw"cant get selector for pjax container!"}}function findAll(elems,selector){return elems.filter(selector).add(elems.find(selector))}function parseHTML(html){return $.parseHTML(html,document,true)}function extractContainer(data,xhr,options){var obj={},fullDocument=/<html/i.test(data);var serverUrl=xhr.getResponseHeader("X-PJAX-URL");obj.url=serverUrl?stripInternalParams(parseURL(serverUrl)):options.requestUrl;if(fullDocument){var $head=$(parseHTML(data.match(/<head[^>]*>([\s\S.]*)<\/head>/i)[0]));var $body=$(parseHTML(data.match(/<body[^>]*>([\s\S.]*)<\/body>/i)[0]))}else{var $head=$body=$(parseHTML(data))}if($body.length===0)return obj;obj.title=findAll($head,"title").last().text();if(options.fragment){if(options.fragment==="body"){var $fragment=$body}else{var $fragment=findAll($body,options.fragment).first()}if($fragment.length){obj.contents=options.fragment==="body"?$fragment:$fragment.contents();if(!obj.title)obj.title=$fragment.attr("title")||$fragment.data("title")}}else if(!fullDocument){obj.contents=$body}if(obj.contents){obj.contents=obj.contents.not(function(){return $(this).is("title")});obj.contents.find("title").remove();obj.scripts=findAll(obj.contents,"script[src]").remove();obj.contents=obj.contents.not(obj.scripts)}if(obj.title)obj.title=$.trim(obj.title);return obj}function executeScriptTags(scripts){if(!scripts)return;var existingScripts=$("script[src]");scripts.each(function(){var src=this.src;var matchedScripts=existingScripts.filter(function(){return this.src===src});if(matchedScripts.length)return;var script=document.createElement("script");var type=$(this).attr("type");if(type)script.type=type;script.src=$(this).attr("src");document.head.appendChild(script)})}var cacheMapping={};var cacheForwardStack=[];var cacheBackStack=[];function cachePush(id,value){cacheMapping[id]=value;cacheBackStack.push(id);trimCacheStack(cacheForwardStack,0);trimCacheStack(cacheBackStack,pjax.defaults.maxCacheLength)}function cachePop(direction,id,value){var pushStack,popStack;cacheMapping[id]=value;if(direction==="forward"){pushStack=cacheBackStack;popStack=cacheForwardStack}else{pushStack=cacheForwardStack;popStack=cacheBackStack}pushStack.push(id);if(id=popStack.pop())delete cacheMapping[id];trimCacheStack(pushStack,pjax.defaults.maxCacheLength)}function trimCacheStack(stack,length){while(stack.length>length)delete cacheMapping[stack.shift()]}function findVersion(){return $("meta").filter(function(){var name=$(this).attr("http-equiv");return name&&name.toUpperCase()==="X-PJAX-VERSION"}).attr("content")}function enable(){$.fn.pjax=fnPjax;$.pjax=pjax;$.pjax.enable=$.noop;$.pjax.disable=disable;$.pjax.click=handleClick;$.pjax.submit=handleSubmit;$.pjax.reload=pjaxReload;$.pjax.defaults={timeout:650,push:true,replace:false,type:"GET",dataType:"html",scrollTo:0,maxCacheLength:20,version:findVersion};$(window).on("popstate.pjax",onPjaxPopstate)}function disable(){$.fn.pjax=function(){return this};$.pjax=fallbackPjax;$.pjax.enable=enable;$.pjax.disable=$.noop;$.pjax.click=$.noop;$.pjax.submit=$.noop;$.pjax.reload=function(){window.location.reload()};$(window).off("popstate.pjax",onPjaxPopstate)}if($.inArray("state",$.event.props)<0)$.event.props.push("state");$.support.pjax=window.history&&window.history.pushState&&window.history.replaceState&&!navigator.userAgent.match(/((iPod|iPhone|iPad).+\bOS\s+[1-4]\D|WebApps\/.+CFNetwork)/);$.support.pjax?enable():disable()})(jQuery);function isMobile(){var width=window.innerWidth>0?window.innerWidth:screen.width;return width<768}function isIOS(){return/(iPad|iPhone|iPod)/g.test(navigator.userAgent)}function isOldIE(){return/MSIE [67]/g.test(navigator.userAgent)}function isAndroid(){return navigator.userAgent.match(/Android/i)||navigator.userAgent.match(/Windows Phone/i)||navigator.userAgent.match(/IEMobile/i)}function isTouchDevice(){return"ontouchstart"in document}function isCurrentlyWeekView(){return $("#week-view").length>0}function initTooltips(){if(!isTouchDevice()){Acuity.jQuery('[data-toggle="tooltip"], .btn-toggle-tooltip').tooltip()}}function debounce(func,wait,immediate){var timeout,result;return function(){var context=this,args=arguments,later,callNow;later=function(){timeout=null;if(!immediate){result=func.apply(context,args)}};callNow=immediate&&!timeout;clearTimeout(timeout);timeout=setTimeout(later,wait);if(callNow){result=func.apply(context,args)}return result}}function escapeHtml(html){return $("<div/>").text(html).html()}function isMetaKeyPressed(ev){if(!ev)return false;if(ev.which>1||ev.metaKey||ev.ctrlKey||ev.shiftKey||ev.altKey){return true}else{return false}}function initDetailNavElement(){if($(".detail-nav").length==0){$detailNav=$("<div />").addClass("detail-nav").addClass("nav");if($(".preferences-container").length){$detailNav.appendTo(".preferences-container")}else{$detailNav.appendTo($(".appointment-content").parent())}}}function async(script,cb){$.ajaxSetup({cache:true});$.getScript(script,cb)}if(!Array.prototype.indexOf){Array.prototype.indexOf=function(elt){var len=this.length>>>0;var from=Number(arguments[1])||0;from=from<0?Math.ceil(from):Math.floor(from);if(from<0)from+=len;for(;from<len;from++){if(from in this&&this[from]===elt)return from}return-1}}function track(n,d){if(typeof _cio!="undefined")_cio.track(n)}var Progress=function(){var timer=null;function start(){if(typeof NProgress!="undefined"){if(timer)clearTimeout(timer);timer=setTimeout(function(){NProgress.start()},200)}}function done(){if(timer)clearTimeout(timer);timer=null;if(typeof NProgress!="undefined"){NProgress.done()}}return{start:start,done:done}}();ErrorTrack["try"](function(){var lastGoto="";var lastAjax="";$.ajaxSetup({beforeSend:function(ev){lastAjax=ev.url}});var lastPjaxErrored=false;$(document).pjax("[data-pjax] a, a[data-pjax]","#container-wrapper");$(document).on("pjax:timeout",function(ev){Flash.error("Unable to connect, are you still online?<br />Retrying...");lastPjaxErrored=true;$("[data-loading-text]").button("reset")});$(document).on("pjax:start",function(ev){Progress.start();Flash.hide(true);lastPjaxErrored=false});$(document).on("pjax:error",function(ev,params){Progress.done();if(!params||params["statusText"]!="abort"){if(typeof trackJs!="undefined"&&typeof JSON!="undefined"){trackJs.track("pjax:error = "+JSON.stringify(params))}Flash.error("Something went wrong, please refresh this page and try again. [error]");lastPjaxErrored=true}$("[data-loading-text]").button("reset")});$(document).on("pjax:end",function(ev){Progress.done();Acuity.init();if(!lastPjaxErrored){Flash.hide(true)}else{lastPjaxErrored=false}$("[data-loading-text]").button("reset");$(".tooltip").remove();if(!isTouchDevice())$('[data-toggle="tooltip"]').tooltip();if($(".main-nav-container").length>=2){document.location.reload()}});if(!isTouchDevice())$('[data-toggle="tooltip"]').tooltip();window.Acuity=function($){var controllers={};function addController(selector,fn){controllers[selector]=fn;initControllerIfValid(selector,fn)}function initControllerIfValid(selector,fn){if(typeof fn=="function"&&$(selector).length&&!$(selector).get(0).controllerInited){$(selector).get(0).controllerInited=true;ErrorTrack["try"](function(){fn($,$($(selector).get(0)))})}}function init(){try{if(typeof localStorage!="undefined")localStorage.setItem("page",document.location)}catch(e){}initDetailNavElement();for(var selector in controllers){initControllerIfValid(selector,controllers[selector])}if(!Modernizr.inputtypes.date){var $dates=$('input[type="date"], .datepicker')}else{var $dates=$(".datepicker")}if(typeof $dates.datepicker!="undefined")$dates.datepicker({dateFormat:"yy-mm-dd"});initTooltips();if(!Modernizr.inputtypes.time){$('input[type="time"]').each(function(){$this=$(this);$this.val(formatTimeForHuman($this.val()))})}if(isTouchDevice()){$("body").removeClass("no-touch")}$(".view-old-site").popover();$(".view-old-site").click(function(ev){ev.preventDefault();$("#old-site-reason").focus()})}function pushState(href){if(typeof window.history!="undefined"&&typeof window.history.pushState!="undefined"){try{window.history.pushState({},null,href)}catch(err){}}}function goTo(url,extraOpts){if(typeof history=="undefined"||typeof history.pushState=="undefined"){document.location=url;return}if(typeof onbeforeunloadFn=="function"&&!onbeforeunloadFn()){return}var opts={url:url,container:"#container-wrapper",timeout:1e3*60};if(extraOpts){for(var k in extraOpts){opts[k]=extraOpts[k]}}lastGoto=url;$.pjax(opts);Details.hide();onbeforeunloadFn=null}var onbeforeunloadFn=null;function onbeforeunload(fn){onbeforeunloadFn=fn;return fn}if(typeof document.addEventListener!="undefined")document.addEventListener("touchstart",function(){},true);return{wrap:window.Acuity.wrap,addController:addController,init:init,goTo:goTo,onbeforeunload:onbeforeunload,pushState:pushState,jQuery:$,loadingHtml:'<div class="btn-detail-back"><div class="progress-spinner small"><div>Loading...</div></div><span class="loading-text">Loading...</span></div>'}}(jQuery);ErrorTrack["try"](function(){(function($){Acuity.init();$(document).on("click","a",function(ev){ErrorTrack["try"](function(){var href=$(ev.currentTarget).attr("href");if(href=="#"){ev.preventDefault();return}if(href&&href.length>=1&&href.substr(0,1)=="#"){return}if(isMetaKeyPressed(ev))return;if($(ev.currentTarget).attr("target")=="_blank"){return}var ignorePrefixes=["javascript:","mailto:","tel:","http"];for(var i in ignorePrefixes){var prefix=ignorePrefixes[i];if(href&&href.substr(0,prefix.length)==prefix){return}}if($(ev.target).closest(".redactor-box").length){return}if(href&&!ev.isDefaultPrevented()&&!$(ev.currentTarget).hasClass("real-link")){if(href.indexOf("logout.php")>-1||href.indexOf("help.php")>-1){window.location=href}else{Acuity.goTo(href)}ev.preventDefault();return false}})})})(Acuity.jQuery)});var oldonerror=window.onerror;window.onerror=function(message,file,line){if(oldonerror)oldonerror(message,file,line);if(""+message=="[object Event]"&&typeof message.type!="undefined"&&typeof window.trackJs!="undefined"){window.trackJs.track("Event: "+message.type+", target = "+(message.target||"no target")+", target = "+(message.target&&message.target.src?message.target.src:"no src"))}var img=new Image;img.src="/error_reporting?m="+encodeURIComponent(message)+"&user="+encodeURIComponent(window.USERID)}});Affix={affixedElements:[],checkTimeout:null,updateTime:50,init:function(element){if(!element)return $(".affix").each(function(){Affix.init($(this))});Affix.affixedElements.push(element);$scrollContainer=$(element).closest(".affix-scroll-container");if($scrollContainer&&$scrollContainer.length&&!$scrollContainer.get(0).hookedAffix){$scrollContainer.get(0).hookedAffix=true;$scrollContainer.on("scroll",Affix.checkAllPositions)}$(element).on("remove",function(){var index=Affix.affixedElements.indexOf(element);Affix.affixedElements.splice(index,1)});if(!window.affixedInitialized){$(window).on("scroll",Affix.checkAllPositions);$(window).on("click",Affix.checkAllPositions);$(window).on("resize",Affix.checkAllPositions);Affix.updateTime=isMobile()?50:10;window.affixedInitialized=true}},checkAllPositions:function(){if(Affix.checkTimeout)clearTimeout(Affix.checkTimeout);Affix.checkTimeout=setTimeout(function(){$(Affix.affixedElements).each(function(element){Affix.checkPosition($(this))})},Affix.updateTime)},checkPosition:function(element){$scrollContainer=$(element).closest(".affix-scroll-container");var scrollHeight=$(document.body).height();var scrollTop=$(window).scrollTop();var scrollLeft=$(window).scrollLeft();var positionTop=element.attr("data-top");var positionLeft=element.attr("data-left");var elementHeight=$(element).height();var offsetTop=0;var offsetBottom=0;var offset=$(element).offset();if(!offset)return;if($scrollContainer.css("overflow")=="visible"){$scrollContainer=null}if((!positionTop||positionTop=="0")&&offset.top>0){$(element).attr("data-top",offset.top);positionTop=offset.top}if((!positionLeft||positionLeft=="0")&&offset.left>0){$(element).attr("data-left",offset.left);positionLeft=offset.left}if(!positionLeft)positionLeft=0;if(!positionTop)positionTop=0;if($scrollContainer&&$scrollContainer.length){if($scrollContainer.get(0).scrollHeight>$scrollContainer.height()){scrollTop=$scrollContainer.scrollTop();positionTop=Math.max(0,positionTop-$scrollContainer.offset().top)}if($scrollContainer.get(0).scrollWidth>$scrollContainer.width()){scrollLeft=$scrollContainer.scrollLeft();positionLeft=Math.max(0,positionLeft-$scrollContainer.offset().left)}}var isAffixing=false;if($(element).hasClass("affix-top")){if(scrollTop>positionTop){if(!$(element).hasClass("navbar-fixed-top")){element.css({top:scrollTop-positionTop+"px"})}isAffixing=true}else{element.css({top:0})}}if($(element).hasClass("affix-left")){if(scrollLeft>positionLeft){element.css({left:scrollLeft-positionLeft-4+"px"});isAffixing=true}else{element.css({left:0})}}if(isAffixing){$(element).addClass("affixing");if(!$(element).hasClass("navbar-fixed-top"))element.css({position:"relative"});element.css({zIndex:500})}else{$(element).removeClass("affixing");element.css({position:""});element.css({zIndex:"3"})}}};(function(){var __slice=[].slice;(function($,window){"use strict";var BootstrapSwitch;BootstrapSwitch=function(){function BootstrapSwitch(element,options){if(options==null){options={}}this.$element=$(element);this.options=$.extend({},$.fn.bootstrapSwitch.defaults,{state:this.$element.is(":checked"),size:this.$element.data("size"),animate:this.$element.data("animate"),disabled:this.$element.is(":disabled"),readonly:this.$element.is("[readonly]"),indeterminate:this.$element.data("indeterminate"),inverse:this.$element.data("inverse"),radioAllOff:this.$element.data("radio-all-off"),onColor:this.$element.data("on-color"),offColor:this.$element.data("off-color"),onText:this.$element.data("on-text"),offText:this.$element.data("off-text"),labelText:this.$element.data("label-text"),handleWidth:this.$element.data("handle-width"),labelWidth:this.$element.data("label-width"),baseClass:this.$element.data("base-class"),wrapperClass:this.$element.data("wrapper-class")},options);this.$wrapper=$("<div>",{"class":function(_this){return function(){var classes;classes=[""+_this.options.baseClass].concat(_this._getClasses(_this.options.wrapperClass));classes.push(_this.options.state?""+_this.options.baseClass+"-on":""+_this.options.baseClass+"-off");if(_this.options.size!=null){classes.push(""+_this.options.baseClass+"-"+_this.options.size)}if(_this.options.disabled){classes.push(""+_this.options.baseClass+"-disabled")}if(_this.options.readonly){classes.push(""+_this.options.baseClass+"-readonly")}if(_this.options.indeterminate){classes.push(""+_this.options.baseClass+"-indeterminate")}if(_this.options.inverse){classes.push(""+_this.options.baseClass+"-inverse")}if(_this.$element.attr("id")){classes.push(""+_this.options.baseClass+"-id-"+_this.$element.attr("id"))}return classes.join(" ")}}(this)()});this.$container=$("<div>",{"class":""+this.options.baseClass+"-container"});this.$on=$("<span>",{html:this.options.onText,"class":""+this.options.baseClass+"-handle-on "+this.options.baseClass+"-"+this.options.onColor});this.$off=$("<span>",{html:this.options.offText,"class":""+this.options.baseClass+"-handle-off "+this.options.baseClass+"-"+this.options.offColor});this.$label=$("<span>",{html:this.options.labelText,"class":""+this.options.baseClass+"-label"});this.$element.on("init.bootstrapSwitch",function(_this){return function(){return _this.options.onInit.apply(element,arguments)}}(this));this.$element.on("switchChange.bootstrapSwitch",function(_this){return function(){return _this.options.onSwitchChange.apply(element,arguments)}}(this));this.$container=this.$element.wrap(this.$container).parent();this.$wrapper=this.$container.wrap(this.$wrapper).parent();this.$element.before(this.options.inverse?this.$off:this.$on).before(this.$label).before(this.options.inverse?this.$on:this.$off);if(this.options.indeterminate){this.$element.prop("indeterminate",true)}this._init();this._elementHandlers();this._handleHandlers();this._labelHandlers();this._formHandler();this._externalLabelHandler();this.$element.trigger("init.bootstrapSwitch")}BootstrapSwitch.prototype._constructor=BootstrapSwitch;BootstrapSwitch.prototype.state=function(value,skip){if(typeof value==="undefined"){return this.options.state}if(this.options.disabled||this.options.readonly){return this.$element}if(this.options.state&&!this.options.radioAllOff&&this.$element.is(":radio")){return this.$element}if(this.options.indeterminate){this.indeterminate(false)}value=!!value;this.$element.prop("checked",value).trigger("change.bootstrapSwitch",skip);return this.$element};BootstrapSwitch.prototype.toggleState=function(skip){if(this.options.disabled||this.options.readonly){return this.$element}if(this.options.indeterminate){this.indeterminate(false);return this.state(true)}else{return this.$element.prop("checked",!this.options.state).trigger("change.bootstrapSwitch",skip)}};BootstrapSwitch.prototype.size=function(value){if(typeof value==="undefined"){return this.options.size}if(this.options.size!=null){this.$wrapper.removeClass(""+this.options.baseClass+"-"+this.options.size)}if(value){this.$wrapper.addClass(""+this.options.baseClass+"-"+value)}this._width();this._containerPosition();this.options.size=value;return this.$element};BootstrapSwitch.prototype.animate=function(value){if(typeof value==="undefined"){return this.options.animate}value=!!value;if(value===this.options.animate){return this.$element}return this.toggleAnimate()};BootstrapSwitch.prototype.toggleAnimate=function(){this.options.animate=!this.options.animate;this.$wrapper.toggleClass(""+this.options.baseClass+"-animate");return this.$element};BootstrapSwitch.prototype.disabled=function(value){if(typeof value==="undefined"){return this.options.disabled}value=!!value;if(value===this.options.disabled){return this.$element}return this.toggleDisabled()};BootstrapSwitch.prototype.toggleDisabled=function(){this.options.disabled=!this.options.disabled;this.$element.prop("disabled",this.options.disabled);this.$wrapper.toggleClass(""+this.options.baseClass+"-disabled");return this.$element};BootstrapSwitch.prototype.readonly=function(value){if(typeof value==="undefined"){return this.options.readonly}value=!!value;if(value===this.options.readonly){return this.$element}return this.toggleReadonly()};BootstrapSwitch.prototype.toggleReadonly=function(){this.options.readonly=!this.options.readonly;this.$element.prop("readonly",this.options.readonly);this.$wrapper.toggleClass(""+this.options.baseClass+"-readonly");return this.$element};BootstrapSwitch.prototype.indeterminate=function(value){if(typeof value==="undefined"){return this.options.indeterminate}value=!!value;if(value===this.options.indeterminate){return this.$element}return this.toggleIndeterminate()};BootstrapSwitch.prototype.toggleIndeterminate=function(){this.options.indeterminate=!this.options.indeterminate;this.$element.prop("indeterminate",this.options.indeterminate);this.$wrapper.toggleClass(""+this.options.baseClass+"-indeterminate");this._containerPosition();return this.$element};BootstrapSwitch.prototype.inverse=function(value){if(typeof value==="undefined"){return this.options.inverse}value=!!value;if(value===this.options.inverse){return this.$element}return this.toggleInverse()};BootstrapSwitch.prototype.toggleInverse=function(){var $off,$on;this.$wrapper.toggleClass(""+this.options.baseClass+"-inverse");$on=this.$on.clone(true);$off=this.$off.clone(true);this.$on.replaceWith($off);this.$off.replaceWith($on);this.$on=$off;this.$off=$on;this.options.inverse=!this.options.inverse;return this.$element};BootstrapSwitch.prototype.onColor=function(value){var color;color=this.options.onColor;if(typeof value==="undefined"){return color}if(color!=null){this.$on.removeClass(""+this.options.baseClass+"-"+color)}this.$on.addClass(""+this.options.baseClass+"-"+value);this.options.onColor=value;return this.$element};BootstrapSwitch.prototype.offColor=function(value){var color;color=this.options.offColor;if(typeof value==="undefined"){return color}if(color!=null){this.$off.removeClass(""+this.options.baseClass+"-"+color)}this.$off.addClass(""+this.options.baseClass+"-"+value);this.options.offColor=value;return this.$element};BootstrapSwitch.prototype.onText=function(value){if(typeof value==="undefined"){return this.options.onText}this.$on.html(value);this._width();this._containerPosition();this.options.onText=value;return this.$element};BootstrapSwitch.prototype.offText=function(value){if(typeof value==="undefined"){return this.options.offText}this.$off.html(value);this._width();this._containerPosition();this.options.offText=value;return this.$element};BootstrapSwitch.prototype.labelText=function(value){if(typeof value==="undefined"){return this.options.labelText}this.$label.html(value);this._width();this.options.labelText=value;return this.$element};BootstrapSwitch.prototype.handleWidth=function(value){if(typeof value==="undefined"){return this.options.handleWidth}this.options.handleWidth=value;this._width();this._containerPosition();return this.$element};BootstrapSwitch.prototype.labelWidth=function(value){if(typeof value==="undefined"){return this.options.labelWidth}this.options.labelWidth=value;this._width();this._containerPosition();return this.$element};BootstrapSwitch.prototype.baseClass=function(value){return this.options.baseClass};BootstrapSwitch.prototype.wrapperClass=function(value){if(typeof value==="undefined"){return this.options.wrapperClass}if(!value){value=$.fn.bootstrapSwitch.defaults.wrapperClass}this.$wrapper.removeClass(this._getClasses(this.options.wrapperClass).join(" "));this.$wrapper.addClass(this._getClasses(value).join(" "));this.options.wrapperClass=value;return this.$element};BootstrapSwitch.prototype.radioAllOff=function(value){if(typeof value==="undefined"){return this.options.radioAllOff}value=!!value;if(value===this.options.radioAllOff){return this.$element}this.options.radioAllOff=value;return this.$element};BootstrapSwitch.prototype.onInit=function(value){if(typeof value==="undefined"){return this.options.onInit}if(!value){value=$.fn.bootstrapSwitch.defaults.onInit}this.options.onInit=value;return this.$element};BootstrapSwitch.prototype.onSwitchChange=function(value){if(typeof value==="undefined"){return this.options.onSwitchChange}if(!value){value=$.fn.bootstrapSwitch.defaults.onSwitchChange}this.options.onSwitchChange=value;return this.$element};BootstrapSwitch.prototype.destroy=function(){var $form;$form=this.$element.closest("form");if($form.length){$form.off("reset.bootstrapSwitch").removeData("bootstrap-switch")}this.$container.children().not(this.$element).remove();this.$element.unwrap().unwrap().off(".bootstrapSwitch").removeData("bootstrap-switch");return this.$element};BootstrapSwitch.prototype._width=function(){var $handles,handleWidth;$handles=this.$on.add(this.$off);$handles.add(this.$label).css("width","");handleWidth=this.options.handleWidth==="auto"?Math.max(this.$on.width(),this.$off.width()):this.options.handleWidth;$handles.width(handleWidth);this.$label.width(function(_this){return function(index,width){if(_this.options.labelWidth!=="auto"){return _this.options.labelWidth}if(width<handleWidth){return handleWidth}else{return width}}}(this));this._handleWidth=this.$on.outerWidth();this._labelWidth=this.$label.outerWidth();this.$container.width(this._handleWidth*2+this._labelWidth);return this.$wrapper.width(this._handleWidth+this._labelWidth)};BootstrapSwitch.prototype._containerPosition=function(state,callback){if(state==null){state=this.options.state}this.$container.css("margin-left",function(_this){return function(){var values;values=[0,"-"+_this._handleWidth+"px"];if(_this.options.indeterminate){return"-"+_this._handleWidth/2+"px"}if(state){if(_this.options.inverse){return values[1]}else{return values[0]}}else{if(_this.options.inverse){return values[0]}else{return values[1]}}}}(this));if(!callback){return}return setTimeout(function(){return callback()},50)};BootstrapSwitch.prototype._init=function(){var init,initInterval;init=function(_this){return function(){_this._width();return _this._containerPosition(null,function(){if(_this.options.animate){return _this.$wrapper.addClass(""+_this.options.baseClass+"-animate")}})}}(this);if(this.$wrapper.is(":visible")){return init()}return initInterval=window.setInterval(function(_this){return function(){if(_this.$wrapper.is(":visible")){init();return window.clearInterval(initInterval)}}}(this),50)};BootstrapSwitch.prototype._elementHandlers=function(){return this.$element.on({"change.bootstrapSwitch":function(_this){return function(e,skip){var state;e.preventDefault();e.stopImmediatePropagation();state=_this.$element.is(":checked");_this._containerPosition(state);if(state===_this.options.state){return}_this.options.state=state;_this.$wrapper.toggleClass(""+_this.options.baseClass+"-off").toggleClass(""+_this.options.baseClass+"-on");if(!skip){if(_this.$element.is(":radio")){$("[name='"+_this.$element.attr("name")+"']").not(_this.$element).prop("checked",false).trigger("change.bootstrapSwitch",true)}return _this.$element.trigger("switchChange.bootstrapSwitch",[state])}}}(this),"focus.bootstrapSwitch":function(_this){return function(e){e.preventDefault();return _this.$wrapper.addClass(""+_this.options.baseClass+"-focused")}}(this),"blur.bootstrapSwitch":function(_this){return function(e){e.preventDefault();return _this.$wrapper.removeClass(""+_this.options.baseClass+"-focused")}}(this),"keydown.bootstrapSwitch":function(_this){return function(e){if(!e.which||_this.options.disabled||_this.options.readonly){return}switch(e.which){case 37:e.preventDefault();e.stopImmediatePropagation();return _this.state(false);case 39:e.preventDefault();e.stopImmediatePropagation();return _this.state(true)}}}(this)})};BootstrapSwitch.prototype._handleHandlers=function(){this.$on.on("click.bootstrapSwitch",function(_this){return function(event){event.preventDefault();event.stopPropagation();_this.state(false);return _this.$element.trigger("focus.bootstrapSwitch")}}(this));return this.$off.on("click.bootstrapSwitch",function(_this){return function(event){event.preventDefault();event.stopPropagation();_this.state(true);return _this.$element.trigger("focus.bootstrapSwitch")}}(this))};BootstrapSwitch.prototype._labelHandlers=function(){return this.$label.on({"mousedown.bootstrapSwitch touchstart.bootstrapSwitch":function(_this){return function(e){if(_this._dragStart||_this.options.disabled||_this.options.readonly){return}e.preventDefault();e.stopPropagation();_this._dragStart=(e.pageX||e.originalEvent.touches[0].pageX)-parseInt(_this.$container.css("margin-left"),10);if(_this.options.animate){_this.$wrapper.removeClass(""+_this.options.baseClass+"-animate")}return _this.$element.trigger("focus.bootstrapSwitch")}}(this),"mousemove.bootstrapSwitch touchmove.bootstrapSwitch":function(_this){return function(e){var difference;if(_this._dragStart==null){return}e.preventDefault();difference=(e.pageX||e.originalEvent.touches[0].pageX)-_this._dragStart;if(difference<-_this._handleWidth||difference>0){return}_this._dragEnd=difference;return _this.$container.css("margin-left",""+_this._dragEnd+"px")}}(this),"mouseup.bootstrapSwitch touchend.bootstrapSwitch":function(_this){return function(e){var state;if(!_this._dragStart){return}e.preventDefault();if(_this.options.animate){_this.$wrapper.addClass(""+_this.options.baseClass+"-animate")}if(_this._dragEnd){state=_this._dragEnd>-(_this._handleWidth/2);_this._dragEnd=false;_this.state(_this.options.inverse?!state:state)}else{_this.state(!_this.options.state)}return _this._dragStart=false}}(this),"mouseleave.bootstrapSwitch":function(_this){return function(e){return _this.$label.trigger("mouseup.bootstrapSwitch")}}(this)})};BootstrapSwitch.prototype._externalLabelHandler=function(){var $externalLabel;$externalLabel=this.$element.closest("label");return $externalLabel.on("click",function(_this){return function(event){event.preventDefault();event.stopImmediatePropagation();if(event.target===$externalLabel[0]){return _this.toggleState()}}}(this))};BootstrapSwitch.prototype._formHandler=function(){var $form;$form=this.$element.closest("form");if($form.data("bootstrap-switch")){return}return $form.on("reset.bootstrapSwitch",function(){return window.setTimeout(function(){return $form.find("input").filter(function(){return $(this).data("bootstrap-switch")}).each(function(){return $(this).bootstrapSwitch("state",this.checked)})},1)}).data("bootstrap-switch",true)};BootstrapSwitch.prototype._getClasses=function(classes){var c,cls,_i,_len;if(!$.isArray(classes)){return[""+this.options.baseClass+"-"+classes]}cls=[];for(_i=0,_len=classes.length;_i<_len;_i++){c=classes[_i];cls.push(""+this.options.baseClass+"-"+c)}return cls};return BootstrapSwitch}();$.fn.bootstrapSwitch=function(){var args,option,ret;option=arguments[0],args=2<=arguments.length?__slice.call(arguments,1):[];ret=this;this.each(function(){var $this,data;$this=$(this);data=$this.data("bootstrap-switch");if(!data){$this.data("bootstrap-switch",data=new BootstrapSwitch(this,option))}if(typeof option==="string"){return ret=data[option].apply(data,args)}});return ret};$.fn.bootstrapSwitch.Constructor=BootstrapSwitch;return $.fn.bootstrapSwitch.defaults={state:true,size:null,animate:true,disabled:false,readonly:false,indeterminate:false,inverse:false,radioAllOff:false,onColor:"primary",offColor:"default",onText:"ON",offText:"OFF",labelText:"&nbsp;",handleWidth:"auto",labelWidth:"auto",baseClass:"bootstrap-switch",wrapperClass:"wrapper",onInit:function(){},onSwitchChange:function(){}}})(window.jQuery,window)}).call(this);if(typeof Object.defineProperty=="function"&&!/MSIE [678]/g.test(navigator.userAgent)&&!(navigator.userAgent.indexOf("Safari")!=-1&&navigator.userAgent.indexOf("Chrome")==-1)){(function(f){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=f()}else if(typeof define==="function"&&define.amd){define([],f)}else{var g;if(typeof window!=="undefined"){g=window}else if(typeof global!=="undefined"){g=global}else if(typeof self!=="undefined"){g=self}else{g=this}g.Clipboard=f()}})(function(){var define,module,exports;return function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;
if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s}({1:[function(require,module,exports){var matches=require("matches-selector");module.exports=function(element,selector,checkYoSelf){var parent=checkYoSelf?element:element.parentNode;while(parent&&parent!==document){if(matches(parent,selector))return parent;parent=parent.parentNode}}},{"matches-selector":2}],2:[function(require,module,exports){var proto=Element.prototype;var vendor=proto.matchesSelector||proto.webkitMatchesSelector||proto.mozMatchesSelector||proto.msMatchesSelector||proto.oMatchesSelector;module.exports=match;function match(el,selector){if(vendor)return vendor.call(el,selector);var nodes=el.parentNode.querySelectorAll(selector);for(var i=0;i<nodes.length;++i){if(nodes[i]==el)return true}return false}},{}],3:[function(require,module,exports){var closest=require("closest");function delegate(element,selector,type,callback){var listenerFn=listener.apply(this,arguments);element.addEventListener(type,listenerFn);return{destroy:function(){element.removeEventListener(type,listenerFn)}}}function listener(element,selector,type,callback){return function(e){e.delegateTarget=closest(e.target,selector,true);if(e.delegateTarget){callback.call(element,e)}}}module.exports=delegate},{closest:1}],4:[function(require,module,exports){exports.node=function(value){return value!==undefined&&value instanceof HTMLElement&&value.nodeType===1};exports.nodeList=function(value){var type=Object.prototype.toString.call(value);return value!==undefined&&(type==="[object NodeList]"||type==="[object HTMLCollection]")&&"length"in value&&(value.length===0||exports.node(value[0]))};exports.string=function(value){return typeof value==="string"||value instanceof String};exports["function"]=function(value){var type=Object.prototype.toString.call(value);return type==="[object Function]"}},{}],5:[function(require,module,exports){var is=require("./is");var delegate=require("delegate");function listen(target,type,callback){if(!target&&!type&&!callback){throw new Error("Missing required arguments")}if(!is.string(type)){throw new TypeError("Second argument must be a String")}if(!is["function"](callback)){throw new TypeError("Third argument must be a Function")}if(is.node(target)){return listenNode(target,type,callback)}else if(is.nodeList(target)){return listenNodeList(target,type,callback)}else if(is.string(target)){return listenSelector(target,type,callback)}else{throw new TypeError("First argument must be a String, HTMLElement, HTMLCollection, or NodeList")}}function listenNode(node,type,callback){node.addEventListener(type,callback);return{destroy:function(){node.removeEventListener(type,callback)}}}function listenNodeList(nodeList,type,callback){Array.prototype.forEach.call(nodeList,function(node){node.addEventListener(type,callback)});return{destroy:function(){Array.prototype.forEach.call(nodeList,function(node){node.removeEventListener(type,callback)})}}}function listenSelector(selector,type,callback){return delegate(document.body,selector,type,callback)}module.exports=listen},{"./is":4,delegate:3}],6:[function(require,module,exports){function select(element){var selectedText;if(element.nodeName==="INPUT"||element.nodeName==="TEXTAREA"){element.focus();element.setSelectionRange(0,element.value.length);selectedText=element.value}else{if(element.hasAttribute("contenteditable")){element.focus()}var selection=window.getSelection();var range=document.createRange();range.selectNodeContents(element);selection.removeAllRanges();selection.addRange(range);selectedText=selection.toString()}return selectedText}module.exports=select},{}],7:[function(require,module,exports){function E(){}E.prototype={on:function(name,callback,ctx){var e=this.e||(this.e={});(e[name]||(e[name]=[])).push({fn:callback,ctx:ctx});return this},once:function(name,callback,ctx){var self=this;function listener(){self.off(name,listener);callback.apply(ctx,arguments)}listener._=callback;return this.on(name,listener,ctx)},emit:function(name){var data=[].slice.call(arguments,1);var evtArr=((this.e||(this.e={}))[name]||[]).slice();var i=0;var len=evtArr.length;for(i;i<len;i++){evtArr[i].fn.apply(evtArr[i].ctx,data)}return this},off:function(name,callback){var e=this.e||(this.e={});var evts=e[name];var liveEvents=[];if(evts&&callback){for(var i=0,len=evts.length;i<len;i++){if(evts[i].fn!==callback&&evts[i].fn._!==callback)liveEvents.push(evts[i])}}liveEvents.length?e[name]=liveEvents:delete e[name];return this}};module.exports=E},{}],8:[function(require,module,exports){"use strict";exports.__esModule=true;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var _select=require("select");var _select2=_interopRequireDefault(_select);var ClipboardAction=function(){function ClipboardAction(options){_classCallCheck(this,ClipboardAction);this.resolveOptions(options);this.initSelection()}ClipboardAction.prototype.resolveOptions=function resolveOptions(){var options=arguments.length<=0||arguments[0]===undefined?{}:arguments[0];this.action=options.action;this.emitter=options.emitter;this.target=options.target;this.text=options.text;this.trigger=options.trigger;this.selectedText=""};ClipboardAction.prototype.initSelection=function initSelection(){if(this.text&&this.target){throw new Error('Multiple attributes declared, use either "target" or "text"')}else if(this.text){this.selectFake()}else if(this.target){this.selectTarget()}else{throw new Error('Missing required attributes, use either "target" or "text"')}};ClipboardAction.prototype.selectFake=function selectFake(){var _this=this;this.removeFake();this.fakeHandler=document.body.addEventListener("click",function(){return _this.removeFake()});this.fakeElem=document.createElement("textarea");this.fakeElem.style.position="absolute";this.fakeElem.style.left="-9999px";this.fakeElem.style.top=(window.pageYOffset||document.documentElement.scrollTop)+"px";this.fakeElem.setAttribute("readonly","");this.fakeElem.value=this.text;document.body.appendChild(this.fakeElem);this.selectedText=_select2["default"](this.fakeElem);this.copyText()};ClipboardAction.prototype.removeFake=function removeFake(){if(this.fakeHandler){document.body.removeEventListener("click");this.fakeHandler=null}if(this.fakeElem){document.body.removeChild(this.fakeElem);this.fakeElem=null}};ClipboardAction.prototype.selectTarget=function selectTarget(){this.selectedText=_select2["default"](this.target);this.copyText()};ClipboardAction.prototype.copyText=function copyText(){var succeeded=undefined;try{succeeded=document.execCommand(this.action)}catch(err){succeeded=false}this.handleResult(succeeded)};ClipboardAction.prototype.handleResult=function handleResult(succeeded){if(succeeded){this.emitter.emit("success",{action:this.action,text:this.selectedText,trigger:this.trigger,clearSelection:this.clearSelection.bind(this)})}else{this.emitter.emit("error",{action:this.action,trigger:this.trigger,clearSelection:this.clearSelection.bind(this)})}};ClipboardAction.prototype.clearSelection=function clearSelection(){if(this.target){this.target.blur()}window.getSelection().removeAllRanges()};ClipboardAction.prototype.destroy=function destroy(){this.removeFake()};_createClass(ClipboardAction,[{key:"action",set:function set(){var action=arguments.length<=0||arguments[0]===undefined?"copy":arguments[0];this._action=action;if(this._action!=="copy"&&this._action!=="cut"){throw new Error('Invalid "action" value, use either "copy" or "cut"')}},get:function get(){return this._action}},{key:"target",set:function set(target){if(target!==undefined){if(target&&typeof target==="object"&&target.nodeType===1){this._target=target}else{throw new Error('Invalid "target" value, use a valid Element')}}},get:function get(){return this._target}}]);return ClipboardAction}();exports["default"]=ClipboardAction;module.exports=exports["default"]},{select:6}],9:[function(require,module,exports){"use strict";exports.__esModule=true;function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var _clipboardAction=require("./clipboard-action");var _clipboardAction2=_interopRequireDefault(_clipboardAction);var _tinyEmitter=require("tiny-emitter");var _tinyEmitter2=_interopRequireDefault(_tinyEmitter);var _goodListener=require("good-listener");var _goodListener2=_interopRequireDefault(_goodListener);var Clipboard=function(_Emitter){_inherits(Clipboard,_Emitter);function Clipboard(trigger,options){_classCallCheck(this,Clipboard);_Emitter.call(this);this.resolveOptions(options);this.listenClick(trigger)}Clipboard.prototype.resolveOptions=function resolveOptions(){var options=arguments.length<=0||arguments[0]===undefined?{}:arguments[0];this.action=typeof options.action==="function"?options.action:this.defaultAction;this.target=typeof options.target==="function"?options.target:this.defaultTarget;this.text=typeof options.text==="function"?options.text:this.defaultText};Clipboard.prototype.listenClick=function listenClick(trigger){var _this=this;this.listener=_goodListener2["default"](trigger,"click",function(e){return _this.onClick(e)})};Clipboard.prototype.onClick=function onClick(e){var trigger=e.delegateTarget||e.currentTarget;if(this.clipboardAction){this.clipboardAction=null}this.clipboardAction=new _clipboardAction2["default"]({action:this.action(trigger),target:this.target(trigger),text:this.text(trigger),trigger:trigger,emitter:this})};Clipboard.prototype.defaultAction=function defaultAction(trigger){return getAttributeValue("action",trigger)};Clipboard.prototype.defaultTarget=function defaultTarget(trigger){var selector=getAttributeValue("target",trigger);if(selector){return document.querySelector(selector)}};Clipboard.prototype.defaultText=function defaultText(trigger){return getAttributeValue("text",trigger)};Clipboard.prototype.destroy=function destroy(){this.listener.destroy();if(this.clipboardAction){this.clipboardAction.destroy();this.clipboardAction=null}};return Clipboard}(_tinyEmitter2["default"]);function getAttributeValue(suffix,element){var attribute="data-clipboard-"+suffix;if(!element.hasAttribute(attribute)){return}return element.getAttribute(attribute)}exports["default"]=Clipboard;module.exports=exports["default"]},{"./clipboard-action":8,"good-listener":5,"tiny-emitter":7}]},{},[9])(9)})}else{Clipboard=function(selector){if(selector)$(selector).hide();return{on:function(){}}}}var Details=function($){var detailFormsChanged=false;var detailNavShowing=false;var detailCache={};$(document).on("submit","form.detail-nav-link",function(event){var el=event.currentTarget;if($(".detail-nav:visible").length&&!event.isDefaultPrevented()&&!el.hasAlreadySubmitted){$.pjax.submit(event,".detail-nav",{timeout:0,url:el.action+"&ajax=1",push:false});el.hasAlreadySubmitted=true}});$(document).on("pjax:complete",function(){$(".detail-nav a.detail-nav-link").click(onDetailNavLinkClicked);detailFormsChanged=false;positionDetailNav(true)});function getCached(key){return detailCache[key]}function onDetailNavLinkClicked(ev){if(ev.which>1||ev.metaKey||ev.ctrlKey||ev.shiftKey||ev.altKey)return;if(!ev.isDefaultPrevented()&&$(ev.currentTarget).attr("href")){ev.preventDefault();ev.stopPropagation();ev.stopImmediatePropagation();loadIntoDetails($(ev.currentTarget).attr("href"),{dontScrollTop:true})}}$("body, html").on("click",".detail-nav a.detail-nav-link",onDetailNavLinkClicked);$("body, html").on("click","a.detail-nav-link-always",onDetailNavLinkClicked);$("body, html").on("click",".detail-nav .btn-detail-back",function(ev){ev.preventDefault();ev.stopPropagation();ev.stopImmediatePropagation();showMenu("detail-nav-display");$(document).trigger("acuity:detailsClosed")});$("body, html").on("change",".detail-nav form",function(ev){detailFormsChanged=true});$("body").on("click",".appointment-list-container, .content.default",function(ev){if(!detailFormsChanged&&detailNavShowing&&$(ev.target).closest(".detail-nav").length==0){hide()}});$(window).on("popstate",function(ev){hide()});function showMenu(targetClass){var container=$(".container");if(targetClass){if(targetClass!="detail-nav-display"){container.removeClass("detail-nav-display")}else{$(".popover").remove()}$(".menu-toggler").each(function(){var otherClass=$(this).attr("data-class");if(otherClass!=targetClass&&container.hasClass(otherClass)){if(otherClass!="main-nav-display")container.removeClass(otherClass)}});container.toggleClass(targetClass);if(!container.hasClass("detail-nav-display")){detailNavShowing=false}detailFormsChanged=false}}function hide(){if($(".container").hasClass("detail-nav-display")){showMenu("detail-nav-display")}}function getDetailNav(){initDetailNavElement();return $(".detail-nav")}function positionDetailNav(dontScrollTop){var minimumTopOffset=0;if(!isMobile()){minimumTopOffset=($(".content-module-full, .content-module-custom, .client-list-standalone, .appointment-list-container").first().offset()||{top:0}).top}var $details=getDetailNav();$details.css({marginTop:0});if(dontScrollTop){$details.css({marginTop:Math.max(0,Math.max(minimumTopOffset,$(window).scrollTop())-$details.offset().top)+"px"})}else{$details.css({marginTop:Math.max(0,minimumTopOffset-$details.offset().top)+"px"});$("body, html").animate({scrollTop:"0px"},300)}}function loadGeneric(cb,doAnimate,opts){opts=opts||{};hide();var $details=getDetailNav();showMenu("detail-nav-display");detailFormsChanged=false;var $cacheParent=$(".detail-nav:visible [data-detail-cache]");if($cacheParent.length){detailCache[$cacheParent.attr("data-detail-cache")]=$(".detail-nav").html()}if(doAnimate)$details.removeClass("slideInRight").html(Acuity.loadingHtml);$(".popover").remove();Acuity.hideMainNav();cb(function(data){$details.html(data).addClass("fast-animated").addClass("slideInRight");Acuity.init();$(".detail-nav a.detail-nav-link").click(onDetailNavLinkClicked);setTimeout(function(){$(".detail-nav").removeClass("slideInRight");detailNavShowing=new Date},300)});positionDetailNav(opts.dontScrollTop)}function loadContentIntoDetails(html,opts){if(!html)return;loadGeneric(function(oncomplete){oncomplete(html)},false,opts)}function loadIntoDetails(uri,opts){if(!uri)return;loadGeneric(function(oncomplete){FastJax.get(uri+(uri.indexOf("?")>-1?"&":"?")+"ajax=1",oncomplete).fail(function(){hide();if(typeof Flash!="undefined")Flash.error("Failed to load, please try again");Progress.done()})},true,opts)}return{loadUri:loadIntoDetails,loadHtml:loadContentIntoDetails,showMenu:showMenu,hide:hide,getCached:getCached,createDetailNav:getDetailNav}}(jQuery);var mceInitialized=false;function makeEditor($el,redactorOpts){if(typeof tinyMCE=="undefined"){if($el.closest(".redactor_box").length==0){$el.redactor(redactorOpts)}}else{if(!mceInitialized){tinyMCE.init({mode:"textareas",theme:"advanced",theme_advanced_toolbar_location:"top",theme_advanced_toolbar_align:"left",theme_advanced_buttons1:"bold,italic,underline,strikethrough,|,justifyleft,justifycenter,justifyright,justifyfull,|,styleselect,formatselect,fontselect,fontsizeselect",theme_advanced_buttons2:"bullist,numlist,|,outdent,indent,|,undo,redo,|,link,unlink,anchor,image,code,preview,|,forecolor,backcolor,|,paste,pasteword",theme_advanced_buttons3:"",editor_selector:"mceEditor",valid_elements:"*[*]"});mceInitialized=true}if(!$el.hasClass("mceEditor"))tinyMCE.execCommand("mceAddControl",false,$el.get(0).id)}}function hideEditor($el){if(!mceInitialized){$el.redactor("core.getBox").hide()}else{$(tinyMCE.get($el.get(0).id).editorContainer).hide()}}function showEditor($el){if(!mceInitialized){$el.redactor("core.getBox").show()}else{$(tinyMCE.get($el.get(0).id).editorContainer).show()}}function setEditor($el,data){if(!mceInitialized){$el.redactor("code.set",data)}else{tinyMCE.get($el.get(0).id).setContent(data)}}function getEditorData($el){if(!mceInitialized){return $el.redactor("code.get")}else{return tinyMCE.get($el.get(0).id).getContent(data)}}var FastJax=function(){var cache={};var millisecondCacheFor=11e3;function normalizeUri(uri){if(uri.indexOf("ajax=1")===-1){return uri+(uri.indexOf("?")>-1?"&":"?")+"ajax=1"}else{return uri}}function isTooOld(start){return new Date-start>=millisecondCacheFor}function preload(uri){var uri=normalizeUri(uri);if(uri in cache&&!isTooOld(cache[uri].start)){return cache[uri].xhr}var xhr=$.get(uri);cache[uri]={start:new Date,xhr:xhr};xhr.fail(function(){delete cache[uri]});setTimeout(function(){if(uri in cache&&isTooOld(cache[uri].start)){cache[uri].xhr.abort();delete cache[uri]}},120*1e3);return xhr}function get(uri,success){var xhr;if(uri in cache&&!isTooOld(cache[uri].start)){xhr=cache[uri].xhr}else{xhr=preload(uri)}xhr.done(success);return xhr}function clear(){cache={}}$("body").on("touchstart mousedown",".fastjax",function(ev){var href=$(ev.target).attr("href");if(href&&!isMobile()){preload(href)}});return{preload:preload,get:get,clear:clear}}();var Flash=function(){function dynamicAlert(type,message,timeout,opts){var cl=opts&&opts.small?"alert-small":"";$(document.body).prepend('<div class="alert alert-'+type+" dynamic-alert fade alert-fixed "+cl+'">'+message+' <button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button></div>');$(".dynamic-alert").addClass("in");setTimeout(function(){$(".dynamic-alert").removeClass("in");setTimeout(hide,200)},timeout||7e3)}function error(message,timeout,opts){dynamicAlert("warning",message,timeout,opts)}function notice(message,timeout,opts){hide();dynamicAlert("success",message,timeout,opts)}function hide(isPageNavigate){if(isPageNavigate){$(".dynamic-alert:not(.dynamic-alert-pjax)").remove()}else{$(".dynamic-alert").remove()}}return{hide:hide,notice:notice,error:error}}();(function($){$.fn.caret=function(pos){var target=this[0];var isContentEditable=target&&target.contentEditable==="true";if(arguments.length==0){if(target){if(window.getSelection){if(isContentEditable){target.focus();var range1=window.getSelection().getRangeAt(0),range2=range1.cloneRange();range2.selectNodeContents(target);range2.setEnd(range1.endContainer,range1.endOffset);return range2.toString().length}return target.selectionStart}if(document.selection){target.focus();if(isContentEditable){var range1=document.selection.createRange(),range2=document.body.createTextRange();range2.moveToElementText(target);range2.setEndPoint("EndToEnd",range1);return range2.text.length}var pos=0,range=target.createTextRange(),range2=document.selection.createRange().duplicate(),bookmark=range2.getBookmark();range.moveToBookmark(bookmark);while(range.moveStart("character",-1)!==0)pos++;return pos}if(target.selectionStart)return target.selectionStart}return}if(target){if(pos==-1)pos=this[isContentEditable?"text":"val"]().length;if(window.getSelection){if(isContentEditable){target.focus();window.getSelection().collapse(target.firstChild,pos)}else target.setSelectionRange(pos,pos)}else if(document.body.createTextRange){if(isContentEditable){var range=document.body.createTextRange();range.moveToElementText(target);range.moveStart("character",pos);range.collapse(true);range.select()}else{var range=target.createTextRange();range.move("character",pos);range.select()}}if(!isContentEditable)target.focus()}return this}})(jQuery);(function(){var $,__indexOf=[].indexOf||function(item){for(var i=0,l=this.length;i<l;i++){if(i in this&&this[i]===item)return i}return-1};$=jQuery;$.fn.validateCreditCard=function(callback,options){var card,card_type,card_types,get_card_type,is_valid_length,is_valid_luhn,normalize,validate,validate_number,_i,_len,_ref,_ref1;card_types=[{name:"amex",pattern:/^3[47]/,valid_length:[15]},{name:"diners_club_carte_blanche",pattern:/^30[0-5]/,valid_length:[14]},{name:"diners_club_international",pattern:/^36/,valid_length:[14]},{name:"jcb",pattern:/^35(2[89]|[3-8][0-9])/,valid_length:[16]},{name:"laser",pattern:/^(6304|670[69]|6771)/,valid_length:[16,17,18,19]},{name:"visa_electron",pattern:/^(4026|417500|4508|4844|491(3|7))/,valid_length:[16]},{name:"visa",pattern:/^4/,valid_length:[16]},{name:"mastercard",pattern:/^5[1-5]/,valid_length:[16]},{name:"maestro",pattern:/^(5018|5020|5038|6304|6759|676[1-3])/,valid_length:[12,13,14,15,16,17,18,19]},{name:"discover",pattern:/^(6011|622(12[6-9]|1[3-9][0-9]|[2-8][0-9]{2}|9[0-1][0-9]|92[0-5]|64[4-9])|65)/,valid_length:[16]}];if(options==null){options={}}if((_ref=options.accept)==null){options.accept=function(){var _i,_len,_results;_results=[];for(_i=0,_len=card_types.length;_i<_len;_i++){card=card_types[_i];_results.push(card.name)}return _results}()}_ref1=options.accept;for(_i=0,_len=_ref1.length;_i<_len;_i++){card_type=_ref1[_i];if(__indexOf.call(function(){var _j,_len1,_results;_results=[];for(_j=0,_len1=card_types.length;_j<_len1;_j++){card=card_types[_j];_results.push(card.name)}return _results}(),card_type)<0){throw"Credit card type '"+card_type+"' is not supported"}}get_card_type=function(number){var _j,_len1,_ref2;_ref2=function(){var _k,_len1,_ref2,_results;_results=[];for(_k=0,_len1=card_types.length;_k<_len1;_k++){card=card_types[_k];if(_ref2=card.name,__indexOf.call(options.accept,_ref2)>=0){_results.push(card)}}return _results}();for(_j=0,_len1=_ref2.length;_j<_len1;_j++){card_type=_ref2[_j];if(number.match(card_type.pattern)){return card_type}}return null};is_valid_luhn=function(number){var digit,n,sum,_j,_len1,_ref2;sum=0;_ref2=number.split("").reverse();for(n=_j=0,_len1=_ref2.length;_j<_len1;n=++_j){digit=_ref2[n];digit=+digit;if(n%2){digit*=2;if(digit<10){sum+=digit}else{sum+=digit-9}}else{sum+=digit}}return sum%10===0};is_valid_length=function(number,card_type){var _ref2;return _ref2=number.length,__indexOf.call(card_type.valid_length,_ref2)>=0};validate_number=function(number){var length_valid,luhn_valid;card_type=get_card_type(number);luhn_valid=false;length_valid=false;if(card_type!=null){luhn_valid=is_valid_luhn(number);length_valid=is_valid_length(number,card_type)}return callback({card_type:card_type,luhn_valid:luhn_valid,length_valid:length_valid})};validate=function(){var number;number=normalize($(this).val());return validate_number(number)};normalize=function(number){return number.replace(/[ -]/g,"")};this.bind("input",function(){$(this).unbind("keyup");return validate.call(this)});this.bind("keyup",function(){return validate.call(this)});if(this.length!==0){validate.call(this)}return this}}).call(this);(function(window,document,undefined){var _MAP={8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"ins",46:"del",91:"meta",93:"meta",224:"meta"},_KEYCODE_MAP={106:"*",107:"+",109:"-",110:".",111:"/",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},_SHIFT_MAP={"~":"`","!":"1","@":"2","#":"3",$:"4","%":"5","^":"6","&":"7","*":"8","(":"9",")":"0",_:"-","+":"=",":":";",'"':"'","<":",",">":".","?":"/","|":"\\"},_SPECIAL_ALIASES={option:"alt",command:"meta","return":"enter",escape:"esc",mod:/Mac|iPod|iPhone|iPad/.test(navigator.platform)?"meta":"ctrl"},_REVERSE_MAP,_callbacks={},_directMap={},_sequenceLevels={},_resetTimer,_ignoreNextKeyup=false,_ignoreNextKeypress=false,_nextExpectedAction=false;for(var i=1;i<20;++i){_MAP[111+i]="f"+i}for(i=0;i<=9;++i){_MAP[i+96]=i}function _addEvent(object,type,callback){if(object.addEventListener){object.addEventListener(type,callback,false);return}object.attachEvent("on"+type,callback)}function _characterFromEvent(e){if(e.type=="keypress"){var character=String.fromCharCode(e.which);if(!e.shiftKey){character=character.toLowerCase()}return character}if(_MAP[e.which]){return _MAP[e.which]}if(_KEYCODE_MAP[e.which]){return _KEYCODE_MAP[e.which]}return String.fromCharCode(e.which).toLowerCase()}function _modifiersMatch(modifiers1,modifiers2){return modifiers1.sort().join(",")===modifiers2.sort().join(",")}function _resetSequences(doNotReset){doNotReset=doNotReset||{};var activeSequences=false,key;for(key in _sequenceLevels){if(doNotReset[key]){activeSequences=true;continue}_sequenceLevels[key]=0}if(!activeSequences){_nextExpectedAction=false}}function _getMatches(character,modifiers,e,sequenceName,combination,level){var i,callback,matches=[],action=e.type;if(!_callbacks[character]){return[]}if(action=="keyup"&&_isModifier(character)){modifiers=[character]}for(i=0;i<_callbacks[character].length;++i){callback=_callbacks[character][i];if(!sequenceName&&callback.seq&&_sequenceLevels[callback.seq]!=callback.level){continue}if(action!=callback.action){continue}if(action=="keypress"&&!e.metaKey&&!e.ctrlKey||_modifiersMatch(modifiers,callback.modifiers)){var deleteCombo=!sequenceName&&callback.combo==combination;var deleteSequence=sequenceName&&callback.seq==sequenceName&&callback.level==level;if(deleteCombo||deleteSequence){_callbacks[character].splice(i,1)}matches.push(callback)}}return matches}function _eventModifiers(e){var modifiers=[];if(e.shiftKey){modifiers.push("shift")}if(e.altKey){modifiers.push("alt")}if(e.ctrlKey){modifiers.push("ctrl")}if(e.metaKey){modifiers.push("meta")}return modifiers}function _preventDefault(e){if(e.preventDefault){e.preventDefault();return}e.returnValue=false}function _stopPropagation(e){if(e.stopPropagation){e.stopPropagation();return}e.cancelBubble=true}function _fireCallback(callback,e,combo,sequence){if(Mousetrap.stopCallback(e,e.target||e.srcElement,combo,sequence)){return}if(callback(e,combo)===false){_preventDefault(e);_stopPropagation(e)}}function _handleKey(character,modifiers,e){var callbacks=_getMatches(character,modifiers,e),i,doNotReset={},maxLevel=0,processedSequenceCallback=false;for(i=0;i<callbacks.length;++i){if(callbacks[i].seq){maxLevel=Math.max(maxLevel,callbacks[i].level)}}for(i=0;i<callbacks.length;++i){if(callbacks[i].seq){if(callbacks[i].level!=maxLevel){continue}processedSequenceCallback=true;doNotReset[callbacks[i].seq]=1;_fireCallback(callbacks[i].callback,e,callbacks[i].combo,callbacks[i].seq);continue}if(!processedSequenceCallback){_fireCallback(callbacks[i].callback,e,callbacks[i].combo)}}var ignoreThisKeypress=e.type=="keypress"&&_ignoreNextKeypress;if(e.type==_nextExpectedAction&&!_isModifier(character)&&!ignoreThisKeypress){_resetSequences(doNotReset)}_ignoreNextKeypress=processedSequenceCallback&&e.type=="keydown"}function _handleKeyEvent(e){if(typeof e.which!=="number"){e.which=e.keyCode}var character=_characterFromEvent(e);if(!character){return}if(e.type=="keyup"&&_ignoreNextKeyup===character){_ignoreNextKeyup=false;return}Mousetrap.handleKey(character,_eventModifiers(e),e)}function _isModifier(key){return key=="shift"||key=="ctrl"||key=="alt"||key=="meta"}function _resetSequenceTimer(){clearTimeout(_resetTimer);_resetTimer=setTimeout(_resetSequences,1e3)}function _getReverseMap(){if(!_REVERSE_MAP){_REVERSE_MAP={};for(var key in _MAP){if(key>95&&key<112){continue}if(_MAP.hasOwnProperty(key)){_REVERSE_MAP[_MAP[key]]=key}}}return _REVERSE_MAP}function _pickBestAction(key,modifiers,action){if(!action){action=_getReverseMap()[key]?"keydown":"keypress"}if(action=="keypress"&&modifiers.length){action="keydown"}return action}function _bindSequence(combo,keys,callback,action){_sequenceLevels[combo]=0;function _increaseSequence(nextAction){return function(){_nextExpectedAction=nextAction;++_sequenceLevels[combo];_resetSequenceTimer()}}function _callbackAndReset(e){_fireCallback(callback,e,combo);if(action!=="keyup"){_ignoreNextKeyup=_characterFromEvent(e)}setTimeout(_resetSequences,10)}for(var i=0;i<keys.length;++i){var isFinal=i+1===keys.length;var wrappedCallback=isFinal?_callbackAndReset:_increaseSequence(action||_getKeyInfo(keys[i+1]).action);_bindSingle(keys[i],wrappedCallback,action,combo,i)}}function _keysFromString(combination){if(combination==="+"){return["+"]}return combination.split("+")}function _getKeyInfo(combination,action){var keys,key,i,modifiers=[];keys=_keysFromString(combination);for(i=0;i<keys.length;++i){key=keys[i];if(_SPECIAL_ALIASES[key]){key=_SPECIAL_ALIASES[key]}if(action&&action!="keypress"&&_SHIFT_MAP[key]){key=_SHIFT_MAP[key];modifiers.push("shift")}if(_isModifier(key)){modifiers.push(key)}}action=_pickBestAction(key,modifiers,action);return{key:key,modifiers:modifiers,action:action}}function _bindSingle(combination,callback,action,sequenceName,level){_directMap[combination+":"+action]=callback;combination=combination.replace(/\s+/g," ");var sequence=combination.split(" "),info;if(sequence.length>1){_bindSequence(combination,sequence,callback,action);return}info=_getKeyInfo(combination,action);_callbacks[info.key]=_callbacks[info.key]||[];_getMatches(info.key,info.modifiers,{type:info.action},sequenceName,combination,level);_callbacks[info.key][sequenceName?"unshift":"push"]({callback:callback,modifiers:info.modifiers,action:info.action,seq:sequenceName,level:level,combo:combination})}function _bindMultiple(combinations,callback,action){for(var i=0;i<combinations.length;++i){_bindSingle(combinations[i],callback,action)}}_addEvent(document,"keypress",_handleKeyEvent);_addEvent(document,"keydown",_handleKeyEvent);_addEvent(document,"keyup",_handleKeyEvent);var Mousetrap={bind:function(keys,callback,action){keys=keys instanceof Array?keys:[keys];_bindMultiple(keys,callback,action);return this},unbind:function(keys,action){return Mousetrap.bind(keys,function(){},action)},trigger:function(keys,action){if(_directMap[keys+":"+action]){_directMap[keys+":"+action]({},keys)}return this},reset:function(){_callbacks={};_directMap={};return this},stopCallback:function(e,element){if((" "+element.className+" ").indexOf(" mousetrap ")>-1){return false}return element.tagName=="INPUT"||element.tagName=="SELECT"||element.tagName=="TEXTAREA"||element.isContentEditable},handleKey:_handleKey};window.Mousetrap=Mousetrap;if(typeof define==="function"&&define.amd){define(Mousetrap)}})(window,document);if(!RedactorPlugins)var RedactorPlugins={};(function($){RedactorPlugins.fontfamily=function(){return{init:function(){var fonts=["Arial","Book Antiqua","Comic Sans MS","Courier New","Georgia","Helvetica","Impact","Tahoma","Times New Roman"];var that=this;var dropdown={};$.each(fonts,function(i,s){dropdown["s"+i]={title:s,func:function(){that.fontfamily.set(s)}}});dropdown.remove={title:"Remove Font Family",func:that.fontfamily.reset};var button=this.button.add("fontfamily","Change Font Family");this.button.addDropdown(button,dropdown)},set:function(value){this.inline.format("span","style","font-family:"+value+";",true)},reset:function(){this.inline.removeStyleRule("font-family")
}}}})(jQuery);(function($){RedactorPlugins.fontcolor=function(){return{init:function(){var colors=["#ffffff","#ffffff","#808000","#0000FF","#00FFFF","#FF0000","#00FF00","#FF00FF","#FF99CC","#FF6600","#FF9900","#ffffff","#000000","#eeece1","#1f497d","#4f81bd","#c0504d","#9bbb59","#8064a2","#4bacc6","#f79646","#ffff00","#f2f2f2","#7f7f7f","#ddd9c3","#c6d9f0","#dbe5f1","#f2dcdb","#ebf1dd","#e5e0ec","#dbeef3","#fdeada","#fff2ca","#d8d8d8","#595959","#c4bd97","#8db3e2","#b8cce4","#e5b9b7","#d7e3bc","#ccc1d9","#b7dde8","#fbd5b5","#ffe694","#bfbfbf","#3f3f3f","#938953","#548dd4","#95b3d7","#d99694","#c3d69b","#b2a2c7","#b7dde8","#fac08f","#f2c314","#a5a5a5","#262626","#494429","#17365d","#366092","#953734","#76923c","#5f497a","#92cddc","#e36c09","#c09100","#7f7f7f","#0c0c0c","#1d1b10","#0f243e","#244061","#632423","#4f6128","#3f3151","#31859b","#974806","#7f6000"];var buttons=["fontcolor","backcolor"];for(var i=0;i<2;i++){var name=buttons[i];var button=this.button.add(name,this.lang.get(name));var $dropdown=this.button.addDropdown(button);$dropdown.width(242);this.fontcolor.buildPicker($dropdown,name,colors)}},buildPicker:function($dropdown,name,colors){var rule=name=="backcolor"?"background-color":"color";var len=colors.length;var self=this;var func=function(e){e.preventDefault();self.fontcolor.set($(this).data("rule"),$(this).attr("rel"))};for(var z=0;z<len;z++){var color=colors[z];var $swatch=$('<a rel="'+color+'" data-rule="'+rule+'" href="#" style="float: left; font-size: 0; border: 2px solid #fff; padding: 0; margin: 0; width: 22px; height: 22px;"></a>');$swatch.css("background-color",color);$swatch.on("click",func);$dropdown.append($swatch)}var $elNone=$('<a href="#" style="display: block; clear: both; padding: 5px; font-size: 12px; line-height: 1;"></a>').html(this.lang.get("none"));$elNone.on("click",$.proxy(function(e){e.preventDefault();this.fontcolor.remove(rule)},this));$dropdown.append($elNone)},set:function(rule,type){this.inline.format("span","style",rule+": "+type+";",true)},remove:function(rule){this.inline.removeStyleRule(rule)}}}})(jQuery);(function($){RedactorPlugins.fontsize=function(){return{init:function(){var fonts=[10,11,12,14,16,18,20,24,28,30];var that=this;var dropdown={};$.each(fonts,function(i,s){dropdown["s"+i]={title:s+"px",func:function(){that.fontsize.set(s)}}});dropdown.remove={title:"Remove Font Size",func:that.fontsize.reset};var button=this.button.add("fontsize","Change Font Size");this.button.addDropdown(button,dropdown)},set:function(size){this.inline.format("span","style","font-size: "+size+"px;")},reset:function(){this.inline.removeStyleRule("font-size")}}}})(jQuery);if(!RedactorPlugins)var RedactorPlugins={};RedactorPlugins.acuityInsert=function(){return{init:function(){var fields={Client:"header","%first%":"First name","%last%":"Last name","%phone%":"Phone","%email%":"E-mail",Appointment:"header","%type%":"Type","%duration%":"Duration","%time%":"Date/time","%oldtime%":"Old date/time","%calendar%":"Calendar name","%oldcalendar%":"Old calendar name","%location%":"Location","%viewlink%":"Link to view/edit","%paylink%":"Link to pay","%export%":"Link to export","%receipt%":"Receipt Summary","%product%":"Name of subscription","%total%":"Total Price","%price%":"Price","%notes%":"Notes","%schedule%":"Link to schedule","%certificate%":"Link to Print Certificate","%subscrlink%":"Change/cancel subscription"};var translateFields={"%viewlink%":'<a href="%viewhref%">change/cancel appointment</a>',"%schedule%":'<a href="%schedulehref%">Schedule</a>',"%subscrlink%":'<a href="%subscrhref%">change/cancel subscription</a>',"%paylink%":'<a href="%payhref%">pay for appointment</a>',"%certificate%":'<a href="%certificatehref%">print gift certificate</a>'};var that=this;var dropdown={};function addReplacementOption(i,s,checkIfEnabled){if(s=="header"){if(i=="Appointment"&&that.opts.enabledInsert.indexOf("Order")>-1){i="Order"}dropdown["s"+i]={title:'<strong class="text-small">'+i+"</strong>",func:function(){}}}else if(!that.opts.enabledInsert||that.opts.enabledInsert.indexOf(i)>-1||!checkIfEnabled){dropdown["s"+i]={title:s+' <div class="text-muted pull-right">'+i+'</div><div class="clearfix"></div>',func:function(){if(typeof translateFields[i]=="undefined"){that.insert.text(i)}else{that.insert.html(translateFields[i])}}}}}$.each(fields,function(i,s){addReplacementOption(i,s,true)});if(that.opts.customInsertFields){addReplacementOption("Intake Form Questions:","header");$.each(that.opts.customInsertFields,function(i,s){addReplacementOption(i,s)})}dropdown["sHelp"]={title:"<u>(?) Learn More About Tags</u>",func:function(){window.open("https://help.acuityscheduling.com/hc/en-us/articles/218724858-What-tags-can-I-add-into-notification-emails-")}};var button=this.button.add("acuityInsert","Insert field");this.button.setAwesome("acuityInsert","icon-tags");this.button.addDropdown(button,dropdown)}}};(function($){"use strict";if(!Function.prototype.bind){Function.prototype.bind=function(scope){var fn=this;return function(){return fn.apply(scope)}}}var uuid=0;$.fn.redactor=function(options){var val=[];var args=Array.prototype.slice.call(arguments,1);if(typeof options==="string"){this.each(function(){var instance=$.data(this,"redactor");var func;if(options.search(/\./)!="-1"){func=options.split(".");if(typeof instance[func[0]]!="undefined"){func=instance[func[0]][func[1]]}}else{func=instance[options]}if(typeof instance!=="undefined"&&$.isFunction(func)){var methodVal=func.apply(instance,args);if(methodVal!==undefined&&methodVal!==instance){val.push(methodVal)}}else{$.error('No such method "'+options+'" for Redactor')}})}else{this.each(function(){$.data(this,"redactor",{});$.data(this,"redactor",Redactor(this,options))})}if(val.length===0)return this;else if(val.length===1)return val[0];else return val};function Redactor(el,options){return new Redactor.prototype.init(el,options)}$.Redactor=Redactor;$.Redactor.VERSION="10.2.5";$.Redactor.modules=["alignment","autosave","block","buffer","build","button","caret","clean","code","core","dropdown","file","focus","image","indent","inline","insert","keydown","keyup","lang","line","link","linkify","list","modal","observe","paragraphize","paste","placeholder","progress","selection","shortcuts","tabifier","tidy","toolbar","upload","utils"];$.Redactor.opts={lang:"en",direction:"ltr",plugins:false,focus:false,focusEnd:false,placeholder:false,visual:true,tabindex:false,minHeight:false,maxHeight:false,linebreaks:false,replaceDivs:true,paragraphize:true,cleanStyleOnEnter:false,enterKey:true,cleanOnPaste:true,cleanSpaces:true,pastePlainText:false,autosave:false,autosaveName:false,autosaveInterval:60,autosaveOnChange:false,autosaveFields:false,linkTooltip:true,linkProtocol:"http",linkNofollow:false,linkSize:50,imageEditable:true,imageLink:true,imagePosition:true,imageFloatMargin:"10px",imageResizable:true,imageUpload:null,imageUploadParam:"file",uploadImageField:false,dragImageUpload:true,fileUpload:null,fileUploadParam:"file",dragFileUpload:true,s3:false,convertLinks:true,convertUrlLinks:true,convertImageLinks:true,convertVideoLinks:true,preSpaces:4,tabAsSpaces:false,tabKey:true,scrollTarget:false,toolbar:true,toolbarFixed:true,toolbarFixedTarget:document,toolbarFixedTopOffset:0,toolbarExternal:false,toolbarOverflow:false,source:true,buttons:["html","formatting","bold","italic","deleted","unorderedlist","orderedlist","outdent","indent","image","file","link","alignment","horizontalrule"],buttonsHide:[],buttonsHideOnMobile:[],formatting:["p","blockquote","pre","h1","h2","h3","h4","h5","h6"],formattingAdd:false,tabifier:true,deniedTags:["script","style"],allowedTags:false,paragraphizeBlocks:["table","div","pre","form","ul","ol","h1","h2","h3","h4","h5","h6","dl","blockquote","figcaption","address","section","header","footer","aside","article","object","style","script","iframe","select","input","textarea","button","option","map","area","math","hr","fieldset","legend","hgroup","nav","figure","details","menu","summary","p"],removeComments:false,replaceTags:[["strike","del"],["b","strong"]],replaceStyles:[["font-weight:\\s?bold","strong"],["font-style:\\s?italic","em"],["text-decoration:\\s?underline","u"],["text-decoration:\\s?line-through","del"]],removeDataAttr:false,removeAttr:false,allowedAttr:false,removeWithoutAttr:["span"],removeEmpty:["p"],activeButtons:["deleted","italic","bold","underline","unorderedlist","orderedlist","alignleft","aligncenter","alignright","justify"],activeButtonsStates:{b:"bold",strong:"bold",i:"italic",em:"italic",del:"deleted",strike:"deleted",ul:"unorderedlist",ol:"orderedlist",u:"underline"},shortcuts:{"ctrl+shift+m, meta+shift+m":{func:"inline.removeFormat"},"ctrl+b, meta+b":{func:"inline.format",params:["bold"]},"ctrl+i, meta+i":{func:"inline.format",params:["italic"]},"ctrl+h, meta+h":{func:"inline.format",params:["superscript"]},"ctrl+l, meta+l":{func:"inline.format",params:["subscript"]},"ctrl+k, meta+k":{func:"link.show"},"ctrl+shift+7":{func:"list.toggle",params:["orderedlist"]},"ctrl+shift+8":{func:"list.toggle",params:["unorderedlist"]}},shortcutsAdd:false,buffer:[],rebuffer:[],emptyHtml:"<p>&#x200b;</p>",invisibleSpace:"&#x200b;",imageTypes:["image/png","image/jpeg","image/gif"],indentValue:20,verifiedTags:["img","b","strong","sub","sup","i","em","u","small","strike","del","cite","ul","ol","li"],inlineTags:["strong","b","u","em","i","code","del","ins","samp","kbd","sup","sub","mark","var","cite","small"],alignmentTags:["P","H1","H2","H3","H4","H5","H6","DL","DT","DD","DIV","TD","BLOCKQUOTE","OUTPUT","FIGCAPTION","ADDRESS","SECTION","HEADER","FOOTER","ASIDE","ARTICLE"],blockLevelElements:["PRE","UL","OL","LI"],highContrast:false,observe:{dropdowns:[]},langs:{en:{html:"HTML",video:"Insert Video",image:"Insert Image",table:"Table",link:"Link",link_insert:"Insert link",link_edit:"Edit link",unlink:"Unlink",formatting:"Formatting",paragraph:"Normal text",quote:"Quote",code:"Code",header1:"Header 1",header2:"Header 2",header3:"Header 3",header4:"Header 4",header5:"Header 5",bold:"Bold",italic:"Italic",fontcolor:"Font Color",backcolor:"Back Color",unorderedlist:"Unordered List",orderedlist:"Ordered List",outdent:"Outdent",indent:"Indent",cancel:"Cancel",insert:"Insert",save:"Save",_delete:"Delete",insert_table:"Insert Table",insert_row_above:"Add Row Above",insert_row_below:"Add Row Below",insert_column_left:"Add Column Left",insert_column_right:"Add Column Right",delete_column:"Delete Column",delete_row:"Delete Row",delete_table:"Delete Table",rows:"Rows",columns:"Columns",add_head:"Add Head",delete_head:"Delete Head",title:"Title",image_position:"Position",none:"None",left:"Left",right:"Right",center:"Center",image_web_link:"Image Web Link",text:"Text",mailto:"Email",web:"URL",video_html_code:"Video Embed Code or Youtube/Vimeo Link",file:"Insert File",upload:"Upload",download:"Download",choose:"Choose",or_choose:"Or choose",drop_file_here:"Drop file here",align_left:"Align text to the left",align_center:"Center text",align_right:"Align text to the right",align_justify:"Justify text",horizontalrule:"Insert Horizontal Rule",deleted:"Deleted",anchor:"Anchor",link_new_tab:"Open link in new tab",underline:"Underline",alignment:"Alignment",filename:"Name (optional)",edit:"Edit",upload_label:"Drop file here or "}},linkify:{regexps:{youtube:/https?:\/\/(?:[0-9A-Z-]+\.)?(?:youtu\.be\/|youtube\.com\S*[^\w\-\s])([\w\-]{11})(?=[^\w\-]|$)(?![?=&+%\w.\-]*(?:['"][^<>]*>|<\/a>))[?=&+%\w.-]*/gi,vimeo:/https?:\/\/(www\.)?vimeo.com\/(\d+)($|\/)/,image:/((https?|www)[^\s]+\.)(jpe?g|png|gif)(\?[^\s-]+)?/gi,url:/(https?:\/\/(?:www\.|(?!www))[^\s\.]+\.[^\s]{2,}|www\.[^\s]+\.[^\s]{2,})/gi}},codemirror:false};Redactor.fn=$.Redactor.prototype={keyCode:{BACKSPACE:8,DELETE:46,UP:38,DOWN:40,ENTER:13,SPACE:32,ESC:27,TAB:9,CTRL:17,META:91,SHIFT:16,ALT:18,RIGHT:39,LEFT:37,LEFT_WIN:91},init:function(el,options){this.$element=$(el);this.uuid=uuid++;this.rtePaste=false;this.$pasteBox=false;this.loadOptions(options);this.loadModules();this.formatting={};$.merge(this.opts.blockLevelElements,this.opts.alignmentTags);this.reIsBlock=new RegExp("^("+this.opts.blockLevelElements.join("|")+")$","i");this.tidy.setupAllowed();if(this.opts.deniedTags!==false){var tags=["html","head","link","body","meta","applet"];for(var i=0;i<tags.length;i++){this.opts.deniedTags.push(tags[i])}}this.lang.load();$.extend(this.opts.shortcuts,this.opts.shortcutsAdd);this.core.setCallback("start");this.start=true;this.build.run()},loadOptions:function(options){this.opts=$.extend({},$.extend(true,{},$.Redactor.opts),this.$element.data(),options)},getModuleMethods:function(object){return Object.getOwnPropertyNames(object).filter(function(property){return typeof object[property]=="function"})},loadModules:function(){var len=$.Redactor.modules.length;for(var i=0;i<len;i++){this.bindModuleMethods($.Redactor.modules[i])}},bindModuleMethods:function(module){if(typeof this[module]=="undefined")return;this[module]=this[module]();var methods=this.getModuleMethods(this[module]);var len=methods.length;for(var z=0;z<len;z++){this[module][methods[z]]=this[module][methods[z]].bind(this)}},alignment:function(){return{left:function(){this.alignment.set("")},right:function(){this.alignment.set("right")},center:function(){this.alignment.set("center")},justify:function(){this.alignment.set("justify")},set:function(type){if(!this.utils.browser("msie")&&!this.opts.linebreaks){this.$editor.focus()}this.alignment.blocks=this.selection.getBlocks();this.alignment.type=type;this.buffer.set();this.selection.save();if(this.alignment.isLinebreaksOrNoBlocks()){this.alignment.setText()}else{this.alignment.setBlocks()}this.selection.restore();this.code.sync()},setText:function(){var wrapper=this.selection.wrap("div");$(wrapper).attr("data-tagblock","redactor").css("text-align",this.alignment.type)},setBlocks:function(){$.each(this.alignment.blocks,$.proxy(function(i,el){var $el=this.utils.getAlignmentElement(el);if(!$el)return;if(this.alignment.isNeedReplaceElement($el)){this.alignment.replaceElement($el)}else{this.alignment.alignElement($el)}},this))},isLinebreaksOrNoBlocks:function(){return this.opts.linebreaks&&this.alignment.blocks[0]===false},isNeedReplaceElement:function($el){return this.alignment.type===""&&typeof $el.data("tagblock")!=="undefined"},replaceElement:function($el){$el.replaceWith($el.html())},alignElement:function($el){$el.css("text-align",this.alignment.type);this.utils.removeEmptyAttr($el,"style")}}},autosave:function(){return{html:false,enable:function(){if(!this.opts.autosave)return;this.autosave.name=this.opts.autosaveName?this.opts.autosaveName:this.$textarea.attr("name");if(this.opts.autosaveOnChange)return;this.autosaveInterval=setInterval(this.autosave.load,this.opts.autosaveInterval*1e3)},onChange:function(){if(!this.opts.autosaveOnChange)return;this.autosave.load()},load:function(){if(!this.opts.autosave)return;this.autosave.source=this.code.get();if(this.autosave.html===this.autosave.source)return;var data={};data["name"]=this.autosave.name;data[this.autosave.name]=this.autosave.source;data=this.autosave.getHiddenFields(data);var jsxhr=$.ajax({url:this.opts.autosave,type:"post",data:data});jsxhr.done(this.autosave.success)},getHiddenFields:function(data){if(this.opts.autosaveFields===false||typeof this.opts.autosaveFields!=="object"){return data}$.each(this.opts.autosaveFields,$.proxy(function(k,v){if(v!==null&&v.toString().indexOf("#")===0)v=$(v).val();data[k]=v},this));return data},success:function(data){var json;try{json=$.parseJSON(data)}catch(e){json=data}var callbackName=typeof json.error=="undefined"?"autosave":"autosaveError";this.core.setCallback(callbackName,this.autosave.name,json);this.autosave.html=this.autosave.source},disable:function(){clearInterval(this.autosaveInterval)}}},block:function(){return{formatting:function(name){this.block.clearStyle=false;var type,value;if(typeof this.formatting[name].data!="undefined")type="data";else if(typeof this.formatting[name].attr!="undefined")type="attr";else if(typeof this.formatting[name]["class"]!="undefined")type="class";if(typeof this.formatting[name].clear!="undefined"){this.block.clearStyle=true}if(type)value=this.formatting[name][type];this.block.format(this.formatting[name].tag,type,value)},format:function(tag,type,value){if(tag=="quote")tag="blockquote";var formatTags=["p","pre","blockquote","h1","h2","h3","h4","h5","h6"];if($.inArray(tag,formatTags)==-1)return;this.block.isRemoveInline=tag=="pre"||tag.search(/h[1-6]/i)!=-1;if(!this.utils.browser("msie"))this.$editor.focus();var html=$.trim(this.$editor.html());this.block.isEmpty=this.utils.isEmpty(html);if(this.utils.browser("mozilla")&&!this.focus.isFocused()){if(this.block.isEmpty){var $first;if(!this.opts.linebreaks){$first=this.$editor.children().first();this.caret.setEnd($first)}}}this.block.blocks=this.selection.getBlocks();this.block.blocksSize=this.block.blocks.length;this.block.type=type;this.block.value=value;this.buffer.set();this.selection.save();this.block.set(tag);this.selection.restore();this.code.sync();this.observe.load()},set:function(tag){this.selection.get();this.block.containerTag=this.range.commonAncestorContainer.tagName;if(this.range.collapsed){this.block.setCollapsed(tag)}else{this.block.setMultiple(tag)}},setCollapsed:function(tag){if(this.opts.linebreaks&&this.block.isEmpty&&tag!="p"){var node=document.createElement(tag);this.$editor.html(node);this.caret.setEnd(node);return}var block=this.block.blocks[0];if(block===false)return;if(block.tagName=="LI"){if(tag!="blockquote")return;this.block.formatListToBlockquote();return}var isContainerTable=this.block.containerTag=="TD"||this.block.containerTag=="TH";if(isContainerTable&&!this.opts.linebreaks){document.execCommand("formatblock",false,"<"+tag+">");block=this.selection.getBlock();this.block.toggle($(block))}else if(block.tagName.toLowerCase()!=tag){if(this.opts.linebreaks&&tag=="p"){$(block).append("<br>");this.utils.replaceWithContents(block)}else{var $formatted=this.utils.replaceToTag(block,tag);this.block.toggle($formatted);if(tag!="p"&&tag!="blockquote")$formatted.find("img").remove();if(this.block.isRemoveInline)this.utils.removeInlineTags($formatted);if(tag=="p"||this.block.headTag)$formatted.find("p").contents().unwrap();this.block.formatTableWrapping($formatted)}}else if(tag=="blockquote"&&block.tagName.toLowerCase()==tag){if(this.opts.linebreaks){$(block).append("<br>");this.utils.replaceWithContents(block)}else{var $el=this.utils.replaceToTag(block,"p");this.block.toggle($el)}}else if(block.tagName.toLowerCase()==tag){this.block.toggle($(block))}if(typeof this.block.type=="undefined"&&typeof this.block.value=="undefined"){$(block).removeAttr("class").removeAttr("style")}},setMultiple:function(tag){var block=this.block.blocks[0];var isContainerTable=this.block.containerTag=="TD"||this.block.containerTag=="TH";if(block!==false&&this.block.blocksSize===1){if(block.tagName.toLowerCase()==tag&&tag=="blockquote"){if(this.opts.linebreaks){$(block).append("<br>");this.utils.replaceWithContents(block)}else{var $el=this.utils.replaceToTag(block,"p");this.block.toggle($el)}}else if(block.tagName=="LI"){if(tag!="blockquote")return;this.block.formatListToBlockquote()}else if(this.block.containerTag=="BLOCKQUOTE"){this.block.formatBlockquote(tag)}else if(this.opts.linebreaks&&(isContainerTable||this.range.commonAncestorContainer!=block)){this.block.formatWrap(tag)}else{if(this.opts.linebreaks&&tag=="p"){$(block).prepend("<br>").append("<br>");this.utils.replaceWithContents(block)}else if(block.tagName==="TD"){this.block.formatWrap(tag)}else{var $formatted=this.utils.replaceToTag(block,tag);this.block.toggle($formatted);if(this.block.isRemoveInline)this.utils.removeInlineTags($formatted);if(tag=="p"||this.block.headTag)$formatted.find("p").contents().unwrap()}}}else{if(this.opts.linebreaks||tag!="p"){if(tag=="blockquote"){var count=0;for(var i=0;i<this.block.blocksSize;i++){if(this.block.blocks[i].tagName=="BLOCKQUOTE")count++}if(count==this.block.blocksSize){$.each(this.block.blocks,$.proxy(function(i,s){var $formatted=false;if(this.opts.linebreaks){$(s).prepend("<br>").append("<br>");$formatted=this.utils.replaceWithContents(s)}else{$formatted=this.utils.replaceToTag(s,"p")}if($formatted&&typeof this.block.type=="undefined"&&typeof this.block.value=="undefined"){$formatted.removeAttr("class").removeAttr("style")}},this));return}}this.block.formatWrap(tag)}else{var classSize=0;var toggleType=false;if(this.block.type=="class"){toggleType="toggle";classSize=$(this.block.blocks).filter("."+this.block.value).length;if(this.block.blocksSize==classSize)toggleType="toggle";else if(this.block.blocksSize>classSize)toggleType="set";else if(classSize===0)toggleType="set"}var exceptTags=["ul","ol","li","td","th","dl","dt","dd"];$.each(this.block.blocks,$.proxy(function(i,s){if($.inArray(s.tagName.toLowerCase(),exceptTags)!=-1)return;var $formatted=this.utils.replaceToTag(s,tag);if(toggleType){if(toggleType=="toggle")this.block.toggle($formatted);else if(toggleType=="remove")this.block.remove($formatted);else if(toggleType=="set")this.block.setForce($formatted)}else this.block.toggle($formatted);if(tag!="p"&&tag!="blockquote")$formatted.find("img").remove();if(this.block.isRemoveInline)this.utils.removeInlineTags($formatted);if(tag=="p"||this.block.headTag)$formatted.find("p").contents().unwrap();if(typeof this.block.type=="undefined"&&typeof this.block.value=="undefined"){$formatted.removeAttr("class").removeAttr("style")}},this))}}},setForce:function($el){if(this.block.clearStyle){$el.removeAttr("class").removeAttr("style")}if(this.block.type=="class"){$el.addClass(this.block.value);return}else if(this.block.type=="attr"||this.block.type=="data"){$el.attr(this.block.value.name,this.block.value.value);return}},toggle:function($el){if(this.block.clearStyle){$el.removeAttr("class").removeAttr("style")}if(this.block.type=="class"){$el.toggleClass(this.block.value);return}else if(this.block.type=="attr"||this.block.type=="data"){if($el.attr(this.block.value.name)==this.block.value.value){$el.removeAttr(this.block.value.name)}else{$el.attr(this.block.value.name,this.block.value.value)}return}else{$el.removeAttr("style class");return}},remove:function($el){$el.removeClass(this.block.value)},formatListToBlockquote:function(){var block=$(this.block.blocks[0]).closest("ul, ol",this.$editor[0]);$(block).find("ul, ol").contents().unwrap();$(block).find("li").append($("<br>")).contents().unwrap();var $el=this.utils.replaceToTag(block,"blockquote");this.block.toggle($el)},formatBlockquote:function(tag){document.execCommand("outdent");document.execCommand("formatblock",false,tag);this.clean.clearUnverified();this.$editor.find("p:empty").remove();var formatted=this.selection.getBlock();if(tag!="p"){$(formatted).find("img").remove()}if(!this.opts.linebreaks){this.block.toggle($(formatted))}this.$editor.find("ul, ol, tr, blockquote, p").each($.proxy(this.utils.removeEmpty,this));if(this.opts.linebreaks&&tag=="p"){this.utils.replaceWithContents(formatted)}},formatWrap:function(tag){if(this.block.containerTag=="UL"||this.block.containerTag=="OL"){if(tag=="blockquote"){this.block.formatListToBlockquote()}else{return}}var formatted=this.selection.wrap(tag);if(formatted===false)return;var $formatted=$(formatted);this.block.formatTableWrapping($formatted);var $elements=$formatted.find(this.opts.blockLevelElements.join(",")+", td, table, thead, tbody, tfoot, th, tr");$elements.contents().unwrap();if(tag!="p"&&tag!="blockquote")$formatted.find("img").remove();$.each(this.block.blocks,$.proxy(this.utils.removeEmpty,this));$formatted.append(this.selection.getMarker(2));if(!this.opts.linebreaks){this.block.toggle($formatted)}this.$editor.find("ul, ol, tr, blockquote, p").each($.proxy(this.utils.removeEmpty,this));$formatted.find("blockquote:empty").remove();if(this.block.isRemoveInline){this.utils.removeInlineTags($formatted)}if(this.opts.linebreaks&&tag=="p"){this.utils.replaceWithContents($formatted)}if(this.opts.linebreaks){var $next=$formatted.next().next();if($next.size()!=0&&$next[0].tagName==="BR"){$next.remove()}}},formatTableWrapping:function($formatted){if($formatted.closest("table",this.$editor[0]).length===0)return;if($formatted.closest("tr",this.$editor[0]).length===0)$formatted.wrap("<tr>");if($formatted.closest("td",this.$editor[0]).length===0&&$formatted.closest("th").length===0){$formatted.wrap("<td>")}},removeData:function(name,value){var blocks=this.selection.getBlocks();$(blocks).removeAttr("data-"+name);this.code.sync()},setData:function(name,value){var blocks=this.selection.getBlocks();$(blocks).attr("data-"+name,value);this.code.sync()},toggleData:function(name,value){var blocks=this.selection.getBlocks();$.each(blocks,function(){if($(this).attr("data-"+name)){$(this).removeAttr("data-"+name)}else{$(this).attr("data-"+name,value)}})},removeAttr:function(attr,value){var blocks=this.selection.getBlocks();$(blocks).removeAttr(attr);this.code.sync()},setAttr:function(attr,value){var blocks=this.selection.getBlocks();$(blocks).attr(attr,value);this.code.sync()},toggleAttr:function(attr,value){var blocks=this.selection.getBlocks();$.each(blocks,function(){if($(this).attr(name)){$(this).removeAttr(name)}else{$(this).attr(name,value)}})},removeClass:function(className){var blocks=this.selection.getBlocks();$(blocks).removeClass(className);this.utils.removeEmptyAttr(blocks,"class");this.code.sync()},setClass:function(className){var blocks=this.selection.getBlocks();$(blocks).addClass(className);this.code.sync()},toggleClass:function(className){var blocks=this.selection.getBlocks();$(blocks).toggleClass(className);this.code.sync()}}},buffer:function(){return{set:function(type){if(typeof type=="undefined"||type=="undo"){this.buffer.setUndo()}else{this.buffer.setRedo()}},setUndo:function(){this.selection.save();this.opts.buffer.push(this.$editor.html());this.selection.restore()},setRedo:function(){this.selection.save();this.opts.rebuffer.push(this.$editor.html());this.selection.restore()},getUndo:function(){this.$editor.html(this.opts.buffer.pop())},getRedo:function(){this.$editor.html(this.opts.rebuffer.pop())},add:function(){this.opts.buffer.push(this.$editor.html())},undo:function(){if(this.opts.buffer.length===0)return;this.buffer.set("redo");this.buffer.getUndo();this.selection.restore();setTimeout($.proxy(this.observe.load,this),50)},redo:function(){if(this.opts.rebuffer.length===0)return;this.buffer.set("undo");this.buffer.getRedo();this.selection.restore();setTimeout($.proxy(this.observe.load,this),50)}}},build:function(){return{focused:false,blured:true,run:function(){this.build.createContainerBox();this.build.loadContent();this.build.loadEditor();this.build.enableEditor();this.build.setCodeAndCall()},isTextarea:function(){return this.$element[0].tagName==="TEXTAREA"},createContainerBox:function(){this.$box=$('<div class="redactor-box" role="application" />')},createTextarea:function(){this.$textarea=$("<textarea />").attr("name",this.build.getTextareaName())},getTextareaName:function(){return typeof name=="undefined"?"content-"+this.uuid:this.$element.attr("id")},loadContent:function(){var func=this.build.isTextarea()?"val":"html";this.content=$.trim(this.$element[func]())},enableEditor:function(){this.$editor.attr({contenteditable:true,dir:this.opts.direction})},loadEditor:function(){var func=this.build.isTextarea()?"fromTextarea":"fromElement";this.build[func]()},fromTextarea:function(){this.$editor=$("<div />");this.$textarea=this.$element;this.$box.insertAfter(this.$element).append(this.$editor).append(this.$element);this.$editor.addClass("redactor-editor");this.$element.hide()},fromElement:function(){this.$editor=this.$element;this.build.createTextarea();this.$box.insertAfter(this.$editor).append(this.$editor).append(this.$textarea);this.$editor.addClass("redactor-editor");this.$textarea.hide()},setCodeAndCall:function(){this.code.set(this.content);this.build.setOptions();this.build.callEditor();if(this.opts.visual)return;setTimeout($.proxy(this.code.showCode,this),200)},callEditor:function(){this.build.disableMozillaEditing();this.build.disableIeLinks();this.build.setEvents();this.build.setHelpers();if(this.opts.toolbar){this.opts.toolbar=this.toolbar.init();this.toolbar.build()}this.modal.loadTemplates();this.build.plugins();setTimeout($.proxy(this.observe.load,this),4);this.core.setCallback("init")},setOptions:function(){$(this.$textarea).attr("dir",this.opts.direction);if(this.opts.linebreaks)this.$editor.addClass("redactor-linebreaks");if(this.opts.tabindex)this.$editor.attr("tabindex",this.opts.tabindex);if(this.opts.minHeight)this.$editor.css("minHeight",this.opts.minHeight);if(this.opts.maxHeight)this.$editor.css("maxHeight",this.opts.maxHeight)},setEventDropUpload:function(e){e.preventDefault();if(!this.opts.dragImageUpload&&!this.opts.dragFileUpload)return;if(this.opts.imageUpload===null&&this.opts.fileUpload===null)return;var files=e.dataTransfer.files;this.upload.directUpload(files[0],e)},setEventDrop:function(e){this.code.sync();setTimeout(this.clean.clearUnverified,1);this.core.setCallback("drop",e)},setEvents:function(){this.$editor.on("dragover.redactor dragenter.redactor",function(e){e.preventDefault();e.stopPropagation()});this.$editor.on("drop.redactor",$.proxy(function(e){e=e.originalEvent||e;if(window.FormData===undefined||!e.dataTransfer)return true;if(e.dataTransfer.files.length===0){return this.build.setEventDrop(e)}else{this.build.setEventDropUpload(e)}setTimeout(this.clean.clearUnverified,1);this.core.setCallback("drop",e)},this));this.$editor.on("click.redactor",$.proxy(function(e){var event=this.core.getEvent();var type=event=="click"||event=="arrow"?false:"click";this.core.addEvent(type);this.utils.disableSelectAll();this.core.setCallback("click",e)},this));this.$editor.on("paste.redactor",$.proxy(this.paste.init,this));this.$editor.on("cut.redactor",$.proxy(this.code.sync,this));this.$editor.on("keydown.redactor",$.proxy(this.keydown.init,this));this.$editor.on("keyup.redactor",$.proxy(this.keyup.init,this));if($.isFunction(this.opts.codeKeydownCallback)){this.$textarea.on("keydown.redactor-textarea",$.proxy(this.opts.codeKeydownCallback,this))}if($.isFunction(this.opts.codeKeyupCallback)){this.$textarea.on("keyup.redactor-textarea",$.proxy(this.opts.codeKeyupCallback,this))}this.$editor.on("focus.redactor",$.proxy(function(e){if($.isFunction(this.opts.focusCallback)){this.core.setCallback("focus",e)}this.build.focused=true;this.build.blured=false;if(this.selection.getCurrent()===false){this.selection.get();this.range.setStart(this.$editor[0],0);this.range.setEnd(this.$editor[0],0);this.selection.addRange()}},this));$(document).on("mousedown.redactor-blur."+this.uuid,$.proxy(function(e){if(this.start)return;if(this.rtePaste)return;if($(e.target).closest(".redactor-editor, .redactor-toolbar, .redactor-dropdown").size()!==0){return}this.utils.disableSelectAll();if(!this.build.blured&&$.isFunction(this.opts.blurCallback)){this.core.setCallback("blur",e)}this.build.focused=false;this.build.blured=true},this))},setHelpers:function(){if(this.linkify.isEnabled()){this.linkify.format()}this.placeholder.enable();if(this.opts.focus)setTimeout(this.focus.setStart,100);if(this.opts.focusEnd)setTimeout(this.focus.setEnd,100)},plugins:function(){if(!this.opts.plugins)return;$.each(this.opts.plugins,$.proxy(function(i,s){var func=typeof RedactorPlugins!=="undefined"&&typeof RedactorPlugins[s]!=="undefined"?RedactorPlugins:Redactor.fn;if(!$.isFunction(func[s])){return}this[s]=func[s]();var methods=this.getModuleMethods(this[s]);var len=methods.length;for(var z=0;z<len;z++){this[s][methods[z]]=this[s][methods[z]].bind(this)}if($.isFunction(this[s].init)){this[s].init()}},this))},disableMozillaEditing:function(){if(!this.utils.browser("mozilla"))return;try{document.execCommand("enableObjectResizing",false,false);document.execCommand("enableInlineTableEditing",false,false)}catch(e){}},disableIeLinks:function(){if(!this.utils.browser("msie"))return;
document.execCommand("AutoUrlDetect",false,false)}}},button:function(){return{build:function(btnName,btnObject){var $button=$('<a href="#" class="re-icon re-'+btnName+'" rel="'+btnName+'" />').attr({role:"button","aria-label":btnObject.title,tabindex:"-1"});if(btnObject.func||btnObject.command||btnObject.dropdown){this.button.setEvent($button,btnName,btnObject)}if(btnObject.dropdown){$button.addClass("redactor-toolbar-link-dropdown").attr("aria-haspopup",true);var $dropdown=$('<div class="redactor-dropdown redactor-dropdown-'+this.uuid+" redactor-dropdown-box-"+btnName+'" style="display: none;">');$button.data("dropdown",$dropdown);this.dropdown.build(btnName,$dropdown,btnObject.dropdown)}if(this.utils.isDesktop()){this.button.createTooltip($button,btnName,btnObject.title)}return $button},setEvent:function($button,btnName,btnObject){$button.on("touchstart click",$.proxy(function(e){if($button.hasClass("redactor-button-disabled"))return false;var type="func";var callback=btnObject.func;if(btnObject.command){type="command";callback=btnObject.command}else if(btnObject.dropdown){type="dropdown";callback=false}this.button.onClick(e,btnName,type,callback)},this))},createTooltip:function($button,name,title){var $tooltip=$("<span>").addClass("redactor-toolbar-tooltip redactor-toolbar-tooltip-"+this.uuid+" redactor-toolbar-tooltip-"+name).hide().html(title);$tooltip.appendTo("body");$button.on("mouseover",function(){if($(this).hasClass("redactor-button-disabled")){return}var pos=$button.offset();$tooltip.css({top:pos.top+$button.innerHeight()+"px",left:pos.left+$button.innerWidth()/2-$tooltip.innerWidth()/2+"px"});$tooltip.show()});$button.on("mouseout",function(){$tooltip.hide()})},onClick:function(e,btnName,type,callback){this.button.caretOffset=this.caret.getOffset();e.preventDefault();$(document).find(".redactor-toolbar-tooltip").hide();if(this.utils.browser("msie"))e.returnValue=false;if(type=="command")this.inline.format(callback);else if(type=="dropdown")this.dropdown.show(e,btnName);else this.button.onClickCallback(e,callback,btnName)},onClickCallback:function(e,callback,btnName){var func;if($.isFunction(callback))callback.call(this,btnName);else if(callback.search(/\./)!="-1"){func=callback.split(".");if(typeof this[func[0]]=="undefined")return;this[func[0]][func[1]](btnName)}else this[callback](btnName);this.observe.buttons(e,btnName)},get:function(key){return this.$toolbar.find("a.re-"+key)},setActive:function(key){this.button.get(key).addClass("redactor-act")},setInactive:function(key){this.button.get(key).removeClass("redactor-act")},setInactiveAll:function(key){if(typeof key==="undefined"){this.$toolbar.find("a.re-icon").removeClass("redactor-act")}else{this.$toolbar.find("a.re-icon").not(".re-"+key).removeClass("redactor-act")}},setActiveInVisual:function(){this.$toolbar.find("a.re-icon").not("a.re-html, a.re-fullscreen").removeClass("redactor-button-disabled")},setInactiveInCode:function(){this.$toolbar.find("a.re-icon").not("a.re-html, a.re-fullscreen").addClass("redactor-button-disabled")},changeIcon:function(key,classname){this.button.get(key).addClass("re-"+classname)},removeIcon:function(key,classname){this.button.get(key).removeClass("re-"+classname)},setAwesome:function(key,name){var $button=this.button.get(key);$button.removeClass("redactor-btn-image").addClass("fa-redactor-btn");$button.html('<i class="fa '+name+'"></i>')},addCallback:function($btn,callback){if($btn=="buffer")return;var type=callback=="dropdown"?"dropdown":"func";var key=$btn.attr("rel");$btn.on("touchstart click",$.proxy(function(e){if($btn.hasClass("redactor-button-disabled"))return false;this.button.onClick(e,key,type,callback)},this))},addDropdown:function($btn,dropdown){$btn.addClass("redactor-toolbar-link-dropdown").attr("aria-haspopup",true);var key=$btn.attr("rel");this.button.addCallback($btn,"dropdown");var $dropdown=$('<div class="redactor-dropdown redactor-dropdown-'+this.uuid+" redactor-dropdown-box-"+key+'" style="display: none;">');$btn.data("dropdown",$dropdown);if(dropdown)this.dropdown.build(key,$dropdown,dropdown);return $dropdown},add:function(key,title){if(!this.opts.toolbar)return;if(this.button.isMobileUndoRedo(key))return"buffer";var btn=this.button.build(key,{title:title});btn.addClass("redactor-btn-image");this.$toolbar.append($("<li>").append(btn));return btn},addFirst:function(key,title){if(!this.opts.toolbar)return;if(this.button.isMobileUndoRedo(key))return"buffer";var btn=this.button.build(key,{title:title});btn.addClass("redactor-btn-image");this.$toolbar.prepend($("<li>").append(btn));return btn},addAfter:function(afterkey,key,title){if(!this.opts.toolbar)return;if(this.button.isMobileUndoRedo(key))return"buffer";var btn=this.button.build(key,{title:title});btn.addClass("redactor-btn-image");var $btn=this.button.get(afterkey);if($btn.length!==0)$btn.parent().after($("<li>").append(btn));else this.$toolbar.append($("<li>").append(btn));return btn},addBefore:function(beforekey,key,title){if(!this.opts.toolbar)return;if(this.button.isMobileUndoRedo(key))return"buffer";var btn=this.button.build(key,{title:title});btn.addClass("redactor-btn-image");var $btn=this.button.get(beforekey);if($btn.length!==0)$btn.parent().before($("<li>").append(btn));else this.$toolbar.append($("<li>").append(btn));return btn},remove:function(key){this.button.get(key).remove()},isMobileUndoRedo:function(key){return(key=="undo"||key=="redo")&&!this.utils.isDesktop()}}},caret:function(){return{setStart:function(node){if(!this.utils.isBlock(node)){var space=this.utils.createSpaceElement();$(node).prepend(space);this.caret.setEnd(space)}else{this.caret.set(node,0,node,0)}},setEnd:function(node){node=node[0]||node;if(node.lastChild.nodeType==1){return this.caret.setAfter(node.lastChild)}this.caret.set(node,1,node,1)},set:function(orgn,orgo,focn,foco){orgn=orgn[0]||orgn;focn=focn[0]||focn;if(this.utils.isBlockTag(orgn.tagName)&&orgn.innerHTML===""){orgn.innerHTML=this.opts.invisibleSpace}if(orgn.tagName=="BR"&&this.opts.linebreaks===false){var parent=$(this.opts.emptyHtml)[0];$(orgn).replaceWith(parent);orgn=parent;focn=orgn}this.selection.get();try{this.range.setStart(orgn,orgo);this.range.setEnd(focn,foco)}catch(e){}this.selection.addRange()},setAfter:function(node){try{var tag=$(node)[0].tagName;if(tag!="BR"&&!this.utils.isBlock(node)){var space=this.utils.createSpaceElement();$(node).after(space);this.caret.setEnd(space)}else{if(tag!="BR"&&this.utils.browser("msie")){this.caret.setStart($(node).next())}else{this.caret.setAfterOrBefore(node,"after")}}}catch(e){var space=this.utils.createSpaceElement();$(node).after(space);this.caret.setEnd(space)}},setBefore:function(node){if(this.utils.isBlock(node)){this.caret.setEnd($(node).prev())}else{this.caret.setAfterOrBefore(node,"before")}},setAfterOrBefore:function(node,type){if(!this.utils.browser("msie"))this.$editor.focus();node=node[0]||node;this.selection.get();if(type=="after"){try{this.range.setStartAfter(node);this.range.setEndAfter(node)}catch(e){}}else{try{this.range.setStartBefore(node);this.range.setEndBefore(node)}catch(e){}}this.range.collapse(false);this.selection.addRange()},getOffsetOfElement:function(node){node=node[0]||node;this.selection.get();var cloned=this.range.cloneRange();cloned.selectNodeContents(node);cloned.setEnd(this.range.endContainer,this.range.endOffset);return $.trim(cloned.toString()).length},getOffset:function(){var offset=0;var sel=window.getSelection();if(sel.rangeCount>0){var range=window.getSelection().getRangeAt(0);var caretRange=range.cloneRange();caretRange.selectNodeContents(this.$editor[0]);caretRange.setEnd(range.endContainer,range.endOffset);offset=caretRange.toString().length}return offset},setOffset:function(start,end){if(typeof end=="undefined")end=start;if(!this.focus.isFocused())this.focus.setStart();var sel=this.selection.get();var node,offset=0;var walker=document.createTreeWalker(this.$editor[0],NodeFilter.SHOW_TEXT,null,null);while(node=walker.nextNode()){offset+=node.nodeValue.length;if(offset>start){this.range.setStart(node,node.nodeValue.length+start-offset);start=Infinity}if(offset>=end){this.range.setEnd(node,node.nodeValue.length+end-offset);break}}this.range.collapse(false);this.selection.addRange()},setToPoint:function(start,end){this.caret.setOffset(start,end)},getCoords:function(){return this.caret.getOffset()}}},clean:function(){return{onSet:function(html){html=this.clean.savePreCode(html);html=html.replace(/<script(.*?[^>]?)>([\w\W]*?)<\/script>/gi,'<pre class="redactor-script-tag" style="display: none;" $1>$2</pre>');html=html.replace(/\$/g,"&#36;");html=html.replace(/<a href="(.*?[^>]?)®(.*?[^>]?)">/gi,'<a href="$1&reg$2">');if(this.opts.replaceDivs&&!this.opts.linebreaks)html=this.clean.replaceDivs(html);if(this.opts.linebreaks)html=this.clean.replaceParagraphsToBr(html);html=this.clean.saveFormTags(html);var $div=$("<div>");$div.html(html);var fonts=$div.find("font[style]");if(fonts.length!==0){fonts.replaceWith(function(){var $el=$(this);var $span=$("<span>").attr("style",$el.attr("style"));return $span.append($el.contents())});html=$div.html()}$div.remove();html=html.replace(/<font(.*?)>/gi,"");html=html.replace(/<\/font>/gi,"");html=this.tidy.load(html);if(this.opts.paragraphize)html=this.paragraphize.load(html);html=this.clean.setVerified(html);html=this.clean.convertInline(html);html=html.replace(/&amp;/g,"&");return html},onSync:function(html){html=html.replace(/\u200B/g,"");html=html.replace(/&#x200b;/gi,"");if(this.opts.cleanSpaces){html=html.replace(/&nbsp;/gi," ")}if(html.search(/^<p>(||\s||<br\s?\/?>||&nbsp;)<\/p>$/i)!=-1){return""}html=html.replace(/<pre class="redactor-script-tag" style="display: none;"(.*?[^>]?)>([\w\W]*?)<\/pre>/gi,"<script$1>$2</script>");html=this.clean.restoreFormTags(html);var chars={"™":"&trade;","©":"&copy;","…":"&hellip;","—":"&mdash;","‐":"&dash;"};$.each(chars,function(i,s){html=html.replace(new RegExp(i,"g"),s)});if(this.utils.browser("mozilla")){html=html.replace(/<br\s?\/?>$/gi,"")}html=html.replace(new RegExp("<br\\s?/?></li>","gi"),"</li>");html=html.replace(new RegExp("</li><br\\s?/?>","gi"),"</li>");html=html.replace(/<(.*?)rel="\s*?"(.*?[^>]?)>/gi,'<$1$2">');html=html.replace(/<(.*?)style="\s*?"(.*?[^>]?)>/gi,'<$1$2">');html=html.replace(/="">/gi,">");html=html.replace(/""">/gi,'">');html=html.replace(/"">/gi,'">');html=html.replace(/<div(.*?)data-tagblock="redactor"(.*?[^>])>/gi,"<div$1$2>");html=html.replace(/<(.*?) data-verified="redactor"(.*?[^>])>/gi,"<$1$2>");var $div=$("<div/>").html($.parseHTML(html,document,true));$div.find("span").removeAttr("rel");$div.find("pre .redactor-invisible-space").each(function(){$(this).contents().unwrap()});html=$div.html();html=html.replace(/<img(.*?[^>])rel="(.*?[^>])"(.*?[^>])>/gi,"<img$1$3>");html=html.replace(/<span class="redactor-invisible-space">(.*?)<\/span>/gi,"$1");html=html.replace(/ data-save-url="(.*?[^>])"/gi,"");html=html.replace(/<span(.*?)id="redactor-image-box"(.*?[^>])>([\w\W]*?)<img(.*?)><\/span>/gi,"$3<img$4>");html=html.replace(/<span(.*?)id="redactor-image-resizer"(.*?[^>])>(.*?)<\/span>/gi,"");html=html.replace(/<span(.*?)id="redactor-image-editter"(.*?[^>])>(.*?)<\/span>/gi,"");html=html.replace(/<font(.*?)>/gi,"");html=html.replace(/<\/font>/gi,"");html=this.tidy.load(html);if(this.opts.linkNofollow){html=html.replace(/<a(.*?)rel="nofollow"(.*?[^>])>/gi,"<a$1$2>");html=html.replace(/<a(.*?[^>])>/gi,'<a$1 rel="nofollow">')}html=html.replace(/\sdata-redactor-(tag|class|style)="(.*?[^>])"/gi,"");html=html.replace(new RegExp('<(.*?) data-verified="redactor"(.*?[^>])>',"gi"),"<$1$2>");html=html.replace(new RegExp('<(.*?) data-verified="redactor">',"gi"),"<$1>");html=html.replace(/&amp;/g,"&");return html},onPaste:function(html,setMode){html=$.trim(html);html=html.replace(/\$/g,"&#36;");html=html.replace(/<span class="s[0-9]">/gi,"<span>");html=html.replace(/<span class="Apple-converted-space">&nbsp;<\/span>/gi," ");html=html.replace(/<span class="Apple-tab-span"[^>]*>\t<\/span>/gi,"	");html=html.replace(/<span[^>]*>(\s|&nbsp;)<\/span>/gi," ");if(this.opts.pastePlainText){return this.clean.getPlainText(html)}if(!this.utils.isSelectAll()&&typeof setMode=="undefined"){if(this.utils.isCurrentOrParent(["FIGCAPTION","A"])){return this.clean.getPlainText(html,false)}if(this.utils.isCurrentOrParent("PRE")){html=html.replace(/”/g,'"');html=html.replace(/“/g,'"');html=html.replace(/‘/g,"'");html=html.replace(/’/g,"'");return this.clean.getPreCode(html)}if(this.utils.isCurrentOrParent(["BLOCKQUOTE","H1","H2","H3","H4","H5","H6"])){html=this.clean.getOnlyImages(html);if(!this.utils.browser("msie")){var block=this.selection.getBlock();if(block&&block.tagName=="P"){html=html.replace(/<img(.*?)>/gi,"<p><img$1></p>")}}return html}if(this.utils.isCurrentOrParent(["TD"])){html=this.clean.onPasteTidy(html,"td");if(this.opts.linebreaks)html=this.clean.replaceParagraphsToBr(html);html=this.clean.replaceDivsToBr(html);return html}if(this.utils.isCurrentOrParent(["LI"])){return this.clean.onPasteTidy(html,"li")}}html=this.clean.isSingleLine(html,setMode);if(!this.clean.singleLine){if(this.opts.linebreaks)html=this.clean.replaceParagraphsToBr(html);if(this.opts.replaceDivs)html=this.clean.replaceDivs(html);html=this.clean.saveFormTags(html)}html=this.clean.onPasteWord(html);html=this.clean.onPasteExtra(html);html=this.clean.onPasteTidy(html,"all");if(!this.clean.singleLine&&this.opts.paragraphize){html=this.paragraphize.load(html)}html=this.clean.removeDirtyStyles(html);html=this.clean.onPasteRemoveSpans(html);html=this.clean.onPasteRemoveEmpty(html);html=this.clean.convertInline(html);return html},onPasteWord:function(html){html=html.replace(/<!--[\s\S]*?-->/gi,"");html=html.replace(/<style[^>]*>[\s\S]*?<\/style>/gi,"");html=html.replace(/<o\:p[^>]*>[\s\S]*?<\/o\:p>/gi,"");if(html.match(/class="?Mso|style="[^"]*\bmso-|style='[^'']*\bmso-|w:WordDocument/i)){html=html.replace(/<!--[\s\S]+?-->/gi,"");html=html.replace(/<(!|script[^>]*>.*?<\/script(?=[>\s])|\/?(\?xml(:\w+)?|img|meta|link|style|\w:\w+)(?=[\s\/>]))[^>]*>/gi,"");html=html.replace(/<(\/?)s>/gi,"<$1strike>");html=html.replace(/ /gi," ");html=html.replace(/<span\s+style\s*=\s*"\s*mso-spacerun\s*:\s*yes\s*;?\s*"\s*>([\s\u00a0]*)<\/span>/gi,function(str,spaces){return spaces.length>0?spaces.replace(/./," ").slice(Math.floor(spaces.length/2)).split("").join(" "):""});html=this.clean.onPasteIeFixLinks(html);html=html.replace(/<img(.*?)v:shapes=(.*?)>/gi,"");html=html.replace(/src="file\:\/\/(.*?)"/,'src=""');var $div=$("<div/>").html(html);var lastList=false;var lastLevel=1;var listsIds=[];$div.find("p[style]").each(function(){var matches=$(this).attr("style").match(/mso\-list\:l([0-9]+)\slevel([0-9]+)/);if(matches){var currentList=parseInt(matches[1]);var currentLevel=parseInt(matches[2]);var listType=$(this).html().match(/^[\w]+\./)?"ol":"ul";var $li=$("<li/>").html($(this).html());$li.html($li.html().replace(/^([\w\.]+)</,"<"));$li.find("span:first").remove();if(currentLevel==1&&$.inArray(currentList,listsIds)==-1){var $list=$("<"+listType+"/>").attr({"data-level":currentLevel,"data-list":currentList}).html($li);$(this).replaceWith($list);lastList=currentList;listsIds.push(currentList)}else{if(currentLevel>lastLevel){var $prevList=$div.find('[data-level="'+lastLevel+'"][data-list="'+lastList+'"]');var $lastList=$prevList;for(var i=lastLevel;i<currentLevel;i++){$list=$("<"+listType+"/>");$list.appendTo($lastList.find("li").last());$lastList=$list}$lastList.attr({"data-level":currentLevel,"data-list":currentList}).html($li)}else{var $prevList=$div.find('[data-level="'+currentLevel+'"][data-list="'+currentList+'"]').last();$prevList.append($li)}lastLevel=currentLevel;lastList=currentList;$(this).remove()}}});$div.find("[data-level][data-list]").removeAttr("data-level data-list");html=$div.html();html=html.replace(/·/g,"");html=html.replace(/<p class="Mso(.*?)"/gi,"<p");html=html.replace(/ class=\"(mso[^\"]*)\"/gi,"");html=html.replace(/ class=(mso\w+)/gi,"");html=html.replace(/<o:p(.*?)>([\w\W]*?)<\/o:p>/gi,"$2");html=html.replace(/\n/g," ");html=html.replace(/<p>\n?<li>/gi,"<li>")}return html},onPasteExtra:function(html){html=html.replace(/<b\sid="internal-source-marker(.*?)">([\w\W]*?)<\/b>/gi,"$2");html=html.replace(/<b(.*?)id="docs-internal-guid(.*?)">([\w\W]*?)<\/b>/gi,"$3");html=html.replace(/<span[^>]*(font-style: italic; font-weight: bold|font-weight: bold; font-style: italic)[^>]*>/gi,'<span style="font-weight: bold;"><span style="font-style: italic;">');html=html.replace(/<span[^>]*font-style: italic[^>]*>/gi,'<span style="font-style: italic;">');html=html.replace(/<span[^>]*font-weight: bold[^>]*>/gi,'<span style="font-weight: bold;">');html=html.replace(/<span[^>]*text-decoration: underline[^>]*>/gi,'<span style="text-decoration: underline;">');html=html.replace(/<img>/gi,"");html=html.replace(/\n{3,}/gi,"\n");html=html.replace(/<font(.*?)>([\w\W]*?)<\/font>/gi,"$2");html=html.replace(/<p><p>/gi,"<p>");html=html.replace(/<\/p><\/p>/gi,"</p>");html=html.replace(/<li>(\s*|\t*|\n*)<p>/gi,"<li>");html=html.replace(/<\/p>(\s*|\t*|\n*)<\/li>/gi,"</li>");html=html.replace(/<\/p>\s<p/gi,"</p><p");html=html.replace(/<img src="webkit-fake-url\:\/\/(.*?)"(.*?)>/gi,"");html=html.replace(/<p>•([\w\W]*?)<\/p>/gi,"<li>$1</li>");if(this.utils.browser("mozilla")){html=html.replace(/<br\s?\/?>$/gi,"")}return html},onPasteTidy:function(html,type){var tags=["span","a","pre","blockquote","small","em","strong","code","kbd","mark","address","cite","var","samp","dfn","sup","sub","b","i","u","del","ol","ul","li","dl","dt","dd","p","br","video","audio","iframe","embed","param","object","img","table","td","th","tr","tbody","tfoot","thead","h1","h2","h3","h4","h5","h6"];var tagsEmpty=false;var attrAllowed=[["a","*"],["img",["src","alt"]],["span",["class","rel","data-verified"]],["iframe","*"],["video","*"],["audio","*"],["embed","*"],["object","*"],["param","*"],["source","*"]];if(type=="all"){tagsEmpty=["p","span","h1","h2","h3","h4","h5","h6"];attrAllowed=[["table","class"],["td",["colspan","rowspan"]],["a","*"],["img",["src","alt","data-redactor-inserted-image"]],["span",["class","rel","data-verified"]],["iframe","*"],["video","*"],["audio","*"],["embed","*"],["object","*"],["param","*"],["source","*"]]}else if(type=="td"){tags=["ul","ol","li","span","a","small","em","strong","code","kbd","mark","cite","var","samp","dfn","sup","sub","b","i","u","del","ol","ul","li","dl","dt","dd","br","iframe","video","audio","embed","param","object","img","h1","h2","h3","h4","h5","h6"]}else if(type=="li"){tags=["ul","ol","li","span","a","small","em","strong","code","kbd","mark","cite","var","samp","dfn","sup","sub","b","i","u","del","br","iframe","video","audio","embed","param","object","img"]}var options={deniedTags:this.opts.deniedTags?this.opts.deniedTags:false,allowedTags:this.opts.allowedTags?this.opts.allowedTags:tags,removeComments:true,removePhp:true,removeAttr:this.opts.removeAttr?this.opts.removeAttr:false,allowedAttr:this.opts.allowedAttr?this.opts.allowedAttr:attrAllowed,removeEmpty:tagsEmpty};return this.tidy.load(html,options)},onPasteRemoveEmpty:function(html){html=html.replace(/<(p|h[1-6])>(|\s|\n|\t|<br\s?\/?>)<\/(p|h[1-6])>/gi,"");if(!this.opts.linebreaks)html=html.replace(/<br>$/i,"");return html},onPasteRemoveSpans:function(html){html=html.replace(/<span>(.*?)<\/span>/gi,"$1");html=html.replace(/<span[^>]*>\s|&nbsp;<\/span>/gi," ");return html},onPasteIeFixLinks:function(html){if(!this.utils.browser("msie"))return html;var tmp=$.trim(html);if(tmp.search(/^<a(.*?)>(.*?)<\/a>$/i)===0){html=html.replace(/^<a(.*?)>(.*?)<\/a>$/i,"$2")}return html},isSingleLine:function(html,setMode){this.clean.singleLine=false;if(!this.utils.isSelectAll()&&typeof setMode=="undefined"){var blocks=this.opts.blockLevelElements.join("|").replace("P|","").replace("DIV|","");var matchBlocks=html.match(new RegExp("</("+blocks+")>","gi"));var matchContainers=html.match(/<\/(p|div)>/gi);if(!matchBlocks&&(matchContainers===null||matchContainers&&matchContainers.length<=1)){var matchBR=html.match(/<br\s?\/?>/gi);if(!matchBR){this.clean.singleLine=true;html=html.replace(/<\/?(p|div)(.*?)>/gi,"")}}}return html},stripTags:function(input,allowed){allowed=(((allowed||"")+"").toLowerCase().match(/<[a-z][a-z0-9]*>/g)||[]).join("");var tags=/<\/?([a-z][a-z0-9]*)\b[^>]*>/gi;return input.replace(tags,function($0,$1){return allowed.indexOf("<"+$1.toLowerCase()+">")>-1?$0:""})},savePreCode:function(html){html=this.clean.savePreFormatting(html);html=this.clean.saveCodeFormatting(html);html=this.clean.restoreSelectionMarker(html);return html},savePreFormatting:function(html){var pre=html.match(/<pre(.*?)>([\w\W]*?)<\/pre>/gi);if(pre!==null){$.each(pre,$.proxy(function(i,s){var arr=s.match(/<pre(.*?)>([\w\W]*?)<\/pre>/i);arr[2]=arr[2].replace(/<br\s?\/?>/g,"\n");arr[2]=arr[2].replace(/&nbsp;/g," ");if(this.opts.preSpaces){arr[2]=arr[2].replace(/\t/g,Array(this.opts.preSpaces+1).join(" "))}arr[2]=this.clean.encodeEntities(arr[2]);arr[2]=arr[2].replace(/\$/g,"&#36;");html=html.replace(s,"<pre"+arr[1]+">"+arr[2]+"</pre>")},this))}return html},saveCodeFormatting:function(html){var code=html.match(/<code(.*?)>([\w\W]*?)<\/code>/gi);if(code!==null){$.each(code,$.proxy(function(i,s){var arr=s.match(/<code(.*?)>([\w\W]*?)<\/code>/i);arr[2]=arr[2].replace(/&nbsp;/g," ");arr[2]=this.clean.encodeEntities(arr[2]);arr[2]=arr[2].replace(/\$/g,"&#36;");html=html.replace(s,"<code"+arr[1]+">"+arr[2]+"</code>")},this))}return html},restoreSelectionMarker:function(html){html=html.replace(/&lt;span id=&quot;selection-marker-([0-9])&quot; class=&quot;redactor-selection-marker&quot; data-verified=&quot;redactor&quot;&gt;​&lt;\/span&gt;/g,'<span id="selection-marker-$1" class="redactor-selection-marker" data-verified="redactor">​</span>');return html},getTextFromHtml:function(html){html=html.replace(/<br\s?\/?>|<\/H[1-6]>|<\/p>|<\/div>|<\/li>|<\/td>/gi,"\n");var tmp=document.createElement("div");tmp.innerHTML=html;html=tmp.textContent||tmp.innerText;return $.trim(html)},getPlainText:function(html,paragraphize){html=this.clean.getTextFromHtml(html);html=html.replace(/\n\s*\n/g,"\n");html=html.replace(/\n\n/g,"\n");html=html.replace(/\n/g,"<br />");if(this.opts.paragraphize&&typeof paragraphize=="undefined"&&!this.utils.browser("mozilla")){html=this.paragraphize.load(html)}return html},getPreCode:function(html){html=html.replace(/<img(.*?) style="(.*?)"(.*?[^>])>/gi,"<img$1$3>");html=html.replace(/<img(.*?)>/gi,"&lt;img$1&gt;");html=this.clean.getTextFromHtml(html);if(this.opts.preSpaces){html=html.replace(/\t/g,Array(this.opts.preSpaces+1).join(" "))}html=this.clean.encodeEntities(html);return html},getOnlyImages:function(html){html=html.replace(/<img(.*?)>/gi,"[img$1]");html=html.replace(/<([Ss]*?)>/gi,"");html=html.replace(/\[img(.*?)\]/gi,"<img$1>");return html},getOnlyLinksAndImages:function(html){html=html.replace(/<a(.*?)href="(.*?)"(.*?)>([\w\W]*?)<\/a>/gi,'[a href="$2"]$4[/a]');html=html.replace(/<img(.*?)>/gi,"[img$1]");html=html.replace(/<(.*?)>/gi,"");html=html.replace(/\[a href="(.*?)"\]([\w\W]*?)\[\/a\]/gi,'<a href="$1">$2</a>');html=html.replace(/\[img(.*?)\]/gi,"<img$1>");return html},encodeEntities:function(str){str=String(str).replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"');return str.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")},removeDirtyStyles:function(html){if(this.utils.browser("msie"))return html;var div=document.createElement("div");div.innerHTML=html;this.clean.clearUnverifiedRemove($(div));html=div.innerHTML;$(div).remove();return html},clearUnverified:function(){if(this.utils.browser("msie"))return;this.clean.clearUnverifiedRemove(this.$editor);var headers=this.$editor.find("h1, h2, h3, h4, h5, h6");headers.find("span").removeAttr("style");headers.find(this.opts.verifiedTags.join(", ")).removeAttr("style");this.code.sync()},clearUnverifiedRemove:function($editor){$editor.find(this.opts.verifiedTags.join(", ")).removeAttr("style");$editor.find("span").not('[data-verified="redactor"]').removeAttr("style");$editor.find('span[data-verified="redactor"], img[data-verified="redactor"]').each(function(i,s){var $s=$(s);$s.attr("style",$s.attr("rel"))})},cleanEmptyParagraph:function(){},setVerified:function(html){if(this.utils.browser("msie"))return html;html=html.replace(new RegExp("<img(.*?[^>])>","gi"),'<img$1 data-verified="redactor">');html=html.replace(new RegExp("<span(.*?[^>])>","gi"),'<span$1 data-verified="redactor">');var matches=html.match(new RegExp('<(span|img)(.*?)style="(.*?)"(.*?[^>])>',"gi"));if(matches){var len=matches.length;for(var i=0;i<len;i++){try{var newTag=matches[i].replace(/style="(.*?)"/i,'style="$1" rel="$1"');html=html.replace(matches[i],newTag)}catch(e){}}}return html},convertInline:function(html){var $div=$("<div />").html(html);var tags=this.opts.inlineTags;tags.push("span");$div.find(tags.join(",")).each(function(){var $el=$(this);var tag=this.tagName.toLowerCase();$el.attr("data-redactor-tag",tag);if(tag=="span"){if($el.attr("style"))$el.attr("data-redactor-style",$el.attr("style"));else if($el.attr("class"))$el.attr("data-redactor-class",$el.attr("class"))}});html=$div.html();$div.remove();return html},normalizeLists:function(){this.$editor.find("li").each(function(i,s){var $next=$(s).next();if($next.length!==0&&($next[0].tagName=="UL"||$next[0].tagName=="OL")){$(s).append($next)}})},removeSpaces:function(html){html=html.replace(/\n/g,"");html=html.replace(/[\t]*/g,"");html=html.replace(/\n\s*\n/g,"\n");html=html.replace(/^[\s\n]*/g," ");html=html.replace(/[\s\n]*$/g," ");html=html.replace(/>\s{2,}</g,"> <");html=html.replace(/\n\n/g,"\n");html=html.replace(/\u200B/g,"");return html},replaceDivs:function(html){if(this.opts.linebreaks){html=html.replace(/<div><br\s?\/?><\/div>/gi,"<br />");html=html.replace(/<div(.*?)>([\w\W]*?)<\/div>/gi,"$2<br />")}else{html=html.replace(/<div(.*?)>([\w\W]*?)<\/div>/gi,"<p$1>$2</p>")}html=html.replace(/<div(.*?[^>])>/gi,"");html=html.replace(/<\/div>/gi,"");return html},replaceDivsToBr:function(html){html=html.replace(/<div\s(.*?)>/gi,"<p>");html=html.replace(/<div><br\s?\/?><\/div>/gi,"<br /><br />");html=html.replace(/<div>([\w\W]*?)<\/div>/gi,"$1<br /><br />");return html},replaceParagraphsToBr:function(html){html=html.replace(/<p\s(.*?)>/gi,"<p>");html=html.replace(/<p><br\s?\/?><\/p>/gi,"<br />");html=html.replace(/<p>([\w\W]*?)<\/p>/gi,"$1<br /><br />");html=html.replace(/(<br\s?\/?>){1,}\n?<\/blockquote>/gi,"</blockquote>");return html},saveFormTags:function(html){return html.replace(/<form(.*?)>([\w\W]*?)<\/form>/gi,'<section$1 rel="redactor-form-tag">$2</section>')},restoreFormTags:function(html){return html.replace(/<section(.*?) rel="redactor-form-tag"(.*?)>([\w\W]*?)<\/section>/gi,"<form$1$2>$3</form>")}}},code:function(){return{set:function(html){html=$.trim(html.toString());html=this.clean.onSet(html);if(this.utils.browser("msie")){html=html.replace(/<span(.*?)id="selection-marker-(1|2)"(.*?)><\/span>/gi,"")}this.$editor.html(html);this.code.sync();if(html!=="")this.placeholder.remove();setTimeout($.proxy(this.buffer.add,this),15);if(this.start===false)this.observe.load()},get:function(){var code=this.$textarea.val();if(this.opts.replaceDivs)code=this.clean.replaceDivs(code);if(this.opts.linebreaks)code=this.clean.replaceParagraphsToBr(code);code=this.tabifier.get(code);return code},sync:function(){setTimeout($.proxy(this.code.startSync,this),10)},startSync:function(){var html=this.$editor.html();if(this.code.syncCode&&this.code.syncCode==html||this.start&&html==""){return}this.code.syncCode=html;html=this.core.setCallback("syncBefore",html);html=this.clean.onSync(html);this.$textarea.val(html);this.core.setCallback("sync",html);if(this.start===false){this.core.setCallback("change",html)}this.start=false;if(this.autosave.html==false){this.autosave.html=this.code.get()}if(this.opts.codemirror){this.$textarea.next(".CodeMirror").each(function(i,el){el.CodeMirror.setValue(html)})}this.autosave.onChange();this.autosave.enable()},toggle:function(){if(this.opts.visual){this.code.showCode()}else{this.code.showVisual()}},showCode:function(){this.selection.save();this.code.offset=this.caret.getOffset();var scroll=$(window).scrollTop();var width=this.$editor.innerWidth(),height=this.$editor.innerHeight();this.$editor.hide();var html=this.$textarea.val();this.modified=this.clean.removeSpaces(html);html=this.tabifier.get(html);var start=0,end=0;var $editorDiv=$("<div/>").append($.parseHTML(this.clean.onSync(this.$editor.html()),document,true));var $selectionMarkers=$editorDiv.find("span.redactor-selection-marker");if($selectionMarkers.length>0){var editorHtml=this.tabifier.get($editorDiv.html()).replace(/&amp;/g,"&");if($selectionMarkers.length==1){start=this.utils.strpos(editorHtml,$editorDiv.find("#selection-marker-1").prop("outerHTML"));end=start}else if($selectionMarkers.length==2){start=this.utils.strpos(editorHtml,$editorDiv.find("#selection-marker-1").prop("outerHTML"));end=this.utils.strpos(editorHtml,$editorDiv.find("#selection-marker-2").prop("outerHTML"))-$editorDiv.find("#selection-marker-1").prop("outerHTML").toString().length}}this.selection.removeMarkers();this.$textarea.val(html);if(this.opts.codemirror){this.$textarea.next(".CodeMirror").each(function(i,el){$(el).show();el.CodeMirror.setValue(html);el.CodeMirror.setSize("100%",height);el.CodeMirror.refresh();if(start==end){el.CodeMirror.setCursor(el.CodeMirror.posFromIndex(start).line,el.CodeMirror.posFromIndex(end).ch)}else{el.CodeMirror.setSelection({line:el.CodeMirror.posFromIndex(start).line,ch:el.CodeMirror.posFromIndex(start).ch},{line:el.CodeMirror.posFromIndex(end).line,ch:el.CodeMirror.posFromIndex(end).ch})}el.CodeMirror.focus()})}else{this.$textarea.height(height).show().focus();this.$textarea.on("keydown.redactor-textarea-indenting",this.code.textareaIndenting);$(window).scrollTop(scroll);if(this.$textarea[0].setSelectionRange){this.$textarea[0].setSelectionRange(start,end)}this.$textarea[0].scrollTop=0}this.opts.visual=false;this.button.setInactiveInCode();this.button.setActive("html");this.core.setCallback("source",html)},showVisual:function(){var html;if(this.opts.visual)return;var start=0,end=0;if(this.opts.codemirror){var selection;this.$textarea.next(".CodeMirror").each(function(i,el){selection=el.CodeMirror.listSelections();start=el.CodeMirror.indexFromPos(selection[0].anchor);end=el.CodeMirror.indexFromPos(selection[0].head);html=el.CodeMirror.getValue()})}else{start=this.$textarea.get(0).selectionStart;end=this.$textarea.get(0).selectionEnd;html=this.$textarea.hide().val()}if(start>end&&end>0){var tempStart=end;var tempEnd=start;start=tempStart;end=tempEnd}start=this.code.enlargeOffset(html,start);end=this.code.enlargeOffset(html,end);html=html.substr(0,start)+this.selection.getMarkerAsHtml(1)+html.substr(start);if(end>start){var markerLength=this.selection.getMarkerAsHtml(1).toString().length;html=html.substr(0,end+markerLength)+this.selection.getMarkerAsHtml(2)+html.substr(end+markerLength)}if(this.modified!==this.clean.removeSpaces(html)){this.code.set(html)}if(this.opts.codemirror){this.$textarea.next(".CodeMirror").hide()}this.$editor.show();if(!this.utils.isEmpty(html)){this.placeholder.remove()}this.selection.restore();this.$textarea.off("keydown.redactor-textarea-indenting");this.button.setActiveInVisual();this.button.setInactive("html");this.observe.load();this.opts.visual=true;this.core.setCallback("visual",html)},textareaIndenting:function(e){if(e.keyCode!==9)return true;var $el=this.$textarea;var start=$el.get(0).selectionStart;$el.val($el.val().substring(0,start)+"	"+$el.val().substring($el.get(0).selectionEnd));$el.get(0).selectionStart=$el.get(0).selectionEnd=start+1;return false},enlargeOffset:function(html,offset){var htmlLength=html.length;var c=0;if(html[offset]==">"){c++}else{for(var i=offset;i<=htmlLength;i++){c++;if(html[i]==">"){break}else if(html[i]=="<"||i==htmlLength){c=0;
break}}}return offset+c}}},core:function(){return{getObject:function(){return $.extend({},this)},getEditor:function(){return this.$editor},getBox:function(){return this.$box},getElement:function(){return this.$element},getTextarea:function(){return this.$textarea},getToolbar:function(){return this.$toolbar?this.$toolbar:false},addEvent:function(name){this.core.event=name},getEvent:function(){return this.core.event},setCallback:function(type,e,data){var eventName=type+"Callback";var eventNamespace="redactor";var callback=this.opts[eventName];if(this.$textarea){var returnValue=false;var events=$._data(this.$textarea[0],"events");if(typeof events!="undefined"&&typeof events[eventName]!="undefined"){$.each(events[eventName],$.proxy(function(key,value){if(value["namespace"]==eventNamespace){var data=typeof data=="undefined"?[e]:[e,data];returnValue=typeof data=="undefined"?value.handler.call(this,e):value.handler.call(this,e,data)}},this))}if(returnValue)return returnValue}if($.isFunction(callback)){return typeof data=="undefined"?callback.call(this,e):callback.call(this,e,data)}else{return typeof data=="undefined"?e:data}},destroy:function(){this.opts.destroyed=true;this.core.setCallback("destroy");this.$element.off(".redactor").removeData("redactor");this.$editor.off(".redactor");$(document).off("mousedown.redactor-blur."+this.uuid);$(document).off("mousedown.redactor."+this.uuid);$(document).off("click.redactor-image-delete."+this.uuid);$(document).off("click.redactor-image-resize-hide."+this.uuid);$(document).off("touchstart.redactor."+this.uuid+" click.redactor."+this.uuid);$("body").off("scroll.redactor."+this.uuid);$(this.opts.toolbarFixedTarget).off("scroll.redactor."+this.uuid);this.$editor.removeClass("redactor-editor redactor-linebreaks redactor-placeholder");this.$editor.removeAttr("contenteditable");var html=this.code.get();if(this.opts.toolbar){this.$toolbar.find("a").each(function(){var $el=$(this);if($el.data("dropdown")){$el.data("dropdown").remove();$el.data("dropdown",{})}})}if(this.build.isTextarea()){this.$box.after(this.$element);this.$box.remove();this.$element.val(html).show()}else{this.$box.after(this.$editor);this.$box.remove();this.$element.html(html).show()}if(this.$pasteBox)this.$pasteBox.remove();if(this.$modalBox)this.$modalBox.remove();if(this.$modalOverlay)this.$modalOverlay.remove();$(".redactor-toolbar-tooltip-"+this.uuid).remove();clearInterval(this.autosaveInterval)}}},dropdown:function(){return{build:function(name,$dropdown,dropdownObject){if(name=="formatting"&&this.opts.formattingAdd){$.each(this.opts.formattingAdd,$.proxy(function(i,s){var name=s.tag,func;if(typeof s["class"]!="undefined"){name=name+"-"+s["class"]}s.type=this.utils.isBlockTag(s.tag)?"block":"inline";if(typeof s.func!=="undefined"){func=s.func}else{func=s.type=="inline"?"inline.formatting":"block.formatting"}if(this.opts.linebreaks&&s.type=="block"&&s.tag=="p")return;this.formatting[name]={tag:s.tag,style:s.style,"class":s["class"],attr:s.attr,data:s.data,clear:s.clear};dropdownObject[name]={func:func,title:s.title}},this))}$.each(dropdownObject,$.proxy(function(btnName,btnObject){var $item=$('<a href="#" class="redactor-dropdown-'+btnName+'" role="button">'+btnObject.title+"</a>");if(name=="formatting")$item.addClass("redactor-formatting-"+btnName);$item.on("click",$.proxy(function(e){e.preventDefault();var type="func";var callback=btnObject.func;if(btnObject.command){type="command";callback=btnObject.command}else if(btnObject.dropdown){type="dropdown";callback=btnObject.dropdown}if($(e.target).hasClass("redactor-dropdown-link-inactive"))return;this.button.onClick(e,btnName,type,callback);this.dropdown.hideAll()},this));this.observe.addDropdown($item,btnName,btnObject);$dropdown.append($item)},this))},show:function(e,key){if(!this.opts.visual){e.preventDefault();return false}var $button=this.button.get(key);var $dropdown=$button.data("dropdown").appendTo(document.body);if(this.opts.highContrast){$dropdown.addClass("redactor-dropdown-contrast")}if($button.hasClass("dropact")){this.dropdown.hideAll()}else{this.dropdown.hideAll();this.observe.dropdowns();this.core.setCallback("dropdownShow",{dropdown:$dropdown,key:key,button:$button});this.button.setActive(key);$button.addClass("dropact");var keyPosition=$button.offset();var dropdownWidth=$dropdown.width();if(keyPosition.left+dropdownWidth>$(document).width()){keyPosition.left=Math.max(0,keyPosition.left-dropdownWidth)}var left=keyPosition.left+"px";if(this.$toolbar.hasClass("toolbar-fixed-box")){var top=this.$toolbar.innerHeight()+this.opts.toolbarFixedTopOffset;var position="fixed";if(this.opts.toolbarFixedTarget!==document){top=this.$toolbar.innerHeight()+this.$toolbar.offset().top+this.opts.toolbarFixedTopOffset;position="absolute"}$dropdown.css({position:position,left:left,top:top+"px"}).show()}else{var top=$button.innerHeight()+keyPosition.top+"px";$dropdown.css({position:"absolute",left:left,top:top}).show()}this.core.setCallback("dropdownShown",{dropdown:$dropdown,key:key,button:$button});this.$dropdown=$dropdown}$(document).one("click.redactor-dropdown",$.proxy(this.dropdown.hide,this));this.$editor.one("click.redactor-dropdown",$.proxy(this.dropdown.hide,this));$(document).one("keyup.redactor-dropdown",$.proxy(this.dropdown.closeHandler,this));$dropdown.on("mouseover.redactor-dropdown",$.proxy(this.utils.disableBodyScroll,this)).on("mouseout.redactor-dropdown",$.proxy(this.utils.enableBodyScroll,this));e.stopPropagation()},closeHandler:function(e){if(e.which!=this.keyCode.ESC)return;this.dropdown.hideAll();this.$editor.focus()},hideAll:function(){this.$toolbar.find("a.dropact").removeClass("redactor-act").removeClass("dropact");this.utils.enableBodyScroll();$(".redactor-dropdown-"+this.uuid).hide();$(".redactor-dropdown-link-selected").removeClass("redactor-dropdown-link-selected");if(this.$dropdown){this.$dropdown.off(".redactor-dropdown");this.core.setCallback("dropdownHide",this.$dropdown);this.$dropdown=false}},hide:function(e){var $dropdown=$(e.target);if(!$dropdown.hasClass("dropact")&&!$dropdown.hasClass("redactor-dropdown-link-inactive")){if($dropdown.hasClass("redactor-dropdown")){$dropdown.removeClass("dropact");$dropdown.off("mouseover mouseout")}this.dropdown.hideAll()}}}},file:function(){return{show:function(){this.modal.load("file",this.lang.get("file"),700);this.upload.init("#redactor-modal-file-upload",this.opts.fileUpload,this.file.insert);this.selection.save();this.selection.get();var text=this.sel.toString();$("#redactor-filename").val(text);this.modal.show()},insert:function(json,direct,e){if(typeof json.error!="undefined"){this.modal.close();this.selection.restore();this.core.setCallback("fileUploadError",json);return}var link;if(typeof json=="string"){link=json}else{var text=$("#redactor-filename").val();if(typeof text=="undefined"||text==="")text=json.filename;link='<a href="'+json.filelink+'" id="filelink-marker">'+text+"</a>"}if(direct){this.selection.removeMarkers();var marker=this.selection.getMarker();this.insert.nodeToCaretPositionFromPoint(e,marker)}else{this.modal.close()}this.selection.restore();this.buffer.set();this.insert.htmlWithoutClean(link);if(typeof json=="string")return;var linkmarker=$(this.$editor.find("a#filelink-marker"));if(linkmarker.length!==0){linkmarker.removeAttr("id").removeAttr("style")}else linkmarker=false;this.core.setCallback("fileUpload",linkmarker,json)}}},focus:function(){return{setStart:function(){this.$editor.focus();var first=this.$editor.children().first();if(first.length===0)return;if(first[0].length===0||first[0].tagName=="BR"||first[0].nodeType==3){return}if(first[0].tagName=="UL"||first[0].tagName=="OL"){var child=first.find("li").first();if(!this.utils.isBlock(child)&&child.text()===""){this.caret.setStart(child);return}}if(this.opts.linebreaks&&!this.utils.isBlockTag(first[0].tagName)){this.selection.get();this.range.setStart(this.$editor[0],0);this.range.setEnd(this.$editor[0],0);this.selection.addRange();return}this.caret.setStart(first)},setEnd:function(){var last=this.$editor.children().last();this.$editor.focus();if(last.size()===0)return;if(this.utils.isEmpty(this.$editor.html())){this.selection.get();this.range.collapse(true);this.range.setStartAfter(last[0]);this.range.setEnd(last[0],0);this.selection.addRange()}else{this.selection.get();this.range.selectNodeContents(last[0]);this.range.collapse(false);this.selection.addRange()}},isFocused:function(){return this.$editor[0]===document.activeElement}}},image:function(){return{show:function(){this.modal.load("image",this.lang.get("image"),700);this.upload.init("#redactor-modal-image-droparea",this.opts.imageUpload,this.image.insert);this.selection.save();this.modal.show()},showEdit:function($image){var $link=$image.closest("a",this.$editor[0]);this.modal.load("imageEdit",this.lang.get("edit"),705);this.modal.createCancelButton();this.image.buttonDelete=this.modal.createDeleteButton(this.lang.get("_delete"));this.image.buttonSave=this.modal.createActionButton(this.lang.get("save"));this.image.buttonDelete.on("click",$.proxy(function(){this.image.remove($image)},this));this.image.buttonSave.on("click",$.proxy(function(){this.image.update($image)},this));$(".redactor-link-tooltip").remove();$("#redactor-image-title").val($image.attr("alt"));if(!this.opts.imageLink)$(".redactor-image-link-option").hide();else{var $redactorImageLink=$("#redactor-image-link");$redactorImageLink.attr("href",$image.attr("src"));if($link.length!==0){$redactorImageLink.val($link.attr("href"));if($link.attr("target")=="_blank")$("#redactor-image-link-blank").prop("checked",true)}}if(!this.opts.imagePosition)$(".redactor-image-position-option").hide();else{var floatValue=$image.css("display")=="block"&&$image.css("float")=="none"?"center":$image.css("float");$("#redactor-image-align").val(floatValue)}this.modal.show();$("#redactor-image-title").focus()},setFloating:function($image){var floating=$("#redactor-image-align").val();var imageFloat="";var imageDisplay="";var imageMargin="";switch(floating){case"left":imageFloat="left";imageMargin="0 "+this.opts.imageFloatMargin+" "+this.opts.imageFloatMargin+" 0";break;case"right":imageFloat="right";imageMargin="0 0 "+this.opts.imageFloatMargin+" "+this.opts.imageFloatMargin;break;case"center":imageDisplay="block";imageMargin="auto";break}$image.css({"float":imageFloat,display:imageDisplay,margin:imageMargin});$image.attr("rel",$image.attr("style"))},update:function($image){this.image.hideResize();this.buffer.set();var $link=$image.closest("a",this.$editor[0]);var title=$("#redactor-image-title").val().replace(/(<([^>]+)>)/gi,"");$image.attr("alt",title);this.image.setFloating($image);var link=$.trim($("#redactor-image-link").val());var link=link.replace(/(<([^>]+)>)/gi,"");if(link!==""){var pattern="((xn--)?[a-z0-9]+(-[a-z0-9]+)*\\.)+[a-z]{2,}";var re=new RegExp("^(http|ftp|https)://"+pattern,"i");var re2=new RegExp("^"+pattern,"i");if(link.search(re)==-1&&link.search(re2)===0&&this.opts.linkProtocol){link=this.opts.linkProtocol+"://"+link}var target=$("#redactor-image-link-blank").prop("checked")?true:false;if($link.length===0){var a=$('<a href="'+link+'">'+this.utils.getOuterHtml($image)+"</a>");if(target)a.attr("target","_blank");$image.replaceWith(a)}else{$link.attr("href",link);if(target){$link.attr("target","_blank")}else{$link.removeAttr("target")}}}else if($link.length!==0){$link.replaceWith(this.utils.getOuterHtml($image))}this.modal.close();this.observe.images();this.code.sync()},setEditable:function($image){var $prev=$image.prev(":not([id^='redactor'])");var $next=$image.next(":not([id^='redactor'])");if($prev.size()||$next.size()){$image.wrap('<span class="acuity-redactor-fix"></span>')}if(this.opts.imageEditable){$image.on("dragstart",$.proxy(this.image.onDrag,this))}var handler=$.proxy(function(e){this.observe.image=$image;this.image.resizer=this.image.loadEditableControls($image);$(document).on("mousedown.redactor-image-resize-hide."+this.uuid,$.proxy(this.image.hideResize,this));if(!this.opts.imageResizable)return;this.image.resizer.on("mousedown.redactor touchstart.redactor",$.proxy(function(e){this.image.setResizable(e,$image)},this))},this);$image.off("mousedown.redactor").on("mousedown.redactor",$.proxy(this.image.hideResize,this));$image.off("click.redactor touchstart.redactor").on("click.redactor touchstart.redactor",handler)},setResizable:function(e,$image){e.preventDefault();this.image.resizeHandle={x:e.pageX,y:e.pageY,el:$image,ratio:$image.width()/$image.height(),h:$image.height()};e=e.originalEvent||e;if(e.targetTouches){this.image.resizeHandle.x=e.targetTouches[0].pageX;this.image.resizeHandle.y=e.targetTouches[0].pageY}this.image.startResize()},startResize:function(){$(document).on("mousemove.redactor-image-resize touchmove.redactor-image-resize",$.proxy(this.image.moveResize,this));$(document).on("mouseup.redactor-image-resize touchend.redactor-image-resize",$.proxy(this.image.stopResize,this))},moveResize:function(e){e.preventDefault();e=e.originalEvent||e;var height=this.image.resizeHandle.h;if(e.targetTouches)height+=e.targetTouches[0].pageY-this.image.resizeHandle.y;else height+=e.pageY-this.image.resizeHandle.y;var width=Math.round(height*this.image.resizeHandle.ratio);if(height<50||width<100)return;var height=Math.round(this.image.resizeHandle.el.width()/this.image.resizeHandle.ratio);this.image.resizeHandle.el.attr({width:width,height:height});this.image.resizeHandle.el.width(width);this.image.resizeHandle.el.height(height);this.code.sync()},stopResize:function(){this.handle=false;$(document).off(".redactor-image-resize");this.image.hideResize()},onDrag:function(e){if(this.$editor.find("#redactor-image-box").length!==0){e.preventDefault();return false}this.$editor.on("drop.redactor-image-inside-drop",$.proxy(function(){setTimeout($.proxy(this.image.onDrop,this),1)},this))},onDrop:function(){this.image.fixImageSourceAfterDrop();this.observe.images();this.$editor.off("drop.redactor-image-inside-drop");this.clean.clearUnverified();this.code.sync()},fixImageSourceAfterDrop:function(){this.$editor.find("img[data-save-url]").each(function(){var $el=$(this);$el.attr("src",$el.attr("data-save-url"));$el.removeAttr("data-save-url")})},hideResize:function(e){if(e&&$(e.target).closest("#redactor-image-box",this.$editor[0]).length!==0)return;if(e&&e.target.tagName=="IMG"){var $image=$(e.target);$image.attr("data-save-url",$image.attr("src"))}var imageBox=this.$editor.find("#redactor-image-box");if(imageBox.length===0)return;$("#redactor-image-editter").remove();$("#redactor-image-resizer").remove();imageBox.find("img").css({marginTop:imageBox[0].style.marginTop,marginBottom:imageBox[0].style.marginBottom,marginLeft:imageBox[0].style.marginLeft,marginRight:imageBox[0].style.marginRight});imageBox.css("margin","");imageBox.find("img").css("opacity","");imageBox.replaceWith(function(){return $(this).contents()});$(document).off("mousedown.redactor-image-resize-hide."+this.uuid);if(typeof this.image.resizeHandle!=="undefined"){this.image.resizeHandle.el.attr("rel",this.image.resizeHandle.el.attr("style"))}this.code.sync()},loadResizableControls:function($image,imageBox){if(this.opts.imageResizable&&!this.utils.isMobile()){var imageResizer=$('<span id="redactor-image-resizer" data-redactor="verified"></span>');if(!this.utils.isDesktop()){imageResizer.css({width:"15px",height:"15px"})}imageResizer.attr("contenteditable",false);imageBox.append(imageResizer);imageBox.append($image);return imageResizer}else{imageBox.append($image);return false}},loadEditableControls:function($image){var imageBox=$('<span id="redactor-image-box" data-redactor="verified">');imageBox.css("float",$image.css("float")).attr("contenteditable",false);if($image[0].style.margin!="auto"){imageBox.css({marginTop:$image[0].style.marginTop,marginBottom:$image[0].style.marginBottom,marginLeft:$image[0].style.marginLeft,marginRight:$image[0].style.marginRight});$image.css("margin","")}else{imageBox.css({display:"block",margin:"auto"})}$image.css("opacity",".5").after(imageBox);if(this.opts.imageEditable){this.image.editter=$('<span id="redactor-image-editter" data-redactor="verified">'+this.lang.get("edit")+"</span>");this.image.editter.attr("contenteditable",false);this.image.editter.on("click",$.proxy(function(){this.image.showEdit($image)},this));imageBox.append(this.image.editter);var editerWidth=this.image.editter.innerWidth();this.image.editter.css("margin-left","-"+editerWidth/2+"px")}return this.image.loadResizableControls($image,imageBox)},remove:function(image){var $image=$(image);var $link=$image.closest("a",this.$editor[0]);var $figure=$image.closest("figure",this.$editor[0]);var $parent=$image.parent();if($("#redactor-image-box").length!==0){$parent=$("#redactor-image-box").parent()}var $next;if($figure.length!==0){$next=$figure.next();$figure.remove()}else if($link.length!==0){$parent=$link.parent();$link.remove()}else{$image.remove()}$("#redactor-image-box").remove();if($figure.length!==0){this.caret.setStart($next)}else{this.caret.setStart($parent)}this.core.setCallback("imageDelete",$image[0].src,$image);this.modal.close();this.code.sync()},insert:function(json,direct,e){if(typeof json.error!="undefined"){this.modal.close();this.selection.restore();this.core.setCallback("imageUploadError",json);return}var $img;if(typeof json=="string"){$img=$(json).attr("data-redactor-inserted-image","true")}else{$img=$("<img>");$img.attr("src",json.filelink).attr("data-redactor-inserted-image","true")}var node=$img;var isP=this.utils.isCurrentOrParent("P");if(isP){node=$("<blockquote />").append($img)}if(direct){this.selection.removeMarkers();var marker=this.selection.getMarker();this.insert.nodeToCaretPositionFromPoint(e,marker)}else{this.modal.close()}this.selection.restore();this.buffer.set();this.insert.html(this.utils.getOuterHtml(node),false);var $image=this.$editor.find("img[data-redactor-inserted-image=true]").removeAttr("data-redactor-inserted-image");if(isP){$image.parent().contents().unwrap().wrap("<p />")}else if(this.opts.linebreaks){if(!this.utils.isEmpty(this.code.get())){$image.before("<br>")}$image.after("<br>")}if(typeof json=="string")return;this.core.setCallback("imageUpload",$image,json)}}},indent:function(){return{increase:function(){if(!this.utils.browser("msie"))this.$editor.focus();this.buffer.set();this.selection.save();var block=this.selection.getBlock();if(block&&block.tagName=="LI"){this.indent.increaseLists()}else if(block===false&&this.opts.linebreaks){this.indent.increaseText()}else{this.indent.increaseBlocks()}this.selection.restore();this.code.sync()},increaseLists:function(){document.execCommand("indent");this.indent.fixEmptyIndent();this.clean.normalizeLists();this.clean.clearUnverified()},increaseBlocks:function(){$.each(this.selection.getBlocks(),$.proxy(function(i,elem){if(elem.tagName==="TD"||elem.tagName==="TH")return;var $el=this.utils.getAlignmentElement(elem);var left=this.utils.normalize($el.css("margin-left"))+this.opts.indentValue;$el.css("margin-left",left+"px")},this))},increaseText:function(){var wrapper=this.selection.wrap("div");$(wrapper).attr("data-tagblock","redactor");$(wrapper).css("margin-left",this.opts.indentValue+"px")},decrease:function(){this.buffer.set();this.selection.save();var block=this.selection.getBlock();if(block&&block.tagName=="LI"){this.indent.decreaseLists()}else{this.indent.decreaseBlocks()}this.selection.restore();this.code.sync()},decreaseLists:function(){document.execCommand("outdent");var current=this.selection.getCurrent();var $item=$(current).closest("li",this.$editor[0]);this.indent.fixEmptyIndent();if(!this.opts.linebreaks&&$item.length===0){document.execCommand("formatblock",false,"p");this.$editor.find("ul, ol, blockquote, p").each($.proxy(this.utils.removeEmpty,this))}this.clean.clearUnverified()},decreaseBlocks:function(){$.each(this.selection.getBlocks(),$.proxy(function(i,elem){var $el=this.utils.getAlignmentElement(elem);var left=this.utils.normalize($el.css("margin-left"))-this.opts.indentValue;if(left<=0){if(this.opts.linebreaks&&typeof $el.data("tagblock")!=="undefined"){$el.replaceWith($el.html()+"<br />")}else{$el.css("margin-left","");this.utils.removeEmptyAttr($el,"style")}}else{$el.css("margin-left",left+"px")}},this))},fixEmptyIndent:function(){var block=this.selection.getBlock();if(this.range.collapsed&&block&&block.tagName=="LI"&&this.utils.isEmpty($(block).text())){var $block=$(block);$block.find("span").not(".redactor-selection-marker").contents().unwrap();$block.append("<br>")}}}},inline:function(){return{formatting:function(name){var type,value;if(typeof this.formatting[name].style!="undefined")type="style";else if(typeof this.formatting[name]["class"]!="undefined")type="class";if(type)value=this.formatting[name][type];this.inline.format(this.formatting[name].tag,type,value)},format:function(tag,type,value,allowHeaderFormatting){var current=this.selection.getCurrent();if(current&&current.tagName==="TR")return;if(!allowHeaderFormatting){if(this.utils.isCurrentOrParent("PRE")||this.utils.isCurrentOrParentHeader())return}var tags=["b","bold","i","italic","underline","strikethrough","deleted","superscript","subscript"];var replaced=["strong","strong","em","em","u","del","del","sup","sub"];for(var i=0;i<tags.length;i++){if(tag==tags[i])tag=replaced[i]}if(this.opts.allowedTags){if($.inArray(tag,this.opts.allowedTags)==-1)return}else{if($.inArray(tag,this.opts.deniedTags)!==-1)return}this.inline.type=type||false;this.inline.value=value||false;this.buffer.set();if(!this.utils.browser("msie")&&!this.opts.linebreaks){this.$editor.focus()}this.selection.get();if(this.range.collapsed){this.inline.formatCollapsed(tag)}else{this.inline.formatMultiple(tag)}},formatCollapsed:function(tag){var current=this.selection.getCurrent();var $parent=$(current).closest(tag+"[data-redactor-tag="+tag+"]",this.$editor[0]);if($parent.length!==0&&(this.inline.type!="style"&&$parent[0].tagName!="SPAN")){if(this.utils.isEmpty($parent.text())){this.caret.setAfter($parent[0]);$parent.remove();this.code.sync()}else if(this.utils.isEndOfElement($parent)){this.caret.setAfter($parent[0])}return}var node=$("<"+tag+">").attr("data-verified","redactor").attr("data-redactor-tag",tag);node.html(this.opts.invisibleSpace);node=this.inline.setFormat(node);var node=this.insert.node(node);this.caret.setEnd(node);this.code.sync()},formatMultiple:function(tag){this.inline.formatConvert(tag);this.selection.save();document.execCommand("strikethrough");this.$editor.find("strike").each($.proxy(function(i,s){var $el=$(s);this.inline.formatRemoveSameChildren($el,tag);var $span;if(this.inline.type){$span=$("<span>").attr("data-redactor-tag",tag).attr("data-verified","redactor");$span=this.inline.setFormat($span)}else{$span=$("<"+tag+">").attr("data-redactor-tag",tag).attr("data-verified","redactor")}$el.replaceWith($span.html($el.contents()));var $parent=$span.parent();if($span[0].tagName==="A"&&$parent&&$parent[0].tagName==="U"){$span.parent().replaceWith($span)}if(tag=="span"){if($parent&&$parent[0].tagName==="SPAN"&&this.inline.type==="style"){var arr=this.inline.value.split(";");for(var z=0;z<arr.length;z++){if(arr[z]==="")return;var style=arr[z].split(":");$parent.css(style[0],"");if(this.utils.removeEmptyAttr($parent,"style")){$parent.replaceWith($parent.contents())}}}}},this));if(tag!="span"){this.$editor.find(this.opts.inlineTags.join(", ")).each($.proxy(function(i,s){var $el=$(s);if(s.tagName==="U"&&s.attributes.length===0){$el.replaceWith($el.contents());return}var property=$el.css("text-decoration");if(property==="line-through"){$el.css("text-decoration","");this.utils.removeEmptyAttr($el,"style")}},this))}if(tag!="del"){var _this=this;this.$editor.find("inline").each(function(i,s){_this.utils.replaceToTag(s,"del")})}if(tag!="u"){var _this=this;this.$editor.find("unline").each(function(i,s){_this.utils.replaceToTag(s,"u")})}this.selection.restore();this.code.sync()},formatRemoveSameChildren:function($el,tag){var self=this;$el.children(tag).each(function(){var $child=$(this);if(!$child.hasClass("redactor-selection-marker")){if(self.inline.type=="style"){var arr=self.inline.value.split(";");for(var z=0;z<arr.length;z++){if(arr[z]==="")return;var style=arr[z].split(":");$child.css(style[0],"");if(self.utils.removeEmptyAttr($child,"style")){$child.replaceWith($child.contents())}}}else{$child.contents().unwrap()}}})},formatConvert:function(tag){this.selection.save();var find="";if(this.inline.type=="class")find="[data-redactor-class="+this.inline.value+"]";else if(this.inline.type=="style"){find='[data-redactor-style="'+this.inline.value+'"]'}var self=this;if(tag!="del"){this.$editor.find("del").each(function(i,s){self.utils.replaceToTag(s,"inline")})}if(tag!="u"){this.$editor.find("u").each(function(i,s){self.utils.replaceToTag(s,"unline")})}if(tag!="span"){this.$editor.find(tag).each(function(){var $el=$(this);$el.replaceWith($("<strike />").html($el.contents()))})}this.$editor.find('[data-redactor-tag="'+tag+'"]'+find).each(function(){if(find===""&&tag=="span"&&this.tagName.toLowerCase()==tag)return;var $el=$(this);$el.replaceWith($("<strike />").html($el.contents()))});this.selection.restore()},setFormat:function(node){switch(this.inline.type){case"class":if(node.hasClass(this.inline.value)){node.removeClass(this.inline.value);node.removeAttr("data-redactor-class")}else{node.addClass(this.inline.value);node.attr("data-redactor-class",this.inline.value)}break;case"style":node[0].style.cssText=this.inline.value;node.attr("data-redactor-style",this.inline.value);break}return node},removeStyle:function(){this.buffer.set();var current=this.selection.getCurrent();var nodes=this.selection.getInlines();this.selection.save();if(current&&current.tagName==="SPAN"){var $s=$(current);$s.removeAttr("style");if($s[0].attributes.length===0){$s.replaceWith($s.contents())}}$.each(nodes,$.proxy(function(i,s){var $s=$(s);if($.inArray(s.tagName.toLowerCase(),this.opts.inlineTags)!=-1&&!$s.hasClass("redactor-selection-marker")){$s.removeAttr("style");if($s[0].attributes.length===0){$s.replaceWith($s.contents())}}},this));this.selection.restore();this.code.sync()},removeStyleRule:function(name){this.buffer.set();var parent=this.selection.getParent();var nodes=this.selection.getInlines();this.selection.save();if(parent&&parent.tagName==="SPAN"){var $s=$(parent);$s.css(name,"");this.utils.removeEmptyAttr($s,"style");if($s[0].attributes.length===0){$s.replaceWith($s.contents())}}$.each(nodes,$.proxy(function(i,s){var $s=$(s);if($.inArray(s.tagName.toLowerCase(),this.opts.inlineTags)!=-1&&!$s.hasClass("redactor-selection-marker")){$s.css(name,"");this.utils.removeEmptyAttr($s,"style");if($s[0].attributes.length===0){$s.replaceWith($s.contents())}}},this));this.selection.restore();this.code.sync()},removeFormat:function(){this.buffer.set();var current=this.selection.getCurrent();this.selection.save();document.execCommand("removeFormat");if(current&&current.tagName==="SPAN"){$(current).replaceWith($(current).contents())}$.each(this.selection.getNodes(),$.proxy(function(i,s){var $s=$(s);if($.inArray(s.tagName.toLowerCase(),this.opts.inlineTags)!=-1&&!$s.hasClass("redactor-selection-marker")){$s.replaceWith($s.contents())}},this));this.selection.restore();this.code.sync()},toggleClass:function(className){this.inline.format("span","class",className)},toggleStyle:function(value){this.inline.format("span","style",value)}}},insert:function(){return{set:function(html,clean){this.placeholder.remove();html=this.clean.setVerified(html);if(typeof clean=="undefined"){html=this.clean.onPaste(html,false)}this.$editor.html(html);this.selection.remove();this.focus.setEnd();this.clean.normalizeLists();this.code.sync();this.observe.load();if(typeof clean=="undefined"){setTimeout($.proxy(this.clean.clearUnverified,this),10)}},text:function(text){this.placeholder.remove();text=text.toString();text=$.trim(text);text=this.clean.getPlainText(text,false);this.$editor.focus();if(this.utils.browser("msie")){this.insert.htmlIe(text)}else{this.selection.get();this.range.deleteContents();var el=document.createElement("div");el.innerHTML=text;var frag=document.createDocumentFragment(),node,lastNode;while(node=el.firstChild){lastNode=frag.appendChild(node)}this.range.insertNode(frag);if(lastNode){var range=this.range.cloneRange();range.setStartAfter(lastNode);range.collapse(true);this.sel.removeAllRanges();this.sel.addRange(range)}}this.code.sync();this.clean.clearUnverified()},htmlWithoutClean:function(html){this.insert.html(html,false)},html:function(html,clean){this.placeholder.remove();if(typeof clean=="undefined")clean=true;if(!this.opts.linebreaks){this.$editor.focus()}html=this.clean.setVerified(html);if(clean){html=this.clean.onPaste(html)}if(this.utils.browser("msie")){this.insert.htmlIe(html)}else{if(this.clean.singleLine)this.insert.execHtml(html);else document.execCommand("insertHTML",false,html);this.insert.htmlFixMozilla()}this.clean.normalizeLists();if(!this.opts.linebreaks){this.$editor.find("p").each($.proxy(this.utils.removeEmpty,this))}this.code.sync();this.observe.load();if(clean){this.clean.clearUnverified()}},htmlFixMozilla:function(){if(!this.utils.browser("mozilla"))return;var $next=$(this.selection.getBlock()).next();if($next.length>0&&$next[0].tagName=="P"&&$next.html()===""){$next.remove()}},htmlIe:function(html){if(this.utils.isIe11()){var parent=this.utils.isCurrentOrParent("P");var $html=$("<div>").append(html);var blocksMatch=$html.contents().is("p, :header, dl, ul, ol, div, table, td, blockquote, pre, address, section, header, footer, aside, article");if(parent&&blocksMatch)this.insert.ie11FixInserting(parent,html);else this.insert.ie11PasteFrag(html);return}document.selection.createRange().pasteHTML(html)},execHtml:function(html){html=this.clean.setVerified(html);this.selection.get();this.range.deleteContents();var el=document.createElement("div");el.innerHTML=html;var frag=document.createDocumentFragment(),node,lastNode;while(node=el.firstChild){lastNode=frag.appendChild(node)}this.range.insertNode(frag);this.range.collapse(true);this.caret.setAfter(lastNode)},node:function(node,deleteContents){node=node[0]||node;var offset=this.caret.getOffset();var html=this.utils.getOuterHtml(node);html=this.clean.setVerified(html);if(html.match(/</g)!==null){node=$(html)[0]}this.selection.get();if(deleteContents!==false){this.range.deleteContents()}this.range.insertNode(node);this.range.collapse(false);this.selection.addRange();this.caret.setOffset(offset);return node},nodeToPoint:function(node,x,y){node=node[0]||node;this.selection.get();var range;if(document.caretPositionFromPoint){var pos=document.caretPositionFromPoint(x,y);this.range.setStart(pos.offsetNode,pos.offset);this.range.collapse(true);this.range.insertNode(node)}else if(document.caretRangeFromPoint){range=document.caretRangeFromPoint(x,y);range.insertNode(node)}else if(typeof document.body.createTextRange!="undefined"){range=document.body.createTextRange();range.moveToPoint(x,y);var endRange=range.duplicate();endRange.moveToPoint(x,y);range.setEndPoint("EndToEnd",endRange);range.select()}},nodeToCaretPositionFromPoint:function(e,node){node=node[0]||node;var range;var x=e.clientX,y=e.clientY;if(document.caretPositionFromPoint){var pos=document.caretPositionFromPoint(x,y);var sel=document.getSelection();range=sel.getRangeAt(0);range.setStart(pos.offsetNode,pos.offset);range.collapse(true);range.insertNode(node)}else if(document.caretRangeFromPoint){range=document.caretRangeFromPoint(x,y);range.insertNode(node)}else if(typeof document.body.createTextRange!="undefined"){range=document.body.createTextRange();range.moveToPoint(x,y);var endRange=range.duplicate();endRange.moveToPoint(x,y);range.setEndPoint("EndToEnd",endRange);range.select()}},ie11FixInserting:function(parent,html){var node=document.createElement("span");node.className="redactor-ie-paste";this.insert.node(node);var parHtml=$(parent).html();parHtml="<p>"+parHtml.replace(/<span class="redactor-ie-paste"><\/span>/gi,"</p>"+html+"<p>")+"</p>";
parHtml=parHtml.replace(/<p><\/p>/gi,"");$(parent).replaceWith(parHtml)},ie11PasteFrag:function(html){this.selection.get();this.range.deleteContents();var el=document.createElement("div");el.innerHTML=html;var frag=document.createDocumentFragment(),node,lastNode;while(node=el.firstChild){lastNode=frag.appendChild(node)}this.range.insertNode(frag);this.range.collapse(false);this.selection.addRange()}}},keydown:function(){return{init:function(e){if(this.rtePaste)return;var key=e.which;var arrow=key>=37&&key<=40;this.keydown.ctrl=e.ctrlKey||e.metaKey;this.keydown.current=this.selection.getCurrent();this.keydown.parent=this.selection.getParent();this.keydown.block=this.selection.getBlock();this.keydown.pre=this.utils.isTag(this.keydown.current,"pre");this.keydown.blockquote=this.utils.isTag(this.keydown.current,"blockquote");this.keydown.figcaption=this.utils.isTag(this.keydown.current,"figcaption");this.shortcuts.init(e,key);if(this.utils.isDesktop()){this.keydown.checkEvents(arrow,key);this.keydown.setupBuffer(e,key)}this.keydown.addArrowsEvent(arrow);this.keydown.setupSelectAll(e,key);var keydownStop=this.core.setCallback("keydown",e);if(keydownStop===false){e.preventDefault();return false}if(this.opts.enterKey&&(this.utils.browser("msie")||this.utils.browser("mozilla"))&&(key===this.keyCode.DOWN||key===this.keyCode.RIGHT)){var isEndOfTable=false;var $table=false;if(this.keydown.block&&this.keydown.block.tagName==="TD"){$table=$(this.keydown.block).closest("table",this.$editor[0])}if($table&&$table.find("td").last()[0]===this.keydown.block){isEndOfTable=true}if(this.utils.isEndOfElement()&&isEndOfTable){var node=$(this.opts.emptyHtml);$table.after(node);this.caret.setStart(node)}}if(this.opts.enterKey&&key===this.keyCode.DOWN){this.keydown.onArrowDown()}if(!this.opts.enterKey&&key===this.keyCode.ENTER){e.preventDefault();if(!this.range.collapsed)this.range.deleteContents();return}if(key==this.keyCode.ENTER&&!e.shiftKey&&!e.ctrlKey&&!e.metaKey){var stop=this.core.setCallback("enter",e);if(stop===false){e.preventDefault();return false}if(this.keydown.blockquote&&this.keydown.exitFromBlockquote(e)===true){return false}var current,$next;if(this.keydown.pre){return this.keydown.insertNewLine(e)}else if(this.keydown.blockquote||this.keydown.figcaption){current=this.selection.getCurrent();$next=$(current).next();if($next.length!==0&&$next[0].tagName=="BR"){return this.keydown.insertBreakLine(e)}else if(this.utils.isEndOfElement()&&(current&&current!="SPAN")){return this.keydown.insertDblBreakLine(e)}else{return this.keydown.insertBreakLine(e)}}else if(this.opts.linebreaks&&!this.keydown.block){current=this.selection.getCurrent();$next=$(this.keydown.current).next();if($next.length!==0&&$next[0].tagName=="BR"){return this.keydown.insertBreakLine(e)}else if(current!==false&&$(current).hasClass("redactor-invisible-space")){this.caret.setAfter(current);$(current).contents().unwrap();return this.keydown.insertDblBreakLine(e)}else{if(this.utils.isEndOfEditor()){return this.keydown.insertDblBreakLine(e)}else if($next.length===0&&current===false&&typeof $next.context!="undefined"){return this.keydown.insertBreakLine(e)}return this.keydown.insertBreakLine(e)}}else if(this.opts.linebreaks&&this.keydown.block){setTimeout($.proxy(this.keydown.replaceDivToBreakLine,this),1)}else if(!this.opts.linebreaks&&this.keydown.block){setTimeout($.proxy(this.keydown.replaceDivToParagraph,this),1);if(this.keydown.block.tagName==="LI"){current=this.selection.getCurrent();var $parent=$(current).closest("li",this.$editor[0]);var $list=$parent.closest("ul,ol",this.$editor[0]);if($parent.length!==0&&this.utils.isEmpty($parent.html())&&$list.next().length===0&&this.utils.isEmpty($list.find("li").last().html())){$list.find("li").last().remove();var node=$(this.opts.emptyHtml);$list.after(node);this.caret.setStart(node);return false}}}else if(!this.opts.linebreaks&&!this.keydown.block){return this.keydown.insertParagraph(e)}}if(key===this.keyCode.ENTER&&(e.ctrlKey||e.shiftKey)){return this.keydown.onShiftEnter(e)}if(key===this.keyCode.TAB||e.metaKey&&key===221||e.metaKey&&key===219){return this.keydown.onTab(e,key)}if(key===this.keyCode.BACKSPACE||key===this.keyCode.DELETE){var nodes=this.selection.getNodes();if(nodes){var len=nodes.length;var last;for(var i=0;i<len;i++){var children=$(nodes[i]).children("img");if(children.length!==0){var self=this;$.each(children,function(z,s){var $s=$(s);if($s.css("float")!="none")return;self.core.setCallback("imageDelete",s.src,$s);last=s})}else if(nodes[i].tagName=="IMG"){if(last!=nodes[i]){this.core.setCallback("imageDelete",nodes[i].src,$(nodes[i]));last=nodes[i]}}}}}if(key===this.keyCode.BACKSPACE){var block=this.selection.getBlock();var indented=$(block).css("margin-left")!=="0px";if(block&&indented&&this.range.collapsed&&this.utils.isStartOfElement()){this.indent.decrease();e.preventDefault();return}if(this.utils.browser("mozilla")){var prev=this.selection.getPrev();var prev2=$(prev).prev()[0];if(prev&&prev.tagName==="HR")$(prev).remove();if(prev2&&prev2.tagName==="HR")$(prev2).remove()}this.keydown.removeInvisibleSpace();this.keydown.removeEmptyListInTable(e)}this.code.sync()},checkEvents:function(arrow,key){if(!arrow&&(this.core.getEvent()=="click"||this.core.getEvent()=="arrow")){this.core.addEvent(false);if(this.keydown.checkKeyEvents(key)){this.buffer.set()}}},checkKeyEvents:function(key){var k=this.keyCode;var keys=[k.BACKSPACE,k.DELETE,k.ENTER,k.ESC,k.TAB,k.CTRL,k.META,k.ALT,k.SHIFT];return $.inArray(key,keys)==-1?true:false},addArrowsEvent:function(arrow){if(!arrow)return;if(this.core.getEvent()=="click"||this.core.getEvent()=="arrow"){this.core.addEvent(false);return}this.core.addEvent("arrow")},setupBuffer:function(e,key){if(this.keydown.ctrl&&key===90&&!e.shiftKey&&!e.altKey&&this.opts.buffer.length){e.preventDefault();this.buffer.undo();return}else if(this.keydown.ctrl&&key===90&&e.shiftKey&&!e.altKey&&this.opts.rebuffer.length!==0){e.preventDefault();this.buffer.redo();return}else if(!this.keydown.ctrl){if(key==this.keyCode.BACKSPACE||key==this.keyCode.DELETE||key==this.keyCode.ENTER&&!e.ctrlKey&&!e.shiftKey){this.buffer.set()}}},setupSelectAll:function(e,key){if(this.keydown.ctrl&&key===65){this.utils.enableSelectAll()}else if(key!=this.keyCode.LEFT_WIN&&!this.keydown.ctrl){this.utils.disableSelectAll()}},onArrowDown:function(){var tags=[this.keydown.blockquote,this.keydown.pre,this.keydown.figcaption];for(var i=0;i<tags.length;i++){if(tags[i]){this.keydown.insertAfterLastElement(tags[i]);return false}}},onShiftEnter:function(e){this.buffer.set();if(this.utils.isEndOfElement()){return this.keydown.insertDblBreakLine(e)}return this.keydown.insertBreakLine(e)},onTab:function(e,key){if(!this.opts.tabKey)return true;if(this.utils.isEmpty(this.code.get())&&this.opts.tabAsSpaces===false)return true;e.preventDefault();var node;if(this.keydown.pre&&!e.shiftKey){node=this.opts.preSpaces?document.createTextNode(Array(this.opts.preSpaces+1).join(" ")):document.createTextNode("	");this.insert.node(node);this.code.sync()}else if(this.opts.tabAsSpaces!==false){node=document.createTextNode(Array(this.opts.tabAsSpaces+1).join(" "));this.insert.node(node);this.code.sync()}else{if(e.metaKey&&key===219)this.indent.decrease();else if(e.metaKey&&key===221)this.indent.increase();else if(!e.shiftKey)this.indent.increase();else this.indent.decrease()}return false},replaceDivToBreakLine:function(){var blockElem=this.selection.getBlock();var blockHtml=blockElem.innerHTML.replace(/<br\s?\/?>/gi,"");if((blockElem.tagName==="DIV"||blockElem.tagName==="P")&&blockHtml===""&&!$(blockElem).hasClass("redactor-editor")){var br=document.createElement("br");$(blockElem).replaceWith(br);this.caret.setBefore(br);this.code.sync();return false}},replaceDivToParagraph:function(){var blockElem=this.selection.getBlock();var blockHtml=blockElem.innerHTML.replace(/<br\s?\/?>/gi,"");if(blockElem.tagName==="DIV"&&this.utils.isEmpty(blockHtml)&&!$(blockElem).hasClass("redactor-editor")){var p=document.createElement("p");p.innerHTML=this.opts.invisibleSpace;$(blockElem).replaceWith(p);this.caret.setStart(p);this.code.sync();return false}else if(this.opts.cleanStyleOnEnter&&blockElem.tagName=="P"){$(blockElem).removeAttr("class").removeAttr("style")}},insertParagraph:function(e){e.preventDefault();this.selection.get();var p=document.createElement("p");p.innerHTML=this.opts.invisibleSpace;this.range.deleteContents();this.range.insertNode(p);this.caret.setStart(p);this.code.sync();return false},exitFromBlockquote:function(e){if(!this.utils.isEndOfElement())return;var tmp=$.trim($(this.keydown.block).html());if(tmp.search(/(<br\s?\/?>){2}$/i)!=-1){e.preventDefault();if(this.opts.linebreaks){var br=document.createElement("br");$(this.keydown.blockquote).after(br);this.caret.setBefore(br);$(this.keydown.block).html(tmp.replace(/<br\s?\/?>$/i,""))}else{var node=$(this.opts.emptyHtml);$(this.keydown.blockquote).after(node);this.caret.setStart(node)}return true}return},insertAfterLastElement:function(element){if(!this.utils.isEndOfElement())return;this.buffer.set();if(this.opts.linebreaks){var contents=$("<div>").append($.trim(this.$editor.html())).contents();var last=contents.last()[0];if(last.tagName=="SPAN"&&last.innerHTML===""){last=contents.prev()[0]}if(this.utils.getOuterHtml(last)!=this.utils.getOuterHtml(element))return;var br=document.createElement("br");$(element).after(br);this.caret.setAfter(br)}else{if(this.$editor.contents().last()[0]!==element)return;var node=$(this.opts.emptyHtml);$(element).after(node);this.caret.setStart(node)}},insertNewLine:function(e){e.preventDefault();var node=document.createTextNode("\n");this.selection.get();this.range.deleteContents();this.range.insertNode(node);this.caret.setAfter(node);this.code.sync();return false},insertBreakLine:function(e){return this.keydown.insertBreakLineProcessing(e)},insertDblBreakLine:function(e){return this.keydown.insertBreakLineProcessing(e,true)},insertBreakLineProcessing:function(e,dbl){e.stopPropagation();this.selection.get();var br1=document.createElement("br");if(this.utils.browser("msie")){this.range.collapse(false);this.range.setEnd(this.range.endContainer,this.range.endOffset)}else{this.range.deleteContents()}this.range.insertNode(br1);var $parentA=$(br1).parent("a");if($parentA.length>0){$parentA.find(br1).remove();$parentA.after(br1)}if(dbl===true){var $next=$(br1).next();if($next.length!==0&&$next[0].tagName==="BR"&&this.utils.isEndOfEditor()){this.caret.setAfter(br1);this.code.sync();return false}var br2=document.createElement("br");this.range.insertNode(br2);this.caret.setAfter(br2)}else{if(this.utils.browser("msie")){var space=document.createElement("span");space.innerHTML="&#x200b;";$(br1).after(space);this.range.setStartAfter(space);this.range.setEndAfter(space);$(space).remove()}else{var range=document.createRange();range.setStartAfter(br1);range.collapse(true);var selection=window.getSelection();selection.removeAllRanges();selection.addRange(range)}}this.code.sync();return false},removeInvisibleSpace:function(){var $current=$(this.keydown.current);if($current.text().search(/^\u200B$/g)===0){$current.remove()}},removeEmptyListInTable:function(e){var $current=$(this.keydown.current);var $parent=$(this.keydown.parent);var td=$current.closest("td",this.$editor[0]);if(td.length!==0&&$current.closest("li",this.$editor[0])&&$parent.children("li").length===1){if(!this.utils.isEmpty($current.text()))return;e.preventDefault();$current.remove();$parent.remove();this.caret.setStart(td)}}}},keyup:function(){return{init:function(e){if(this.rtePaste)return;var key=e.which;this.keyup.current=this.selection.getCurrent();this.keyup.parent=this.selection.getParent();var $parent=this.utils.isRedactorParent($(this.keyup.parent).parent());var keyupStop=this.core.setCallback("keyup",e);if(keyupStop===false){e.preventDefault();return false}if(!this.opts.linebreaks&&this.keyup.current.nodeType===3&&this.keyup.current.length<=1&&(this.keyup.parent===false||this.keyup.parent.tagName=="BODY")){this.keyup.replaceToParagraph()}if(!this.opts.linebreaks&&this.utils.isRedactorParent(this.keyup.current)&&this.keyup.current.tagName==="DIV"){this.keyup.replaceToParagraph(false)}if(!this.opts.linebreaks&&$(this.keyup.parent).hasClass("redactor-invisible-space")&&($parent===false||$parent[0].tagName=="BODY")){$(this.keyup.parent).contents().unwrap();this.keyup.replaceToParagraph()}if(this.linkify.isEnabled()&&this.linkify.isKey(key))this.linkify.format();if(key===this.keyCode.DELETE||key===this.keyCode.BACKSPACE){if(this.utils.browser("mozilla")){var td=$(this.keydown.current).closest("td",this.$editor[0]);if(td.size()!==0&&td.text()!==""){e.preventDefault();return false}}this.clean.clearUnverified();if(this.observe.image){e.preventDefault();this.image.hideResize();this.buffer.set();this.image.remove(this.observe.image);this.observe.image=false;return false}this.$editor.find("p").each($.proxy(function(i,s){this.utils.removeEmpty(i,$(s).html())},this));if(this.opts.linebreaks&&this.keyup.current&&this.keyup.current.tagName=="DIV"&&this.utils.isEmpty(this.keyup.current.innerHTML)){$(this.keyup.current).after(this.selection.getMarkerAsHtml());this.selection.restore();$(this.keyup.current).remove()}this.keyup.removeEmptyLists();return this.keyup.formatEmpty(e)}},replaceToParagraph:function(clone){var $current=$(this.keyup.current);var node;if(clone===false){node=$("<p>").append($current.html())}else{node=$("<p>").append($current.clone())}$current.replaceWith(node);var next=$(node).next();if(typeof next[0]!=="undefined"&&next[0].tagName=="BR"){next.remove()}this.caret.setEnd(node)},removeEmptyLists:function(){var removeIt=function(){var html=$.trim(this.innerHTML).replace(/\/t\/n/g,"");if(html===""){$(this).remove()}};this.$editor.find("li").each(removeIt);this.$editor.find("ul, ol").each(removeIt)},formatEmpty:function(e){var html=$.trim(this.$editor.html());if(!this.utils.isEmpty(html))return;e.preventDefault();if(this.opts.linebreaks){this.$editor.html(this.selection.getMarkerAsHtml());this.selection.restore()}else{this.$editor.html(this.opts.emptyHtml);this.focus.setStart()}this.code.sync();return false}}},lang:function(){return{load:function(){this.opts.curLang=this.opts.langs[this.opts.lang]},get:function(name){return typeof this.opts.curLang[name]!="undefined"?this.opts.curLang[name]:""}}},line:function(){return{insert:function(){this.buffer.set();var blocks=this.selection.getBlocks();if(blocks[0]!==false&&this.line.isExceptLastOrFirst(blocks)){if(!this.utils.browser("msie"))this.$editor.focus();return}if(this.utils.browser("msie")){this.line.insertInIe()}else{this.line.insertInOthersBrowsers()}},isExceptLastOrFirst:function(blocks){var exceptTags=["li","td","th","blockquote","figcaption","pre","dl","dt","dd"];var first=blocks[0].tagName.toLowerCase();var last=this.selection.getLastBlock();last=typeof last=="undefined"?first:last.tagName.toLowerCase();var firstFound=$.inArray(first,exceptTags)!=-1;var lastFound=$.inArray(last,exceptTags)!=-1;if(firstFound&&lastFound||firstFound){return true}},insertInIe:function(){this.utils.saveScroll();this.buffer.set();this.insert.node(document.createElement("hr"));this.utils.restoreScroll();this.code.sync()},insertInOthersBrowsers:function(){this.buffer.set();var extra='<p id="redactor-insert-line"><br /></p>';if(this.opts.linebreaks)extra='<br id="redactor-insert-line">';document.execCommand("insertHtml",false,"<hr>"+extra);this.line.setFocus();this.code.sync()},setFocus:function(){var node=this.$editor.find("#redactor-insert-line");var next=$(node).next()[0];var target=next;if(this.utils.browser("mozilla")&&next&&next.innerHTML===""){target=$(next).next()[0];$(next).remove()}if(target){node.remove();if(!this.opts.linebreaks){this.$editor.focus();this.line.setStart(target)}}else{node.removeAttr("id");this.line.setStart(node[0])}},setStart:function(node){if(typeof node==="undefined")return;var textNode=document.createTextNode("​");this.selection.get();this.range.setStart(node,0);this.range.insertNode(textNode);this.range.collapse(true);this.selection.addRange()}}},link:function(){return{show:function(e){if(typeof e!="undefined"&&e.preventDefault)e.preventDefault();if(!this.observe.isCurrent("a")){this.modal.load("link",this.lang.get("link_insert"),600)}else{this.modal.load("link",this.lang.get("link_edit"),600)}this.modal.createCancelButton();var buttonText=!this.observe.isCurrent("a")?this.lang.get("insert"):this.lang.get("edit");this.link.buttonInsert=this.modal.createActionButton(buttonText);this.selection.get();this.link.getData();this.link.cleanUrl();if(this.link.target=="_blank")$("#redactor-link-blank").prop("checked",true);this.link.$inputUrl=$("#redactor-link-url");this.link.$inputText=$("#redactor-link-url-text");this.link.$inputText.val(this.link.text);this.link.$inputUrl.val(this.link.url);this.link.buttonInsert.on("click",$.proxy(this.link.insert,this));$(".redactor-link-tooltip").remove();this.selection.save();this.modal.show();this.link.$inputUrl.focus()},cleanUrl:function(){var thref=self.location.href.replace(/\/$/i,"");if(typeof this.link.url!=="undefined"){this.link.url=this.link.url.replace(thref,"");this.link.url=this.link.url.replace(/^\/#/,"#");this.link.url=this.link.url.replace("mailto:","");if(!this.opts.linkProtocol){var re=new RegExp("^(http|ftp|https)://"+self.location.host,"i");this.link.url=this.link.url.replace(re,"")}}},getData:function(){this.link.$node=false;var $el=$(this.selection.getCurrent()).closest("a",this.$editor[0]);if($el.length!==0&&$el[0].tagName==="A"){this.link.$node=$el;this.link.url=$el.attr("href");this.link.text=$el.text();this.link.target=$el.attr("target")}else{this.link.text=this.sel.toString();this.link.url="";this.link.target=""}},insert:function(){this.placeholder.remove();var target="";var link=this.link.$inputUrl.val();var text=this.link.$inputText.val().replace(/(<([^>]+)>)/gi,"");if($.trim(link)===""){this.link.$inputUrl.addClass("redactor-input-error").on("keyup",function(){$(this).removeClass("redactor-input-error");$(this).off("keyup")});return}if(link.search("@")!=-1&&/(http|ftp|https):\/\//i.test(link)===false){link=link.replace("mailto:","");link="mailto:"+link}else if(link.search("#")!==0){if($("#redactor-link-blank").prop("checked")){target="_blank"}var pattern="((xn--)?[a-z0-9]+(-[a-z0-9]+)*\\.)+[a-z]{2,}";var re=new RegExp("^(http|ftp|https)://"+pattern,"i");var re2=new RegExp("^"+pattern,"i");var re3=new RegExp(".(html|php)$","i");if(link.search(re)==-1&&link.search(re3)==-1&&link.search(re2)===0&&this.opts.linkProtocol){link=this.opts.linkProtocol+"://"+link}}this.link.set(text,link,target);this.modal.close()},set:function(text,link,target){text=$.trim(text.replace(/<|>/g,""));this.selection.restore();var blocks=this.selection.getBlocks();if(text===""&&link==="")return;if(text===""&&link!=="")text=link;if(this.link.$node){this.buffer.set();var $link=this.link.$node,$el=$link.children();if($el.length>0){while($el.length){$el=$el.children()}$el=$el.end()}else{$el=$link}$link.attr("href",link);$el.text(text);if(target!==""){$link.attr("target",target)}else{$link.removeAttr("target")}this.selection.selectElement($link);this.code.sync()}else{if(this.utils.browser("mozilla")&&this.link.text===""){var $a=$("<a />").attr("href",link).text(text);if(target!=="")$a.attr("target",target);$a=$(this.insert.node($a));if(this.opts.linebreaks){$a.after("&nbsp;")}this.selection.selectElement($a)}else{var $a;if(this.utils.browser("msie")){$a=$('<a href="'+link+'">').text(text);if(target!=="")$a.attr("target",target);$a=$(this.insert.node($a));if(this.selection.getText().match(/\s$/)){$a.after(" ")}this.selection.selectElement($a)}else{document.execCommand("createLink",false,link);$a=$(this.selection.getCurrent()).closest("a",this.$editor[0]);if(this.utils.browser("mozilla")){$a=$('a[_moz_dirty=""]')}if(target!=="")$a.attr("target",target);$a.removeAttr("style").removeAttr("_moz_dirty");if(this.selection.getText().match(/\s$/)){$a.after(" ")}if(this.link.text!==""||this.link.text!=text){if(!this.opts.linebreaks&&blocks&&blocks.length<=1){$a.text(text)}else if(this.opts.linebreaks){$a.text(text)}this.selection.selectElement($a)}}}this.code.sync();this.core.setCallback("insertedLink",$a)}setTimeout($.proxy(function(){this.observe.links()},this),5)},unlink:function(e){if(typeof e!="undefined"&&e.preventDefault){e.preventDefault()}var nodes=this.selection.getNodes();if(!nodes)return;this.buffer.set();var len=nodes.length;var links=[];for(var i=0;i<len;i++){if(nodes[i].tagName==="A"){links.push(nodes[i])}var $node=$(nodes[i]).closest("a",this.$editor[0]);$node.replaceWith($node.contents())}this.core.setCallback("deletedLink",links);$(".redactor-link-tooltip").remove();this.code.sync()},toggleClass:function(className){this.link.setClass(className,"toggleClass")},addClass:function(className){this.link.setClass(className,"addClass")},removeClass:function(className){this.link.setClass(className,"removeClass")},setClass:function(className,func){var links=this.selection.getInlinesTags(["a"]);if(links===false)return;$.each(links,function(){$(this)[func](className)})}}},linkify:function(){return{isKey:function(key){return key==this.keyCode.ENTER||key==this.keyCode.SPACE},isEnabled:function(){return this.opts.convertLinks&&(this.opts.convertUrlLinks||this.opts.convertImageLinks||this.opts.convertVideoLinks)&&!this.utils.isCurrentOrParent("PRE")},format:function(){var linkify=this.linkify,opts=this.opts;this.$editor.find(":not(iframe,img,a,pre)").addBack().contents().filter(function(){return this.nodeType===3&&$.trim(this.nodeValue)!=""&&!$(this).parent().is("pre")&&(this.nodeValue.match(opts.linkify.regexps.youtube)||this.nodeValue.match(opts.linkify.regexps.vimeo)||this.nodeValue.match(opts.linkify.regexps.image)||this.nodeValue.match(opts.linkify.regexps.url))}).each(function(){var text=$(this).text(),html=text;if(opts.convertVideoLinks&&(html.match(opts.linkify.regexps.youtube)||html.match(opts.linkify.regexps.vimeo))){html=linkify.convertVideoLinks(html)}else if(opts.convertImageLinks&&html.match(opts.linkify.regexps.image)){html=linkify.convertImages(html)}else if(opts.convertUrlLinks){html=linkify.convertLinks(html)}$(this).before(text.replace(text,html)).remove()});var objects=this.$editor.find(".redactor-linkify-object").each(function(){var $el=$(this);$el.removeClass("redactor-linkify-object");if($el.attr("class")==="")$el.removeAttr("class");return $el[0]});setTimeout($.proxy(function(){this.observe.load();this.core.setCallback("linkify",objects)},this),100);this.code.sync()},convertVideoLinks:function(html){var iframeStart='<iframe class="redactor-linkify-object" width="500" height="281" src="',iframeEnd='" frameborder="0" allowfullscreen></iframe>';if(html.match(this.opts.linkify.regexps.youtube)){html=html.replace(this.opts.linkify.regexps.youtube,iframeStart+"//www.youtube.com/embed/$1"+iframeEnd)}if(html.match(this.opts.linkify.regexps.vimeo)){html=html.replace(this.opts.linkify.regexps.vimeo,iframeStart+"//player.vimeo.com/video/$2"+iframeEnd)}return html},convertImages:function(html){var matches=html.match(this.opts.linkify.regexps.image);if(matches){html=html.replace(html,'<img src="'+matches+'" class="redactor-linkify-object" />');if(this.opts.linebreaks){if(!this.utils.isEmpty(this.code.get())){html="<br>"+html}}html+="<br>"}return html},convertLinks:function(html){var matches=html.match(this.opts.linkify.regexps.url);if(matches){matches=$.grep(matches,function(v,k){return $.inArray(v,matches)===k});var length=matches.length;for(var i=0;i<length;i++){var href=matches[i],text=href,linkProtocol=this.opts.linkProtocol+"://";if(href.match(/(https?|ftp):\/\//i)!==null){linkProtocol=""}if(text.length>this.opts.linkSize){text=text.substring(0,this.opts.linkSize)+"..."}if(text.search("%")===-1){text=decodeURIComponent(text)}var regexB="\\b";if($.inArray(href.slice(-1),["/","&","="])!=-1){regexB=""}var regexp=new RegExp("("+href.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")+regexB+")","g");html=html.replace(regexp,'<a href="'+linkProtocol+$.trim(href)+'" class="redactor-linkify-object">'+$.trim(text)+"</a>")}}return html}}},list:function(){return{toggle:function(cmd){this.placeholder.remove();if(!this.utils.browser("msie")&&!this.opts.linebreaks){this.$editor.focus()}this.buffer.set();this.selection.save();var parent=this.selection.getParent();var $list=$(parent).closest("ol, ul",this.$editor[0]);if(!this.utils.isRedactorParent($list)&&$list.length!==0){$list=false}var isUnorderedCmdOrdered,isOrderedCmdUnordered;var remove=false;if($list&&$list.length){remove=true;var listTag=$list[0].tagName;isUnorderedCmdOrdered=cmd==="orderedlist"&&listTag==="UL";isOrderedCmdUnordered=cmd==="unorderedlist"&&listTag==="OL"}if(isUnorderedCmdOrdered){this.utils.replaceToTag($list,"ol")}else if(isOrderedCmdUnordered){this.utils.replaceToTag($list,"ul")}else{if(remove){this.list.remove(cmd,$list)}else{this.list.insert(cmd)}}this.selection.restore();this.code.sync()},insert:function(cmd){var current=this.selection.getCurrent();var $td=$(current).closest("td, th",this.$editor[0]);if(this.utils.browser("msie")&&this.opts.linebreaks){this.list.insertInIe(cmd)}else{document.execCommand("insert"+cmd)}var parent=this.selection.getParent();var $list=$(parent).closest("ol, ul",this.$editor[0]);if($td.length!==0){var newTd=$td.clone();$td.after(newTd).remove("")}if(this.utils.isEmpty($list.find("li").text())){var $children=$list.children("li");$children.find("br").remove();$children.append(this.selection.getMarkerAsHtml());if(this.opts.linebreaks&&this.utils.browser("mozilla")&&$children.size()==2&&this.utils.isEmpty($children.eq(1).text())){$children.eq(1).remove()}}if($list.length){var $listParent=$list.parent();if(this.utils.isRedactorParent($listParent)&&$listParent[0].tagName!="LI"&&this.utils.isBlock($listParent[0])){$listParent.replaceWith($listParent.contents())}}if(!this.utils.browser("msie")){this.$editor.focus()}this.clean.clearUnverified()},insertInIe:function(cmd){var wrapper=this.selection.wrap("div");var wrapperHtml=$(wrapper).html();var tmpList=cmd=="orderedlist"?$("<ol>"):$("<ul>");var tmpLi=$("<li>");if($.trim(wrapperHtml)===""){tmpLi.append(this.selection.getMarkerAsHtml());tmpList.append(tmpLi);this.$editor.find("#selection-marker-1").replaceWith(tmpList)}else{var items=wrapperHtml.split(/<br\s?\/?>/gi);if(items){for(var i=0;i<items.length;i++){if($.trim(items[i])!==""){tmpList.append($("<li>").html(items[i]))}}}else{tmpLi.append(wrapperHtml);tmpList.append(tmpLi)}$(wrapper).replaceWith(tmpList)}},remove:function(cmd,$list){if($.inArray("ul",this.selection.getBlocks()))cmd="unorderedlist";document.execCommand("insert"+cmd);var $current=$(this.selection.getCurrent());this.indent.fixEmptyIndent();if(!this.opts.linebreaks&&$current.closest("li, th, td",this.$editor[0]).length===0){document.execCommand("formatblock",false,"p");this.$editor.find("ul, ol, blockquote").each($.proxy(this.utils.removeEmpty,this))}var $table=$(this.selection.getCurrent()).closest("table",this.$editor[0]);var $prev=$table.prev();if(!this.opts.linebreaks&&$table.length!==0&&$prev.length!==0&&$prev[0].tagName=="BR"){$prev.remove()}this.clean.clearUnverified()}}},modal:function(){return{callbacks:{},loadTemplates:function(){this.opts.modal={imageEdit:String()+'<section id="redactor-modal-image-edit">'+"<label>"+this.lang.get("title")+"</label>"+'<input type="text" id="redactor-image-title" />'+'<label class="redactor-image-link-option">'+this.lang.get("link")+"</label>"+'<input type="text" id="redactor-image-link" class="redactor-image-link-option" aria-label="'+this.lang.get("link")+'" />'+'<label class="redactor-image-link-option"><input type="checkbox" id="redactor-image-link-blank" aria-label="'+this.lang.get("link_new_tab")+'"> '+this.lang.get("link_new_tab")+"</label>"+'<label class="redactor-image-position-option">'+this.lang.get("image_position")+"</label>"+'<select class="redactor-image-position-option" id="redactor-image-align" aria-label="'+this.lang.get("image_position")+'">'+'<option value="none">'+this.lang.get("none")+"</option>"+'<option value="left">'+this.lang.get("left")+"</option>"+'<option value="center">'+this.lang.get("center")+"</option>"+'<option value="right">'+this.lang.get("right")+"</option>"+"</select>"+"</section>",image:String()+'<section id="redactor-modal-image-insert">'+'<div id="redactor-modal-image-droparea"></div>'+"</section>",file:String()+'<section id="redactor-modal-file-insert">'+'<div id="redactor-modal-file-upload-box">'+"<label>"+this.lang.get("filename")+"</label>"+'<input type="text" id="redactor-filename" aria-label="'+this.lang.get("filename")+'" /><br><br>'+'<div id="redactor-modal-file-upload"></div>'+"</div>"+"</section>",link:String()+'<section id="redactor-modal-link-insert">'+"<label>URL</label>"+'<input type="url" id="redactor-link-url" aria-label="URL" />'+"<label>"+this.lang.get("text")+"</label>"+'<input type="text" id="redactor-link-url-text" aria-label="'+this.lang.get("text")+'" />'+'<label><input type="checkbox" id="redactor-link-blank"> '+this.lang.get("link_new_tab")+"</label>"+"</section>"};$.extend(this.opts,this.opts.modal)},addCallback:function(name,callback){this.modal.callbacks[name]=callback},createTabber:function($modal){this.modal.$tabber=$("<div>").attr("id","redactor-modal-tabber");$modal.prepend(this.modal.$tabber)},addTab:function(id,name,active){var $tab=$('<a href="#" rel="tab'+id+'">').text(name);if(active){$tab.addClass("active")}var self=this;$tab.on("click",function(e){e.preventDefault();$(".redactor-tab").hide();$(".redactor-"+$(this).attr("rel")).show();self.modal.$tabber.find("a").removeClass("active");$(this).addClass("active")});this.modal.$tabber.append($tab)},addTemplate:function(name,template){this.opts.modal[name]=template},getTemplate:function(name){return this.opts.modal[name]},getModal:function(){return this.$modalBody.find("section")},load:function(templateName,title,width){this.modal.templateName=templateName;this.modal.width=width;this.modal.build();this.modal.enableEvents();this.modal.setTitle(title);this.modal.setDraggable();this.modal.setContent();if(typeof this.modal.callbacks[templateName]!="undefined"){this.modal.callbacks[templateName].call(this)}},show:function(){this.utils.disableBodyScroll();if(this.utils.isMobile()){this.modal.showOnMobile()}else{this.modal.showOnDesktop()}if(this.opts.highContrast){this.$modalBox.addClass("redactor-modal-contrast")}this.$modalOverlay.show();this.$modalBox.show();this.$modal.attr("tabindex","-1");this.$modal.focus();this.modal.setButtonsWidth();this.utils.saveScroll();if(!this.utils.isMobile()){setTimeout($.proxy(this.modal.showOnDesktop,this),0);$(window).on("resize.redactor-modal",$.proxy(this.modal.resize,this))}this.core.setCallback("modalOpened",this.modal.templateName,this.$modal);$(document).off("focusin.modal");this.$modal.find("input[type=text],input[type=url],input[type=email]").on("keydown.redactor-modal",$.proxy(this.modal.setEnter,this))},showOnDesktop:function(){var height=this.$modal.outerHeight();var windowHeight=$(window).height();var windowWidth=$(window).width();if(this.modal.width>windowWidth){this.$modal.css({width:"96%",marginTop:windowHeight/2-height/2+"px"});return}if(height>windowHeight){this.$modal.css({width:this.modal.width+"px",marginTop:"20px"})}else{this.$modal.css({width:this.modal.width+"px",marginTop:windowHeight/2-height/2+"px"})}},showOnMobile:function(){this.$modal.css({width:"96%",marginTop:"2%"})},resize:function(){if(this.utils.isMobile()){this.modal.showOnMobile()}else{this.modal.showOnDesktop()}},setTitle:function(title){this.$modalHeader.html(title)},setContent:function(){this.$modalBody.html(this.modal.getTemplate(this.modal.templateName))},setDraggable:function(){if(typeof $.fn.draggable==="undefined")return;this.$modal.draggable({handle:this.$modalHeader});this.$modalHeader.css("cursor","move")},setEnter:function(e){if(e.which!=13)return;
e.preventDefault();this.$modal.find("button.redactor-modal-action-btn").click()},createCancelButton:function(){var button=$("<button>").addClass("redactor-modal-btn redactor-modal-close-btn").html(this.lang.get("cancel"));button.on("click",$.proxy(this.modal.close,this));this.$modalFooter.append(button)},createDeleteButton:function(label){return this.modal.createButton(label,"delete")},createActionButton:function(label){return this.modal.createButton(label,"action")},createButton:function(label,className){var button=$("<button>").addClass("redactor-modal-btn").addClass("redactor-modal-"+className+"-btn").html(label);this.$modalFooter.append(button);return button},setButtonsWidth:function(){var buttons=this.$modalFooter.find("button");var buttonsSize=buttons.length;if(buttonsSize===0)return;buttons.css("width",100/buttonsSize+"%")},build:function(){this.modal.buildOverlay();this.$modalBox=$('<div id="redactor-modal-box"/>').hide();this.$modal=$('<div id="redactor-modal" role="dialog" aria-labelledby="redactor-modal-header" />');this.$modalHeader=$('<header id="redactor-modal-header"/>');this.$modalClose=$('<button type="button" id="redactor-modal-close" tabindex="1" aria-label="Close" />').html("&times;");this.$modalBody=$('<div id="redactor-modal-body" />');this.$modalFooter=$("<footer />");this.$modal.append(this.$modalHeader);this.$modal.append(this.$modalClose);this.$modal.append(this.$modalBody);this.$modal.append(this.$modalFooter);this.$modalBox.append(this.$modal);this.$modalBox.appendTo(document.body)},buildOverlay:function(){this.$modalOverlay=$('<div id="redactor-modal-overlay">').hide();$("body").prepend(this.$modalOverlay)},enableEvents:function(){this.$modalClose.on("click.redactor-modal",$.proxy(this.modal.close,this));$(document).on("keyup.redactor-modal",$.proxy(this.modal.closeHandler,this));this.$editor.on("keyup.redactor-modal",$.proxy(this.modal.closeHandler,this));this.$modalBox.on("click.redactor-modal",$.proxy(this.modal.close,this))},disableEvents:function(){this.$modalClose.off("click.redactor-modal");$(document).off("keyup.redactor-modal");this.$editor.off("keyup.redactor-modal");this.$modalBox.off("click.redactor-modal");$(window).off("resize.redactor-modal")},closeHandler:function(e){if(e.which!=this.keyCode.ESC)return;this.modal.close(false)},close:function(e){if(e){if(!$(e.target).hasClass("redactor-modal-close-btn")&&e.target!=this.$modalClose[0]&&e.target!=this.$modalBox[0]){return}e.preventDefault()}if(!this.$modalBox)return;this.modal.disableEvents();this.utils.enableBodyScroll();this.$modalOverlay.remove();this.$modalBox.fadeOut("fast",$.proxy(function(){this.$modalBox.remove();setTimeout($.proxy(this.utils.restoreScroll,this),0);if(e!==undefined)this.selection.restore();$(document.body).css("overflow",this.modal.bodyOveflow);this.core.setCallback("modalClosed",this.modal.templateName)},this))}}},observe:function(){return{load:function(){if(typeof this.opts.destroyed!="undefined")return;if(this.utils.browser("msie")){var self=this;this.$editor.find("pre, code").on("mouseover",function(){self.$editor.attr("contenteditable",false);$(this).attr("contenteditable",true)}).on("mouseout",function(){self.$editor.attr("contenteditable",true);$(this).removeAttr("contenteditable")})}this.observe.images();this.observe.links()},toolbar:function(e,btnName){this.observe.buttons(e,btnName);this.observe.dropdowns()},isCurrent:function($el,$current){if(typeof $current=="undefined"){var $current=$(this.selection.getCurrent())}return $current.is($el)||$current.parents($el).length>0},dropdowns:function(){var $current=$(this.selection.getCurrent());$.each(this.opts.observe.dropdowns,$.proxy(function(key,value){var observe=value.observe,element=observe.element,$item=value.item,inValues=typeof observe["in"]!="undefined"?observe["in"]:false,outValues=typeof observe["out"]!="undefined"?observe["out"]:false;if($current.closest(element).size()>0){this.observe.setDropdownProperties($item,inValues,outValues)}else{this.observe.setDropdownProperties($item,outValues,inValues)}},this))},setDropdownProperties:function($item,addProperties,deleteProperties){if(deleteProperties&&typeof deleteProperties["attr"]!="undefined"){this.observe.setDropdownAttr($item,deleteProperties.attr,true)}if(typeof addProperties["attr"]!="undefined"){this.observe.setDropdownAttr($item,addProperties.attr)}if(typeof addProperties["title"]!="undefined"){$item.text(addProperties["title"])}},setDropdownAttr:function($item,properties,isDelete){$.each(properties,function(key,value){if(key=="class"){if(!isDelete){$item.addClass(value)}else{$item.removeClass(value)}}else{if(!isDelete){$item.attr(key,value)}else{$item.removeAttr(key)}}})},addDropdown:function($item,btnName,btnObject){if(typeof btnObject.observe=="undefined")return;btnObject.item=$item;this.opts.observe.dropdowns.push(btnObject)},buttons:function(e,btnName){var current=this.selection.getCurrent();var parent=this.selection.getParent();if(e!==false){this.button.setInactiveAll()}else{this.button.setInactiveAll(btnName)}if(e===false&&btnName!=="html"){if($.inArray(btnName,this.opts.activeButtons)!=-1)this.button.toggleActive(btnName);return}$.each(this.opts.activeButtonsStates,$.proxy(function(key,value){var parentEl=$(parent).closest(key,this.$editor[0]);var currentEl=$(current).closest(key,this.$editor[0]);if(parentEl.length!==0&&!this.utils.isRedactorParent(parentEl))return;if(!this.utils.isRedactorParent(currentEl))return;if(parentEl.length!==0||currentEl.closest(key,this.$editor[0]).length!==0){this.button.setActive(value)}},this));var $parent=$(parent).closest(this.opts.alignmentTags.toString().toLowerCase(),this.$editor[0]);if(this.utils.isRedactorParent(parent)&&$parent.length){var align=$parent.css("text-align")===""?"left":$parent.css("text-align");this.button.setActive("align"+align)}},addButton:function(tag,btnName){this.opts.activeButtons.push(btnName);this.opts.activeButtonsStates[tag]=btnName},images:function(){this.$editor.find("img").each($.proxy(function(i,img){var $img=$(img);$img.closest("a",this.$editor[0]).on("click",function(e){e.preventDefault()});if(this.utils.browser("msie"))$img.attr("unselectable","on");this.image.setEditable($img)},this));$(document).on("click.redactor-image-delete."+this.uuid,$.proxy(function(e){this.observe.image=false;if(e.target.tagName=="IMG"&&this.utils.isRedactorParent(e.target)){this.observe.image=this.observe.image&&this.observe.image==e.target?false:e.target}},this))},links:function(){if(!this.opts.linkTooltip)return;this.$editor.find("a").on("touchstart.redactor."+this.uuid+" click.redactor."+this.uuid,$.proxy(this.observe.showTooltip,this));this.$editor.on("touchstart.redactor."+this.uuid+" click.redactor."+this.uuid,$.proxy(this.observe.closeTooltip,this));$(document).on("touchstart.redactor."+this.uuid+" click.redactor."+this.uuid,$.proxy(this.observe.closeTooltip,this))},getTooltipPosition:function($link){return $link.offset()},showTooltip:function(e){var $el=$(e.target);if($el[0].tagName=="IMG")return;if($el[0].tagName!=="A")$el=$el.closest("a",this.$editor[0]);if($el[0].tagName!=="A")return;var $link=$el;var pos=this.observe.getTooltipPosition($link);var tooltip=$('<span class="redactor-link-tooltip"></span>');var href=$link.attr("href");if(href===undefined){href=""}if(href.length>24)href=href.substring(0,24)+"...";var aLink=$('<a href="'+$link.attr("href")+'" target="_blank" />').html(href).addClass("redactor-link-tooltip-action");var aEdit=$('<a href="#" />').html(this.lang.get("edit")).on("click",$.proxy(this.link.show,this)).addClass("redactor-link-tooltip-action");var aUnlink=$('<a href="#" />').html(this.lang.get("unlink")).on("click",$.proxy(this.link.unlink,this)).addClass("redactor-link-tooltip-action");tooltip.append(aLink).append(" | ").append(aEdit).append(" | ").append(aUnlink);tooltip.css({top:pos.top+parseInt($link.css("line-height"),10)+"px",left:pos.left+"px"});$(".redactor-link-tooltip").remove();$("body").append(tooltip)},closeTooltip:function(e){e=e.originalEvent||e;var target=e.target;var $parent=$(target).closest("a",this.$editor[0]);if($parent.length!==0&&$parent[0].tagName==="A"&&target.tagName!=="A"){return}else if(target.tagName==="A"&&this.utils.isRedactorParent(target)||$(target).hasClass("redactor-link-tooltip-action")){return}$(".redactor-link-tooltip").remove()}}},paragraphize:function(){return{load:function(html){if(this.opts.linebreaks)return html;if(html===""||html==="<p></p>")return this.opts.emptyHtml;html=html+"\n";this.paragraphize.safes=[];this.paragraphize.z=0;html=html.replace(/(<br\s?\/?>){1,}\n?<\/blockquote>/gi,"</blockquote>");html=this.paragraphize.getSafes(html);html=this.paragraphize.getSafesComments(html);html=this.paragraphize.replaceBreaksToNewLines(html);html=this.paragraphize.replaceBreaksToParagraphs(html);html=this.paragraphize.clear(html);html=this.paragraphize.restoreSafes(html);html=html.replace(new RegExp("<br\\s?/?>\n?<("+this.opts.paragraphizeBlocks.join("|")+")(.*?[^>])>","gi"),"<p><br /></p>\n<$1$2>");return $.trim(html)},getSafes:function(html){var $div=$("<div />").append(html);$div.find("blockquote p").replaceWith(function(){return $(this).append("<br />").contents()});html=$div.html();$div.find(this.opts.paragraphizeBlocks.join(", ")).each($.proxy(function(i,s){this.paragraphize.z++;this.paragraphize.safes[this.paragraphize.z]=s.outerHTML;html=html.replace(s.outerHTML,"\n{replace"+this.paragraphize.z+"}")},this));return html},getSafesComments:function(html){var commentsMatches=html.match(/<!--([\w\W]*?)-->/gi);if(!commentsMatches)return html;$.each(commentsMatches,$.proxy(function(i,s){this.paragraphize.z++;this.paragraphize.safes[this.paragraphize.z]=s;html=html.replace(s,"\n{replace"+this.paragraphize.z+"}")},this));return html},restoreSafes:function(html){$.each(this.paragraphize.safes,function(i,s){s=typeof s!=="undefined"?s.replace(/\$/g,"&#36;"):s;html=html.replace("{replace"+i+"}",s)});return html},replaceBreaksToParagraphs:function(html){var htmls=html.split(new RegExp("\n","g"),-1);html="";if(htmls){var len=htmls.length;for(var i=0;i<len;i++){if(!htmls.hasOwnProperty(i))return;if(htmls[i].search("{replace")==-1){htmls[i]=htmls[i].replace(/<p>\n\t?<\/p>/gi,"");htmls[i]=htmls[i].replace(/<p><\/p>/gi,"");if(htmls[i]!==""){html+="<p>"+htmls[i].replace(/^\n+|\n+$/g,"")+"</p>"}}else html+=htmls[i]}}return html},replaceBreaksToNewLines:function(html){html=html.replace(/<br \/>\s*<br \/>/gi,"\n\n");html=html.replace(/<br\s?\/?>\n?<br\s?\/?>/gi,"\n<br /><br />");html=html.replace(new RegExp("\r\n","g"),"\n");html=html.replace(new RegExp("\r","g"),"\n");html=html.replace(new RegExp("/\n\n+/"),"g","\n\n");return html},clear:function(html){html=html.replace(new RegExp("</blockquote></p>","gi"),"</blockquote>");html=html.replace(new RegExp("<p></blockquote>","gi"),"</blockquote>");html=html.replace(new RegExp("<p><blockquote>","gi"),"<blockquote>");html=html.replace(new RegExp("<blockquote></p>","gi"),"<blockquote>");html=html.replace(new RegExp("<p><p ","gi"),"<p ");html=html.replace(new RegExp("<p><p>","gi"),"<p>");html=html.replace(new RegExp("</p></p>","gi"),"</p>");html=html.replace(new RegExp("<p>\\s?</p>","gi"),"");html=html.replace(new RegExp("\n</p>","gi"),"</p>");html=html.replace(new RegExp("<p>	?	?\n?<p>","gi"),"<p>");html=html.replace(new RegExp("<p>	*</p>","gi"),"");return html}}},paste:function(){return{init:function(e){if(!this.opts.cleanOnPaste){setTimeout($.proxy(this.code.sync,this),1);return}this.rtePaste=true;this.buffer.set();this.selection.save();this.utils.saveScroll();this.paste.createPasteBox();$(window).on("scroll.redactor-freeze",$.proxy(function(){$(window).scrollTop(this.saveBodyScroll)},this));setTimeout($.proxy(function(){var html=this.$pasteBox.html();this.$pasteBox.remove();this.selection.restore();this.utils.restoreScroll();this.paste.insert(html);$(window).off("scroll.redactor-freeze");if(this.linkify.isEnabled()){this.linkify.format()}},this),1)},createPasteBox:function(){this.$pasteBox=$("<div>").html("").attr("contenteditable","true").css({position:"fixed",width:0,top:0,left:"-9999px"});if(this.utils.browser("msie")){this.$box.append(this.$pasteBox)}else{var $visibleModals=$(".modal-body:visible");if($visibleModals.length>0){$visibleModals.append(this.$pasteBox)}else{$("body").append(this.$pasteBox)}}this.$pasteBox.get(0).focus()},insert:function(html){html=this.core.setCallback("pasteBefore",html);html=this.utils.isSelectAll()?this.clean.onPaste(html,false):this.clean.onPaste(html);html=this.core.setCallback("paste",html);if(this.utils.isSelectAll()){this.insert.set(html,false)}else{this.insert.html(html,false)}this.utils.disableSelectAll();this.rtePaste=false;setTimeout($.proxy(this.clean.clearUnverified,this),10);setTimeout($.proxy(function(){var spans=this.$editor.find("span");$.each(spans,function(i,s){var html=s.innerHTML.replace(/\u200B/,"");if(html===""&&s.attributes.length===0)$(s).remove()})},this),10)}}},placeholder:function(){return{enable:function(){if(!this.placeholder.is())return;this.$editor.attr("placeholder",this.$element.attr("placeholder"));this.placeholder.toggle();this.$editor.on("keydown.redactor-placeholder",$.proxy(this.placeholder.toggle,this))},toggle:function(){setTimeout($.proxy(function(){var func=this.utils.isEmpty(this.$editor.html(),false)?"addClass":"removeClass";this.$editor[func]("redactor-placeholder")},this),5)},remove:function(){this.$editor.removeClass("redactor-placeholder")},is:function(){if(this.opts.placeholder){return this.$element.attr("placeholder",this.opts.placeholder)}else{return!(typeof this.$element.attr("placeholder")=="undefined"||this.$element.attr("placeholder")==="")}}}},progress:function(){return{show:function(){$(document.body).append($('<div id="redactor-progress"><span></span></div>'));$("#redactor-progress").fadeIn()},hide:function(){$("#redactor-progress").fadeOut(1500,function(){$(this).remove()})}}},selection:function(){return{get:function(){this.sel=document.getSelection();if(document.getSelection&&this.sel.getRangeAt&&this.sel.rangeCount){this.range=this.sel.getRangeAt(0)}else{this.range=document.createRange()}},addRange:function(){try{this.sel.removeAllRanges()}catch(e){}this.sel.addRange(this.range)},getCurrent:function(){var el=false;this.selection.get();if(this.sel&&this.sel.rangeCount>0){el=this.sel.getRangeAt(0).startContainer}return this.utils.isRedactorParent(el)},getParent:function(elem){elem=elem||this.selection.getCurrent();if(elem){return this.utils.isRedactorParent($(elem).parent()[0])}return false},getPrev:function(){return window.getSelection().anchorNode.previousSibling},getNext:function(){return window.getSelection().anchorNode.nextSibling},getBlock:function(node){node=node||this.selection.getCurrent();while(node){if(this.utils.isBlockTag(node.tagName)){return $(node).hasClass("redactor-editor")?false:node}node=node.parentNode}return false},getInlines:function(nodes,tags){this.selection.get();if(this.range&&this.range.collapsed){return false}var inlines=[];nodes=typeof nodes=="undefined"||nodes===false?this.selection.getNodes():nodes;var inlineTags=this.opts.inlineTags;inlineTags.push("span");if(typeof tags!=="undefined"){for(var i=0;i<tags.length;i++){inlineTags.push(tags[i])}}$.each(nodes,$.proxy(function(i,node){if($.inArray(node.tagName.toLowerCase(),inlineTags)!=-1){inlines.push(node)}},this));return inlines.length===0?false:inlines},getInlinesTags:function(tags){this.selection.get();if(this.range&&this.range.collapsed){return false}var inlines=[];var nodes=this.selection.getNodes();$.each(nodes,$.proxy(function(i,node){if($.inArray(node.tagName.toLowerCase(),tags)!=-1){inlines.push(node)}},this));return inlines.length===0?false:inlines},getBlocks:function(nodes){this.selection.get();if(this.range&&this.range.collapsed){return[this.selection.getBlock()]}var blocks=[];nodes=typeof nodes=="undefined"?this.selection.getNodes():nodes;$.each(nodes,$.proxy(function(i,node){if(this.utils.isBlock(node)){blocks.push(node)}},this));return blocks.length===0?[this.selection.getBlock()]:blocks},getLastBlock:function(){return this.selection.lastBlock},getNodes:function(){this.selection.get();var startNode=this.selection.getNodesMarker(1);var endNode=this.selection.getNodesMarker(2);if(this.range.collapsed===false){if(window.getSelection){var sel=window.getSelection();if(sel.rangeCount>0){var range=sel.getRangeAt(0);var startPointNode=range.startContainer,startOffset=range.startOffset;var boundaryRange=range.cloneRange();boundaryRange.collapse(false);boundaryRange.insertNode(endNode);boundaryRange.setStart(startPointNode,startOffset);boundaryRange.collapse(true);boundaryRange.insertNode(startNode);range.setStartAfter(startNode);range.setEndBefore(endNode);sel.removeAllRanges();sel.addRange(range)}}}else{this.selection.setNodesMarker(this.range,startNode,true);endNode=startNode}var nodes=[];var counter=0;var self=this;this.$editor.find("*").each(function(){if(this==startNode){var parent=$(this).parent();if(parent.length!==0&&parent[0].tagName!="BODY"&&self.utils.isRedactorParent(parent[0])){nodes.push(parent[0])}nodes.push(this);counter=1}else{if(counter>0){nodes.push(this);counter=counter+1}}if(this==endNode){return false}});var finalNodes=[];var len=nodes.length;for(var i=0;i<len;i++){if(nodes[i].id!="nodes-marker-1"&&nodes[i].id!="nodes-marker-2"){finalNodes.push(nodes[i])}}this.selection.removeNodesMarkers();return finalNodes},getNodesMarker:function(num){return $('<span id="nodes-marker-'+num+'" class="redactor-nodes-marker" data-verified="redactor">'+this.opts.invisibleSpace+"</span>")[0]},setNodesMarker:function(range,node,type){var range=range.cloneRange();try{range.collapse(type);range.insertNode(node)}catch(e){}},removeNodesMarkers:function(){$(document).find("span.redactor-nodes-marker").remove();this.$editor.find("span.redactor-nodes-marker").remove()},fromPoint:function(start,end){this.caret.setOffset(start,end)},wrap:function(tag){this.selection.get();if(this.range.collapsed)return false;var wrapper=document.createElement(tag);wrapper.appendChild(this.range.extractContents());this.range.insertNode(wrapper);return wrapper},selectElement:function(node){if(this.utils.browser("mozilla")){node=node[0]||node;var range=document.createRange();range.selectNodeContents(node)}else{this.caret.set(node,0,node,1)}},selectAll:function(){this.selection.get();this.range.selectNodeContents(this.$editor[0]);this.selection.addRange()},remove:function(){this.selection.get();this.sel.removeAllRanges()},save:function(){this.selection.createMarkers()},createMarkers:function(){this.selection.get();var node1=this.selection.getMarker(1);this.selection.setMarker(this.range,node1,true);if(this.range.collapsed===false){var node2=this.selection.getMarker(2);this.selection.setMarker(this.range,node2,false)}this.savedSel=this.$editor.html()},getMarker:function(num){if(typeof num=="undefined")num=1;return $('<span id="selection-marker-'+num+'" class="redactor-selection-marker"  data-verified="redactor">'+this.opts.invisibleSpace+"</span>")[0]},getMarkerAsHtml:function(num){return this.utils.getOuterHtml(this.selection.getMarker(num))},setMarker:function(range,node,type){range=range.cloneRange();try{range.collapse(type);range.insertNode(node)}catch(e){this.focus.setStart()}},restore:function(){var node1=this.$editor.find("span#selection-marker-1");var node2=this.$editor.find("span#selection-marker-2");if(this.utils.browser("mozilla")){this.$editor.focus()}if(node1.length!==0&&node2.length!==0){this.caret.set(node1,0,node2,0)}else if(node1.length!==0){this.caret.set(node1,0,node1,0)}else{this.$editor.focus()}this.selection.removeMarkers();this.savedSel=false},removeMarkers:function(){this.$editor.find("span.redactor-selection-marker").each(function(i,s){var text=$(s).text().replace(/\u200B/g,"");if(text==="")$(s).remove();else $(s).replaceWith(function(){return $(this).contents()})})},getText:function(){this.selection.get();return this.sel.toString()},getHtml:function(){var html="";this.selection.get();if(this.sel.rangeCount){var container=document.createElement("div");var len=this.sel.rangeCount;for(var i=0;i<len;++i){container.appendChild(this.sel.getRangeAt(i).cloneContents())}html=container.innerHTML}return this.clean.onSync(html)},replaceSelection:function(html){this.selection.get();this.range.deleteContents();var div=document.createElement("div");div.innerHTML=html;var frag=document.createDocumentFragment(),child;while(child=div.firstChild){frag.appendChild(child)}this.range.insertNode(frag)},replaceWithHtml:function(html){html=this.selection.getMarkerAsHtml(1)+html+this.selection.getMarkerAsHtml(2);this.selection.get();if(window.getSelection&&window.getSelection().getRangeAt){this.selection.replaceSelection(html)}else if(document.selection&&document.selection.createRange){this.range.pasteHTML(html)}this.selection.restore();this.code.sync()}}},shortcuts:function(){return{init:function(e,key){if(!this.opts.shortcuts){if((e.ctrlKey||e.metaKey)&&(key===66||key===73))e.preventDefault();return false}$.each(this.opts.shortcuts,$.proxy(function(str,command){var keys=str.split(",");var len=keys.length;for(var i=0;i<len;i++){if(typeof keys[i]==="string"){this.shortcuts.handler(e,$.trim(keys[i]),$.proxy(function(){var func;if(command.func.search(/\./)!="-1"){func=command.func.split(".");if(typeof this[func[0]]!="undefined"){this[func[0]][func[1]].apply(this,command.params)}}else{this[command.func].apply(this,command.params)}},this))}}},this))},handler:function(e,keys,origHandler){var hotkeysSpecialKeys={8:"backspace",9:"tab",10:"return",13:"return",16:"shift",17:"ctrl",18:"alt",19:"pause",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"insert",46:"del",59:";",61:"=",96:"0",97:"1",98:"2",99:"3",100:"4",101:"5",102:"6",103:"7",104:"8",105:"9",106:"*",107:"+",109:"-",110:".",111:"/",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",144:"numlock",145:"scroll",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"};var hotkeysShiftNums={"`":"~",1:"!",2:"@",3:"#",4:"$",5:"%",6:"^",7:"&",8:"*",9:"(",0:")","-":"_","=":"+",";":": ","'":'"',",":"<",".":">","/":"?","\\":"|"};keys=keys.toLowerCase().split(" ");var special=hotkeysSpecialKeys[e.keyCode],character=String.fromCharCode(e.which).toLowerCase(),modif="",possible={};$.each(["alt","ctrl","meta","shift"],function(index,specialKey){if(e[specialKey+"Key"]&&special!==specialKey){modif+=specialKey+"+"}});if(special)possible[modif+special]=true;if(character){possible[modif+character]=true;possible[modif+hotkeysShiftNums[character]]=true;if(modif==="shift+"){possible[hotkeysShiftNums[character]]=true}}for(var i=0,len=keys.length;i<len;i++){if(possible[keys[i]]){e.preventDefault();return origHandler.apply(this,arguments)}}}}},tabifier:function(){return{get:function(code){if(!this.opts.tabifier)return code;var ownLine=["area","body","head","hr","i?frame","link","meta","noscript","style","script","table","tbody","thead","tfoot"];var contOwnLine=["li","dt","dt","h[1-6]","option","script"];var newLevel=["p","blockquote","div","dl","fieldset","form","frameset","map","ol","pre","select","td","th","tr","ul"];this.tabifier.lineBefore=new RegExp("^<(/?"+ownLine.join("|/?")+"|"+contOwnLine.join("|")+")[ >]");this.tabifier.lineAfter=new RegExp("^<(br|/?"+ownLine.join("|/?")+"|/"+contOwnLine.join("|/")+")[ >]");this.tabifier.newLevel=new RegExp("^</?("+newLevel.join("|")+")[ >]");var i=0,codeLength=code.length,point=0,start=null,end=null,tag="",out="",cont="";this.tabifier.cleanlevel=0;for(;i<codeLength;i++){point=i;if(-1==code.substr(i).indexOf("<")){out+=code.substr(i);return this.tabifier.finish(out)}while(point<codeLength&&code.charAt(point)!="<"){point++}if(i!=point){cont=code.substr(i,point-i);if(!cont.match(/^\s{2,}$/g)){if("\n"==out.charAt(out.length-1))out+=this.tabifier.getTabs();else if("\n"==cont.charAt(0)){out+="\n"+this.tabifier.getTabs();cont=cont.replace(/^\s+/,"")}out+=cont}if(cont.match(/\n/))out+="\n"+this.tabifier.getTabs()}start=point;while(point<codeLength&&">"!=code.charAt(point)){point++}tag=code.substr(start,point-start);i=point;var t;if("!--"==tag.substr(1,3)){if(!tag.match(/--$/)){while("-->"!=code.substr(point,3)){point++}point+=2;tag=code.substr(start,point-start);i=point}if("\n"!=out.charAt(out.length-1))out+="\n";out+=this.tabifier.getTabs();out+=tag+">\n"}else if("!"==tag[1]){out=this.tabifier.placeTag(tag+">",out)}else if("?"==tag[1]){out+=tag+">\n"}else if(t=tag.match(/^<(script|style|pre)/i)){t[1]=t[1].toLowerCase();tag=this.tabifier.cleanTag(tag);out=this.tabifier.placeTag(tag,out);end=String(code.substr(i+1)).toLowerCase().indexOf("</"+t[1]);if(end){cont=code.substr(i+1,end);i+=end;out+=cont}}else{tag=this.tabifier.cleanTag(tag);out=this.tabifier.placeTag(tag,out)}}return this.tabifier.finish(out)},getTabs:function(){var s="";for(var j=0;j<this.tabifier.cleanlevel;j++){s+="	"}return s},finish:function(code){code=code.replace(/\n\s*\n/g,"\n");code=code.replace(/^[\s\n]*/,"");code=code.replace(/[\s\n]*$/,"");code=code.replace(/<script(.*?)>\n<\/script>/gi,"<script$1></script>");this.tabifier.cleanlevel=0;return code},cleanTag:function(tag){var tagout="";tag=tag.replace(/\n/g," ");tag=tag.replace(/\s{2,}/g," ");tag=tag.replace(/^\s+|\s+$/g," ");var suffix="";if(tag.match(/\/$/)){suffix="/";tag=tag.replace(/\/+$/,"")}var m;while(m=/\s*([^= ]+)(?:=((['"']).*?\3|[^ ]+))?/.exec(tag)){if(m[2])tagout+=m[1].toLowerCase()+"="+m[2];else if(m[1])tagout+=m[1].toLowerCase();tagout+=" ";tag=tag.substr(m[0].length)}return tagout.replace(/\s*$/,"")+suffix+">"},placeTag:function(tag,out){var nl=tag.match(this.tabifier.newLevel);if(tag.match(this.tabifier.lineBefore)||nl){out=out.replace(/\s*$/,"");out+="\n"}if(nl&&"/"==tag.charAt(1))this.tabifier.cleanlevel--;if("\n"==out.charAt(out.length-1))out+=this.tabifier.getTabs();if(nl&&"/"!=tag.charAt(1))this.tabifier.cleanlevel++;out+=tag;if(tag.match(this.tabifier.lineAfter)||tag.match(this.tabifier.newLevel)){out=out.replace(/ *$/,"")}return out}}},tidy:function(){return{setupAllowed:function(){var index=$.inArray("span",this.opts.removeEmpty);if(index!==-1){this.opts.removeEmpty.splice(index,1)}if(this.opts.allowedTags)this.opts.deniedTags=false;if(this.opts.allowedAttr)this.opts.removeAttr=false;if(this.opts.linebreaks)return;var tags=["p","section"];if(this.opts.allowedTags)this.tidy.addToAllowed(tags);if(this.opts.deniedTags)this.tidy.removeFromDenied(tags)},addToAllowed:function(tags){var len=tags.length;for(var i=0;i<len;i++){if($.inArray(tags[i],this.opts.allowedTags)==-1){this.opts.allowedTags.push(tags[i])}}},removeFromDenied:function(tags){var len=tags.length;for(var i=0;i<len;i++){var pos=$.inArray(tags[i],this.opts.deniedTags);if(pos!=-1){this.opts.deniedTags.splice(pos,1)}}},load:function(html,options){this.tidy.settings={deniedTags:this.opts.deniedTags,allowedTags:this.opts.allowedTags,removeComments:this.opts.removeComments,replaceTags:this.opts.replaceTags,replaceStyles:this.opts.replaceStyles,removeDataAttr:this.opts.removeDataAttr,removeAttr:this.opts.removeAttr,allowedAttr:this.opts.allowedAttr,removeWithoutAttr:this.opts.removeWithoutAttr,removeEmpty:this.opts.removeEmpty};$.extend(this.tidy.settings,options);html=this.tidy.removeComments(html);this.tidy.$div=$("<div />").append(html);this.tidy.replaceTags();this.tidy.replaceStyles();this.tidy.removeTags();this.tidy.removeAttr();this.tidy.removeEmpty();this.tidy.removeParagraphsInLists();this.tidy.removeDataAttr();this.tidy.removeWithoutAttr();html=this.tidy.$div.html();this.tidy.$div.remove();return html},removeComments:function(html){if(!this.tidy.settings.removeComments)return html;return html.replace(/<!--[\s\S]*?-->/gi,"")},replaceTags:function(html){if(!this.tidy.settings.replaceTags)return html;var len=this.tidy.settings.replaceTags.length;var replacement=[],rTags=[];for(var i=0;i<len;i++){rTags.push(this.tidy.settings.replaceTags[i][1]);replacement.push(this.tidy.settings.replaceTags[i][0])}$.each(replacement,$.proxy(function(key,value){this.tidy.$div.find(value).replaceWith(function(){return $("<"+rTags[key]+" />",{html:$(this).html()})})},this))},replaceStyles:function(){if(!this.tidy.settings.replaceStyles)return;var len=this.tidy.settings.replaceStyles.length;this.tidy.$div.find("span").each($.proxy(function(n,s){var $el=$(s);var style=$el.attr("style");for(var i=0;i<len;i++){if(style&&style.match(new RegExp("^"+this.tidy.settings.replaceStyles[i][0],"i"))){var tagName=this.tidy.settings.replaceStyles[i][1];$el.replaceWith(function(){var tag=document.createElement(tagName);return $(tag).append($(this).contents())})}}},this))},removeTags:function(){if(!this.tidy.settings.deniedTags&&this.tidy.settings.allowedTags){this.tidy.$div.find("*").not(this.tidy.settings.allowedTags.join(",")).each(function(i,s){if(s.innerHTML==="")$(s).remove();else $(s).contents().unwrap()})}if(this.tidy.settings.deniedTags){this.tidy.$div.find(this.tidy.settings.deniedTags.join(",")).each(function(i,s){if($(s).hasClass("redactor-script-tag")||$(s).hasClass("redactor-selection-marker"))return;if(s.innerHTML==="")$(s).remove();else $(s).contents().unwrap()})}},removeAttr:function(){var len;if(!this.tidy.settings.removeAttr&&this.tidy.settings.allowedAttr){var allowedAttrTags=[],allowedAttrData=[];len=this.tidy.settings.allowedAttr.length;for(var i=0;i<len;i++){allowedAttrTags.push(this.tidy.settings.allowedAttr[i][0]);allowedAttrData.push(this.tidy.settings.allowedAttr[i][1])}this.tidy.$div.find("*").each($.proxy(function(n,s){var $el=$(s);var pos=$.inArray($el[0].tagName.toLowerCase(),allowedAttrTags);var attributesRemove=this.tidy.removeAttrGetRemoves(pos,allowedAttrData,$el);if(attributesRemove){$.each(attributesRemove,function(z,f){$el.removeAttr(f)})}},this))}if(this.tidy.settings.removeAttr){len=this.tidy.settings.removeAttr.length;for(var i=0;i<len;i++){var attrs=this.tidy.settings.removeAttr[i][1];if($.isArray(attrs))attrs=attrs.join(" ");this.tidy.$div.find(this.tidy.settings.removeAttr[i][0]).removeAttr(attrs)}}},removeAttrGetRemoves:function(pos,allowed,$el){var attributesRemove=[];if(pos==-1){$.each($el[0].attributes,function(i,item){attributesRemove.push(item.name)})}else if(allowed[pos]=="*"){attributesRemove=[]}else{$.each($el[0].attributes,function(i,item){if($.isArray(allowed[pos])){if($.inArray(item.name,allowed[pos])==-1){attributesRemove.push(item.name)}}else if(allowed[pos]!=item.name){attributesRemove.push(item.name)}})}return attributesRemove},removeAttrs:function(el,regex){regex=new RegExp(regex,"g");return el.each(function(){var self=$(this);var len=this.attributes.length-1;for(var i=len;i>=0;i--){var item=this.attributes[i];if(item&&item.specified&&item.name.search(regex)>=0){self.removeAttr(item.name)}}})},removeEmpty:function(){if(!this.tidy.settings.removeEmpty)return;this.tidy.$div.find(this.tidy.settings.removeEmpty.join(",")).each(function(){var $el=$(this);var text=$el.text();text=text.replace(/\u200B/g,"");text=text.replace(/&nbsp;/gi,"");text=text.replace(/\s/g,"");if(text===""&&$el.children().length===0){$el.remove()}})},removeParagraphsInLists:function(){this.tidy.$div.find("li p").contents().unwrap()},removeDataAttr:function(){if(!this.tidy.settings.removeDataAttr)return;var tags=this.tidy.settings.removeDataAttr;if($.isArray(this.tidy.settings.removeDataAttr))tags=this.tidy.settings.removeDataAttr.join(",");this.tidy.removeAttrs(this.tidy.$div.find(tags),"^(data-)")},removeWithoutAttr:function(){if(!this.tidy.settings.removeWithoutAttr)return;this.tidy.$div.find(this.tidy.settings.removeWithoutAttr.join(",")).each(function(){if(this.attributes.length===0){$(this).contents().unwrap()}})}}},toolbar:function(){return{init:function(){return{html:{title:this.lang.get("html"),func:"code.toggle"},formatting:{title:this.lang.get("formatting"),dropdown:{p:{title:this.lang.get("paragraph"),func:"block.format"},blockquote:{title:this.lang.get("quote"),func:"block.format"},pre:{title:this.lang.get("code"),func:"block.format"},h1:{title:this.lang.get("header1"),func:"block.format"},h2:{title:this.lang.get("header2"),func:"block.format"},h3:{title:this.lang.get("header3"),func:"block.format"},h4:{title:this.lang.get("header4"),func:"block.format"},h5:{title:this.lang.get("header5"),func:"block.format"}}},bold:{title:this.lang.get("bold"),func:"inline.format"},italic:{title:this.lang.get("italic"),func:"inline.format"},deleted:{title:this.lang.get("deleted"),func:"inline.format"},underline:{title:this.lang.get("underline"),func:"inline.format"},unorderedlist:{title:"&bull; "+this.lang.get("unorderedlist"),func:"list.toggle"},orderedlist:{title:"1. "+this.lang.get("orderedlist"),func:"list.toggle"},outdent:{title:"< "+this.lang.get("outdent"),func:"indent.decrease"},indent:{title:"> "+this.lang.get("indent"),func:"indent.increase"},image:{title:this.lang.get("image"),func:"image.show"},file:{title:this.lang.get("file"),func:"file.show"},link:{title:this.lang.get("link"),dropdown:{link:{title:this.lang.get("link_insert"),func:"link.show",observe:{element:"a","in":{title:this.lang.get("link_edit")},out:{title:this.lang.get("link_insert")}}},unlink:{title:this.lang.get("unlink"),func:"link.unlink",observe:{element:"a",out:{attr:{"class":"redactor-dropdown-link-inactive","aria-disabled":true}}}}}},alignment:{title:this.lang.get("alignment"),dropdown:{left:{title:this.lang.get("align_left"),func:"alignment.left"},center:{title:this.lang.get("align_center"),func:"alignment.center"},right:{title:this.lang.get("align_right"),func:"alignment.right"},justify:{title:this.lang.get("align_justify"),func:"alignment.justify"}}},horizontalrule:{title:this.lang.get("horizontalrule"),func:"line.insert"}}
},build:function(){this.toolbar.hideButtons();this.toolbar.hideButtonsOnMobile();this.toolbar.isButtonSourceNeeded();if(this.opts.buttons.length===0)return;this.$toolbar=this.toolbar.createContainer();this.toolbar.setOverflow();this.toolbar.append();this.toolbar.setFormattingTags();this.toolbar.loadButtons();this.toolbar.setFixed();if(this.opts.activeButtons){this.$editor.on("mouseup.redactor keyup.redactor focus.redactor",$.proxy(this.observe.toolbar,this))}},createContainer:function(){return $("<ul>").addClass("redactor-toolbar").attr({id:"redactor-toolbar-"+this.uuid,role:"toolbar"})},setFormattingTags:function(){$.each(this.opts.toolbar.formatting.dropdown,$.proxy(function(i,s){if($.inArray(i,this.opts.formatting)==-1)delete this.opts.toolbar.formatting.dropdown[i]},this))},loadButtons:function(){$.each(this.opts.buttons,$.proxy(function(i,btnName){if(!this.opts.toolbar[btnName])return;if(btnName==="file"){if(this.opts.fileUpload===false)return;else if(!this.opts.fileUpload&&this.opts.s3===false)return}if(btnName==="image"){if(this.opts.imageUpload===false)return;else if(!this.opts.imageUpload&&this.opts.s3===false)return}var btnObject=this.opts.toolbar[btnName];this.$toolbar.append($("<li>").append(this.button.build(btnName,btnObject)))},this))},append:function(){if(this.opts.toolbarExternal){this.$toolbar.addClass("redactor-toolbar-external");$(this.opts.toolbarExternal).html(this.$toolbar)}else{this.$box.prepend(this.$toolbar)}},setFixed:function(){if(!this.utils.isDesktop())return;if(this.opts.toolbarExternal)return;if(!this.opts.toolbarFixed)return;this.toolbar.observeScroll();$(this.opts.toolbarFixedTarget).on("scroll.redactor."+this.uuid,$.proxy(this.toolbar.observeScroll,this))},setOverflow:function(){if(this.utils.isMobile()&&this.opts.toolbarOverflow){this.$toolbar.addClass("redactor-toolbar-overflow")}},isButtonSourceNeeded:function(){if(this.opts.source)return;var index=this.opts.buttons.indexOf("html");if(index!==-1){this.opts.buttons.splice(index,1)}},hideButtons:function(){if(this.opts.buttonsHide.length===0)return;$.each(this.opts.buttonsHide,$.proxy(function(i,s){var index=this.opts.buttons.indexOf(s);this.opts.buttons.splice(index,1)},this))},hideButtonsOnMobile:function(){if(!this.utils.isMobile()||this.opts.buttonsHideOnMobile.length===0)return;$.each(this.opts.buttonsHideOnMobile,$.proxy(function(i,s){var index=this.opts.buttons.indexOf(s);this.opts.buttons.splice(index,1)},this))},observeScroll:function(){var scrollTop=$(this.opts.toolbarFixedTarget).scrollTop();var boxTop=1;if(this.opts.toolbarFixedTarget===document){boxTop=this.$box.offset().top}if(scrollTop+this.opts.toolbarFixedTopOffset>boxTop){this.toolbar.observeScrollEnable(scrollTop,boxTop)}else{this.toolbar.observeScrollDisable()}},observeScrollEnable:function(scrollTop,boxTop){var top=this.opts.toolbarFixedTopOffset+scrollTop-boxTop;var left=0;var end=boxTop+this.$box.height()-32;var width=this.$box.innerWidth();this.$toolbar.addClass("toolbar-fixed-box");this.$toolbar.css({position:"absolute",width:width,top:top+"px",left:left});if(scrollTop>end)$(".redactor-dropdown-"+this.uuid+":visible").hide();this.toolbar.setDropdownsFixed();this.$toolbar.css("visibility",scrollTop<end?"visible":"hidden")},observeScrollDisable:function(){this.$toolbar.css({position:"relative",width:"auto",top:0,left:0,visibility:"visible"});this.toolbar.unsetDropdownsFixed();this.$toolbar.removeClass("toolbar-fixed-box")},setDropdownsFixed:function(){var top=this.$toolbar.innerHeight()+this.opts.toolbarFixedTopOffset;var position="fixed";if(this.opts.toolbarFixedTarget!==document){top=this.$toolbar.innerHeight()+this.$toolbar.offset().top+this.opts.toolbarFixedTopOffset;position="absolute"}$(".redactor-dropdown-"+this.uuid).each(function(){$(this).css({position:position,top:top+"px"})})},unsetDropdownsFixed:function(){var top=this.$toolbar.innerHeight()+this.$toolbar.offset().top;$(".redactor-dropdown-"+this.uuid).each(function(){$(this).css({position:"absolute",top:top+"px"})})}}},upload:function(){return{init:function(id,url,callback){this.upload.direct=false;this.upload.callback=callback;this.upload.url=url;this.upload.$el=$(id);this.upload.$droparea=$('<div id="redactor-droparea" />');this.upload.$placeholdler=$('<div id="redactor-droparea-placeholder" />').text(this.lang.get("upload_label"));this.upload.$input=$('<input type="file" name="file" />');this.upload.$placeholdler.append(this.upload.$input);this.upload.$droparea.append(this.upload.$placeholdler);this.upload.$el.append(this.upload.$droparea);this.upload.$droparea.off("redactor.upload");this.upload.$input.off("redactor.upload");this.upload.$droparea.on("dragover.redactor.upload",$.proxy(this.upload.onDrag,this));this.upload.$droparea.on("dragleave.redactor.upload",$.proxy(this.upload.onDragLeave,this));this.upload.$input.on("change.redactor.upload",$.proxy(function(e){e=e.originalEvent||e;this.upload.traverseFile(this.upload.$input[0].files[0],e)},this));this.upload.$droparea.on("drop.redactor.upload",$.proxy(function(e){e.preventDefault();this.upload.$droparea.removeClass("drag-hover").addClass("drag-drop");this.upload.onDrop(e)},this))},directUpload:function(file,e){this.upload.direct=true;this.upload.traverseFile(file,e)},onDrop:function(e){e=e.originalEvent||e;var files=e.dataTransfer.files;this.upload.traverseFile(files[0],e)},traverseFile:function(file,e){if(this.opts.s3){this.upload.setConfig(file);this.upload.s3uploadFile(file);return}var formData=!!window.FormData?new FormData:null;if(window.FormData){this.upload.setConfig(file);var name=this.upload.type=="image"?this.opts.imageUploadParam:this.opts.fileUploadParam;formData.append(name,file)}this.progress.show();this.core.setCallback("uploadStart",e,formData);this.upload.sendData(formData,e)},setConfig:function(file){this.upload.getType(file);if(this.upload.direct){this.upload.url=this.upload.type=="image"?this.opts.imageUpload:this.opts.fileUpload;this.upload.callback=this.upload.type=="image"?this.image.insert:this.file.insert}},getType:function(file){this.upload.type="image";if(this.opts.imageTypes.indexOf(file.type)==-1){this.upload.type="file"}if(this.opts.imageUpload===null&&this.opts.fileUpload!==null){this.upload.type="file"}},getHiddenFields:function(obj,fd){if(obj===false||typeof obj!=="object")return fd;$.each(obj,$.proxy(function(k,v){if(v!==null&&v.toString().indexOf("#")===0)v=$(v).val();fd.append(k,v)},this));return fd},sendData:function(formData,e){if(this.upload.type=="image"){formData=this.upload.getHiddenFields(this.opts.uploadImageFields,formData);formData=this.upload.getHiddenFields(this.upload.imageFields,formData)}else{formData=this.upload.getHiddenFields(this.opts.uploadFileFields,formData);formData=this.upload.getHiddenFields(this.upload.fileFields,formData)}var xhr=new XMLHttpRequest;xhr.open("POST",this.upload.url);xhr.setRequestHeader("X-Requested-With","XMLHttpRequest");xhr.onreadystatechange=$.proxy(function(){if(xhr.readyState==4){var data=xhr.responseText;data=data.replace(/^\[/,"");data=data.replace(/\]$/,"");var json;try{json=typeof data==="string"?$.parseJSON(data):data}catch(err){json={error:true}}this.progress.hide();if(!this.upload.direct){this.upload.$droparea.removeClass("drag-drop")}this.upload.callback(json,this.upload.direct,e)}},this);xhr.send(formData)},onDrag:function(e){e.preventDefault();this.upload.$droparea.addClass("drag-hover")},onDragLeave:function(e){e.preventDefault();this.upload.$droparea.removeClass("drag-hover")},clearImageFields:function(){this.upload.imageFields={}},addImageFields:function(name,value){this.upload.imageFields[name]=value},removeImageFields:function(name){delete this.upload.imageFields[name]},clearFileFields:function(){this.upload.fileFields={}},addFileFields:function(name,value){this.upload.fileFields[name]=value},removeFileFields:function(name){delete this.upload.fileFields[name]},s3uploadFile:function(file){this.upload.s3executeOnSignedUrl(file,$.proxy(function(signedURL){this.upload.s3uploadToS3(file,signedURL)},this))},s3executeOnSignedUrl:function(file,callback){var xhr=new XMLHttpRequest;var mark=this.opts.s3.search(/\?/)!=="-1"?"?":"&";xhr.open("GET",this.opts.s3+mark+"name="+file.name+"&type="+file.type,true);if(xhr.overrideMimeType)xhr.overrideMimeType("text/plain; charset=x-user-defined");var that=this;xhr.onreadystatechange=function(e){if(this.readyState==4&&this.status==200){that.progress.show();callback(decodeURIComponent(this.responseText))}else if(this.readyState==4&&this.status!=200){}};xhr.send()},s3createCORSRequest:function(method,url){var xhr=new XMLHttpRequest;if("withCredentials"in xhr){xhr.open(method,url,true)}else if(typeof XDomainRequest!="undefined"){xhr=new XDomainRequest;xhr.open(method,url)}else{xhr=null}return xhr},s3uploadToS3:function(file,url){var xhr=this.upload.s3createCORSRequest("PUT",url);if(!xhr){}else{xhr.onload=$.proxy(function(){if(xhr.status==200){this.progress.hide();var s3file=url.split("?");if(!s3file[0]){return false}if(!this.upload.direct){this.upload.$droparea.removeClass("drag-drop")}var json={filelink:s3file[0]};if(this.upload.type=="file"){var arr=s3file[0].split("/");json.filename=arr[arr.length-1]}this.upload.callback(json,this.upload.direct,false)}else{}},this);xhr.onerror=function(){};xhr.upload.onprogress=function(e){};xhr.setRequestHeader("Content-Type",file.type);xhr.setRequestHeader("x-amz-acl","public-read");xhr.send(file)}}}},utils:function(){return{isMobile:function(){return/(iPhone|iPod|BlackBerry|Android)/.test(navigator.userAgent)},isDesktop:function(){return!/(iPhone|iPod|iPad|BlackBerry|Android)/.test(navigator.userAgent)},isString:function(obj){return Object.prototype.toString.call(obj)=="[object String]"},isEmpty:function(html,removeEmptyTags){html=html.replace(/[\u200B-\u200D\uFEFF]/g,"");html=html.replace(/&nbsp;/gi,"");html=html.replace(/<\/?br\s?\/?>/g,"");html=html.replace(/\s/g,"");html=html.replace(/^<p>[^\W\w\D\d]*?<\/p>$/i,"");html=html.replace(/<iframe(.*?[^>])>$/i,"iframe");html=html.replace(/<source(.*?[^>])>$/i,"source");if(removeEmptyTags!==false){html=html.replace(/<[^\/>][^>]*><\/[^>]+>/gi,"");html=html.replace(/<[^\/>][^>]*><\/[^>]+>/gi,"")}html=$.trim(html);return html===""},normalize:function(str){if(typeof str==="undefined")return 0;return parseInt(str.replace("px",""),10)},hexToRgb:function(hex){if(typeof hex=="undefined")return;if(hex.search(/^#/)==-1)return hex;var shorthandRegex=/^#?([a-f\d])([a-f\d])([a-f\d])$/i;hex=hex.replace(shorthandRegex,function(m,r,g,b){return r+r+g+g+b+b});var result=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);return"rgb("+parseInt(result[1],16)+", "+parseInt(result[2],16)+", "+parseInt(result[3],16)+")"},getOuterHtml:function(el){return $("<div>").append($(el).eq(0).clone()).html()},getAlignmentElement:function(el){if($.inArray(el.tagName,this.opts.alignmentTags)!==-1){return $(el)}else{return $(el).closest(this.opts.alignmentTags.toString().toLowerCase(),this.$editor[0])}},removeEmptyAttr:function(el,attr){var $el=$(el);if(typeof $el.attr(attr)=="undefined"){return true}if($el.attr(attr)===""){$el.removeAttr(attr);return true}return false},removeEmpty:function(i,s){var $s=$($.parseHTML(s));$s.find(".redactor-invisible-space").removeAttr("style").removeAttr("class");if($s.find("hr, br, img, iframe, source").length!==0)return;var text=$.trim($s.text());if(this.utils.isEmpty(text,false)){$s.remove()}},saveScroll:function(){this.saveEditorScroll=this.$editor.scrollTop();this.saveBodyScroll=$(window).scrollTop();if(this.opts.scrollTarget)this.saveTargetScroll=$(this.opts.scrollTarget).scrollTop()},restoreScroll:function(){if(typeof this.saveScroll==="undefined"&&typeof this.saveBodyScroll==="undefined")return;$(window).scrollTop(this.saveBodyScroll);this.$editor.scrollTop(this.saveEditorScroll);if(this.opts.scrollTarget)$(this.opts.scrollTarget).scrollTop(this.saveTargetScroll)},createSpaceElement:function(){var space=document.createElement("span");space.className="redactor-invisible-space";space.innerHTML=this.opts.invisibleSpace;return space},removeInlineTags:function(node){var tags=this.opts.inlineTags;tags.push("span");if(node.tagName=="PRE")tags.push("a");$(node).find(tags.join(",")).not("span.redactor-selection-marker").contents().unwrap()},replaceWithContents:function(node,removeInlineTags){var self=this;$(node).replaceWith(function(){if(removeInlineTags===true)self.utils.removeInlineTags(this);return $(this).contents()});return $(node)},replaceToTag:function(node,tag,removeInlineTags){var replacement;var self=this;$(node).replaceWith(function(){replacement=$("<"+tag+" />").append($(this).contents());for(var i=0;i<this.attributes.length;i++){replacement.attr(this.attributes[i].name,this.attributes[i].value)}if(removeInlineTags===true)self.utils.removeInlineTags(replacement);return replacement});return replacement},isStartOfElement:function(){var block=this.selection.getBlock();if(!block)return false;var offset=this.caret.getOffsetOfElement(block);return offset===0?true:false},isEndOfElement:function(element){if(typeof element=="undefined"){var element=this.selection.getBlock();if(!element)return false}var offset=this.caret.getOffsetOfElement(element);var text=$.trim($(element).text()).replace(/\n\r\n/g,"");return offset==text.length?true:false},isStartOfEditor:function(){var offset=this.caret.getOffsetOfElement(this.$editor[0]);return offset===0?true:false},isEndOfEditor:function(){var block=this.$editor[0];var offset=this.caret.getOffsetOfElement(block);var text=$.trim($(block).html().replace(/(<([^>]+)>)/gi,""));return offset==text.length?true:false},isBlock:function(block){block=block[0]||block;return block&&this.utils.isBlockTag(block.tagName)},isBlockTag:function(tag){if(typeof tag=="undefined")return false;return this.reIsBlock.test(tag)},isTag:function(current,tag){var element=$(current).closest(tag,this.$editor[0]);if(element.length==1){return element[0]}return false},isSelectAll:function(){return this.selectAll},enableSelectAll:function(){this.selectAll=true},disableSelectAll:function(){this.selectAll=false},isRedactorParent:function(el){if(!el){return false}if($(el).parents(".redactor-editor").length===0||$(el).hasClass("redactor-editor")){return false}return el},isCurrentOrParentHeader:function(){return this.utils.isCurrentOrParent(["H1","H2","H3","H4","H5","H6"])},isCurrentOrParent:function(tagName){var parent=this.selection.getParent();var current=this.selection.getCurrent();if($.isArray(tagName)){var matched=0;$.each(tagName,$.proxy(function(i,s){if(this.utils.isCurrentOrParentOne(current,parent,s)){matched++}},this));return matched===0?false:true}else{return this.utils.isCurrentOrParentOne(current,parent,tagName)}},isCurrentOrParentOne:function(current,parent,tagName){tagName=tagName.toUpperCase();return parent&&parent.tagName===tagName?parent:current&&current.tagName===tagName?current:false},isOldIe:function(){return this.utils.browser("msie")&&parseInt(this.utils.browser("version"),10)<9?true:false},isLessIe10:function(){return this.utils.browser("msie")&&parseInt(this.utils.browser("version"),10)<10?true:false},isIe11:function(){return!!navigator.userAgent.match(/Trident\/7\./)},browser:function(browser){var ua=navigator.userAgent.toLowerCase();var match=/(opr)[\/]([\w.]+)/.exec(ua)||/(chrome)[ \/]([\w.]+)/.exec(ua)||/(webkit)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(ua)||/(webkit)[ \/]([\w.]+)/.exec(ua)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(ua)||/(msie) ([\w.]+)/.exec(ua)||ua.indexOf("trident")>=0&&/(rv)(?::| )([\w.]+)/.exec(ua)||ua.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(ua)||[];if(browser=="safari")return typeof match[3]!="undefined"?match[3]=="safari":false;if(browser=="version")return match[2];if(browser=="webkit")return match[1]=="chrome"||match[1]=="opr"||match[1]=="webkit";if(match[1]=="rv")return browser=="msie";if(match[1]=="opr")return browser=="webkit";return browser==match[1]},strpos:function(haystack,needle,offset){var i=haystack.indexOf(needle,offset);return i>=0?i:false},disableBodyScroll:function(){var $body=$("html");var windowWidth=window.innerWidth;if(!windowWidth){var documentElementRect=document.documentElement.getBoundingClientRect();windowWidth=documentElementRect.right-Math.abs(documentElementRect.left)}var isOverflowing=document.body.clientWidth<windowWidth;var scrollbarWidth=this.utils.measureScrollbar();$body.css("overflow","hidden");if(isOverflowing)$body.css("padding-right",scrollbarWidth)},measureScrollbar:function(){var $body=$("body");var scrollDiv=document.createElement("div");scrollDiv.className="redactor-scrollbar-measure";$body.append(scrollDiv);var scrollbarWidth=scrollDiv.offsetWidth-scrollDiv.clientWidth;$body[0].removeChild(scrollDiv);return scrollbarWidth},enableBodyScroll:function(){$("html").css({overflow:"","padding-right":""});$("body").remove("redactor-scrollbar-measure")}}}};$(window).on("load.tools.redactor",function(){$('[data-tools="redactor"]').redactor()});Redactor.prototype.init.prototype=Redactor.prototype})(jQuery);(function(window,$,undefined){var defaultOpts={beforeShow:noop,move:noop,change:noop,show:noop,hide:noop,color:false,flat:false,showInput:false,allowEmpty:false,showButtons:true,clickoutFiresChange:false,showInitial:false,showPalette:false,showPaletteOnly:false,showSelectionPalette:true,localStorageKey:false,appendTo:"body",maxSelectionSize:7,cancelText:"cancel",chooseText:"choose",clearText:"Clear Color Selection",preferredFormat:false,className:"",showAlpha:false,theme:"sp-light",palette:[["#ffffff","#000000","#ff0000","#ff8000","#ffff00","#008000","#0000ff","#4b0082","#9400d3"]],selectionPalette:[],disabled:false},spectrums=[],IE=!!/msie/i.exec(window.navigator.userAgent),rgbaSupport=function(){function contains(str,substr){return!!~(""+str).indexOf(substr)}var elem=document.createElement("div");var style=elem.style;style.cssText="background-color:rgba(0,0,0,.5)";return contains(style.backgroundColor,"rgba")||contains(style.backgroundColor,"hsla")}(),inputTypeColorSupport=function(){var colorInput=$("<input type='color' value='!' />")[0];return colorInput.type==="color"&&colorInput.value!=="!"}(),replaceInput=["<div class='sp-replacer'>","<div class='sp-preview'><div class='sp-preview-inner'></div></div>","<div class='sp-dd'>&#9660;</div>","</div>"].join(""),markup=function(){var gradientFix="";if(IE){for(var i=1;i<=6;i++){gradientFix+="<div class='sp-"+i+"'></div>"}}return["<div class='sp-container sp-hidden'>","<div class='sp-palette-container'>","<div class='sp-palette sp-thumb sp-cf'></div>","</div>","<div class='sp-picker-container'>","<div class='sp-top sp-cf'>","<div class='sp-fill'></div>","<div class='sp-top-inner'>","<div class='sp-color'>","<div class='sp-sat'>","<div class='sp-val'>","<div class='sp-dragger'></div>","</div>","</div>","</div>","<div class='sp-clear sp-clear-display'>","</div>","<div class='sp-hue'>","<div class='sp-slider'></div>",gradientFix,"</div>","</div>","<div class='sp-alpha'><div class='sp-alpha-inner'><div class='sp-alpha-handle'></div></div></div>","</div>","<div class='sp-input-container sp-cf'>","<input class='sp-input' type='text' spellcheck='false'  />","</div>","<div class='sp-initial sp-thumb sp-cf'></div>","<div class='sp-button-container sp-cf'>","<a class='sp-cancel' href='#'></a>","<button class='sp-choose'></button>","</div>","</div>","</div>"].join("")}();function paletteTemplate(p,color,className){var html=[];for(var i=0;i<p.length;i++){var current=p[i];if(current){var tiny=tinycolor(current);var c=tiny.toHsl().l<.5?"sp-thumb-el sp-thumb-dark":"sp-thumb-el sp-thumb-light";c+=tinycolor.equals(color,current)?" sp-thumb-active":"";var swatchStyle=rgbaSupport?"background-color:"+tiny.toRgbString():"filter:"+tiny.toFilter();html.push('<span title="'+tiny.toRgbString()+'" data-color="'+tiny.toRgbString()+'" class="'+c+'"><span class="sp-thumb-inner" style="'+swatchStyle+';" /></span>')}else{var cls="sp-clear-display";html.push('<span title="No Color Selected" data-color="" style="background-color:transparent;" class="'+cls+'"></span>')}}return"<div class='sp-cf "+className+"'>"+html.join("")+"</div>"}function hideAll(){for(var i=0;i<spectrums.length;i++){if(spectrums[i]){spectrums[i].hide()}}}function instanceOptions(o,callbackContext){var opts=$.extend({},defaultOpts,o);opts.callbacks={move:bind(opts.move,callbackContext),change:bind(opts.change,callbackContext),show:bind(opts.show,callbackContext),hide:bind(opts.hide,callbackContext),beforeShow:bind(opts.beforeShow,callbackContext)};return opts}function spectrum(element,o){var opts=instanceOptions(o,element),flat=opts.flat,showSelectionPalette=opts.showSelectionPalette,localStorageKey=opts.localStorageKey,theme=opts.theme,callbacks=opts.callbacks,resize=throttle(reflow,10),visible=false,dragWidth=0,dragHeight=0,dragHelperHeight=0,slideHeight=0,slideWidth=0,alphaWidth=0,alphaSlideHelperWidth=0,slideHelperHeight=0,currentHue=0,currentSaturation=0,currentValue=0,currentAlpha=1,palette=[],paletteArray=[],paletteLookup={},selectionPalette=opts.selectionPalette.slice(0),maxSelectionSize=opts.maxSelectionSize,draggingClass="sp-dragging",shiftMovementDirection=null;var doc=element.ownerDocument,body=doc.body,boundElement=$(element),disabled=false,container=$(markup,doc).addClass(theme),dragger=container.find(".sp-color"),dragHelper=container.find(".sp-dragger"),slider=container.find(".sp-hue"),slideHelper=container.find(".sp-slider"),alphaSliderInner=container.find(".sp-alpha-inner"),alphaSlider=container.find(".sp-alpha"),alphaSlideHelper=container.find(".sp-alpha-handle"),textInput=container.find(".sp-input"),paletteContainer=container.find(".sp-palette"),initialColorContainer=container.find(".sp-initial"),cancelButton=container.find(".sp-cancel"),clearButton=container.find(".sp-clear"),chooseButton=container.find(".sp-choose"),isInput=boundElement.is("input"),isInputTypeColor=isInput&&inputTypeColorSupport&&boundElement.attr("type")==="color",shouldReplace=isInput&&!flat,replacer=shouldReplace?$(replaceInput).addClass(theme).addClass(opts.className):$([]),offsetElement=shouldReplace?replacer:boundElement,previewElement=replacer.find(".sp-preview-inner"),initialColor=opts.color||isInput&&boundElement.val(),colorOnShow=false,preferredFormat=opts.preferredFormat,currentPreferredFormat=preferredFormat,clickoutFiresChange=!opts.showButtons||opts.clickoutFiresChange,isEmpty=!initialColor,allowEmpty=opts.allowEmpty&&!isInputTypeColor;function applyOptions(){if(opts.showPaletteOnly){opts.showPalette=true}if(opts.palette){palette=opts.palette.slice(0);paletteArray=$.isArray(palette[0])?palette:[palette];paletteLookup={};for(var i=0;i<paletteArray.length;i++){for(var j=0;j<paletteArray[i].length;j++){var rgb=tinycolor(paletteArray[i][j]).toRgbString();paletteLookup[rgb]=true}}}container.toggleClass("sp-flat",flat);container.toggleClass("sp-input-disabled",!opts.showInput);container.toggleClass("sp-alpha-enabled",opts.showAlpha);container.toggleClass("sp-clear-enabled",allowEmpty);container.toggleClass("sp-buttons-disabled",!opts.showButtons);container.toggleClass("sp-palette-disabled",!opts.showPalette);container.toggleClass("sp-palette-only",opts.showPaletteOnly);container.toggleClass("sp-initial-disabled",!opts.showInitial);container.addClass(opts.className);reflow()}function initialize(){if(IE){container.find("*:not(input)").attr("unselectable","on")}applyOptions();if(shouldReplace){boundElement.after(replacer).hide()}if(!allowEmpty){clearButton.hide()}if(flat){boundElement.after(container).hide()}else{var appendTo=opts.appendTo==="parent"?boundElement.parent():$(opts.appendTo);if(appendTo.length!==1){appendTo=$("body")}appendTo.append(container)}updateSelectionPaletteFromStorage();offsetElement.bind("click.spectrum touchstart.spectrum",function(e){if(!disabled){toggle()}e.stopPropagation();if(!$(e.target).is("input")){e.preventDefault()}});if(boundElement.is(":disabled")||opts.disabled===true){disable()}container.click(stopPropagation);textInput.change(setFromTextInput);textInput.bind("paste",function(){setTimeout(setFromTextInput,1)});textInput.keydown(function(e){if(e.keyCode==13){setFromTextInput()}});cancelButton.text(opts.cancelText);cancelButton.bind("click.spectrum",function(e){e.stopPropagation();e.preventDefault();hide("cancel")});clearButton.attr("title",opts.clearText);clearButton.bind("click.spectrum",function(e){e.stopPropagation();e.preventDefault();isEmpty=true;move();if(flat){updateOriginalInput(true)}});chooseButton.text(opts.chooseText);chooseButton.bind("click.spectrum",function(e){e.stopPropagation();e.preventDefault();if(isValid()){updateOriginalInput(true);hide()}});draggable(alphaSlider,function(dragX,dragY,e){currentAlpha=dragX/alphaWidth;isEmpty=false;if(e.shiftKey){currentAlpha=Math.round(currentAlpha*10)/10}move()},dragStart,dragStop);draggable(slider,function(dragX,dragY){currentHue=parseFloat(dragY/slideHeight);isEmpty=false;if(!opts.showAlpha){currentAlpha=1}move()},dragStart,dragStop);draggable(dragger,function(dragX,dragY,e){if(!e.shiftKey){shiftMovementDirection=null}else if(!shiftMovementDirection){var oldDragX=currentSaturation*dragWidth;var oldDragY=dragHeight-currentValue*dragHeight;var furtherFromX=Math.abs(dragX-oldDragX)>Math.abs(dragY-oldDragY);shiftMovementDirection=furtherFromX?"x":"y"}var setSaturation=!shiftMovementDirection||shiftMovementDirection==="x";var setValue=!shiftMovementDirection||shiftMovementDirection==="y";if(setSaturation){currentSaturation=parseFloat(dragX/dragWidth)}if(setValue){currentValue=parseFloat((dragHeight-dragY)/dragHeight)}isEmpty=false;if(!opts.showAlpha){currentAlpha=1}move()},dragStart,dragStop);if(!!initialColor){set(initialColor);updateUI();currentPreferredFormat=preferredFormat||tinycolor(initialColor).format;addColorToSelectionPalette(initialColor)}else{updateUI()}if(flat){show()}function palletElementClick(e){if(e.data&&e.data.ignore){set($(this).data("color"));move()}else{set($(this).data("color"));move();updateOriginalInput(true);hide()}return false}var paletteEvent=IE?"mousedown.spectrum":"click.spectrum touchstart.spectrum";paletteContainer.delegate(".sp-thumb-el",paletteEvent,palletElementClick);initialColorContainer.delegate(".sp-thumb-el:nth-child(1)",paletteEvent,{ignore:true},palletElementClick)}function updateSelectionPaletteFromStorage(){if(localStorageKey&&window.localStorage){try{var oldPalette=window.localStorage[localStorageKey].split(",#");if(oldPalette.length>1){delete window.localStorage[localStorageKey];$.each(oldPalette,function(i,c){addColorToSelectionPalette(c)})}}catch(e){}try{selectionPalette=window.localStorage[localStorageKey].split(";")}catch(e){}}}function addColorToSelectionPalette(color){if(showSelectionPalette){var rgb=tinycolor(color).toRgbString();if(!paletteLookup[rgb]&&$.inArray(rgb,selectionPalette)===-1){selectionPalette.push(rgb);while(selectionPalette.length>maxSelectionSize){selectionPalette.shift()}}if(localStorageKey&&window.localStorage){try{window.localStorage[localStorageKey]=selectionPalette.join(";")}catch(e){}}}}function getUniqueSelectionPalette(){var unique=[];if(opts.showPalette){for(i=0;i<selectionPalette.length;i++){var rgb=tinycolor(selectionPalette[i]).toRgbString();if(!paletteLookup[rgb]){unique.push(selectionPalette[i])}}}return unique.reverse().slice(0,opts.maxSelectionSize)}function drawPalette(){var currentColor=get();var html=$.map(paletteArray,function(palette,i){return paletteTemplate(palette,currentColor,"sp-palette-row sp-palette-row-"+i)});updateSelectionPaletteFromStorage();if(selectionPalette){html.push(paletteTemplate(getUniqueSelectionPalette(),currentColor,"sp-palette-row sp-palette-row-selection"))}paletteContainer.html(html.join(""))}function drawInitial(){if(opts.showInitial){var initial=colorOnShow;var current=get();initialColorContainer.html(paletteTemplate([initial,current],current,"sp-palette-row-initial"))}}function dragStart(){if(dragHeight<=0||dragWidth<=0||slideHeight<=0){reflow()}container.addClass(draggingClass);shiftMovementDirection=null;boundElement.trigger("dragstart.spectrum",[get()])}function dragStop(){container.removeClass(draggingClass);boundElement.trigger("dragstop.spectrum",[get()])}function setFromTextInput(){var value=textInput.val();if((value===null||value==="")&&allowEmpty){set(null);updateOriginalInput(true)}else{var tiny=tinycolor(value);if(tiny.ok){set(tiny);updateOriginalInput(true)}else{textInput.addClass("sp-validation-error")}}}function toggle(){if(visible){hide()}else{show()}}function show(){var event=$.Event("beforeShow.spectrum");if(visible){reflow();return}boundElement.trigger(event,[get()]);if(callbacks.beforeShow(get())===false||event.isDefaultPrevented()){return}hideAll();visible=true;$(doc).bind("click.spectrum",hide);$(window).bind("resize.spectrum",resize);replacer.addClass("sp-active");container.removeClass("sp-hidden");reflow();updateUI();colorOnShow=get();drawInitial();callbacks.show(colorOnShow);boundElement.trigger("show.spectrum",[colorOnShow])}function hide(e){if(e&&e.type=="click"&&e.button==2){return}if(!visible||flat){return}visible=false;$(doc).unbind("click.spectrum",hide);$(window).unbind("resize.spectrum",resize);replacer.removeClass("sp-active");container.addClass("sp-hidden");var colorHasChanged=!tinycolor.equals(get(),colorOnShow);if(colorHasChanged){if(clickoutFiresChange&&e!=="cancel"){updateOriginalInput(true)}else{revert()}}callbacks.hide(get());boundElement.trigger("hide.spectrum",[get()])}function revert(){set(colorOnShow,true)}function set(color,ignoreFormatChange){if(tinycolor.equals(color,get())){updateUI();return}var newColor,newHsv;if(!color&&allowEmpty){isEmpty=true}else{isEmpty=false;newColor=tinycolor(color);newHsv=newColor.toHsv();currentHue=newHsv.h%360/360;currentSaturation=newHsv.s;currentValue=newHsv.v;currentAlpha=newHsv.a}updateUI();if(newColor&&newColor.ok&&!ignoreFormatChange){currentPreferredFormat=preferredFormat||newColor.format}}function get(opts){opts=opts||{};if(allowEmpty&&isEmpty){return null}return tinycolor.fromRatio({h:currentHue,s:currentSaturation,v:currentValue,a:Math.round(currentAlpha*100)/100},{format:opts.format||currentPreferredFormat})}function isValid(){return!textInput.hasClass("sp-validation-error")}function move(){updateUI();callbacks.move(get());boundElement.trigger("move.spectrum",[get()])}function updateUI(){textInput.removeClass("sp-validation-error");updateHelperLocations();var flatColor=tinycolor.fromRatio({h:currentHue,s:1,v:1});dragger.css("background-color",flatColor.toHexString());var format=currentPreferredFormat;if(currentAlpha<1&&!(currentAlpha===0&&format==="name")){if(format==="hex"||format==="hex3"||format==="hex6"||format==="name"){format="rgb"}}var realColor=get({format:format}),displayColor="";previewElement.removeClass("sp-clear-display");previewElement.css("background-color","transparent");if(!realColor&&allowEmpty){previewElement.addClass("sp-clear-display")}else{var realHex=realColor.toHexString(),realRgb=realColor.toRgbString();if(rgbaSupport||realColor.alpha===1){previewElement.css("background-color",realRgb)}else{previewElement.css("background-color","transparent");previewElement.css("filter",realColor.toFilter())}if(opts.showAlpha){var rgb=realColor.toRgb();rgb.a=0;var realAlpha=tinycolor(rgb).toRgbString();var gradient="linear-gradient(left, "+realAlpha+", "+realHex+")";if(IE){alphaSliderInner.css("filter",tinycolor(realAlpha).toFilter({gradientType:1},realHex))}else{alphaSliderInner.css("background","-webkit-"+gradient);alphaSliderInner.css("background","-moz-"+gradient);alphaSliderInner.css("background","-ms-"+gradient);alphaSliderInner.css("background","linear-gradient(to right, "+realAlpha+", "+realHex+")")}}displayColor=realColor.toString(format)}if(opts.showInput){textInput.val(displayColor)}if(opts.showPalette){drawPalette()}drawInitial()}function updateHelperLocations(){var s=currentSaturation;var v=currentValue;if(allowEmpty&&isEmpty){alphaSlideHelper.hide();slideHelper.hide();dragHelper.hide()}else{alphaSlideHelper.show();
slideHelper.show();dragHelper.show();var dragX=s*dragWidth;var dragY=dragHeight-v*dragHeight;dragX=Math.max(-dragHelperHeight,Math.min(dragWidth-dragHelperHeight,dragX-dragHelperHeight));dragY=Math.max(-dragHelperHeight,Math.min(dragHeight-dragHelperHeight,dragY-dragHelperHeight));dragHelper.css({top:dragY+"px",left:dragX+"px"});var alphaX=currentAlpha*alphaWidth;alphaSlideHelper.css({left:alphaX-alphaSlideHelperWidth/2+"px"});var slideY=currentHue*slideHeight;slideHelper.css({top:slideY-slideHelperHeight+"px"})}}function updateOriginalInput(fireCallback){var color=get(),displayColor="",hasChanged=!tinycolor.equals(color,colorOnShow);if(color){displayColor=color.toString(currentPreferredFormat);addColorToSelectionPalette(color)}if(isInput){boundElement.val(displayColor)}colorOnShow=color;if(fireCallback&&hasChanged){callbacks.change(color);boundElement.trigger("change",[color])}}function reflow(){dragWidth=dragger.width();dragHeight=dragger.height();dragHelperHeight=dragHelper.height();slideWidth=slider.width();slideHeight=slider.height();slideHelperHeight=slideHelper.height();alphaWidth=alphaSlider.width();alphaSlideHelperWidth=alphaSlideHelper.width();if(!flat){container.css("position","absolute");container.offset(getOffset(container,offsetElement))}updateHelperLocations();if(opts.showPalette){drawPalette()}boundElement.trigger("reflow.spectrum")}function destroy(){boundElement.show();offsetElement.unbind("click.spectrum touchstart.spectrum");container.remove();replacer.remove();spectrums[spect.id]=null}function option(optionName,optionValue){if(optionName===undefined){return $.extend({},opts)}if(optionValue===undefined){return opts[optionName]}opts[optionName]=optionValue;applyOptions()}function enable(){disabled=false;boundElement.attr("disabled",false);offsetElement.removeClass("sp-disabled")}function disable(){hide();disabled=true;boundElement.attr("disabled",true);offsetElement.addClass("sp-disabled")}initialize();var spect={show:show,hide:hide,toggle:toggle,reflow:reflow,option:option,enable:enable,disable:disable,set:function(c){set(c);updateOriginalInput()},get:get,destroy:destroy,container:container};spect.id=spectrums.push(spect)-1;return spect}function getOffset(picker,input){var extraY=0;var dpWidth=picker.outerWidth();var dpHeight=picker.outerHeight();var inputHeight=input.outerHeight();var doc=picker[0].ownerDocument;var docElem=doc.documentElement;var viewWidth=docElem.clientWidth+$(doc).scrollLeft();var viewHeight=docElem.clientHeight+$(doc).scrollTop();var offset=input.offset();offset.top+=inputHeight;offset.left-=Math.min(offset.left,offset.left+dpWidth>viewWidth&&viewWidth>dpWidth?Math.abs(offset.left+dpWidth-viewWidth):0);offset.top-=Math.min(offset.top,offset.top+dpHeight>viewHeight&&viewHeight>dpHeight?Math.abs(dpHeight+inputHeight-extraY):extraY);return offset}function noop(){}function stopPropagation(e){e.stopPropagation()}function bind(func,obj){var slice=Array.prototype.slice;var args=slice.call(arguments,2);return function(){return func.apply(obj,args.concat(slice.call(arguments)))}}function draggable(element,onmove,onstart,onstop){onmove=onmove||function(){};onstart=onstart||function(){};onstop=onstop||function(){};var doc=element.ownerDocument||document;var dragging=false;var offset={};var maxHeight=0;var maxWidth=0;var hasTouch="ontouchstart"in window;var duringDragEvents={};duringDragEvents["selectstart"]=prevent;duringDragEvents["dragstart"]=prevent;duringDragEvents["touchmove mousemove"]=move;duringDragEvents["touchend mouseup"]=stop;function prevent(e){if(e.stopPropagation){e.stopPropagation()}if(e.preventDefault){e.preventDefault()}e.returnValue=false}function move(e){if(dragging){if(IE&&document.documentMode<9&&!e.button){return stop()}var touches=e.originalEvent.touches;var pageX=touches?touches[0].pageX:e.pageX;var pageY=touches?touches[0].pageY:e.pageY;var dragX=Math.max(0,Math.min(pageX-offset.left,maxWidth));var dragY=Math.max(0,Math.min(pageY-offset.top,maxHeight));if(hasTouch){prevent(e)}onmove.apply(element,[dragX,dragY,e])}}function start(e){var rightclick=e.which?e.which==3:e.button==2;var touches=e.originalEvent.touches;if(!rightclick&&!dragging){if(onstart.apply(element,arguments)!==false){dragging=true;maxHeight=$(element).height();maxWidth=$(element).width();offset=$(element).offset();$(doc).bind(duringDragEvents);$(doc.body).addClass("sp-dragging");if(!hasTouch){move(e)}prevent(e)}}}function stop(){if(dragging){$(doc).unbind(duringDragEvents);$(doc.body).removeClass("sp-dragging");onstop.apply(element,arguments)}dragging=false}$(element).bind("touchstart mousedown",start)}function throttle(func,wait,debounce){var timeout;return function(){var context=this,args=arguments;var throttler=function(){timeout=null;func.apply(context,args)};if(debounce)clearTimeout(timeout);if(debounce||!timeout)timeout=setTimeout(throttler,wait)}}function log(){if(window.console){if(Function.prototype.bind)log=Function.prototype.bind.call(console.log,console);else log=function(){Function.prototype.apply.call(console.log,console,arguments)};log.apply(this,arguments)}}var dataID="spectrum.id";$.fn.spectrum=function(opts,extra){if(typeof opts=="string"){var returnValue=this;var args=Array.prototype.slice.call(arguments,1);this.each(function(){var spect=spectrums[$(this).data(dataID)];if(spect){var method=spect[opts];if(!method){throw new Error("Spectrum: no such method: '"+opts+"'")}if(opts=="get"){returnValue=spect.get()}else if(opts=="container"){returnValue=spect.container}else if(opts=="option"){returnValue=spect.option.apply(spect,args)}else if(opts=="destroy"){spect.destroy();$(this).removeData(dataID)}else{method.apply(spect,args)}}});return returnValue}return this.spectrum("destroy").each(function(){var options=$.extend({},opts,$(this).data());var spect=spectrum(this,options);$(this).data(dataID,spect.id)})};$.fn.spectrum.load=true;$.fn.spectrum.loadOpts={};$.fn.spectrum.draggable=draggable;$.fn.spectrum.defaults=defaultOpts;$.spectrum={};$.spectrum.localization={};$.spectrum.palettes={};$.fn.spectrum.processNativeColorInputs=function(){if(!inputTypeColorSupport){$("input[type=color]").spectrum({preferredFormat:"hex6"})}};(function(){var trimLeft=/^[\s,#]+/,trimRight=/\s+$/,tinyCounter=0,math=Math,mathRound=math.round,mathMin=math.min,mathMax=math.max,mathRandom=math.random;function tinycolor(color,opts){color=color?color:"";opts=opts||{};if(typeof color=="object"&&color.hasOwnProperty("_tc_id")){return color}var rgb=inputToRGB(color);var r=rgb.r,g=rgb.g,b=rgb.b,a=rgb.a,roundA=mathRound(100*a)/100,format=opts.format||rgb.format;if(r<1){r=mathRound(r)}if(g<1){g=mathRound(g)}if(b<1){b=mathRound(b)}return{ok:rgb.ok,format:format,_tc_id:tinyCounter++,alpha:a,getAlpha:function(){return a},setAlpha:function(value){a=boundAlpha(value);roundA=mathRound(100*a)/100},toHsv:function(){var hsv=rgbToHsv(r,g,b);return{h:hsv.h*360,s:hsv.s,v:hsv.v,a:a}},toHsvString:function(){var hsv=rgbToHsv(r,g,b);var h=mathRound(hsv.h*360),s=mathRound(hsv.s*100),v=mathRound(hsv.v*100);return a==1?"hsv("+h+", "+s+"%, "+v+"%)":"hsva("+h+", "+s+"%, "+v+"%, "+roundA+")"},toHsl:function(){var hsl=rgbToHsl(r,g,b);return{h:hsl.h*360,s:hsl.s,l:hsl.l,a:a}},toHslString:function(){var hsl=rgbToHsl(r,g,b);var h=mathRound(hsl.h*360),s=mathRound(hsl.s*100),l=mathRound(hsl.l*100);return a==1?"hsl("+h+", "+s+"%, "+l+"%)":"hsla("+h+", "+s+"%, "+l+"%, "+roundA+")"},toHex:function(allow3Char){return rgbToHex(r,g,b,allow3Char)},toHexString:function(allow3Char){return"#"+this.toHex(allow3Char)},toHex8:function(){return rgbaToHex(r,g,b,a)},toHex8String:function(){return"#"+this.toHex8()},toRgb:function(){return{r:mathRound(r),g:mathRound(g),b:mathRound(b),a:a}},toRgbString:function(){return a==1?"rgb("+mathRound(r)+", "+mathRound(g)+", "+mathRound(b)+")":"rgba("+mathRound(r)+", "+mathRound(g)+", "+mathRound(b)+", "+roundA+")"},toPercentageRgb:function(){return{r:mathRound(bound01(r,255)*100)+"%",g:mathRound(bound01(g,255)*100)+"%",b:mathRound(bound01(b,255)*100)+"%",a:a}},toPercentageRgbString:function(){return a==1?"rgb("+mathRound(bound01(r,255)*100)+"%, "+mathRound(bound01(g,255)*100)+"%, "+mathRound(bound01(b,255)*100)+"%)":"rgba("+mathRound(bound01(r,255)*100)+"%, "+mathRound(bound01(g,255)*100)+"%, "+mathRound(bound01(b,255)*100)+"%, "+roundA+")"},toName:function(){if(a===0){return"transparent"}return hexNames[rgbToHex(r,g,b,true)]||false},toFilter:function(secondColor){var hex8String="#"+rgbaToHex(r,g,b,a);var secondHex8String=hex8String;var gradientType=opts&&opts.gradientType?"GradientType = 1, ":"";if(secondColor){var s=tinycolor(secondColor);secondHex8String=s.toHex8String()}return"progid:DXImageTransform.Microsoft.gradient("+gradientType+"startColorstr="+hex8String+",endColorstr="+secondHex8String+")"},toString:function(format){var formatSet=!!format;format=format||this.format;var formattedString=false;var hasAlphaAndFormatNotSet=!formatSet&&a<1&&a>0;var formatWithAlpha=hasAlphaAndFormatNotSet&&(format==="hex"||format==="hex6"||format==="hex3"||format==="name");if(format==="rgb"){formattedString=this.toRgbString()}if(format==="prgb"){formattedString=this.toPercentageRgbString()}if(format==="hex"||format==="hex6"){formattedString=this.toHexString()}if(format==="hex3"){formattedString=this.toHexString(true)}if(format==="hex8"){formattedString=this.toHex8String()}if(format==="name"){formattedString=this.toName()}if(format==="hsl"){formattedString=this.toHslString()}if(format==="hsv"){formattedString=this.toHsvString()}if(formatWithAlpha){return this.toRgbString()}return formattedString||this.toHexString()}}}tinycolor.fromRatio=function(color,opts){if(typeof color=="object"){var newColor={};for(var i in color){if(color.hasOwnProperty(i)){if(i==="a"){newColor[i]=color[i]}else{newColor[i]=convertToPercentage(color[i])}}}color=newColor}return tinycolor(color,opts)};function inputToRGB(color){var rgb={r:0,g:0,b:0};var a=1;var ok=false;var format=false;if(typeof color=="string"){color=stringInputToObject(color)}if(typeof color=="object"){if(color.hasOwnProperty("r")&&color.hasOwnProperty("g")&&color.hasOwnProperty("b")){rgb=rgbToRgb(color.r,color.g,color.b);ok=true;format=String(color.r).substr(-1)==="%"?"prgb":"rgb"}else if(color.hasOwnProperty("h")&&color.hasOwnProperty("s")&&color.hasOwnProperty("v")){color.s=convertToPercentage(color.s);color.v=convertToPercentage(color.v);rgb=hsvToRgb(color.h,color.s,color.v);ok=true;format="hsv"}else if(color.hasOwnProperty("h")&&color.hasOwnProperty("s")&&color.hasOwnProperty("l")){color.s=convertToPercentage(color.s);color.l=convertToPercentage(color.l);rgb=hslToRgb(color.h,color.s,color.l);ok=true;format="hsl"}if(color.hasOwnProperty("a")){a=color.a}}a=boundAlpha(a);return{ok:ok,format:color.format||format,r:mathMin(255,mathMax(rgb.r,0)),g:mathMin(255,mathMax(rgb.g,0)),b:mathMin(255,mathMax(rgb.b,0)),a:a}}function rgbToRgb(r,g,b){return{r:bound01(r,255)*255,g:bound01(g,255)*255,b:bound01(b,255)*255}}function rgbToHsl(r,g,b){r=bound01(r,255);g=bound01(g,255);b=bound01(b,255);var max=mathMax(r,g,b),min=mathMin(r,g,b);var h,s,l=(max+min)/2;if(max==min){h=s=0}else{var d=max-min;s=l>.5?d/(2-max-min):d/(max+min);switch(max){case r:h=(g-b)/d+(g<b?6:0);break;case g:h=(b-r)/d+2;break;case b:h=(r-g)/d+4;break}h/=6}return{h:h,s:s,l:l}}function hslToRgb(h,s,l){var r,g,b;h=bound01(h,360);s=bound01(s,100);l=bound01(l,100);function hue2rgb(p,q,t){if(t<0)t+=1;if(t>1)t-=1;if(t<1/6)return p+(q-p)*6*t;if(t<1/2)return q;if(t<2/3)return p+(q-p)*(2/3-t)*6;return p}if(s===0){r=g=b=l}else{var q=l<.5?l*(1+s):l+s-l*s;var p=2*l-q;r=hue2rgb(p,q,h+1/3);g=hue2rgb(p,q,h);b=hue2rgb(p,q,h-1/3)}return{r:r*255,g:g*255,b:b*255}}function rgbToHsv(r,g,b){r=bound01(r,255);g=bound01(g,255);b=bound01(b,255);var max=mathMax(r,g,b),min=mathMin(r,g,b);var h,s,v=max;var d=max-min;s=max===0?0:d/max;if(max==min){h=0}else{switch(max){case r:h=(g-b)/d+(g<b?6:0);break;case g:h=(b-r)/d+2;break;case b:h=(r-g)/d+4;break}h/=6}return{h:h,s:s,v:v}}function hsvToRgb(h,s,v){h=bound01(h,360)*6;s=bound01(s,100);v=bound01(v,100);var i=math.floor(h),f=h-i,p=v*(1-s),q=v*(1-f*s),t=v*(1-(1-f)*s),mod=i%6,r=[v,q,p,p,t,v][mod],g=[t,v,v,q,p,p][mod],b=[p,p,t,v,v,q][mod];return{r:r*255,g:g*255,b:b*255}}function rgbToHex(r,g,b,allow3Char){var hex=[pad2(mathRound(r).toString(16)),pad2(mathRound(g).toString(16)),pad2(mathRound(b).toString(16))];if(allow3Char&&hex[0].charAt(0)==hex[0].charAt(1)&&hex[1].charAt(0)==hex[1].charAt(1)&&hex[2].charAt(0)==hex[2].charAt(1)){return hex[0].charAt(0)+hex[1].charAt(0)+hex[2].charAt(0)}return hex.join("")}function rgbaToHex(r,g,b,a){var hex=[pad2(convertDecimalToHex(a)),pad2(mathRound(r).toString(16)),pad2(mathRound(g).toString(16)),pad2(mathRound(b).toString(16))];return hex.join("")}tinycolor.equals=function(color1,color2){if(!color1||!color2){return false}return tinycolor(color1).toRgbString()==tinycolor(color2).toRgbString()};tinycolor.random=function(){return tinycolor.fromRatio({r:mathRandom(),g:mathRandom(),b:mathRandom()})};tinycolor.desaturate=function(color,amount){amount=amount===0?0:amount||10;var hsl=tinycolor(color).toHsl();hsl.s-=amount/100;hsl.s=clamp01(hsl.s);return tinycolor(hsl)};tinycolor.saturate=function(color,amount){amount=amount===0?0:amount||10;var hsl=tinycolor(color).toHsl();hsl.s+=amount/100;hsl.s=clamp01(hsl.s);return tinycolor(hsl)};tinycolor.greyscale=function(color){return tinycolor.desaturate(color,100)};tinycolor.lighten=function(color,amount){amount=amount===0?0:amount||10;var hsl=tinycolor(color).toHsl();hsl.l+=amount/100;hsl.l=clamp01(hsl.l);return tinycolor(hsl)};tinycolor.darken=function(color,amount){amount=amount===0?0:amount||10;var hsl=tinycolor(color).toHsl();hsl.l-=amount/100;hsl.l=clamp01(hsl.l);return tinycolor(hsl)};tinycolor.complement=function(color){var hsl=tinycolor(color).toHsl();hsl.h=(hsl.h+180)%360;return tinycolor(hsl)};tinycolor.triad=function(color){var hsl=tinycolor(color).toHsl();var h=hsl.h;return[tinycolor(color),tinycolor({h:(h+120)%360,s:hsl.s,l:hsl.l}),tinycolor({h:(h+240)%360,s:hsl.s,l:hsl.l})]};tinycolor.tetrad=function(color){var hsl=tinycolor(color).toHsl();var h=hsl.h;return[tinycolor(color),tinycolor({h:(h+90)%360,s:hsl.s,l:hsl.l}),tinycolor({h:(h+180)%360,s:hsl.s,l:hsl.l}),tinycolor({h:(h+270)%360,s:hsl.s,l:hsl.l})]};tinycolor.splitcomplement=function(color){var hsl=tinycolor(color).toHsl();var h=hsl.h;return[tinycolor(color),tinycolor({h:(h+72)%360,s:hsl.s,l:hsl.l}),tinycolor({h:(h+216)%360,s:hsl.s,l:hsl.l})]};tinycolor.analogous=function(color,results,slices){results=results||6;slices=slices||30;var hsl=tinycolor(color).toHsl();var part=360/slices;var ret=[tinycolor(color)];for(hsl.h=(hsl.h-(part*results>>1)+720)%360;--results;){hsl.h=(hsl.h+part)%360;ret.push(tinycolor(hsl))}return ret};tinycolor.monochromatic=function(color,results){results=results||6;var hsv=tinycolor(color).toHsv();var h=hsv.h,s=hsv.s,v=hsv.v;var ret=[];var modification=1/results;while(results--){ret.push(tinycolor({h:h,s:s,v:v}));v=(v+modification)%1}return ret};tinycolor.readability=function(color1,color2){var a=tinycolor(color1).toRgb();var b=tinycolor(color2).toRgb();var brightnessA=(a.r*299+a.g*587+a.b*114)/1e3;var brightnessB=(b.r*299+b.g*587+b.b*114)/1e3;var colorDiff=Math.max(a.r,b.r)-Math.min(a.r,b.r)+Math.max(a.g,b.g)-Math.min(a.g,b.g)+Math.max(a.b,b.b)-Math.min(a.b,b.b);return{brightness:Math.abs(brightnessA-brightnessB),color:colorDiff}};tinycolor.readable=function(color1,color2){var readability=tinycolor.readability(color1,color2);return readability.brightness>125&&readability.color>500};tinycolor.mostReadable=function(baseColor,colorList){var bestColor=null;var bestScore=0;var bestIsReadable=false;for(var i=0;i<colorList.length;i++){var readability=tinycolor.readability(baseColor,colorList[i]);var readable=readability.brightness>125&&readability.color>500;var score=3*(readability.brightness/125)+readability.color/500;if(readable&&!bestIsReadable||readable&&bestIsReadable&&score>bestScore||!readable&&!bestIsReadable&&score>bestScore){bestIsReadable=readable;bestScore=score;bestColor=tinycolor(colorList[i])}}return bestColor};var names=tinycolor.names={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"0ff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000",blanchedalmond:"ffebcd",blue:"00f",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",burntsienna:"ea7e5d",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"0ff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkgrey:"a9a9a9",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkslategrey:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dimgrey:"696969",dodgerblue:"1e90ff",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"f0f",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",grey:"808080",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgray:"d3d3d3",lightgreen:"90ee90",lightgrey:"d3d3d3",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslategray:"789",lightslategrey:"789",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"0f0",limegreen:"32cd32",linen:"faf0e6",magenta:"f0f",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370db",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"db7093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",red:"f00",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",slategrey:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",wheat:"f5deb3",white:"fff",whitesmoke:"f5f5f5",yellow:"ff0",yellowgreen:"9acd32"};var hexNames=tinycolor.hexNames=flip(names);function flip(o){var flipped={};for(var i in o){if(o.hasOwnProperty(i)){flipped[o[i]]=i}}return flipped}function boundAlpha(a){a=parseFloat(a);if(isNaN(a)||a<0||a>1){a=1}return a}function bound01(n,max){if(isOnePointZero(n)){n="100%"}var processPercent=isPercentage(n);n=mathMin(max,mathMax(0,parseFloat(n)));if(processPercent){n=parseInt(n*max,10)/100}if(math.abs(n-max)<1e-6){return 1}return n%max/parseFloat(max)}function clamp01(val){return mathMin(1,mathMax(0,val))}function parseIntFromHex(val){return parseInt(val,16)}function isOnePointZero(n){return typeof n=="string"&&n.indexOf(".")!=-1&&parseFloat(n)===1}function isPercentage(n){return typeof n==="string"&&n.indexOf("%")!=-1}function pad2(c){return c.length==1?"0"+c:""+c}function convertToPercentage(n){if(n<=1){n=n*100+"%"}return n}function convertDecimalToHex(d){return Math.round(parseFloat(d)*255).toString(16)}function convertHexToDecimal(h){return parseIntFromHex(h)/255}var matchers=function(){var CSS_INTEGER="[-\\+]?\\d+%?";var CSS_NUMBER="[-\\+]?\\d*\\.\\d+%?";var CSS_UNIT="(?:"+CSS_NUMBER+")|(?:"+CSS_INTEGER+")";var PERMISSIVE_MATCH3="[\\s|\\(]+("+CSS_UNIT+")[,|\\s]+("+CSS_UNIT+")[,|\\s]+("+CSS_UNIT+")\\s*\\)?";var PERMISSIVE_MATCH4="[\\s|\\(]+("+CSS_UNIT+")[,|\\s]+("+CSS_UNIT+")[,|\\s]+("+CSS_UNIT+")[,|\\s]+("+CSS_UNIT+")\\s*\\)?";return{rgb:new RegExp("rgb"+PERMISSIVE_MATCH3),rgba:new RegExp("rgba"+PERMISSIVE_MATCH4),hsl:new RegExp("hsl"+PERMISSIVE_MATCH3),hsla:new RegExp("hsla"+PERMISSIVE_MATCH4),hsv:new RegExp("hsv"+PERMISSIVE_MATCH3),hex3:/^([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex6:/^([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,hex8:/^([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/}}();function stringInputToObject(color){color=color.replace(trimLeft,"").replace(trimRight,"").toLowerCase();var named=false;if(names[color]){color=names[color];named=true}else if(color=="transparent"){return{r:0,g:0,b:0,a:0,format:"name"}}var match;if(match=matchers.rgb.exec(color)){return{r:match[1],g:match[2],b:match[3]}}if(match=matchers.rgba.exec(color)){return{r:match[1],g:match[2],b:match[3],a:match[4]}}if(match=matchers.hsl.exec(color)){return{h:match[1],s:match[2],l:match[3]}}if(match=matchers.hsla.exec(color)){return{h:match[1],s:match[2],l:match[3],a:match[4]}}if(match=matchers.hsv.exec(color)){return{h:match[1],s:match[2],v:match[3]}}if(match=matchers.hex8.exec(color)){return{a:convertHexToDecimal(match[1]),r:parseIntFromHex(match[2]),g:parseIntFromHex(match[3]),b:parseIntFromHex(match[4]),format:named?"name":"hex8"}}if(match=matchers.hex6.exec(color)){return{r:parseIntFromHex(match[1]),g:parseIntFromHex(match[2]),b:parseIntFromHex(match[3]),format:named?"name":"hex"}}if(match=matchers.hex3.exec(color)){return{r:parseIntFromHex(match[1]+""+match[1]),g:parseIntFromHex(match[2]+""+match[2]),b:parseIntFromHex(match[3]+""+match[3]),format:named?"name":"hex"}}return false}window.tinycolor=tinycolor})();$(function(){if($.fn.spectrum.load){$.fn.spectrum.processNativeColorInputs()}})})(window,jQuery);(function($){$.fn.tagEditorInput=function(){var t=" ",e=$(this),n=parseInt(e.css("fontSize")),i=$("<span/>").css({position:"absolute",top:-9999,left:-9999,width:"auto",fontSize:e.css("fontSize"),fontFamily:e.css("fontFamily"),fontWeight:e.css("fontWeight"),letterSpacing:e.css("letterSpacing"),whiteSpace:"nowrap"}),s=function(){if(t!==(t=e.val())){i.text(t);var s=i.width()+n;20>s&&(s=20),s!=e.width()&&e.width(s)}};return i.insertAfter(e),e.bind("keyup keydown focus",s)};$.fn.tagEditor=function(options,val,blur){function escape(tag){return tag.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}var blur_result,o=$.extend({},$.fn.tagEditor.defaults,options),selector=this;o.dregex=new RegExp("["+o.delimiter.replace("-","-")+"]","g");if(typeof options=="string"){var response=[];selector.each(function(){var el=$(this),o=el.data("options"),ed=el.next(".tag-editor");if(options=="getTags")response.push({field:el[0],editor:ed,tags:ed.data("tags")});else if(options=="addTag"){if(o.maxTags&&ed.data("tags").length>=o.maxTags)return false;$('<li><div class="tag-editor-spacer">&nbsp;'+o.delimiter[0]+'</div><div class="tag-editor-tag"></div><div class="tag-editor-delete"><i></i></div></li>').appendTo(ed).find(".tag-editor-tag").html('<input type="text" maxlength="'+o.maxLength+'">').addClass("active").find("input").val(val).blur();if(!blur)ed.click();else $(".placeholder",ed).remove()}else if(options=="removeTag"){$(".tag-editor-tag",ed).filter(function(){return $(this).text()==val}).closest("li").find(".tag-editor-delete").click();if(!blur)ed.click()}else if(options=="destroy"){el.removeClass("tag-editor-hidden-src").removeData("options").off("focus.tag-editor").next(".tag-editor").remove()}});return options=="getTags"?response:this}if(window.getSelection)$(document).off("keydown.tag-editor").on("keydown.tag-editor",function(e){if(e.which==8||e.which==46||e.ctrlKey&&e.which==88){try{var sel=getSelection(),el=document.activeElement.tagName=="BODY"?$(sel.getRangeAt(0).startContainer.parentNode).closest(".tag-editor"):0}catch(e){el=0}if(sel.rangeCount>0&&el&&el.length){var tags=[],splits=sel.toString().split(el.prev().data("options").dregex);for(i=0;i<splits.length;i++){var tag=$.trim(splits[i]);if(tag)tags.push(tag)}$(".tag-editor-tag",el).each(function(){if(~$.inArray($(this).text(),tags))$(this).closest("li").find(".tag-editor-delete").click()});return false}}});return selector.each(function(){var el=$(this),tag_list=[];var ed=$("<ul "+(o.clickDelete?'oncontextmenu="return false;" ':"")+'class="tag-editor"></ul>').insertAfter(el);el.addClass("tag-editor-hidden-src").data("options",o).on("focus.tag-editor",function(){ed.click()});ed.append('<li style="width:1px">&nbsp;</li>');var new_tag='<li><div class="tag-editor-spacer">&nbsp;'+o.delimiter[0]+'</div><div class="tag-editor-tag"></div><div class="tag-editor-delete"><i></i></div></li>';function set_placeholder(){if(o.placeholder&&!tag_list.length&&!$(".deleted, .placeholder, input",ed).length)ed.append('<li class="placeholder"><div>'+o.placeholder+"</div></li>")}function update_globals(init){var old_tags=tag_list.toString();tag_list=$(".tag-editor-tag:not(.deleted)",ed).map(function(i,e){var val=$.trim($(this).hasClass("active")?$(this).find("input").val():$(e).text());if(val)return val}).get();ed.data("tags",tag_list);el.val(tag_list.join(o.delimiter[0]));if(!init)if(old_tags!=tag_list.toString())o.onChange(el,ed,tag_list);set_placeholder()}ed.click(function(e,closest_tag){var d,dist=99999,loc;if(window.getSelection&&getSelection()!="")return;if(o.maxTags&&ed.data("tags").length>=o.maxTags){ed.find("input").blur();return false}blur_result=true;$("input:focus",ed).blur();if(!blur_result)return false;blur_result=true;$(".placeholder",ed).remove();if(closest_tag&&closest_tag.length)loc="before";else{$(".tag-editor-tag",ed).each(function(){var tag=$(this),to=tag.offset(),tag_x=to.left,tag_y=to.top;if(e.pageY>=tag_y&&e.pageY<=tag_y+tag.height()){if(e.pageX<tag_x)loc="before",d=tag_x-e.pageX;else loc="after",d=e.pageX-tag_x-tag.width();if(d<dist)dist=d,closest_tag=tag}})}if(loc=="before"){$(new_tag).insertBefore(closest_tag.closest("li")).find(".tag-editor-tag").click()}else if(loc=="after")$(new_tag).insertAfter(closest_tag.closest("li")).find(".tag-editor-tag").click();else $(new_tag).appendTo(ed).find(".tag-editor-tag").click();return false});ed.on("click",".tag-editor-delete",function(e){if($(this).prev().hasClass("active")){$(this).closest("li").find("input").caret(-1);return false}var li=$(this).closest("li"),tag=li.find(".tag-editor-tag");if(o.beforeTagDelete(el,ed,tag_list,tag.text())===false)return false;tag.addClass("deleted").animate({width:0},o.animateDelete,function(){li.remove();set_placeholder()});update_globals();return false});if(o.clickDelete)ed.on("mousedown",".tag-editor-tag",function(e){if(e.ctrlKey||e.which>1){var li=$(this).closest("li"),tag=li.find(".tag-editor-tag");if(o.beforeTagDelete(el,ed,tag_list,tag.text())===false)return false;tag.addClass("deleted").animate({width:0},o.animateDelete,function(){li.remove();set_placeholder()});update_globals();return false}});ed.on("click",".tag-editor-tag",function(e){if(o.clickDelete&&(e.ctrlKey||e.which>1))return false;if(!$(this).hasClass("active")){var tag=$(this).text();var left_percent=Math.abs(($(this).offset().left-e.pageX)/$(this).width()),caret_pos=parseInt(tag.length*left_percent),input=$(this).html('<input type="text" maxlength="'+o.maxLength+'" value="'+escape(tag)+'">').addClass("active").find("input");input.data("old_tag",tag).tagEditorInput().focus().caret(caret_pos);if(o.autocomplete){var aco=$.extend({},o.autocomplete);var ac_select="select"in aco?o.autocomplete.select:"";aco.select=function(e,ui){if(ac_select)ac_select(e,ui);setTimeout(function(){ed.trigger("click",[$(".active",ed).find("input").closest("li").next("li").find(".tag-editor-tag")])},20)};input.autocomplete(aco)}}return false});function split_cleanup(input){var li=input.closest("li"),sub_tags=input.val().replace(/ +/," ").split(o.dregex),old_tag=input.data("old_tag"),old_tags=tag_list.slice(0),exceeded=false,cb_val;for(var i=0;i<sub_tags.length;i++){tag=$.trim(sub_tags[i]).slice(0,o.maxLength);if(o.forceLowercase)tag=tag.toLowerCase();cb_val=o.beforeTagSave(el,ed,old_tags,old_tag,tag);tag=cb_val||tag;if(cb_val===false||!tag)continue;if(o.removeDuplicates&&~$.inArray(tag,old_tags))$(".tag-editor-tag",ed).each(function(){if($(this).text()==tag)$(this).closest("li").remove()});old_tags.push(tag);li.before('<li><div class="tag-editor-spacer">&nbsp;'+o.delimiter[0]+'</div><div class="tag-editor-tag">'+escape(tag)+'</div><div class="tag-editor-delete"><i></i></div></li>');if(o.maxTags&&old_tags.length>=o.maxTags){exceeded=true;break}}input.attr("maxlength",o.maxLength).removeData("old_tag").val("");if(exceeded)input.blur();else input.focus();update_globals()}ed.on("blur","input",function(e){e.stopPropagation();var input=$(this),old_tag=input.data("old_tag"),tag=$.trim(input.val().replace(/ +/," ").replace(o.dregex,o.delimiter[0]));if(!tag){if(old_tag&&o.beforeTagDelete(el,ed,tag_list,old_tag)===false){input.val(old_tag).focus();blur_result=false;update_globals();return}try{input.closest("li").remove()}catch(e){}if(old_tag)update_globals()}else if(tag.indexOf(o.delimiter[0])>=0){split_cleanup(input);return}else if(tag!=old_tag){if(o.forceLowercase)tag=tag.toLowerCase();cb_val=o.beforeTagSave(el,ed,tag_list,old_tag,tag);tag=cb_val||tag;if(cb_val===false){if(old_tag){input.val(old_tag).focus();blur_result=false;update_globals();return}try{input.closest("li").remove()}catch(e){}if(old_tag)update_globals()}else if(o.removeDuplicates)$(".tag-editor-tag:not(.active)",ed).each(function(){if($(this).text()==tag)$(this).closest("li").remove()})}input.parent().html(escape(tag)).removeClass("active");if(tag!=old_tag)update_globals();set_placeholder()});var pasted_content;ed.on("paste","input",function(e){$(this).removeAttr("maxlength");pasted_content=$(this);setTimeout(function(){split_cleanup(pasted_content)},30)});var inp;ed.on("keypress","input",function(e){if(o.delimiter.indexOf(String.fromCharCode(e.which))>=0){inp=$(this);setTimeout(function(){split_cleanup(inp)},20)}});ed.on("keydown","input",function(e){var $t=$(this);if((e.which==37||!o.autocomplete&&e.which==38)&&!$t.caret()||e.which==8&&!$t.val()){var prev_tag=$t.closest("li").prev("li").find(".tag-editor-tag");if(prev_tag.length)prev_tag.click().find("input").caret(-1);else if($t.val()&&!(o.maxTags&&ed.data("tags").length>=o.maxTags))$(new_tag).insertBefore($t.closest("li")).find(".tag-editor-tag").click();return false}else if((e.which==39||!o.autocomplete&&e.which==40)&&$t.caret()==$t.val().length){var next_tag=$t.closest("li").next("li").find(".tag-editor-tag");if(next_tag.length)next_tag.click().find("input").caret(0);else if($t.val())ed.click();return false}else if(e.which==9){if(e.shiftKey){var prev_tag=$t.closest("li").prev("li").find(".tag-editor-tag");if(prev_tag.length)prev_tag.click().find("input").caret(0);else if($t.val()&&!(o.maxTags&&ed.data("tags").length>=o.maxTags))$(new_tag).insertBefore($t.closest("li")).find(".tag-editor-tag").click();else{el.attr("disabled","disabled");setTimeout(function(){el.removeAttr("disabled")},30);return}return false}else{var next_tag=$t.closest("li").next("li").find(".tag-editor-tag");if(next_tag.length)next_tag.click().find("input").caret(0);else if($t.val())ed.click();else return;return false}}else if(e.which==46&&(!$.trim($t.val())||$t.caret()==$t.val().length)){var next_tag=$t.closest("li").next("li").find(".tag-editor-tag");if(next_tag.length)next_tag.click().find("input").caret(0);else if($t.val())ed.click();return false}else if(e.which==13){ed.trigger("click",[$t.closest("li").next("li").find(".tag-editor-tag")]);if(o.maxTags&&ed.data("tags").length>=o.maxTags)ed.find("input").blur();return false}else if(e.which==36&&!$t.caret())ed.find(".tag-editor-tag").first().click();else if(e.which==35&&$t.caret()==$t.val().length)ed.find(".tag-editor-tag").last().click();
else if(e.which==27){$t.val($t.data("old_tag")?$t.data("old_tag"):"").blur();return false}});var tags=o.initialTags.length?o.initialTags:el.val().split(o.dregex);for(var i=0;i<tags.length;i++){if(o.maxTags&&i>=o.maxTags)break;var tag=$.trim(tags[i].replace(/ +/," "));if(tag){if(o.forceLowercase)tag=tag.toLowerCase();tag_list.push(tag);ed.append('<li><div class="tag-editor-spacer">&nbsp;'+o.delimiter[0]+'</div><div class="tag-editor-tag">'+escape(tag)+'</div><div class="tag-editor-delete"><i></i></div></li>')}}update_globals(true);if(o.sortable&&$.fn.sortable)ed.sortable({distance:5,cancel:".tag-editor-spacer, input",helper:"clone",update:function(){update_globals()}})})};$.fn.tagEditor.defaults={initialTags:[],maxTags:0,maxLength:50,delimiter:",;",placeholder:"",forceLowercase:true,removeDuplicates:true,clickDelete:false,animateDelete:175,sortable:true,autocomplete:null,onChange:function(){},beforeTagSave:function(){},beforeTagDelete:function(){}}})(jQuery);(function($){var _={isMsie:function(){return/(msie|trident)/i.test(navigator.userAgent)?navigator.userAgent.match(/(msie |rv:)(\d+(.\d+)?)/i)[2]:false},isBlankString:function(str){return!str||/^\s*$/.test(str)},escapeRegExChars:function(str){return str.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")},isString:function(obj){return typeof obj==="string"},isNumber:function(obj){return typeof obj==="number"},isArray:$.isArray,isFunction:$.isFunction,isObject:$.isPlainObject,isUndefined:function(obj){return typeof obj==="undefined"},bind:$.proxy,each:function(collection,cb){$.each(collection,reverseArgs);function reverseArgs(index,value){return cb(value,index)}},map:$.map,filter:$.grep,every:function(obj,test){var result=true;if(!obj){return result}$.each(obj,function(key,val){if(!(result=test.call(null,val,key,obj))){return false}});return!!result},some:function(obj,test){var result=false;if(!obj){return result}$.each(obj,function(key,val){if(result=test.call(null,val,key,obj)){return false}});return!!result},mixin:$.extend,getUniqueId:function(){var counter=0;return function(){return counter++}}(),templatify:function templatify(obj){return $.isFunction(obj)?obj:template;function template(){return String(obj)}},defer:function(fn){setTimeout(fn,0)},debounce:function(func,wait,immediate){var timeout,result;return function(){var context=this,args=arguments,later,callNow;later=function(){timeout=null;if(!immediate){result=func.apply(context,args)}};callNow=immediate&&!timeout;clearTimeout(timeout);timeout=setTimeout(later,wait);if(callNow){result=func.apply(context,args)}return result}},throttle:function(func,wait){var context,args,timeout,result,previous,later;previous=0;later=function(){previous=new Date;timeout=null;result=func.apply(context,args)};return function(){var now=new Date,remaining=wait-(now-previous);context=this;args=arguments;if(remaining<=0){clearTimeout(timeout);timeout=null;previous=now;result=func.apply(context,args)}else if(!timeout){timeout=setTimeout(later,remaining)}return result}},noop:function(){}};var VERSION="0.10.2";var tokenizers=function(root){return{nonword:nonword,whitespace:whitespace,obj:{nonword:getObjTokenizer(nonword),whitespace:getObjTokenizer(whitespace)}};function whitespace(s){return s.split(/\s+/)}function nonword(s){return s.split(/\W+/)}function getObjTokenizer(tokenizer){return function setKey(key){return function tokenize(o){return tokenizer(o[key])}}}}();var LruCache=function(){function LruCache(maxSize){this.maxSize=maxSize||100;this.size=0;this.hash={};this.list=new List}_.mixin(LruCache.prototype,{set:function set(key,val){var tailItem=this.list.tail,node;if(this.size>=this.maxSize){this.list.remove(tailItem);delete this.hash[tailItem.key]}if(node=this.hash[key]){node.val=val;this.list.moveToFront(node)}else{node=new Node(key,val);this.list.add(node);this.hash[key]=node;this.size++}},get:function get(key){var node=this.hash[key];if(node){this.list.moveToFront(node);return node.val}}});function List(){this.head=this.tail=null}_.mixin(List.prototype,{add:function add(node){if(this.head){node.next=this.head;this.head.prev=node}this.head=node;this.tail=this.tail||node},remove:function remove(node){node.prev?node.prev.next=node.next:this.head=node.next;node.next?node.next.prev=node.prev:this.tail=node.prev},moveToFront:function(node){this.remove(node);this.add(node)}});function Node(key,val){this.key=key;this.val=val;this.prev=this.next=null}return LruCache}();var PersistentStorage=function(){var ls,methods;try{ls=window.localStorage;ls.setItem("~~~","!");ls.removeItem("~~~")}catch(err){ls=null}function PersistentStorage(namespace){this.prefix=["__",namespace,"__"].join("");this.ttlKey="__ttl__";this.keyMatcher=new RegExp("^"+this.prefix)}if(ls&&window.JSON){methods={_prefix:function(key){return this.prefix+key},_ttlKey:function(key){return this._prefix(key)+this.ttlKey},get:function(key){if(this.isExpired(key)){this.remove(key)}return decode(ls.getItem(this._prefix(key)))},set:function(key,val,ttl){if(_.isNumber(ttl)){ls.setItem(this._ttlKey(key),encode(now()+ttl))}else{ls.removeItem(this._ttlKey(key))}return ls.setItem(this._prefix(key),encode(val))},remove:function(key){ls.removeItem(this._ttlKey(key));ls.removeItem(this._prefix(key));return this},clear:function(){var i,key,keys=[],len=ls.length;for(i=0;i<len;i++){if((key=ls.key(i)).match(this.keyMatcher)){keys.push(key.replace(this.keyMatcher,""))}}for(i=keys.length;i--;){this.remove(keys[i])}return this},isExpired:function(key){var ttl=decode(ls.getItem(this._ttlKey(key)));return _.isNumber(ttl)&&now()>ttl?true:false}}}else{methods={get:_.noop,set:_.noop,remove:_.noop,clear:_.noop,isExpired:_.noop}}_.mixin(PersistentStorage.prototype,methods);return PersistentStorage;function now(){return(new Date).getTime()}function encode(val){return JSON.stringify(_.isUndefined(val)?null:val)}function decode(val){return JSON.parse(val)}}();var Transport=function(){var pendingRequestsCount=0,pendingRequests={},maxPendingRequests=6,requestCache=new LruCache(10);function Transport(o){o=o||{};this._send=o.transport?callbackToDeferred(o.transport):$.ajax;this._get=o.rateLimiter?o.rateLimiter(this._get):this._get}Transport.setMaxPendingRequests=function setMaxPendingRequests(num){maxPendingRequests=num};Transport.resetCache=function clearCache(){requestCache=new LruCache(10)};_.mixin(Transport.prototype,{_get:function(url,o,cb){var that=this,jqXhr;if(jqXhr=pendingRequests[url]){jqXhr.done(done).fail(fail)}else if(pendingRequestsCount<maxPendingRequests){pendingRequestsCount++;pendingRequests[url]=this._send(url,o).done(done).fail(fail).always(always)}else{this.onDeckRequestArgs=[].slice.call(arguments,0)}function done(resp){cb&&cb(null,resp);requestCache.set(url,resp)}function fail(){cb&&cb(true)}function always(){pendingRequestsCount--;delete pendingRequests[url];if(that.onDeckRequestArgs){that._get.apply(that,that.onDeckRequestArgs);that.onDeckRequestArgs=null}}},get:function(url,o,cb){var resp;if(_.isFunction(o)){cb=o;o={}}if(resp=requestCache.get(url)){_.defer(function(){cb&&cb(null,resp)})}else{this._get(url,o,cb)}return!!resp}});return Transport;function callbackToDeferred(fn){return function customSendWrapper(url,o){var deferred=$.Deferred();fn(url,o,onSuccess,onError);return deferred;function onSuccess(resp){_.defer(function(){deferred.resolve(resp)})}function onError(err){_.defer(function(){deferred.reject(err)})}}}}();var SearchIndex=function(){function SearchIndex(o){o=o||{};if(!o.datumTokenizer||!o.queryTokenizer){$.error("datumTokenizer and queryTokenizer are both required")}this.datumTokenizer=o.datumTokenizer;this.queryTokenizer=o.queryTokenizer;this.reset()}_.mixin(SearchIndex.prototype,{bootstrap:function bootstrap(o){this.datums=o.datums;this.trie=o.trie},add:function(data){var that=this;data=_.isArray(data)?data:[data];_.each(data,function(datum){var id,tokens;id=that.datums.push(datum)-1;tokens=normalizeTokens(that.datumTokenizer(datum));_.each(tokens,function(token){var node,chars,ch;node=that.trie;chars=token.split("");while(ch=chars.shift()){node=node.children[ch]||(node.children[ch]=newNode());node.ids.push(id)}})})},get:function get(query){var that=this,tokens,matches;tokens=normalizeTokens(this.queryTokenizer(query));_.each(tokens,function(token){var node,chars,ch,ids;if(matches&&matches.length===0){return false}node=that.trie;chars=token.split("");while(node&&(ch=chars.shift())){node=node.children[ch]}if(node&&chars.length===0){ids=node.ids.slice(0);matches=matches?getIntersection(matches,ids):ids}else{matches=[];return false}});return matches?_.map(unique(matches),function(id){return that.datums[id]}):[]},reset:function reset(){this.datums=[];this.trie=newNode()},serialize:function serialize(){return{datums:this.datums,trie:this.trie}}});return SearchIndex;function normalizeTokens(tokens){tokens=_.filter(tokens,function(token){return!!token});tokens=_.map(tokens,function(token){return token.toLowerCase()});return tokens}function newNode(){return{ids:[],children:{}}}function unique(array){var seen={},uniques=[];for(var i=0;i<array.length;i++){if(!seen[array[i]]){seen[array[i]]=true;uniques.push(array[i])}}return uniques}function getIntersection(arrayA,arrayB){var ai=0,bi=0,intersection=[];arrayA=arrayA.sort(compare);arrayB=arrayB.sort(compare);while(ai<arrayA.length&&bi<arrayB.length){if(arrayA[ai]<arrayB[bi]){ai++}else if(arrayA[ai]>arrayB[bi]){bi++}else{intersection.push(arrayA[ai]);ai++;bi++}}return intersection;function compare(a,b){return a-b}}}();var oParser=function(){return{local:getLocal,prefetch:getPrefetch,remote:getRemote};function getLocal(o){return o.local||null}function getPrefetch(o){var prefetch,defaults;defaults={url:null,thumbprint:"",ttl:24*60*60*1e3,filter:null,ajax:{}};if(prefetch=o.prefetch||null){prefetch=_.isString(prefetch)?{url:prefetch}:prefetch;prefetch=_.mixin(defaults,prefetch);prefetch.thumbprint=VERSION+prefetch.thumbprint;prefetch.ajax.type=prefetch.ajax.type||"GET";prefetch.ajax.dataType=prefetch.ajax.dataType||"json";!prefetch.url&&$.error("prefetch requires url to be set")}return prefetch}function getRemote(o){var remote,defaults;defaults={url:null,wildcard:"%QUERY",replace:null,rateLimitBy:"debounce",rateLimitWait:300,send:null,filter:null,ajax:{}};if(remote=o.remote||null){remote=_.isString(remote)?{url:remote}:remote;remote=_.mixin(defaults,remote);remote.rateLimiter=/^throttle$/i.test(remote.rateLimitBy)?byThrottle(remote.rateLimitWait):byDebounce(remote.rateLimitWait);remote.ajax.type=remote.ajax.type||"GET";remote.ajax.dataType=remote.ajax.dataType||"json";delete remote.rateLimitBy;delete remote.rateLimitWait;!remote.url&&$.error("remote requires url to be set")}return remote;function byDebounce(wait){return function(fn){return _.debounce(fn,wait)}}function byThrottle(wait){return function(fn){return _.throttle(fn,wait)}}}}();(function(root){var old,keys;old=root.Bloodhound;keys={data:"data",protocol:"protocol",thumbprint:"thumbprint"};root.Bloodhound=Bloodhound;function Bloodhound(o){if(!o||!o.local&&!o.prefetch&&!o.remote){$.error("one of local, prefetch, or remote is required")}this.limit=o.limit||5;this.sorter=getSorter(o.sorter);this.dupDetector=o.dupDetector||ignoreDuplicates;this.local=oParser.local(o);this.prefetch=oParser.prefetch(o);this.remote=oParser.remote(o);this.cacheKey=this.prefetch?this.prefetch.cacheKey||this.prefetch.url:null;this.index=new SearchIndex({datumTokenizer:o.datumTokenizer,queryTokenizer:o.queryTokenizer});this.storage=this.cacheKey?new PersistentStorage(this.cacheKey):null}Bloodhound.noConflict=function noConflict(){root.Bloodhound=old;return Bloodhound};Bloodhound.tokenizers=tokenizers;_.mixin(Bloodhound.prototype,{_loadPrefetch:function loadPrefetch(o){var that=this,serialized,deferred;if(serialized=this._readFromStorage(o.thumbprint)){this.index.bootstrap(serialized);deferred=$.Deferred().resolve()}else{deferred=$.ajax(o.url,o.ajax).done(handlePrefetchResponse)}return deferred;function handlePrefetchResponse(resp){that.clear();that.add(o.filter?o.filter(resp):resp);that._saveToStorage(that.index.serialize(),o.thumbprint,o.ttl)}},_getFromRemote:function getFromRemote(query,cb){var that=this,url,uriEncodedQuery;query=query||"";uriEncodedQuery=encodeURIComponent(query);url=this.remote.replace?this.remote.replace(this.remote.url,query):this.remote.url.replace(this.remote.wildcard,uriEncodedQuery);return this.transport.get(url,this.remote.ajax,handleRemoteResponse);function handleRemoteResponse(err,resp){err?cb([]):cb(that.remote.filter?that.remote.filter(resp):resp)}},_saveToStorage:function saveToStorage(data,thumbprint,ttl){if(this.storage){this.storage.set(keys.data,data,ttl);this.storage.set(keys.protocol,location.protocol,ttl);this.storage.set(keys.thumbprint,thumbprint,ttl)}},_readFromStorage:function readFromStorage(thumbprint){var stored={},isExpired;if(this.storage){stored.data=this.storage.get(keys.data);stored.protocol=this.storage.get(keys.protocol);stored.thumbprint=this.storage.get(keys.thumbprint)}isExpired=stored.thumbprint!==thumbprint||stored.protocol!==location.protocol;return stored.data&&!isExpired?stored.data:null},_initialize:function initialize(){var that=this,local=this.local,deferred;deferred=this.prefetch?this._loadPrefetch(this.prefetch):$.Deferred().resolve();local&&deferred.done(addLocalToIndex);this.transport=this.remote?new Transport(this.remote):null;return this.initPromise=deferred.promise();function addLocalToIndex(){that.add(_.isFunction(local)?local():local)}},initialize:function initialize(force){return!this.initPromise||force?this._initialize():this.initPromise},add:function add(data){this.index.add(data)},get:function get(query,cb){var that=this,matches=[],cacheHit=false;matches=this.index.get(query);matches=this.sorter(matches).slice(0,this.limit);if(matches.length<this.limit&&this.transport){cacheHit=this._getFromRemote(query,returnRemoteMatches)}if(!cacheHit){(matches.length>0||!this.transport)&&cb&&cb(matches)}function returnRemoteMatches(remoteMatches){var matchesWithBackfill=matches.slice(0);_.each(remoteMatches,function(remoteMatch){var isDuplicate;isDuplicate=_.some(matchesWithBackfill,function(match){return that.dupDetector(remoteMatch,match)});!isDuplicate&&matchesWithBackfill.push(remoteMatch);return matchesWithBackfill.length<that.limit});cb&&cb(that.sorter(matchesWithBackfill))}},clear:function clear(){this.index.reset()},clearPrefetchCache:function clearPrefetchCache(){this.storage&&this.storage.clear()},clearRemoteCache:function clearRemoteCache(){this.transport&&Transport.resetCache()},ttAdapter:function ttAdapter(){return _.bind(this.get,this)}});return Bloodhound;function getSorter(sortFn){return _.isFunction(sortFn)?sort:noSort;function sort(array){return array.sort(sortFn)}function noSort(array){return array}}function ignoreDuplicates(){return false}})(this);var html={wrapper:'<span class="twitter-typeahead"></span>',dropdown:'<span class="tt-dropdown-menu"></span>',dataset:'<div class="tt-dataset-%CLASS%"></div>',suggestions:'<span class="tt-suggestions"></span>',suggestion:'<div class="tt-suggestion"></div>'};var css={wrapper:{position:"relative",display:"inline-block"},hint:{position:"absolute",top:"0",left:"0",borderColor:"transparent",boxShadow:"none"},input:{position:"relative",verticalAlign:"top",backgroundColor:"transparent"},inputWithNoHint:{position:"relative",verticalAlign:"top"},dropdown:{position:"absolute",top:"100%",left:"0",zIndex:"100",display:"none"},suggestions:{display:"block"},suggestion:{whiteSpace:"nowrap",cursor:"pointer"},suggestionChild:{whiteSpace:"normal"},ltr:{left:"0",right:"auto"},rtl:{left:"auto",right:" 0"}};if(_.isMsie()){_.mixin(css.input,{backgroundImage:"url(data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7)"})}if(_.isMsie()&&_.isMsie()<=7){_.mixin(css.input,{marginTop:"-1px"})}var EventBus=function(){var namespace="typeahead:";function EventBus(o){if(!o||!o.el){$.error("EventBus initialized without el")}this.$el=$(o.el)}_.mixin(EventBus.prototype,{trigger:function(type){var args=[].slice.call(arguments,1);this.$el.trigger(namespace+type,args)}});return EventBus}();var EventEmitter=function(){var splitter=/\s+/,nextTick=getNextTick();return{onSync:onSync,onAsync:onAsync,off:off,trigger:trigger};function on(method,types,cb,context){var type;if(!cb){return this}types=types.split(splitter);cb=context?bindContext(cb,context):cb;this._callbacks=this._callbacks||{};while(type=types.shift()){this._callbacks[type]=this._callbacks[type]||{sync:[],async:[]};this._callbacks[type][method].push(cb)}return this}function onAsync(types,cb,context){return on.call(this,"async",types,cb,context)}function onSync(types,cb,context){return on.call(this,"sync",types,cb,context)}function off(types){var type;if(!this._callbacks){return this}types=types.split(splitter);while(type=types.shift()){delete this._callbacks[type]}return this}function trigger(types){var type,callbacks,args,syncFlush,asyncFlush;if(!this._callbacks){return this}types=types.split(splitter);args=[].slice.call(arguments,1);while((type=types.shift())&&(callbacks=this._callbacks[type])){syncFlush=getFlush(callbacks.sync,this,[type].concat(args));asyncFlush=getFlush(callbacks.async,this,[type].concat(args));syncFlush()&&nextTick(asyncFlush)}return this}function getFlush(callbacks,context,args){return flush;function flush(){var cancelled;for(var i=0;!cancelled&&i<callbacks.length;i+=1){cancelled=callbacks[i].apply(context,args)===false}return!cancelled}}function getNextTick(){var nextTickFn;if(window.setImmediate){nextTickFn=function nextTickSetImmediate(fn){setImmediate(function(){fn()})}}else{nextTickFn=function nextTickSetTimeout(fn){setTimeout(function(){fn()},0)}}return nextTickFn}function bindContext(fn,context){return fn.bind?fn.bind(context):function(){fn.apply(context,[].slice.call(arguments,0))}}}();var highlight=function(doc){var defaults={node:null,pattern:null,tagName:"strong",className:null,wordsOnly:false,caseSensitive:false};return function hightlight(o){var regex;o=_.mixin({},defaults,o);if(!o.node||!o.pattern){return}o.pattern=_.isArray(o.pattern)?o.pattern:[o.pattern];regex=getRegex(o.pattern,o.caseSensitive,o.wordsOnly);traverse(o.node,hightlightTextNode);function hightlightTextNode(textNode){var match,patternNode;if(match=regex.exec(textNode.data)){wrapperNode=doc.createElement(o.tagName);o.className&&(wrapperNode.className=o.className);patternNode=textNode.splitText(match.index);patternNode.splitText(match[0].length);wrapperNode.appendChild(patternNode.cloneNode(true));textNode.parentNode.replaceChild(wrapperNode,patternNode)}return!!match}function traverse(el,hightlightTextNode){var childNode,TEXT_NODE_TYPE=3;for(var i=0;i<el.childNodes.length;i++){childNode=el.childNodes[i];if(childNode.nodeType===TEXT_NODE_TYPE){i+=hightlightTextNode(childNode)?1:0}else{traverse(childNode,hightlightTextNode)}}}};function getRegex(patterns,caseSensitive,wordsOnly){var escapedPatterns=[],regexStr;for(var i=0;i<patterns.length;i++){escapedPatterns.push(_.escapeRegExChars(patterns[i]))}regexStr=wordsOnly?"\\b("+escapedPatterns.join("|")+")\\b":"("+escapedPatterns.join("|")+")";return caseSensitive?new RegExp(regexStr):new RegExp(regexStr,"i")}}(window.document);var Input=function(){var specialKeyCodeMap;specialKeyCodeMap={9:"tab",27:"esc",37:"left",39:"right",13:"enter",38:"up",40:"down"};function Input(o){var that=this,onBlur,onFocus,onKeydown,onInput;o=o||{};if(!o.input){$.error("input is missing")}onBlur=_.bind(this._onBlur,this);onFocus=_.bind(this._onFocus,this);onKeydown=_.bind(this._onKeydown,this);onInput=_.bind(this._onInput,this);this.$hint=$(o.hint);this.$input=$(o.input).on("blur.tt",onBlur).on("focus.tt",onFocus).on("keydown.tt",onKeydown);if(this.$hint.length===0){this.setHint=this.getHint=this.clearHint=this.clearHintIfInvalid=_.noop}if(!_.isMsie()){this.$input.on("input.tt",onInput)}else{this.$input.on("keydown.tt keypress.tt cut.tt paste.tt",function($e){if(specialKeyCodeMap[$e.which||$e.keyCode]){return}_.defer(_.bind(that._onInput,that,$e))})}this.query=this.$input.val();this.$overflowHelper=buildOverflowHelper(this.$input)}Input.normalizeQuery=function(str){return(str||"").replace(/^\s*/g,"").replace(/\s{2,}/g," ")};_.mixin(Input.prototype,EventEmitter,{_onBlur:function onBlur(){this.resetInputValue();this.trigger("blurred")},_onFocus:function onFocus(){this.trigger("focused")},_onKeydown:function onKeydown($e){var keyName=specialKeyCodeMap[$e.which||$e.keyCode];this._managePreventDefault(keyName,$e);if(keyName&&this._shouldTrigger(keyName,$e)){this.trigger(keyName+"Keyed",$e)}},_onInput:function onInput(){this._checkInputValue()},_managePreventDefault:function managePreventDefault(keyName,$e){var preventDefault,hintValue,inputValue;switch(keyName){case"tab":hintValue=this.getHint();inputValue=this.getInputValue();preventDefault=hintValue&&hintValue!==inputValue&&!withModifier($e);break;case"up":case"down":preventDefault=!withModifier($e);break;default:preventDefault=false}preventDefault&&$e.preventDefault()},_shouldTrigger:function shouldTrigger(keyName,$e){var trigger;switch(keyName){case"tab":trigger=!withModifier($e);break;default:trigger=true}return trigger},_checkInputValue:function checkInputValue(){var inputValue,areEquivalent,hasDifferentWhitespace;inputValue=this.getInputValue();areEquivalent=areQueriesEquivalent(inputValue,this.query);hasDifferentWhitespace=areEquivalent?this.query.length!==inputValue.length:false;if(!areEquivalent){this.trigger("queryChanged",this.query=inputValue)}else if(hasDifferentWhitespace){this.trigger("whitespaceChanged",this.query)}},focus:function focus(){this.$input.focus()},blur:function blur(){this.$input.blur()},getQuery:function getQuery(){return this.query},setQuery:function setQuery(query){this.query=query},getInputValue:function getInputValue(){return this.$input.val()},setInputValue:function setInputValue(value,silent){silent?this.clearHint():this._checkInputValue()},resetInputValue:function resetInputValue(){this.setInputValue(this.query,true)},getHint:function getHint(){return this.$hint.val()},setHint:function setHint(value){this.$hint.val(value)},clearHint:function clearHint(){this.setHint("")},clearHintIfInvalid:function clearHintIfInvalid(){var val,hint,valIsPrefixOfHint,isValid;val=this.getInputValue();hint=this.getHint();valIsPrefixOfHint=val!==hint&&hint.indexOf(val)===0;isValid=val!==""&&valIsPrefixOfHint&&!this.hasOverflow();!isValid&&this.clearHint()},getLanguageDirection:function getLanguageDirection(){return(this.$input.css("direction")||"ltr").toLowerCase()},hasOverflow:function hasOverflow(){var constraint=this.$input.width()-2;this.$overflowHelper.text(this.getInputValue());return this.$overflowHelper.width()>=constraint},isCursorAtEnd:function(){var valueLength,selectionStart,range;valueLength=this.$input.val().length;selectionStart=this.$input[0].selectionStart;if(_.isNumber(selectionStart)){return selectionStart===valueLength}else if(document.selection){range=document.selection.createRange();range.moveStart("character",-valueLength);return valueLength===range.text.length}return true},destroy:function destroy(){this.$hint.off(".tt");this.$input.off(".tt");this.$hint=this.$input=this.$overflowHelper=null}});return Input;function buildOverflowHelper($input){return $('<pre aria-hidden="true"></pre>').css({position:"absolute",visibility:"hidden",whiteSpace:"pre",fontFamily:$input.css("font-family"),fontSize:$input.css("font-size"),fontStyle:$input.css("font-style"),fontVariant:$input.css("font-variant"),fontWeight:$input.css("font-weight"),wordSpacing:$input.css("word-spacing"),letterSpacing:$input.css("letter-spacing"),textIndent:$input.css("text-indent"),textRendering:$input.css("text-rendering"),textTransform:$input.css("text-transform")}).insertAfter($input)}function areQueriesEquivalent(a,b){return Input.normalizeQuery(a)===Input.normalizeQuery(b)}function withModifier($e){return $e.altKey||$e.ctrlKey||$e.metaKey||$e.shiftKey}}();var Dataset=function(){var datasetKey="ttDataset",valueKey="ttValue",datumKey="ttDatum";function Dataset(o){o=o||{};o.templates=o.templates||{};if(!o.source){$.error("missing source")}if(o.name&&!isValidName(o.name)){$.error("invalid dataset name: "+o.name)}this.query=null;this.highlight=!!o.highlight;this.name=o.name||_.getUniqueId();this.source=o.source;this.displayFn=getDisplayFn(o.display||o.displayKey);this.templates=getTemplates(o.templates,this.displayFn);this.$el=$(html.dataset.replace("%CLASS%",this.name))}Dataset.extractDatasetName=function extractDatasetName(el){return $(el).data(datasetKey)};Dataset.extractValue=function extractDatum(el){return $(el).data(valueKey)};Dataset.extractDatum=function extractDatum(el){return $(el).data(datumKey)};_.mixin(Dataset.prototype,EventEmitter,{_render:function render(query,suggestions){if(!this.$el){return}var that=this,hasSuggestions;this.$el.empty();hasSuggestions=suggestions&&suggestions.length;if(!hasSuggestions&&this.templates.empty){this.$el.html(getEmptyHtml()).prepend(that.templates.header?getHeaderHtml():null).append(that.templates.footer?getFooterHtml():null)}else if(hasSuggestions){this.$el.html(getSuggestionsHtml()).prepend(that.templates.header?getHeaderHtml():null).append(that.templates.footer?getFooterHtml():null)}this.trigger("rendered");function getEmptyHtml(){return that.templates.empty({query:query,isEmpty:true})}function getSuggestionsHtml(){var $suggestions,nodes;$suggestions=$(html.suggestions).css(css.suggestions);nodes=_.map(suggestions,getSuggestionNode);$suggestions.append.apply($suggestions,nodes);that.highlight&&highlight({node:$suggestions[0],pattern:query});return $suggestions;function getSuggestionNode(suggestion){var $el;$el=$(html.suggestion).append(that.templates.suggestion(suggestion)).data(datasetKey,that.name).data(valueKey,that.displayFn(suggestion)).data(datumKey,suggestion);$el.children().each(function(){$(this).css(css.suggestionChild)});return $el}}function getHeaderHtml(){return that.templates.header({query:query,isEmpty:!hasSuggestions})}function getFooterHtml(){return that.templates.footer({query:query,isEmpty:!hasSuggestions})}},getRoot:function getRoot(){return this.$el},update:function update(query){var that=this;this.query=query;this.canceled=false;this.source(query,render);function render(suggestions){if(!that.canceled&&query===that.query){that._render(query,suggestions)}}},cancel:function cancel(){this.canceled=true},clear:function clear(){this.cancel();this.$el.empty();this.trigger("rendered")},isEmpty:function isEmpty(){return this.$el.is(":empty")},destroy:function destroy(){this.$el=null}});return Dataset;function getDisplayFn(display){display=display||"value";return _.isFunction(display)?display:displayFn;function displayFn(obj){return obj[display]}}function getTemplates(templates,displayFn){return{empty:templates.empty&&_.templatify(templates.empty),header:templates.header&&_.templatify(templates.header),footer:templates.footer&&_.templatify(templates.footer),suggestion:templates.suggestion||suggestionTemplate};function suggestionTemplate(context){return"<p>"+displayFn(context)+"</p>"}}function isValidName(str){return/^[_a-zA-Z0-9-]+$/.test(str)}}();var Dropdown=function(){function Dropdown(o){var that=this,onSuggestionClick,onSuggestionMouseEnter,onSuggestionMouseLeave;o=o||{};if(!o.menu){$.error("menu is required")}this.isOpen=false;this.isEmpty=true;this.datasets=_.map(o.datasets,initializeDataset);onSuggestionClick=_.bind(this._onSuggestionClick,this);onSuggestionMouseEnter=_.bind(this._onSuggestionMouseEnter,this);onSuggestionMouseLeave=_.bind(this._onSuggestionMouseLeave,this);this.$menu=$(o.menu).on("click.tt",".tt-suggestion",onSuggestionClick).on("mouseenter.tt",".tt-suggestion",onSuggestionMouseEnter).on("mouseleave.tt",".tt-suggestion",onSuggestionMouseLeave);_.each(this.datasets,function(dataset){that.$menu.append(dataset.getRoot());dataset.onSync("rendered",that._onRendered,that)})}_.mixin(Dropdown.prototype,EventEmitter,{_onSuggestionClick:function onSuggestionClick($e){this.trigger("suggestionClicked",$($e.currentTarget))},_onSuggestionMouseEnter:function onSuggestionMouseEnter($e){this._removeCursor();this._setCursor($($e.currentTarget),true)},_onSuggestionMouseLeave:function onSuggestionMouseLeave(){this._removeCursor()},_onRendered:function onRendered(){this.isEmpty=_.every(this.datasets,isDatasetEmpty);this.isEmpty?this._hide():this.isOpen&&this._show();this.trigger("datasetRendered");function isDatasetEmpty(dataset){return dataset.isEmpty()}},_hide:function(){this.$menu.hide()},_show:function(){this.$menu.css("display","block")},_getSuggestions:function getSuggestions(){return this.$menu.find(".tt-suggestion")},_getCursor:function getCursor(){return this.$menu.find(".tt-cursor").first()},_setCursor:function setCursor($el,silent){$el.first().addClass("tt-cursor");!silent&&this.trigger("cursorMoved")},_removeCursor:function removeCursor(){this._getCursor().removeClass("tt-cursor")},_moveCursor:function moveCursor(increment){var $suggestions,$oldCursor,newCursorIndex,$newCursor;if(!this.isOpen){return}$oldCursor=this._getCursor();$suggestions=this._getSuggestions();this._removeCursor();newCursorIndex=$suggestions.index($oldCursor)+increment;newCursorIndex=(newCursorIndex+1)%($suggestions.length+1)-1;if(newCursorIndex===-1){this.trigger("cursorRemoved");return}else if(newCursorIndex<-1){newCursorIndex=$suggestions.length-1}this._setCursor($newCursor=$suggestions.eq(newCursorIndex));this._ensureVisible($newCursor)},_ensureVisible:function ensureVisible($el){var elTop,elBottom,menuScrollTop,menuHeight;elTop=$el.position().top;elBottom=elTop+$el.outerHeight(true);menuScrollTop=this.$menu.scrollTop();menuHeight=this.$menu.height()+parseInt(this.$menu.css("paddingTop"),10)+parseInt(this.$menu.css("paddingBottom"),10);if(elTop<0){this.$menu.scrollTop(menuScrollTop+elTop)}else if(menuHeight<elBottom){this.$menu.scrollTop(menuScrollTop+(elBottom-menuHeight))}},close:function close(){if(this.isOpen){this.isOpen=false;this._removeCursor();this._hide();this.trigger("closed")}},open:function open(){if(!this.isOpen){this.isOpen=true;!this.isEmpty&&this._show();this.trigger("opened")}},setLanguageDirection:function setLanguageDirection(dir){this.$menu.css(dir==="ltr"?css.ltr:css.rtl)},moveCursorUp:function moveCursorUp(){this._moveCursor(-1)},moveCursorDown:function moveCursorDown(){this._moveCursor(+1)},getDatumForSuggestion:function getDatumForSuggestion($el){var datum=null;if($el.length){datum={raw:Dataset.extractDatum($el),value:Dataset.extractValue($el),datasetName:Dataset.extractDatasetName($el)}}return datum},getDatumForCursor:function getDatumForCursor(){return this.getDatumForSuggestion(this._getCursor().first())},getDatumForTopSuggestion:function getDatumForTopSuggestion(){return this.getDatumForSuggestion(this._getSuggestions().first())},update:function update(query){_.each(this.datasets,updateDataset);function updateDataset(dataset){dataset.update(query)}},empty:function empty(){_.each(this.datasets,clearDataset);this.isEmpty=true;function clearDataset(dataset){dataset.clear()}},isVisible:function isVisible(){return this.isOpen&&!this.isEmpty},destroy:function destroy(){this.$menu.off(".tt");this.$menu=null;_.each(this.datasets,destroyDataset);function destroyDataset(dataset){dataset.destroy()}}});return Dropdown;function initializeDataset(oDataset){return new Dataset(oDataset)}}();var Typeahead=function(){var attrsKey="ttAttrs";function Typeahead(o){var $menu,$input,$hint;o=o||{};if(!o.input){$.error("missing input")}this.isActivated=false;this.autoselect=!!o.autoselect;this.minLength=_.isNumber(o.minLength)?o.minLength:1;this.$node=buildDomStructure(o.input,o.withHint);$menu=this.$node.find(".tt-dropdown-menu");$input=this.$node.find(".tt-input");$hint=this.$node.find(".tt-hint");$input.on("blur.tt",function($e){var active,isActive,hasActive;active=document.activeElement;isActive=$menu.is(active);hasActive=$menu.has(active).length>0;if(_.isMsie()&&(isActive||hasActive)){$e.preventDefault();
$e.stopImmediatePropagation();_.defer(function(){$input.focus()})}});$menu.on("mousedown.tt",function($e){$e.preventDefault()});this.eventBus=o.eventBus||new EventBus({el:$input});this.dropdown=new Dropdown({menu:$menu,datasets:o.datasets}).onSync("suggestionClicked",this._onSuggestionClicked,this).onSync("cursorMoved",this._onCursorMoved,this).onSync("cursorRemoved",this._onCursorRemoved,this).onSync("opened",this._onOpened,this).onSync("closed",this._onClosed,this).onAsync("datasetRendered",this._onDatasetRendered,this);this.input=new Input({input:$input,hint:$hint}).onSync("focused",this._onFocused,this).onSync("blurred",this._onBlurred,this).onSync("enterKeyed",this._onEnterKeyed,this).onSync("tabKeyed",this._onTabKeyed,this).onSync("escKeyed",this._onEscKeyed,this).onSync("upKeyed",this._onUpKeyed,this).onSync("downKeyed",this._onDownKeyed,this).onSync("leftKeyed",this._onLeftKeyed,this).onSync("rightKeyed",this._onRightKeyed,this).onSync("queryChanged",this._onQueryChanged,this).onSync("whitespaceChanged",this._onWhitespaceChanged,this);this._setLanguageDirection()}_.mixin(Typeahead.prototype,{_onSuggestionClicked:function onSuggestionClicked(type,$el){var datum;if(datum=this.dropdown.getDatumForSuggestion($el)){this._select(datum)}},_onCursorMoved:function onCursorMoved(){var datum=this.dropdown.getDatumForCursor();this.input.setInputValue(datum.value,true);this.eventBus.trigger("cursorchanged",datum.raw,datum.datasetName)},_onCursorRemoved:function onCursorRemoved(){this.input.resetInputValue();this._updateHint()},_onDatasetRendered:function onDatasetRendered(){this._updateHint()},_onOpened:function onOpened(){this._updateHint();this.eventBus.trigger("opened")},_onClosed:function onClosed(){this.input.clearHint();this.eventBus.trigger("closed")},_onFocused:function onFocused(){this.isActivated=true;this.dropdown.open()},_onBlurred:function onBlurred(){this.isActivated=false;this.dropdown.empty();this.dropdown.close()},_onEnterKeyed:function onEnterKeyed(type,$e){var cursorDatum,topSuggestionDatum;cursorDatum=this.dropdown.getDatumForCursor();topSuggestionDatum=this.dropdown.getDatumForTopSuggestion();if(cursorDatum){this._select(cursorDatum);$e.preventDefault()}else if(this.autoselect&&topSuggestionDatum){this._select(topSuggestionDatum);$e.preventDefault()}},_onTabKeyed:function onTabKeyed(type,$e){var datum;if(datum=this.dropdown.getDatumForCursor()){this._select(datum);$e.preventDefault()}else{this._autocomplete(true)}},_onEscKeyed:function onEscKeyed(){this.dropdown.close();this.input.resetInputValue()},_onUpKeyed:function onUpKeyed(){var query=this.input.getQuery();this.dropdown.isEmpty&&query.length>=this.minLength?this.dropdown.update(query):this.dropdown.moveCursorUp();this.dropdown.open()},_onDownKeyed:function onDownKeyed(){var query=this.input.getQuery();this.dropdown.isEmpty&&query.length>=this.minLength?this.dropdown.update(query):this.dropdown.moveCursorDown();this.dropdown.open()},_onLeftKeyed:function onLeftKeyed(){this.dir==="rtl"&&this._autocomplete()},_onRightKeyed:function onRightKeyed(){this.dir==="ltr"&&this._autocomplete()},_onQueryChanged:function onQueryChanged(e,query){this.input.clearHintIfInvalid();query.length>=this.minLength?this.dropdown.update(query):this.dropdown.empty();this.dropdown.open();this._setLanguageDirection()},_onWhitespaceChanged:function onWhitespaceChanged(){this._updateHint();this.dropdown.open()},_setLanguageDirection:function setLanguageDirection(){var dir;if(this.dir!==(dir=this.input.getLanguageDirection())){this.dir=dir;this.$node.css("direction",dir);this.dropdown.setLanguageDirection(dir)}},_updateHint:function updateHint(){var datum,val,query,escapedQuery,frontMatchRegEx,match;datum=this.dropdown.getDatumForTopSuggestion();if(datum&&this.dropdown.isVisible()&&!this.input.hasOverflow()){val=this.input.getInputValue();query=Input.normalizeQuery(val);escapedQuery=_.escapeRegExChars(query);frontMatchRegEx=new RegExp("^(?:"+escapedQuery+")(.+$)","i");match=frontMatchRegEx.exec(datum.value);match?this.input.setHint(val+match[1]):this.input.clearHint()}else{this.input.clearHint()}},_autocomplete:function autocomplete(laxCursor){var hint,query,isCursorAtEnd,datum;hint=this.input.getHint();query=this.input.getQuery();isCursorAtEnd=laxCursor||this.input.isCursorAtEnd();if(hint&&query!==hint&&isCursorAtEnd){datum=this.dropdown.getDatumForTopSuggestion();datum&&this.input.setInputValue(datum.value);this.eventBus.trigger("autocompleted",datum.raw,datum.datasetName)}},_select:function select(datum){this.input.setQuery(datum.value);this.input.setInputValue(datum.value,true);this._setLanguageDirection();this.eventBus.trigger("selected",datum.raw,datum.datasetName);this.dropdown.close();_.defer(_.bind(this.dropdown.empty,this.dropdown))},open:function open(){this.dropdown.open()},close:function close(){this.dropdown.close()},setVal:function setVal(val){if(this.isActivated){this.input.setInputValue(val)}else{this.input.setQuery(val);this.input.setInputValue(val,true)}this._setLanguageDirection()},getVal:function getVal(){return this.input.getQuery()},destroy:function destroy(){this.input.destroy();this.dropdown.destroy();destroyDomStructure(this.$node);this.$node=null}});return Typeahead;function buildDomStructure(input,withHint){var $input,$wrapper,$dropdown,$hint;$input=$(input);$wrapper=$(html.wrapper).css(css.wrapper);$dropdown=$(html.dropdown).css(css.dropdown);$hint=$input.clone().css(css.hint).css(getBackgroundStyles($input));$hint.val("").removeData().addClass("tt-hint").removeAttr("id name placeholder").prop("disabled",true).attr({autocomplete:"off",spellcheck:"false"});$input.data(attrsKey,{dir:$input.attr("dir"),autocomplete:$input.attr("autocomplete"),spellcheck:$input.attr("spellcheck"),style:$input.attr("style")});$input.addClass("tt-input").attr({autocomplete:"off",spellcheck:false}).css(withHint?css.input:css.inputWithNoHint);try{!$input.attr("dir")&&$input.attr("dir","auto")}catch(e){}return $input.wrap($wrapper).parent().prepend(withHint?$hint:null).append($dropdown)}function getBackgroundStyles($el){return{backgroundAttachment:$el.css("background-attachment"),backgroundClip:$el.css("background-clip"),backgroundColor:$el.css("background-color"),backgroundImage:$el.css("background-image"),backgroundOrigin:$el.css("background-origin"),backgroundPosition:$el.css("background-position"),backgroundRepeat:$el.css("background-repeat"),backgroundSize:$el.css("background-size")}}function destroyDomStructure($node){var $input=$node.find(".tt-input");_.each($input.data(attrsKey),function(val,key){_.isUndefined(val)?$input.removeAttr(key):$input.attr(key,val)});$input.detach().removeData(attrsKey).removeClass("tt-input").insertAfter($node);$node.remove()}}();(function(){var old,typeaheadKey,methods;old=$.fn.typeahead;typeaheadKey="ttTypeahead";methods={initialize:function initialize(o,datasets){datasets=_.isArray(datasets)?datasets:[].slice.call(arguments,1);o=o||{};return this.each(attach);function attach(){var $input=$(this),eventBus,typeahead;_.each(datasets,function(d){d.highlight=!!o.highlight});typeahead=new Typeahead({input:$input,eventBus:eventBus=new EventBus({el:$input}),withHint:_.isUndefined(o.hint)?true:!!o.hint,minLength:o.minLength,autoselect:o.autoselect,datasets:datasets});$input.data(typeaheadKey,typeahead)}},open:function open(){return this.each(openTypeahead);function openTypeahead(){var $input=$(this),typeahead;if(typeahead=$input.data(typeaheadKey)){typeahead.open()}}},close:function close(){return this.each(closeTypeahead);function closeTypeahead(){var $input=$(this),typeahead;if(typeahead=$input.data(typeaheadKey)){typeahead.close()}}},val:function val(newVal){return!arguments.length?getVal(this.first()):this.each(setVal);function setVal(){var $input=$(this),typeahead;if(typeahead=$input.data(typeaheadKey)){typeahead.setVal(newVal)}}function getVal($input){var typeahead,query;if(typeahead=$input.data(typeaheadKey)){query=typeahead.getVal()}return query}},destroy:function destroy(){return this.each(unattach);function unattach(){var $input=$(this),typeahead;if(typeahead=$input.data(typeaheadKey)){typeahead.destroy();$input.removeData(typeaheadKey)}}}};$.fn.typeahead=function(method){if(methods[method]){return methods[method].apply(this,[].slice.call(arguments,1))}else{return methods.initialize.apply(this,arguments)}};$.fn.typeahead.noConflict=function noConflict(){$.fn.typeahead=old;return this}})()})(window.jQuery);(function($,undefined){var uuid=0,runiqueId=/^ui-id-\d+$/;$.ui=$.ui||{};$.extend($.ui,{version:"1.10.4",keyCode:{BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,NUMPAD_ADD:107,NUMPAD_DECIMAL:110,NUMPAD_DIVIDE:111,NUMPAD_ENTER:108,NUMPAD_MULTIPLY:106,NUMPAD_SUBTRACT:109,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38}});$.fn.extend({focus:function(orig){return function(delay,fn){return typeof delay==="number"?this.each(function(){var elem=this;setTimeout(function(){$(elem).focus();if(fn){fn.call(elem)}},delay)}):orig.apply(this,arguments)}}($.fn.focus),scrollParent:function(){var scrollParent;if($.ui.ie&&/(static|relative)/.test(this.css("position"))||/absolute/.test(this.css("position"))){scrollParent=this.parents().filter(function(){return/(relative|absolute|fixed)/.test($.css(this,"position"))&&/(auto|scroll)/.test($.css(this,"overflow")+$.css(this,"overflow-y")+$.css(this,"overflow-x"))}).eq(0)}else{scrollParent=this.parents().filter(function(){return/(auto|scroll)/.test($.css(this,"overflow")+$.css(this,"overflow-y")+$.css(this,"overflow-x"))}).eq(0)}return/fixed/.test(this.css("position"))||!scrollParent.length?$(document):scrollParent},zIndex:function(zIndex){if(zIndex!==undefined){return this.css("zIndex",zIndex)}if(this.length){var elem=$(this[0]),position,value;while(elem.length&&elem[0]!==document){position=elem.css("position");if(position==="absolute"||position==="relative"||position==="fixed"){value=parseInt(elem.css("zIndex"),10);if(!isNaN(value)&&value!==0){return value}}elem=elem.parent()}}return 0},uniqueId:function(){return this.each(function(){if(!this.id){this.id="ui-id-"+ ++uuid}})},removeUniqueId:function(){return this.each(function(){if(runiqueId.test(this.id)){$(this).removeAttr("id")}})}});function focusable(element,isTabIndexNotNaN){var map,mapName,img,nodeName=element.nodeName.toLowerCase();if("area"===nodeName){map=element.parentNode;mapName=map.name;if(!element.href||!mapName||map.nodeName.toLowerCase()!=="map"){return false}img=$("img[usemap=#"+mapName+"]")[0];return!!img&&visible(img)}return(/input|select|textarea|button|object/.test(nodeName)?!element.disabled:"a"===nodeName?element.href||isTabIndexNotNaN:isTabIndexNotNaN)&&visible(element)}function visible(element){return $.expr.filters.visible(element)&&!$(element).parents().addBack().filter(function(){return $.css(this,"visibility")==="hidden"}).length}$.extend($.expr[":"],{data:$.expr.createPseudo?$.expr.createPseudo(function(dataName){return function(elem){return!!$.data(elem,dataName)}}):function(elem,i,match){return!!$.data(elem,match[3])},focusable:function(element){return focusable(element,!isNaN($.attr(element,"tabindex")))},tabbable:function(element){var tabIndex=$.attr(element,"tabindex"),isTabIndexNaN=isNaN(tabIndex);return(isTabIndexNaN||tabIndex>=0)&&focusable(element,!isTabIndexNaN)}});if(!$("<a>").outerWidth(1).jquery){$.each(["Width","Height"],function(i,name){var side=name==="Width"?["Left","Right"]:["Top","Bottom"],type=name.toLowerCase(),orig={innerWidth:$.fn.innerWidth,innerHeight:$.fn.innerHeight,outerWidth:$.fn.outerWidth,outerHeight:$.fn.outerHeight};function reduce(elem,size,border,margin){$.each(side,function(){size-=parseFloat($.css(elem,"padding"+this))||0;if(border){size-=parseFloat($.css(elem,"border"+this+"Width"))||0}if(margin){size-=parseFloat($.css(elem,"margin"+this))||0}});return size}$.fn["inner"+name]=function(size){if(size===undefined){return orig["inner"+name].call(this)}return this.each(function(){$(this).css(type,reduce(this,size)+"px")})};$.fn["outer"+name]=function(size,margin){if(typeof size!=="number"){return orig["outer"+name].call(this,size)}return this.each(function(){$(this).css(type,reduce(this,size,true,margin)+"px")})}})}if(!$.fn.addBack){$.fn.addBack=function(selector){return this.add(selector==null?this.prevObject:this.prevObject.filter(selector))}}if($("<a>").data("a-b","a").removeData("a-b").data("a-b")){$.fn.removeData=function(removeData){return function(key){if(arguments.length){return removeData.call(this,$.camelCase(key))}else{return removeData.call(this)}}}($.fn.removeData)}$.ui.ie=!!/msie [\w.]+/.exec(navigator.userAgent.toLowerCase());$.support.selectstart="onselectstart"in document.createElement("div");$.fn.extend({disableSelection:function(){return this.bind(($.support.selectstart?"selectstart":"mousedown")+".ui-disableSelection",function(event){event.preventDefault()})},enableSelection:function(){return this.unbind(".ui-disableSelection")}});$.extend($.ui,{plugin:{add:function(module,option,set){var i,proto=$.ui[module].prototype;for(i in set){proto.plugins[i]=proto.plugins[i]||[];proto.plugins[i].push([option,set[i]])}},call:function(instance,name,args){var i,set=instance.plugins[name];if(!set||!instance.element[0].parentNode||instance.element[0].parentNode.nodeType===11){return}for(i=0;i<set.length;i++){if(instance.options[set[i][0]]){set[i][1].apply(instance.element,args)}}}},hasScroll:function(el,a){if($(el).css("overflow")==="hidden"){return false}var scroll=a&&a==="left"?"scrollLeft":"scrollTop",has=false;if(el[scroll]>0){return true}el[scroll]=1;has=el[scroll]>0;el[scroll]=0;return has}})})(jQuery);(function($,undefined){var uuid=0,slice=Array.prototype.slice,_cleanData=$.cleanData;$.cleanData=function(elems){for(var i=0,elem;(elem=elems[i])!=null;i++){try{$(elem).triggerHandler("remove")}catch(e){}}_cleanData(elems)};$.widget=function(name,base,prototype){var fullName,existingConstructor,constructor,basePrototype,proxiedPrototype={},namespace=name.split(".")[0];name=name.split(".")[1];fullName=namespace+"-"+name;if(!prototype){prototype=base;base=$.Widget}$.expr[":"][fullName.toLowerCase()]=function(elem){return!!$.data(elem,fullName)};$[namespace]=$[namespace]||{};existingConstructor=$[namespace][name];constructor=$[namespace][name]=function(options,element){if(!this._createWidget){return new constructor(options,element)}if(arguments.length){this._createWidget(options,element)}};$.extend(constructor,existingConstructor,{version:prototype.version,_proto:$.extend({},prototype),_childConstructors:[]});basePrototype=new base;basePrototype.options=$.widget.extend({},basePrototype.options);$.each(prototype,function(prop,value){if(!$.isFunction(value)){proxiedPrototype[prop]=value;return}proxiedPrototype[prop]=function(){var _super=function(){return base.prototype[prop].apply(this,arguments)},_superApply=function(args){return base.prototype[prop].apply(this,args)};return function(){var __super=this._super,__superApply=this._superApply,returnValue;this._super=_super;this._superApply=_superApply;returnValue=value.apply(this,arguments);this._super=__super;this._superApply=__superApply;return returnValue}}()});constructor.prototype=$.widget.extend(basePrototype,{widgetEventPrefix:existingConstructor?basePrototype.widgetEventPrefix||name:name},proxiedPrototype,{constructor:constructor,namespace:namespace,widgetName:name,widgetFullName:fullName});if(existingConstructor){$.each(existingConstructor._childConstructors,function(i,child){var childPrototype=child.prototype;$.widget(childPrototype.namespace+"."+childPrototype.widgetName,constructor,child._proto)});delete existingConstructor._childConstructors}else{base._childConstructors.push(constructor)}$.widget.bridge(name,constructor)};$.widget.extend=function(target){var input=slice.call(arguments,1),inputIndex=0,inputLength=input.length,key,value;for(;inputIndex<inputLength;inputIndex++){for(key in input[inputIndex]){value=input[inputIndex][key];if(input[inputIndex].hasOwnProperty(key)&&value!==undefined){if($.isPlainObject(value)){target[key]=$.isPlainObject(target[key])?$.widget.extend({},target[key],value):$.widget.extend({},value)}else{target[key]=value}}}}return target};$.widget.bridge=function(name,object){var fullName=object.prototype.widgetFullName||name;$.fn[name]=function(options){var isMethodCall=typeof options==="string",args=slice.call(arguments,1),returnValue=this;options=!isMethodCall&&args.length?$.widget.extend.apply(null,[options].concat(args)):options;if(isMethodCall){this.each(function(){var methodValue,instance=$.data(this,fullName);if(!instance){return $.error("cannot call methods on "+name+" prior to initialization; "+"attempted to call method '"+options+"'")}if(!$.isFunction(instance[options])||options.charAt(0)==="_"){return $.error("no such method '"+options+"' for "+name+" widget instance")}methodValue=instance[options].apply(instance,args);if(methodValue!==instance&&methodValue!==undefined){returnValue=methodValue&&methodValue.jquery?returnValue.pushStack(methodValue.get()):methodValue;return false}})}else{this.each(function(){var instance=$.data(this,fullName);if(instance){instance.option(options||{})._init()}else{$.data(this,fullName,new object(options,this))}})}return returnValue}};$.Widget=function(){};$.Widget._childConstructors=[];$.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{disabled:false,create:null},_createWidget:function(options,element){element=$(element||this.defaultElement||this)[0];this.element=$(element);this.uuid=uuid++;this.eventNamespace="."+this.widgetName+this.uuid;this.options=$.widget.extend({},this.options,this._getCreateOptions(),options);this.bindings=$();this.hoverable=$();this.focusable=$();if(element!==this){$.data(element,this.widgetFullName,this);this._on(true,this.element,{remove:function(event){if(event.target===element){this.destroy()}}});this.document=$(element.style?element.ownerDocument:element.document||element);this.window=$(this.document[0].defaultView||this.document[0].parentWindow)}this._create();this._trigger("create",null,this._getCreateEventData());this._init()},_getCreateOptions:$.noop,_getCreateEventData:$.noop,_create:$.noop,_init:$.noop,destroy:function(){this._destroy();this.element.unbind(this.eventNamespace).removeData(this.widgetName).removeData(this.widgetFullName).removeData($.camelCase(this.widgetFullName));this.widget().unbind(this.eventNamespace).removeAttr("aria-disabled").removeClass(this.widgetFullName+"-disabled "+"ui-state-disabled");this.bindings.unbind(this.eventNamespace);this.hoverable.removeClass("ui-state-hover");this.focusable.removeClass("ui-state-focus")},_destroy:$.noop,widget:function(){return this.element},option:function(key,value){var options=key,parts,curOption,i;if(arguments.length===0){return $.widget.extend({},this.options)}if(typeof key==="string"){options={};parts=key.split(".");key=parts.shift();if(parts.length){curOption=options[key]=$.widget.extend({},this.options[key]);for(i=0;i<parts.length-1;i++){curOption[parts[i]]=curOption[parts[i]]||{};curOption=curOption[parts[i]]}key=parts.pop();if(arguments.length===1){return curOption[key]===undefined?null:curOption[key]}curOption[key]=value}else{if(arguments.length===1){return this.options[key]===undefined?null:this.options[key]}options[key]=value}}this._setOptions(options);return this},_setOptions:function(options){var key;for(key in options){this._setOption(key,options[key])}return this},_setOption:function(key,value){this.options[key]=value;if(key==="disabled"){this.widget().toggleClass(this.widgetFullName+"-disabled ui-state-disabled",!!value).attr("aria-disabled",value);this.hoverable.removeClass("ui-state-hover");this.focusable.removeClass("ui-state-focus")}return this},enable:function(){return this._setOption("disabled",false)},disable:function(){return this._setOption("disabled",true)},_on:function(suppressDisabledCheck,element,handlers){var delegateElement,instance=this;if(typeof suppressDisabledCheck!=="boolean"){handlers=element;element=suppressDisabledCheck;suppressDisabledCheck=false}if(!handlers){handlers=element;element=this.element;delegateElement=this.widget()}else{element=delegateElement=$(element);this.bindings=this.bindings.add(element)}$.each(handlers,function(event,handler){function handlerProxy(){if(!suppressDisabledCheck&&(instance.options.disabled===true||$(this).hasClass("ui-state-disabled"))){return}return(typeof handler==="string"?instance[handler]:handler).apply(instance,arguments)}if(typeof handler!=="string"){handlerProxy.guid=handler.guid=handler.guid||handlerProxy.guid||$.guid++}var match=event.match(/^(\w+)\s*(.*)$/),eventName=match[1]+instance.eventNamespace,selector=match[2];if(selector){delegateElement.delegate(selector,eventName,handlerProxy)}else{element.bind(eventName,handlerProxy)}})},_off:function(element,eventName){eventName=(eventName||"").split(" ").join(this.eventNamespace+" ")+this.eventNamespace;element.unbind(eventName).undelegate(eventName)},_delay:function(handler,delay){function handlerProxy(){return(typeof handler==="string"?instance[handler]:handler).apply(instance,arguments)}var instance=this;return setTimeout(handlerProxy,delay||0)},_hoverable:function(element){this.hoverable=this.hoverable.add(element);this._on(element,{mouseenter:function(event){$(event.currentTarget).addClass("ui-state-hover")},mouseleave:function(event){$(event.currentTarget).removeClass("ui-state-hover")}})},_focusable:function(element){this.focusable=this.focusable.add(element);this._on(element,{focusin:function(event){$(event.currentTarget).addClass("ui-state-focus")},focusout:function(event){$(event.currentTarget).removeClass("ui-state-focus")}})},_trigger:function(type,event,data){var prop,orig,callback=this.options[type];data=data||{};event=$.Event(event);event.type=(type===this.widgetEventPrefix?type:this.widgetEventPrefix+type).toLowerCase();event.target=this.element[0];orig=event.originalEvent;if(orig){for(prop in orig){if(!(prop in event)){event[prop]=orig[prop]}}}this.element.trigger(event,data);return!($.isFunction(callback)&&callback.apply(this.element[0],[event].concat(data))===false||event.isDefaultPrevented())}};$.each({show:"fadeIn",hide:"fadeOut"},function(method,defaultEffect){$.Widget.prototype["_"+method]=function(element,options,callback){if(typeof options==="string"){options={effect:options}}var hasOptions,effectName=!options?method:options===true||typeof options==="number"?defaultEffect:options.effect||defaultEffect;options=options||{};if(typeof options==="number"){options={duration:options}}hasOptions=!$.isEmptyObject(options);options.complete=callback;if(options.delay){element.delay(options.delay)}if(hasOptions&&$.effects&&$.effects.effect[effectName]){element[method](options)}else if(effectName!==method&&element[effectName]){element[effectName](options.duration,options.easing,callback)}else{element.queue(function(next){$(this)[method]();if(callback){callback.call(element[0])}next()})}}})})(jQuery);(function($,undefined){var mouseHandled=false;$(document).mouseup(function(){mouseHandled=false});$.widget("ui.mouse",{version:"1.10.4",options:{cancel:"input,textarea,button,select,option",distance:1,delay:0},_mouseInit:function(){var that=this;this.element.bind("mousedown."+this.widgetName,function(event){return that._mouseDown(event)}).bind("click."+this.widgetName,function(event){if(true===$.data(event.target,that.widgetName+".preventClickEvent")){$.removeData(event.target,that.widgetName+".preventClickEvent");event.stopImmediatePropagation();return false}});this.started=false},_mouseDestroy:function(){this.element.unbind("."+this.widgetName);if(this._mouseMoveDelegate){$(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate)}},_mouseDown:function(event){if(mouseHandled){return}this._mouseStarted&&this._mouseUp(event);this._mouseDownEvent=event;var that=this,btnIsLeft=event.which===1,elIsCancel=typeof this.options.cancel==="string"&&event.target.nodeName?$(event.target).closest(this.options.cancel).length:false;if(!btnIsLeft||elIsCancel||!this._mouseCapture(event)){return true}this.mouseDelayMet=!this.options.delay;if(!this.mouseDelayMet){this._mouseDelayTimer=setTimeout(function(){that.mouseDelayMet=true},this.options.delay)}if(this._mouseDistanceMet(event)&&this._mouseDelayMet(event)){this._mouseStarted=this._mouseStart(event)!==false;if(!this._mouseStarted){event.preventDefault();return true}}if(true===$.data(event.target,this.widgetName+".preventClickEvent")){$.removeData(event.target,this.widgetName+".preventClickEvent")}this._mouseMoveDelegate=function(event){return that._mouseMove(event)};this._mouseUpDelegate=function(event){return that._mouseUp(event)};$(document).bind("mousemove."+this.widgetName,this._mouseMoveDelegate).bind("mouseup."+this.widgetName,this._mouseUpDelegate);event.preventDefault();mouseHandled=true;return true},_mouseMove:function(event){if($.ui.ie&&(!document.documentMode||document.documentMode<9)&&!event.button){return this._mouseUp(event)}if(this._mouseStarted){this._mouseDrag(event);return event.preventDefault()}if(this._mouseDistanceMet(event)&&this._mouseDelayMet(event)){this._mouseStarted=this._mouseStart(this._mouseDownEvent,event)!==false;this._mouseStarted?this._mouseDrag(event):this._mouseUp(event)}return!this._mouseStarted},_mouseUp:function(event){$(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate);if(this._mouseStarted){this._mouseStarted=false;if(event.target===this._mouseDownEvent.target){$.data(event.target,this.widgetName+".preventClickEvent",true)}this._mouseStop(event)}return false},_mouseDistanceMet:function(event){return Math.max(Math.abs(this._mouseDownEvent.pageX-event.pageX),Math.abs(this._mouseDownEvent.pageY-event.pageY))>=this.options.distance},_mouseDelayMet:function(){return this.mouseDelayMet},_mouseStart:function(){},_mouseDrag:function(){},_mouseStop:function(){},_mouseCapture:function(){return true}})})(jQuery);(function($,undefined){$.ui=$.ui||{};var cachedScrollbarWidth,max=Math.max,abs=Math.abs,round=Math.round,rhorizontal=/left|center|right/,rvertical=/top|center|bottom/,roffset=/[\+\-]\d+(\.[\d]+)?%?/,rposition=/^\w+/,rpercent=/%$/,_position=$.fn.position;function getOffsets(offsets,width,height){return[parseFloat(offsets[0])*(rpercent.test(offsets[0])?width/100:1),parseFloat(offsets[1])*(rpercent.test(offsets[1])?height/100:1)]}function parseCss(element,property){return parseInt($.css(element,property),10)||0}function getDimensions(elem){var raw=elem[0];if(raw.nodeType===9){return{width:elem.width(),height:elem.height(),offset:{top:0,left:0}}}if($.isWindow(raw)){return{width:elem.width(),height:elem.height(),offset:{top:elem.scrollTop(),left:elem.scrollLeft()}}}if(raw.preventDefault){return{width:0,height:0,offset:{top:raw.pageY,left:raw.pageX}}}return{width:elem.outerWidth(),height:elem.outerHeight(),offset:elem.offset()}}$.position={scrollbarWidth:function(){if(cachedScrollbarWidth!==undefined){return cachedScrollbarWidth}var w1,w2,div=$("<div style='display:block;position:absolute;width:50px;height:50px;overflow:hidden;'><div style='height:100px;width:auto;'></div></div>"),innerDiv=div.children()[0];$("body").append(div);w1=innerDiv.offsetWidth;div.css("overflow","scroll");w2=innerDiv.offsetWidth;if(w1===w2){w2=div[0].clientWidth}div.remove();return cachedScrollbarWidth=w1-w2},getScrollInfo:function(within){var overflowX=within.isWindow||within.isDocument?"":within.element.css("overflow-x"),overflowY=within.isWindow||within.isDocument?"":within.element.css("overflow-y"),hasOverflowX=overflowX==="scroll"||overflowX==="auto"&&within.width<within.element[0].scrollWidth,hasOverflowY=overflowY==="scroll"||overflowY==="auto"&&within.height<within.element[0].scrollHeight;return{width:hasOverflowY?$.position.scrollbarWidth():0,height:hasOverflowX?$.position.scrollbarWidth():0}},getWithinInfo:function(element){var withinElement=$(element||window),isWindow=$.isWindow(withinElement[0]),isDocument=!!withinElement[0]&&withinElement[0].nodeType===9;return{element:withinElement,isWindow:isWindow,isDocument:isDocument,offset:withinElement.offset()||{left:0,top:0},scrollLeft:withinElement.scrollLeft(),scrollTop:withinElement.scrollTop(),width:isWindow?withinElement.width():withinElement.outerWidth(),height:isWindow?withinElement.height():withinElement.outerHeight()}}};$.fn.position=function(options){if(!options||!options.of){return _position.apply(this,arguments)}options=$.extend({},options);var atOffset,targetWidth,targetHeight,targetOffset,basePosition,dimensions,target=$(options.of),within=$.position.getWithinInfo(options.within),scrollInfo=$.position.getScrollInfo(within),collision=(options.collision||"flip").split(" "),offsets={};dimensions=getDimensions(target);if(target[0].preventDefault){options.at="left top"}targetWidth=dimensions.width;targetHeight=dimensions.height;targetOffset=dimensions.offset;basePosition=$.extend({},targetOffset);$.each(["my","at"],function(){var pos=(options[this]||"").split(" "),horizontalOffset,verticalOffset;if(pos.length===1){pos=rhorizontal.test(pos[0])?pos.concat(["center"]):rvertical.test(pos[0])?["center"].concat(pos):["center","center"]}pos[0]=rhorizontal.test(pos[0])?pos[0]:"center";pos[1]=rvertical.test(pos[1])?pos[1]:"center";horizontalOffset=roffset.exec(pos[0]);verticalOffset=roffset.exec(pos[1]);offsets[this]=[horizontalOffset?horizontalOffset[0]:0,verticalOffset?verticalOffset[0]:0];options[this]=[rposition.exec(pos[0])[0],rposition.exec(pos[1])[0]]});if(collision.length===1){collision[1]=collision[0]}if(options.at[0]==="right"){basePosition.left+=targetWidth}else if(options.at[0]==="center"){basePosition.left+=targetWidth/2}if(options.at[1]==="bottom"){basePosition.top+=targetHeight}else if(options.at[1]==="center"){basePosition.top+=targetHeight/2}atOffset=getOffsets(offsets.at,targetWidth,targetHeight);basePosition.left+=atOffset[0];basePosition.top+=atOffset[1];return this.each(function(){var collisionPosition,using,elem=$(this),elemWidth=elem.outerWidth(),elemHeight=elem.outerHeight(),marginLeft=parseCss(this,"marginLeft"),marginTop=parseCss(this,"marginTop"),collisionWidth=elemWidth+marginLeft+parseCss(this,"marginRight")+scrollInfo.width,collisionHeight=elemHeight+marginTop+parseCss(this,"marginBottom")+scrollInfo.height,position=$.extend({},basePosition),myOffset=getOffsets(offsets.my,elem.outerWidth(),elem.outerHeight());if(options.my[0]==="right"){position.left-=elemWidth}else if(options.my[0]==="center"){position.left-=elemWidth/2}if(options.my[1]==="bottom"){position.top-=elemHeight}else if(options.my[1]==="center"){position.top-=elemHeight/2}position.left+=myOffset[0];position.top+=myOffset[1];if(!$.support.offsetFractions){position.left=round(position.left);position.top=round(position.top)}collisionPosition={marginLeft:marginLeft,marginTop:marginTop};$.each(["left","top"],function(i,dir){if($.ui.position[collision[i]]){$.ui.position[collision[i]][dir](position,{targetWidth:targetWidth,targetHeight:targetHeight,elemWidth:elemWidth,elemHeight:elemHeight,collisionPosition:collisionPosition,collisionWidth:collisionWidth,collisionHeight:collisionHeight,offset:[atOffset[0]+myOffset[0],atOffset[1]+myOffset[1]],my:options.my,at:options.at,within:within,elem:elem})}});if(options.using){using=function(props){var left=targetOffset.left-position.left,right=left+targetWidth-elemWidth,top=targetOffset.top-position.top,bottom=top+targetHeight-elemHeight,feedback={target:{element:target,left:targetOffset.left,top:targetOffset.top,width:targetWidth,height:targetHeight},element:{element:elem,left:position.left,top:position.top,width:elemWidth,height:elemHeight},horizontal:right<0?"left":left>0?"right":"center",vertical:bottom<0?"top":top>0?"bottom":"middle"};if(targetWidth<elemWidth&&abs(left+right)<targetWidth){feedback.horizontal="center"}if(targetHeight<elemHeight&&abs(top+bottom)<targetHeight){feedback.vertical="middle"
}if(max(abs(left),abs(right))>max(abs(top),abs(bottom))){feedback.important="horizontal"}else{feedback.important="vertical"}options.using.call(this,props,feedback)}}elem.offset($.extend(position,{using:using}))})};$.ui.position={fit:{left:function(position,data){var within=data.within,withinOffset=within.isWindow?within.scrollLeft:within.offset.left,outerWidth=within.width,collisionPosLeft=position.left-data.collisionPosition.marginLeft,overLeft=withinOffset-collisionPosLeft,overRight=collisionPosLeft+data.collisionWidth-outerWidth-withinOffset,newOverRight;if(data.collisionWidth>outerWidth){if(overLeft>0&&overRight<=0){newOverRight=position.left+overLeft+data.collisionWidth-outerWidth-withinOffset;position.left+=overLeft-newOverRight}else if(overRight>0&&overLeft<=0){position.left=withinOffset}else{if(overLeft>overRight){position.left=withinOffset+outerWidth-data.collisionWidth}else{position.left=withinOffset}}}else if(overLeft>0){position.left+=overLeft}else if(overRight>0){position.left-=overRight}else{position.left=max(position.left-collisionPosLeft,position.left)}},top:function(position,data){var within=data.within,withinOffset=within.isWindow?within.scrollTop:within.offset.top,outerHeight=data.within.height,collisionPosTop=position.top-data.collisionPosition.marginTop,overTop=withinOffset-collisionPosTop,overBottom=collisionPosTop+data.collisionHeight-outerHeight-withinOffset,newOverBottom;if(data.collisionHeight>outerHeight){if(overTop>0&&overBottom<=0){newOverBottom=position.top+overTop+data.collisionHeight-outerHeight-withinOffset;position.top+=overTop-newOverBottom}else if(overBottom>0&&overTop<=0){position.top=withinOffset}else{if(overTop>overBottom){position.top=withinOffset+outerHeight-data.collisionHeight}else{position.top=withinOffset}}}else if(overTop>0){position.top+=overTop}else if(overBottom>0){position.top-=overBottom}else{position.top=max(position.top-collisionPosTop,position.top)}}},flip:{left:function(position,data){var within=data.within,withinOffset=within.offset.left+within.scrollLeft,outerWidth=within.width,offsetLeft=within.isWindow?within.scrollLeft:within.offset.left,collisionPosLeft=position.left-data.collisionPosition.marginLeft,overLeft=collisionPosLeft-offsetLeft,overRight=collisionPosLeft+data.collisionWidth-outerWidth-offsetLeft,myOffset=data.my[0]==="left"?-data.elemWidth:data.my[0]==="right"?data.elemWidth:0,atOffset=data.at[0]==="left"?data.targetWidth:data.at[0]==="right"?-data.targetWidth:0,offset=-2*data.offset[0],newOverRight,newOverLeft;if(overLeft<0){newOverRight=position.left+myOffset+atOffset+offset+data.collisionWidth-outerWidth-withinOffset;if(newOverRight<0||newOverRight<abs(overLeft)){position.left+=myOffset+atOffset+offset}}else if(overRight>0){newOverLeft=position.left-data.collisionPosition.marginLeft+myOffset+atOffset+offset-offsetLeft;if(newOverLeft>0||abs(newOverLeft)<overRight){position.left+=myOffset+atOffset+offset}}},top:function(position,data){var within=data.within,withinOffset=within.offset.top+within.scrollTop,outerHeight=within.height,offsetTop=within.isWindow?within.scrollTop:within.offset.top,collisionPosTop=position.top-data.collisionPosition.marginTop,overTop=collisionPosTop-offsetTop,overBottom=collisionPosTop+data.collisionHeight-outerHeight-offsetTop,top=data.my[1]==="top",myOffset=top?-data.elemHeight:data.my[1]==="bottom"?data.elemHeight:0,atOffset=data.at[1]==="top"?data.targetHeight:data.at[1]==="bottom"?-data.targetHeight:0,offset=-2*data.offset[1],newOverTop,newOverBottom;if(overTop<0){newOverBottom=position.top+myOffset+atOffset+offset+data.collisionHeight-outerHeight-withinOffset;if(position.top+myOffset+atOffset+offset>overTop&&(newOverBottom<0||newOverBottom<abs(overTop))){position.top+=myOffset+atOffset+offset}}else if(overBottom>0){newOverTop=position.top-data.collisionPosition.marginTop+myOffset+atOffset+offset-offsetTop;if(position.top+myOffset+atOffset+offset>overBottom&&(newOverTop>0||abs(newOverTop)<overBottom)){position.top+=myOffset+atOffset+offset}}}},flipfit:{left:function(){$.ui.position.flip.left.apply(this,arguments);$.ui.position.fit.left.apply(this,arguments)},top:function(){$.ui.position.flip.top.apply(this,arguments);$.ui.position.fit.top.apply(this,arguments)}}};(function(){var testElement,testElementParent,testElementStyle,offsetLeft,i,body=document.getElementsByTagName("body")[0],div=document.createElement("div");testElement=document.createElement(body?"div":"body");testElementStyle={visibility:"hidden",width:0,height:0,border:0,margin:0,background:"none"};if(body){$.extend(testElementStyle,{position:"absolute",left:"-1000px",top:"-1000px"})}for(i in testElementStyle){testElement.style[i]=testElementStyle[i]}testElement.appendChild(div);testElementParent=body||document.documentElement;testElementParent.insertBefore(testElement,testElementParent.firstChild);div.style.cssText="position: absolute; left: 10.7432222px;";offsetLeft=$(div).offset().left;$.support.offsetFractions=offsetLeft>10&&offsetLeft<11;testElement.innerHTML="";testElementParent.removeChild(testElement)})()})(jQuery);(function($,undefined){function isOverAxis(x,reference,size){return x>reference&&x<reference+size}function isFloating(item){return/left|right/.test(item.css("float"))||/inline|table-cell/.test(item.css("display"))}$.widget("ui.sortable",$.ui.mouse,{version:"1.10.4",widgetEventPrefix:"sort",ready:false,options:{appendTo:"parent",axis:false,connectWith:false,containment:false,cursor:"auto",cursorAt:false,dropOnEmpty:true,forcePlaceholderSize:false,forceHelperSize:false,grid:false,handle:false,helper:"original",items:"> *",opacity:false,placeholder:false,revert:false,scroll:true,scrollSensitivity:20,scrollSpeed:20,scope:"default",tolerance:"intersect",zIndex:1e3,activate:null,beforeStop:null,change:null,deactivate:null,out:null,over:null,receive:null,remove:null,sort:null,start:null,stop:null,update:null},_create:function(){var o=this.options;this.containerCache={};this.element.addClass("ui-sortable");this.refresh();this.floating=this.items.length?o.axis==="x"||isFloating(this.items[0].item):false;this.offset=this.element.offset();this._mouseInit();this.ready=true},_destroy:function(){this.element.removeClass("ui-sortable ui-sortable-disabled");this._mouseDestroy();for(var i=this.items.length-1;i>=0;i--){this.items[i].item.removeData(this.widgetName+"-item")}return this},_setOption:function(key,value){if(key==="disabled"){this.options[key]=value;this.widget().toggleClass("ui-sortable-disabled",!!value)}else{$.Widget.prototype._setOption.apply(this,arguments)}},_mouseCapture:function(event,overrideHandle){var currentItem=null,validHandle=false,that=this;if(this.reverting){return false}if(this.options.disabled||this.options.type==="static"){return false}this._refreshItems(event);$(event.target).parents().each(function(){if($.data(this,that.widgetName+"-item")===that){currentItem=$(this);return false}});if($.data(event.target,that.widgetName+"-item")===that){currentItem=$(event.target)}if(!currentItem){return false}if(this.options.handle&&!overrideHandle){$(this.options.handle,currentItem).find("*").addBack().each(function(){if(this===event.target){validHandle=true}});if(!validHandle){return false}}this.currentItem=currentItem;this._removeCurrentsFromItems();return true},_mouseStart:function(event,overrideHandle,noActivation){var i,body,o=this.options;this.currentContainer=this;this.refreshPositions();this.helper=this._createHelper(event);this._cacheHelperProportions();this._cacheMargins();this.scrollParent=this.helper.scrollParent();this.offset=this.currentItem.offset();this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left};$.extend(this.offset,{click:{left:event.pageX-this.offset.left,top:event.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()});this.helper.css("position","absolute");this.cssPosition=this.helper.css("position");this.originalPosition=this._generatePosition(event);this.originalPageX=event.pageX;this.originalPageY=event.pageY;o.cursorAt&&this._adjustOffsetFromHelper(o.cursorAt);this.domPosition={prev:this.currentItem.prev()[0],parent:this.currentItem.parent()[0]};if(this.helper[0]!==this.currentItem[0]){this.currentItem.hide()}this._createPlaceholder();if(o.containment){this._setContainment()}if(o.cursor&&o.cursor!=="auto"){body=this.document.find("body");this.storedCursor=body.css("cursor");body.css("cursor",o.cursor);this.storedStylesheet=$("<style>*{ cursor: "+o.cursor+" !important; }</style>").appendTo(body)}if(o.opacity){if(this.helper.css("opacity")){this._storedOpacity=this.helper.css("opacity")}this.helper.css("opacity",o.opacity)}if(o.zIndex){if(this.helper.css("zIndex")){this._storedZIndex=this.helper.css("zIndex")}this.helper.css("zIndex",o.zIndex)}if(this.scrollParent[0]!==document&&this.scrollParent[0].tagName!=="HTML"){this.overflowOffset=this.scrollParent.offset()}this._trigger("start",event,this._uiHash());if(!this._preserveHelperProportions){this._cacheHelperProportions()}if(!noActivation){for(i=this.containers.length-1;i>=0;i--){this.containers[i]._trigger("activate",event,this._uiHash(this))}}if($.ui.ddmanager){$.ui.ddmanager.current=this}if($.ui.ddmanager&&!o.dropBehaviour){$.ui.ddmanager.prepareOffsets(this,event)}this.dragging=true;this.helper.addClass("ui-sortable-helper");this._mouseDrag(event);return true},_mouseDrag:function(event){var i,item,itemElement,intersection,o=this.options,scrolled=false;this.position=this._generatePosition(event);this.positionAbs=this._convertPositionTo("absolute");if(!this.lastPositionAbs){this.lastPositionAbs=this.positionAbs}if(this.options.scroll){if(this.scrollParent[0]!==document&&this.scrollParent[0].tagName!=="HTML"){if(this.overflowOffset.top+this.scrollParent[0].offsetHeight-event.pageY<o.scrollSensitivity){this.scrollParent[0].scrollTop=scrolled=this.scrollParent[0].scrollTop+o.scrollSpeed}else if(event.pageY-this.overflowOffset.top<o.scrollSensitivity){this.scrollParent[0].scrollTop=scrolled=this.scrollParent[0].scrollTop-o.scrollSpeed}if(this.overflowOffset.left+this.scrollParent[0].offsetWidth-event.pageX<o.scrollSensitivity){this.scrollParent[0].scrollLeft=scrolled=this.scrollParent[0].scrollLeft+o.scrollSpeed}else if(event.pageX-this.overflowOffset.left<o.scrollSensitivity){this.scrollParent[0].scrollLeft=scrolled=this.scrollParent[0].scrollLeft-o.scrollSpeed}}else{if(event.pageY-$(document).scrollTop()<o.scrollSensitivity){scrolled=$(document).scrollTop($(document).scrollTop()-o.scrollSpeed)}else if($(window).height()-(event.pageY-$(document).scrollTop())<o.scrollSensitivity){scrolled=$(document).scrollTop($(document).scrollTop()+o.scrollSpeed)}if(event.pageX-$(document).scrollLeft()<o.scrollSensitivity){scrolled=$(document).scrollLeft($(document).scrollLeft()-o.scrollSpeed)}else if($(window).width()-(event.pageX-$(document).scrollLeft())<o.scrollSensitivity){scrolled=$(document).scrollLeft($(document).scrollLeft()+o.scrollSpeed)}}if(scrolled!==false&&$.ui.ddmanager&&!o.dropBehaviour){$.ui.ddmanager.prepareOffsets(this,event)}}this.positionAbs=this._convertPositionTo("absolute");if(!this.options.axis||this.options.axis!=="y"){this.helper[0].style.left=this.position.left+"px"}if(!this.options.axis||this.options.axis!=="x"){this.helper[0].style.top=this.position.top+"px"}for(i=this.items.length-1;i>=0;i--){item=this.items[i];itemElement=item.item[0];intersection=this._intersectsWithPointer(item);if(!intersection){continue}if(item.instance!==this.currentContainer){continue}if(itemElement!==this.currentItem[0]&&this.placeholder[intersection===1?"next":"prev"]()[0]!==itemElement&&!$.contains(this.placeholder[0],itemElement)&&(this.options.type==="semi-dynamic"?!$.contains(this.element[0],itemElement):true)){this.direction=intersection===1?"down":"up";if(this.options.tolerance==="pointer"||this._intersectsWithSides(item)){this._rearrange(event,item)}else{break}this._trigger("change",event,this._uiHash());break}}this._contactContainers(event);if($.ui.ddmanager){$.ui.ddmanager.drag(this,event)}this._trigger("sort",event,this._uiHash());this.lastPositionAbs=this.positionAbs;return false},_mouseStop:function(event,noPropagation){if(!event){return}if($.ui.ddmanager&&!this.options.dropBehaviour){$.ui.ddmanager.drop(this,event)}if(this.options.revert){var that=this,cur=this.placeholder.offset(),axis=this.options.axis,animation={};if(!axis||axis==="x"){animation.left=cur.left-this.offset.parent.left-this.margins.left+(this.offsetParent[0]===document.body?0:this.offsetParent[0].scrollLeft)}if(!axis||axis==="y"){animation.top=cur.top-this.offset.parent.top-this.margins.top+(this.offsetParent[0]===document.body?0:this.offsetParent[0].scrollTop)}this.reverting=true;$(this.helper).animate(animation,parseInt(this.options.revert,10)||500,function(){that._clear(event)})}else{this._clear(event,noPropagation)}return false},cancel:function(){if(this.dragging){this._mouseUp({target:null});if(this.options.helper==="original"){this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper")}else{this.currentItem.show()}for(var i=this.containers.length-1;i>=0;i--){this.containers[i]._trigger("deactivate",null,this._uiHash(this));if(this.containers[i].containerCache.over){this.containers[i]._trigger("out",null,this._uiHash(this));this.containers[i].containerCache.over=0}}}if(this.placeholder){if(this.placeholder[0].parentNode){this.placeholder[0].parentNode.removeChild(this.placeholder[0])}if(this.options.helper!=="original"&&this.helper&&this.helper[0].parentNode){this.helper.remove()}$.extend(this,{helper:null,dragging:false,reverting:false,_noFinalSort:null});if(this.domPosition.prev){$(this.domPosition.prev).after(this.currentItem)}else{$(this.domPosition.parent).prepend(this.currentItem)}}return this},serialize:function(o){var items=this._getItemsAsjQuery(o&&o.connected),str=[];o=o||{};$(items).each(function(){var res=($(o.item||this).attr(o.attribute||"id")||"").match(o.expression||/(.+)[\-=_](.+)/);if(res){str.push((o.key||res[1]+"[]")+"="+(o.key&&o.expression?res[1]:res[2]))}});if(!str.length&&o.key){str.push(o.key+"=")}return str.join("&")},toArray:function(o){var items=this._getItemsAsjQuery(o&&o.connected),ret=[];o=o||{};items.each(function(){ret.push($(o.item||this).attr(o.attribute||"id")||"")});return ret},_intersectsWith:function(item){var x1=this.positionAbs.left,x2=x1+this.helperProportions.width,y1=this.positionAbs.top,y2=y1+this.helperProportions.height,l=item.left,r=l+item.width,t=item.top,b=t+item.height,dyClick=this.offset.click.top,dxClick=this.offset.click.left,isOverElementHeight=this.options.axis==="x"||y1+dyClick>t&&y1+dyClick<b,isOverElementWidth=this.options.axis==="y"||x1+dxClick>l&&x1+dxClick<r,isOverElement=isOverElementHeight&&isOverElementWidth;if(this.options.tolerance==="pointer"||this.options.forcePointerForContainers||this.options.tolerance!=="pointer"&&this.helperProportions[this.floating?"width":"height"]>item[this.floating?"width":"height"]){return isOverElement}else{return l<x1+this.helperProportions.width/2&&x2-this.helperProportions.width/2<r&&t<y1+this.helperProportions.height/2&&y2-this.helperProportions.height/2<b}},_intersectsWithPointer:function(item){var isOverElementHeight=this.options.axis==="x"||isOverAxis(this.positionAbs.top+this.offset.click.top,item.top,item.height),isOverElementWidth=this.options.axis==="y"||isOverAxis(this.positionAbs.left+this.offset.click.left,item.left,item.width),isOverElement=isOverElementHeight&&isOverElementWidth,verticalDirection=this._getDragVerticalDirection(),horizontalDirection=this._getDragHorizontalDirection();if(!isOverElement){return false}return this.floating?horizontalDirection&&horizontalDirection==="right"||verticalDirection==="down"?2:1:verticalDirection&&(verticalDirection==="down"?2:1)},_intersectsWithSides:function(item){var isOverBottomHalf=isOverAxis(this.positionAbs.top+this.offset.click.top,item.top+item.height/2,item.height),isOverRightHalf=isOverAxis(this.positionAbs.left+this.offset.click.left,item.left+item.width/2,item.width),verticalDirection=this._getDragVerticalDirection(),horizontalDirection=this._getDragHorizontalDirection();if(this.floating&&horizontalDirection){return horizontalDirection==="right"&&isOverRightHalf||horizontalDirection==="left"&&!isOverRightHalf}else{return verticalDirection&&(verticalDirection==="down"&&isOverBottomHalf||verticalDirection==="up"&&!isOverBottomHalf)}},_getDragVerticalDirection:function(){var delta=this.positionAbs.top-this.lastPositionAbs.top;return delta!==0&&(delta>0?"down":"up")},_getDragHorizontalDirection:function(){var delta=this.positionAbs.left-this.lastPositionAbs.left;return delta!==0&&(delta>0?"right":"left")},refresh:function(event){this._refreshItems(event);this.refreshPositions();return this},_connectWith:function(){var options=this.options;return options.connectWith.constructor===String?[options.connectWith]:options.connectWith},_getItemsAsjQuery:function(connected){var i,j,cur,inst,items=[],queries=[],connectWith=this._connectWith();if(connectWith&&connected){for(i=connectWith.length-1;i>=0;i--){cur=$(connectWith[i]);for(j=cur.length-1;j>=0;j--){inst=$.data(cur[j],this.widgetFullName);if(inst&&inst!==this&&!inst.options.disabled){queries.push([$.isFunction(inst.options.items)?inst.options.items.call(inst.element):$(inst.options.items,inst.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),inst])}}}}queries.push([$.isFunction(this.options.items)?this.options.items.call(this.element,null,{options:this.options,item:this.currentItem}):$(this.options.items,this.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),this]);function addItems(){items.push(this)}for(i=queries.length-1;i>=0;i--){queries[i][0].each(addItems)}return $(items)},_removeCurrentsFromItems:function(){var list=this.currentItem.find(":data("+this.widgetName+"-item)");this.items=$.grep(this.items,function(item){for(var j=0;j<list.length;j++){if(list[j]===item.item[0]){return false}}return true})},_refreshItems:function(event){this.items=[];this.containers=[this];var i,j,cur,inst,targetData,_queries,item,queriesLength,items=this.items,queries=[[$.isFunction(this.options.items)?this.options.items.call(this.element[0],event,{item:this.currentItem}):$(this.options.items,this.element),this]],connectWith=this._connectWith();if(connectWith&&this.ready){for(i=connectWith.length-1;i>=0;i--){cur=$(connectWith[i]);for(j=cur.length-1;j>=0;j--){inst=$.data(cur[j],this.widgetFullName);if(inst&&inst!==this&&!inst.options.disabled){queries.push([$.isFunction(inst.options.items)?inst.options.items.call(inst.element[0],event,{item:this.currentItem}):$(inst.options.items,inst.element),inst]);this.containers.push(inst)}}}}for(i=queries.length-1;i>=0;i--){targetData=queries[i][1];_queries=queries[i][0];for(j=0,queriesLength=_queries.length;j<queriesLength;j++){item=$(_queries[j]);item.data(this.widgetName+"-item",targetData);items.push({item:item,instance:targetData,width:0,height:0,left:0,top:0})}}},refreshPositions:function(fast){if(this.offsetParent&&this.helper){this.offset.parent=this._getParentOffset()}var i,item,t,p;for(i=this.items.length-1;i>=0;i--){item=this.items[i];if(item.instance!==this.currentContainer&&this.currentContainer&&item.item[0]!==this.currentItem[0]){continue}t=this.options.toleranceElement?$(this.options.toleranceElement,item.item):item.item;if(!fast){item.width=t.outerWidth();item.height=t.outerHeight()}p=t.offset();item.left=p.left;item.top=p.top}if(this.options.custom&&this.options.custom.refreshContainers){this.options.custom.refreshContainers.call(this)}else{for(i=this.containers.length-1;i>=0;i--){p=this.containers[i].element.offset();this.containers[i].containerCache.left=p.left;this.containers[i].containerCache.top=p.top;this.containers[i].containerCache.width=this.containers[i].element.outerWidth();this.containers[i].containerCache.height=this.containers[i].element.outerHeight()}}return this},_createPlaceholder:function(that){that=that||this;var className,o=that.options;if(!o.placeholder||o.placeholder.constructor===String){className=o.placeholder;o.placeholder={element:function(){var nodeName=that.currentItem[0].nodeName.toLowerCase(),element=$("<"+nodeName+">",that.document[0]).addClass(className||that.currentItem[0].className+" ui-sortable-placeholder").removeClass("ui-sortable-helper");if(nodeName==="tr"){that.currentItem.children().each(function(){$("<td>&#160;</td>",that.document[0]).attr("colspan",$(this).attr("colspan")||1).appendTo(element)})}else if(nodeName==="img"){element.attr("src",that.currentItem.attr("src"))}if(!className){element.css("visibility","hidden")}return element},update:function(container,p){if(className&&!o.forcePlaceholderSize){return}if(!p.height()){p.height(that.currentItem.innerHeight()-parseInt(that.currentItem.css("paddingTop")||0,10)-parseInt(that.currentItem.css("paddingBottom")||0,10))}if(!p.width()){p.width(that.currentItem.innerWidth()-parseInt(that.currentItem.css("paddingLeft")||0,10)-parseInt(that.currentItem.css("paddingRight")||0,10))}}}}that.placeholder=$(o.placeholder.element.call(that.element,that.currentItem));that.currentItem.after(that.placeholder);o.placeholder.update(that,that.placeholder)},_contactContainers:function(event){var i,j,dist,itemWithLeastDistance,posProperty,sizeProperty,base,cur,nearBottom,floating,innermostContainer=null,innermostIndex=null;for(i=this.containers.length-1;i>=0;i--){if($.contains(this.currentItem[0],this.containers[i].element[0])){continue}if(this._intersectsWith(this.containers[i].containerCache)){if(innermostContainer&&$.contains(this.containers[i].element[0],innermostContainer.element[0])){continue}innermostContainer=this.containers[i];innermostIndex=i}else{if(this.containers[i].containerCache.over){this.containers[i]._trigger("out",event,this._uiHash(this));this.containers[i].containerCache.over=0}}}if(!innermostContainer){return}if(this.containers.length===1){if(!this.containers[innermostIndex].containerCache.over){this.containers[innermostIndex]._trigger("over",event,this._uiHash(this));this.containers[innermostIndex].containerCache.over=1}}else{dist=1e4;itemWithLeastDistance=null;floating=innermostContainer.floating||isFloating(this.currentItem);posProperty=floating?"left":"top";sizeProperty=floating?"width":"height";base=this.positionAbs[posProperty]+this.offset.click[posProperty];for(j=this.items.length-1;j>=0;j--){if(!$.contains(this.containers[innermostIndex].element[0],this.items[j].item[0])){continue}if(this.items[j].item[0]===this.currentItem[0]){continue}if(floating&&!isOverAxis(this.positionAbs.top+this.offset.click.top,this.items[j].top,this.items[j].height)){continue}cur=this.items[j].item.offset()[posProperty];nearBottom=false;if(Math.abs(cur-base)>Math.abs(cur+this.items[j][sizeProperty]-base)){nearBottom=true;cur+=this.items[j][sizeProperty]}if(Math.abs(cur-base)<dist){dist=Math.abs(cur-base);itemWithLeastDistance=this.items[j];this.direction=nearBottom?"up":"down"}}if(!itemWithLeastDistance&&!this.options.dropOnEmpty){return}if(this.currentContainer===this.containers[innermostIndex]){return}itemWithLeastDistance?this._rearrange(event,itemWithLeastDistance,null,true):this._rearrange(event,null,this.containers[innermostIndex].element,true);this._trigger("change",event,this._uiHash());this.containers[innermostIndex]._trigger("change",event,this._uiHash(this));this.currentContainer=this.containers[innermostIndex];this.options.placeholder.update(this.currentContainer,this.placeholder);this.containers[innermostIndex]._trigger("over",event,this._uiHash(this));this.containers[innermostIndex].containerCache.over=1}},_createHelper:function(event){var o=this.options,helper=$.isFunction(o.helper)?$(o.helper.apply(this.element[0],[event,this.currentItem])):o.helper==="clone"?this.currentItem.clone():this.currentItem;if(!helper.parents("body").length){$(o.appendTo!=="parent"?o.appendTo:this.currentItem[0].parentNode)[0].appendChild(helper[0])}if(helper[0]===this.currentItem[0]){this._storedCSS={width:this.currentItem[0].style.width,height:this.currentItem[0].style.height,position:this.currentItem.css("position"),top:this.currentItem.css("top"),left:this.currentItem.css("left")}}if(!helper[0].style.width||o.forceHelperSize){helper.width(this.currentItem.width())}if(!helper[0].style.height||o.forceHelperSize){helper.height(this.currentItem.height())}return helper},_adjustOffsetFromHelper:function(obj){if(typeof obj==="string"){obj=obj.split(" ")}if($.isArray(obj)){obj={left:+obj[0],top:+obj[1]||0}}if("left"in obj){this.offset.click.left=obj.left+this.margins.left}if("right"in obj){this.offset.click.left=this.helperProportions.width-obj.right+this.margins.left}if("top"in obj){this.offset.click.top=obj.top+this.margins.top}if("bottom"in obj){this.offset.click.top=this.helperProportions.height-obj.bottom+this.margins.top}},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var po=this.offsetParent.offset();if(this.cssPosition==="absolute"&&this.scrollParent[0]!==document&&$.contains(this.scrollParent[0],this.offsetParent[0])){po.left+=this.scrollParent.scrollLeft();po.top+=this.scrollParent.scrollTop()}if(this.offsetParent[0]===document.body||this.offsetParent[0].tagName&&this.offsetParent[0].tagName.toLowerCase()==="html"&&$.ui.ie){po={top:0,left:0}}return{top:po.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:po.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if(this.cssPosition==="relative"){var p=this.currentItem.position();return{top:p.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:p.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}else{return{top:0,left:0}}},_cacheMargins:function(){this.margins={left:parseInt(this.currentItem.css("marginLeft"),10)||0,top:parseInt(this.currentItem.css("marginTop"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var ce,co,over,o=this.options;if(o.containment==="parent"){o.containment=this.helper[0].parentNode}if(o.containment==="document"||o.containment==="window"){this.containment=[0-this.offset.relative.left-this.offset.parent.left,0-this.offset.relative.top-this.offset.parent.top,$(o.containment==="document"?document:window).width()-this.helperProportions.width-this.margins.left,($(o.containment==="document"?document:window).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]}if(!/^(document|window|parent)$/.test(o.containment)){ce=$(o.containment)[0];co=$(o.containment).offset();over=$(ce).css("overflow")!=="hidden";this.containment=[co.left+(parseInt($(ce).css("borderLeftWidth"),10)||0)+(parseInt($(ce).css("paddingLeft"),10)||0)-this.margins.left,co.top+(parseInt($(ce).css("borderTopWidth"),10)||0)+(parseInt($(ce).css("paddingTop"),10)||0)-this.margins.top,co.left+(over?Math.max(ce.scrollWidth,ce.offsetWidth):ce.offsetWidth)-(parseInt($(ce).css("borderLeftWidth"),10)||0)-(parseInt($(ce).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left,co.top+(over?Math.max(ce.scrollHeight,ce.offsetHeight):ce.offsetHeight)-(parseInt($(ce).css("borderTopWidth"),10)||0)-(parseInt($(ce).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top]}},_convertPositionTo:function(d,pos){if(!pos){pos=this.position}var mod=d==="absolute"?1:-1,scroll=this.cssPosition==="absolute"&&!(this.scrollParent[0]!==document&&$.contains(this.scrollParent[0],this.offsetParent[0]))?this.offsetParent:this.scrollParent,scrollIsRootNode=/(html|body)/i.test(scroll[0].tagName);return{top:pos.top+this.offset.relative.top*mod+this.offset.parent.top*mod-(this.cssPosition==="fixed"?-this.scrollParent.scrollTop():scrollIsRootNode?0:scroll.scrollTop())*mod,left:pos.left+this.offset.relative.left*mod+this.offset.parent.left*mod-(this.cssPosition==="fixed"?-this.scrollParent.scrollLeft():scrollIsRootNode?0:scroll.scrollLeft())*mod}},_generatePosition:function(event){var top,left,o=this.options,pageX=event.pageX,pageY=event.pageY,scroll=this.cssPosition==="absolute"&&!(this.scrollParent[0]!==document&&$.contains(this.scrollParent[0],this.offsetParent[0]))?this.offsetParent:this.scrollParent,scrollIsRootNode=/(html|body)/i.test(scroll[0].tagName);if(this.cssPosition==="relative"&&!(this.scrollParent[0]!==document&&this.scrollParent[0]!==this.offsetParent[0])){this.offset.relative=this._getRelativeOffset()}if(this.originalPosition){if(this.containment){if(event.pageX-this.offset.click.left<this.containment[0]){pageX=this.containment[0]+this.offset.click.left}if(event.pageY-this.offset.click.top<this.containment[1]){pageY=this.containment[1]+this.offset.click.top}if(event.pageX-this.offset.click.left>this.containment[2]){pageX=this.containment[2]+this.offset.click.left}if(event.pageY-this.offset.click.top>this.containment[3]){pageY=this.containment[3]+this.offset.click.top}}if(o.grid){top=this.originalPageY+Math.round((pageY-this.originalPageY)/o.grid[1])*o.grid[1];pageY=this.containment?top-this.offset.click.top>=this.containment[1]&&top-this.offset.click.top<=this.containment[3]?top:top-this.offset.click.top>=this.containment[1]?top-o.grid[1]:top+o.grid[1]:top;left=this.originalPageX+Math.round((pageX-this.originalPageX)/o.grid[0])*o.grid[0];pageX=this.containment?left-this.offset.click.left>=this.containment[0]&&left-this.offset.click.left<=this.containment[2]?left:left-this.offset.click.left>=this.containment[0]?left-o.grid[0]:left+o.grid[0]:left}}return{top:pageY-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+(this.cssPosition==="fixed"?-this.scrollParent.scrollTop():scrollIsRootNode?0:scroll.scrollTop()),left:pageX-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+(this.cssPosition==="fixed"?-this.scrollParent.scrollLeft():scrollIsRootNode?0:scroll.scrollLeft())}},_rearrange:function(event,i,a,hardRefresh){a?a[0].appendChild(this.placeholder[0]):i.item[0].parentNode.insertBefore(this.placeholder[0],this.direction==="down"?i.item[0]:i.item[0].nextSibling);this.counter=this.counter?++this.counter:1;var counter=this.counter;this._delay(function(){if(counter===this.counter){this.refreshPositions(!hardRefresh)}})},_clear:function(event,noPropagation){this.reverting=false;var i,delayedTriggers=[];if(!this._noFinalSort&&this.currentItem.parent().length){this.placeholder.before(this.currentItem)}this._noFinalSort=null;if(this.helper[0]===this.currentItem[0]){for(i in this._storedCSS){if(this._storedCSS[i]==="auto"||this._storedCSS[i]==="static"){this._storedCSS[i]=""}}this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper")}else{this.currentItem.show()}if(this.fromOutside&&!noPropagation){delayedTriggers.push(function(event){this._trigger("receive",event,this._uiHash(this.fromOutside))})}if((this.fromOutside||this.domPosition.prev!==this.currentItem.prev().not(".ui-sortable-helper")[0]||this.domPosition.parent!==this.currentItem.parent()[0])&&!noPropagation){delayedTriggers.push(function(event){this._trigger("update",event,this._uiHash())})}if(this!==this.currentContainer){if(!noPropagation){delayedTriggers.push(function(event){this._trigger("remove",event,this._uiHash())});delayedTriggers.push(function(c){return function(event){c._trigger("receive",event,this._uiHash(this))}}.call(this,this.currentContainer));delayedTriggers.push(function(c){return function(event){c._trigger("update",event,this._uiHash(this))}}.call(this,this.currentContainer))}}function delayEvent(type,instance,container){return function(event){container._trigger(type,event,instance._uiHash(instance))}}for(i=this.containers.length-1;i>=0;i--){if(!noPropagation){delayedTriggers.push(delayEvent("deactivate",this,this.containers[i]))}if(this.containers[i].containerCache.over){delayedTriggers.push(delayEvent("out",this,this.containers[i]));this.containers[i].containerCache.over=0
}}if(this.storedCursor){this.document.find("body").css("cursor",this.storedCursor);this.storedStylesheet.remove()}if(this._storedOpacity){this.helper.css("opacity",this._storedOpacity)}if(this._storedZIndex){this.helper.css("zIndex",this._storedZIndex==="auto"?"":this._storedZIndex)}this.dragging=false;if(this.cancelHelperRemoval){if(!noPropagation){this._trigger("beforeStop",event,this._uiHash());for(i=0;i<delayedTriggers.length;i++){delayedTriggers[i].call(this,event)}this._trigger("stop",event,this._uiHash())}this.fromOutside=false;return false}if(!noPropagation){this._trigger("beforeStop",event,this._uiHash())}this.placeholder[0].parentNode.removeChild(this.placeholder[0]);if(this.helper[0]!==this.currentItem[0]){this.helper.remove()}this.helper=null;if(!noPropagation){for(i=0;i<delayedTriggers.length;i++){delayedTriggers[i].call(this,event)}this._trigger("stop",event,this._uiHash())}this.fromOutside=false;return true},_trigger:function(){if($.Widget.prototype._trigger.apply(this,arguments)===false){this.cancel()}},_uiHash:function(_inst){var inst=_inst||this;return{helper:inst.helper,placeholder:inst.placeholder||$([]),position:inst.position,originalPosition:inst.originalPosition,offset:inst.positionAbs,item:inst.currentItem,sender:_inst?_inst.element:null}}})})(jQuery);(function($,undefined){$.extend($.ui,{datepicker:{version:"1.10.4"}});var PROP_NAME="datepicker",instActive;function Datepicker(){this._curInst=null;this._keyEvent=false;this._disabledInputs=[];this._datepickerShowing=false;this._inDialog=false;this._mainDivId="ui-datepicker-div";this._inlineClass="ui-datepicker-inline";this._appendClass="ui-datepicker-append";this._triggerClass="ui-datepicker-trigger";this._dialogClass="ui-datepicker-dialog";this._disableClass="ui-datepicker-disabled";this._unselectableClass="ui-datepicker-unselectable";this._currentClass="ui-datepicker-current-day";this._dayOverClass="ui-datepicker-days-cell-over";this.regional=[];this.regional[""]={closeText:"Done",prevText:"Prev",nextText:"Next",currentText:"Today",monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],monthNamesShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],dayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],dayNamesShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],dayNamesMin:["Su","Mo","Tu","We","Th","Fr","Sa"],weekHeader:"Wk",dateFormat:"mm/dd/yy",firstDay:0,isRTL:false,showMonthAfterYear:false,yearSuffix:""};this._defaults={showOn:"focus",showAnim:"fadeIn",showOptions:{},defaultDate:null,appendText:"",buttonText:"...",buttonImage:"",buttonImageOnly:false,hideIfNoPrevNext:false,navigationAsDateFormat:false,gotoCurrent:false,changeMonth:false,changeYear:false,yearRange:"c-10:c+10",showOtherMonths:false,selectOtherMonths:false,showWeek:false,calculateWeek:this.iso8601Week,shortYearCutoff:"+10",minDate:null,maxDate:null,duration:"fast",beforeShowDay:null,beforeShow:null,onSelect:null,onChangeMonthYear:null,onClose:null,numberOfMonths:1,showCurrentAtPos:0,stepMonths:1,stepBigMonths:12,altField:"",altFormat:"",constrainInput:true,showButtonPanel:false,autoSize:false,disabled:false};$.extend(this._defaults,this.regional[""]);this.dpDiv=bindHover($("<div id='"+this._mainDivId+"' class='ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all'></div>"))}$.extend(Datepicker.prototype,{markerClassName:"hasDatepicker",maxRows:4,_widgetDatepicker:function(){return this.dpDiv},setDefaults:function(settings){extendRemove(this._defaults,settings||{});return this},_attachDatepicker:function(target,settings){var nodeName,inline,inst;nodeName=target.nodeName.toLowerCase();inline=nodeName==="div"||nodeName==="span";if(!target.id){this.uuid+=1;target.id="dp"+this.uuid}inst=this._newInst($(target),inline);inst.settings=$.extend({},settings||{});if(nodeName==="input"){this._connectDatepicker(target,inst)}else if(inline){this._inlineDatepicker(target,inst)}},_newInst:function(target,inline){var id=target[0].id.replace(/([^A-Za-z0-9_\-])/g,"\\\\$1");return{id:id,input:target,selectedDay:0,selectedMonth:0,selectedYear:0,drawMonth:0,drawYear:0,inline:inline,dpDiv:!inline?this.dpDiv:bindHover($("<div class='"+this._inlineClass+" ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all'></div>"))}},_connectDatepicker:function(target,inst){var input=$(target);inst.append=$([]);inst.trigger=$([]);if(input.hasClass(this.markerClassName)){return}this._attachments(input,inst);input.addClass(this.markerClassName).keydown(this._doKeyDown).keypress(this._doKeyPress).keyup(this._doKeyUp);this._autoSize(inst);$.data(target,PROP_NAME,inst);if(inst.settings.disabled){this._disableDatepicker(target)}},_attachments:function(input,inst){var showOn,buttonText,buttonImage,appendText=this._get(inst,"appendText"),isRTL=this._get(inst,"isRTL");if(inst.append){inst.append.remove()}if(appendText){inst.append=$("<span class='"+this._appendClass+"'>"+appendText+"</span>");input[isRTL?"before":"after"](inst.append)}input.unbind("focus",this._showDatepicker);if(inst.trigger){inst.trigger.remove()}showOn=this._get(inst,"showOn");if(showOn==="focus"||showOn==="both"){input.focus(this._showDatepicker)}if(showOn==="button"||showOn==="both"){buttonText=this._get(inst,"buttonText");buttonImage=this._get(inst,"buttonImage");inst.trigger=$(this._get(inst,"buttonImageOnly")?$("<img/>").addClass(this._triggerClass).attr({src:buttonImage,alt:buttonText,title:buttonText}):$("<button type='button'></button>").addClass(this._triggerClass).html(!buttonImage?buttonText:$("<img/>").attr({src:buttonImage,alt:buttonText,title:buttonText})));input[isRTL?"before":"after"](inst.trigger);inst.trigger.click(function(){if($.datepicker._datepickerShowing&&$.datepicker._lastInput===input[0]){$.datepicker._hideDatepicker()}else if($.datepicker._datepickerShowing&&$.datepicker._lastInput!==input[0]){$.datepicker._hideDatepicker();$.datepicker._showDatepicker(input[0])}else{$.datepicker._showDatepicker(input[0])}return false})}},_autoSize:function(inst){if(this._get(inst,"autoSize")&&!inst.inline){var findMax,max,maxI,i,date=new Date(2009,12-1,20),dateFormat=this._get(inst,"dateFormat");if(dateFormat.match(/[DM]/)){findMax=function(names){max=0;maxI=0;for(i=0;i<names.length;i++){if(names[i].length>max){max=names[i].length;maxI=i}}return maxI};date.setMonth(findMax(this._get(inst,dateFormat.match(/MM/)?"monthNames":"monthNamesShort")));date.setDate(findMax(this._get(inst,dateFormat.match(/DD/)?"dayNames":"dayNamesShort"))+20-date.getDay())}inst.input.attr("size",this._formatDate(inst,date).length)}},_inlineDatepicker:function(target,inst){var divSpan=$(target);if(divSpan.hasClass(this.markerClassName)){return}divSpan.addClass(this.markerClassName).append(inst.dpDiv);$.data(target,PROP_NAME,inst);this._setDate(inst,this._getDefaultDate(inst),true);this._updateDatepicker(inst);this._updateAlternate(inst);if(inst.settings.disabled){this._disableDatepicker(target)}inst.dpDiv.css("display","block")},_dialogDatepicker:function(input,date,onSelect,settings,pos){var id,browserWidth,browserHeight,scrollX,scrollY,inst=this._dialogInst;if(!inst){this.uuid+=1;id="dp"+this.uuid;this._dialogInput=$("<input type='text' id='"+id+"' style='position: absolute; top: -100px; width: 0px;'/>");this._dialogInput.keydown(this._doKeyDown);$("body").append(this._dialogInput);inst=this._dialogInst=this._newInst(this._dialogInput,false);inst.settings={};$.data(this._dialogInput[0],PROP_NAME,inst)}extendRemove(inst.settings,settings||{});date=date&&date.constructor===Date?this._formatDate(inst,date):date;this._dialogInput.val(date);this._pos=pos?pos.length?pos:[pos.pageX,pos.pageY]:null;if(!this._pos){browserWidth=document.documentElement.clientWidth;browserHeight=document.documentElement.clientHeight;scrollX=document.documentElement.scrollLeft||document.body.scrollLeft;scrollY=document.documentElement.scrollTop||document.body.scrollTop;this._pos=[browserWidth/2-100+scrollX,browserHeight/2-150+scrollY]}this._dialogInput.css("left",this._pos[0]+20+"px").css("top",this._pos[1]+"px");inst.settings.onSelect=onSelect;this._inDialog=true;this.dpDiv.addClass(this._dialogClass);this._showDatepicker(this._dialogInput[0]);if($.blockUI){$.blockUI(this.dpDiv)}$.data(this._dialogInput[0],PROP_NAME,inst);return this},_destroyDatepicker:function(target){var nodeName,$target=$(target),inst=$.data(target,PROP_NAME);if(!$target.hasClass(this.markerClassName)){return}nodeName=target.nodeName.toLowerCase();$.removeData(target,PROP_NAME);if(nodeName==="input"){inst.append.remove();inst.trigger.remove();$target.removeClass(this.markerClassName).unbind("focus",this._showDatepicker).unbind("keydown",this._doKeyDown).unbind("keypress",this._doKeyPress).unbind("keyup",this._doKeyUp)}else if(nodeName==="div"||nodeName==="span"){$target.removeClass(this.markerClassName).empty()}},_enableDatepicker:function(target){var nodeName,inline,$target=$(target),inst=$.data(target,PROP_NAME);if(!$target.hasClass(this.markerClassName)){return}nodeName=target.nodeName.toLowerCase();if(nodeName==="input"){target.disabled=false;inst.trigger.filter("button").each(function(){this.disabled=false}).end().filter("img").css({opacity:"1.0",cursor:""})}else if(nodeName==="div"||nodeName==="span"){inline=$target.children("."+this._inlineClass);inline.children().removeClass("ui-state-disabled");inline.find("select.ui-datepicker-month, select.ui-datepicker-year").prop("disabled",false)}this._disabledInputs=$.map(this._disabledInputs,function(value){return value===target?null:value})},_disableDatepicker:function(target){var nodeName,inline,$target=$(target),inst=$.data(target,PROP_NAME);if(!$target.hasClass(this.markerClassName)){return}nodeName=target.nodeName.toLowerCase();if(nodeName==="input"){target.disabled=true;inst.trigger.filter("button").each(function(){this.disabled=true}).end().filter("img").css({opacity:"0.5",cursor:"default"})}else if(nodeName==="div"||nodeName==="span"){inline=$target.children("."+this._inlineClass);inline.children().addClass("ui-state-disabled");inline.find("select.ui-datepicker-month, select.ui-datepicker-year").prop("disabled",true)}this._disabledInputs=$.map(this._disabledInputs,function(value){return value===target?null:value});this._disabledInputs[this._disabledInputs.length]=target},_isDisabledDatepicker:function(target){if(!target){return false}for(var i=0;i<this._disabledInputs.length;i++){if(this._disabledInputs[i]===target){return true}}return false},_getInst:function(target){try{return $.data(target,PROP_NAME)}catch(err){throw"Missing instance data for this datepicker"}},_optionDatepicker:function(target,name,value){var settings,date,minDate,maxDate,inst=this._getInst(target);if(arguments.length===2&&typeof name==="string"){return name==="defaults"?$.extend({},$.datepicker._defaults):inst?name==="all"?$.extend({},inst.settings):this._get(inst,name):null}settings=name||{};if(typeof name==="string"){settings={};settings[name]=value}if(inst){if(this._curInst===inst){this._hideDatepicker()}date=this._getDateDatepicker(target,true);minDate=this._getMinMaxDate(inst,"min");maxDate=this._getMinMaxDate(inst,"max");extendRemove(inst.settings,settings);if(minDate!==null&&settings.dateFormat!==undefined&&settings.minDate===undefined){inst.settings.minDate=this._formatDate(inst,minDate)}if(maxDate!==null&&settings.dateFormat!==undefined&&settings.maxDate===undefined){inst.settings.maxDate=this._formatDate(inst,maxDate)}if("disabled"in settings){if(settings.disabled){this._disableDatepicker(target)}else{this._enableDatepicker(target)}}this._attachments($(target),inst);this._autoSize(inst);this._setDate(inst,date);this._updateAlternate(inst);this._updateDatepicker(inst)}},_changeDatepicker:function(target,name,value){this._optionDatepicker(target,name,value)},_refreshDatepicker:function(target){var inst=this._getInst(target);if(inst){this._updateDatepicker(inst)}},_setDateDatepicker:function(target,date){var inst=this._getInst(target);if(inst){this._setDate(inst,date);this._updateDatepicker(inst);this._updateAlternate(inst)}},_getDateDatepicker:function(target,noDefault){var inst=this._getInst(target);if(inst&&!inst.inline){this._setDateFromField(inst,noDefault)}return inst?this._getDate(inst):null},_doKeyDown:function(event){var onSelect,dateStr,sel,inst=$.datepicker._getInst(event.target),handled=true,isRTL=inst.dpDiv.is(".ui-datepicker-rtl");inst._keyEvent=true;if($.datepicker._datepickerShowing){switch(event.keyCode){case 9:$.datepicker._hideDatepicker();handled=false;break;case 13:sel=$("td."+$.datepicker._dayOverClass+":not(."+$.datepicker._currentClass+")",inst.dpDiv);if(sel[0]){$.datepicker._selectDay(event.target,inst.selectedMonth,inst.selectedYear,sel[0])}onSelect=$.datepicker._get(inst,"onSelect");if(onSelect){dateStr=$.datepicker._formatDate(inst);onSelect.apply(inst.input?inst.input[0]:null,[dateStr,inst])}else{$.datepicker._hideDatepicker()}return false;case 27:$.datepicker._hideDatepicker();break;case 33:$.datepicker._adjustDate(event.target,event.ctrlKey?-$.datepicker._get(inst,"stepBigMonths"):-$.datepicker._get(inst,"stepMonths"),"M");break;case 34:$.datepicker._adjustDate(event.target,event.ctrlKey?+$.datepicker._get(inst,"stepBigMonths"):+$.datepicker._get(inst,"stepMonths"),"M");break;case 35:if(event.ctrlKey||event.metaKey){$.datepicker._clearDate(event.target)}handled=event.ctrlKey||event.metaKey;break;case 36:if(event.ctrlKey||event.metaKey){$.datepicker._gotoToday(event.target)}handled=event.ctrlKey||event.metaKey;break;case 37:if(event.ctrlKey||event.metaKey){$.datepicker._adjustDate(event.target,isRTL?+1:-1,"D")}handled=event.ctrlKey||event.metaKey;if(event.originalEvent.altKey){$.datepicker._adjustDate(event.target,event.ctrlKey?-$.datepicker._get(inst,"stepBigMonths"):-$.datepicker._get(inst,"stepMonths"),"M")}break;case 38:if(event.ctrlKey||event.metaKey){$.datepicker._adjustDate(event.target,-7,"D")}handled=event.ctrlKey||event.metaKey;break;case 39:if(event.ctrlKey||event.metaKey){$.datepicker._adjustDate(event.target,isRTL?-1:+1,"D")}handled=event.ctrlKey||event.metaKey;if(event.originalEvent.altKey){$.datepicker._adjustDate(event.target,event.ctrlKey?+$.datepicker._get(inst,"stepBigMonths"):+$.datepicker._get(inst,"stepMonths"),"M")}break;case 40:if(event.ctrlKey||event.metaKey){$.datepicker._adjustDate(event.target,+7,"D")}handled=event.ctrlKey||event.metaKey;break;default:handled=false}}else if(event.keyCode===36&&event.ctrlKey){$.datepicker._showDatepicker(this)}else{handled=false}if(handled){event.preventDefault();event.stopPropagation()}},_doKeyPress:function(event){var chars,chr,inst=$.datepicker._getInst(event.target);if($.datepicker._get(inst,"constrainInput")){chars=$.datepicker._possibleChars($.datepicker._get(inst,"dateFormat"));chr=String.fromCharCode(event.charCode==null?event.keyCode:event.charCode);return event.ctrlKey||event.metaKey||(chr<" "||!chars||chars.indexOf(chr)>-1)}},_doKeyUp:function(event){var date,inst=$.datepicker._getInst(event.target);if(inst.input.val()!==inst.lastVal){try{date=$.datepicker.parseDate($.datepicker._get(inst,"dateFormat"),inst.input?inst.input.val():null,$.datepicker._getFormatConfig(inst));if(date){$.datepicker._setDateFromField(inst);$.datepicker._updateAlternate(inst);$.datepicker._updateDatepicker(inst)}}catch(err){}}return true},_showDatepicker:function(input){input=input.target||input;if(input.nodeName.toLowerCase()!=="input"){input=$("input",input.parentNode)[0]}if($.datepicker._isDisabledDatepicker(input)||$.datepicker._lastInput===input){return}var inst,beforeShow,beforeShowSettings,isFixed,offset,showAnim,duration;inst=$.datepicker._getInst(input);if($.datepicker._curInst&&$.datepicker._curInst!==inst){$.datepicker._curInst.dpDiv.stop(true,true);if(inst&&$.datepicker._datepickerShowing){$.datepicker._hideDatepicker($.datepicker._curInst.input[0])}}beforeShow=$.datepicker._get(inst,"beforeShow");beforeShowSettings=beforeShow?beforeShow.apply(input,[input,inst]):{};if(beforeShowSettings===false){return}extendRemove(inst.settings,beforeShowSettings);inst.lastVal=null;$.datepicker._lastInput=input;$.datepicker._setDateFromField(inst);if($.datepicker._inDialog){input.value=""}if(!$.datepicker._pos){$.datepicker._pos=$.datepicker._findPos(input);$.datepicker._pos[1]+=input.offsetHeight}isFixed=false;$(input).parents().each(function(){isFixed|=$(this).css("position")==="fixed";return!isFixed});offset={left:$.datepicker._pos[0],top:$.datepicker._pos[1]};$.datepicker._pos=null;inst.dpDiv.empty();inst.dpDiv.css({position:"absolute",display:"block",top:"-1000px"});$.datepicker._updateDatepicker(inst);offset=$.datepicker._checkOffset(inst,offset,isFixed);inst.dpDiv.css({position:$.datepicker._inDialog&&$.blockUI?"static":isFixed?"fixed":"absolute",display:"none",left:offset.left+"px",top:offset.top+"px"});if(!inst.inline){showAnim=$.datepicker._get(inst,"showAnim");duration=$.datepicker._get(inst,"duration");inst.dpDiv.zIndex($(input).zIndex()+1);$.datepicker._datepickerShowing=true;if($.effects&&$.effects.effect[showAnim]){inst.dpDiv.show(showAnim,$.datepicker._get(inst,"showOptions"),duration)}else{inst.dpDiv[showAnim||"show"](showAnim?duration:null)}if($.datepicker._shouldFocusInput(inst)){inst.input.focus()}$.datepicker._curInst=inst}},_updateDatepicker:function(inst){this.maxRows=4;instActive=inst;inst.dpDiv.empty().append(this._generateHTML(inst));this._attachHandlers(inst);inst.dpDiv.find("."+this._dayOverClass+" a").mouseover();var origyearshtml,numMonths=this._getNumberOfMonths(inst),cols=numMonths[1],width=17;inst.dpDiv.removeClass("ui-datepicker-multi-2 ui-datepicker-multi-3 ui-datepicker-multi-4").width("");if(cols>1){inst.dpDiv.addClass("ui-datepicker-multi-"+cols).css("width",width*cols+"em")}inst.dpDiv[(numMonths[0]!==1||numMonths[1]!==1?"add":"remove")+"Class"]("ui-datepicker-multi");inst.dpDiv[(this._get(inst,"isRTL")?"add":"remove")+"Class"]("ui-datepicker-rtl");if(inst===$.datepicker._curInst&&$.datepicker._datepickerShowing&&$.datepicker._shouldFocusInput(inst)){inst.input.focus()}if(inst.yearshtml){origyearshtml=inst.yearshtml;setTimeout(function(){if(origyearshtml===inst.yearshtml&&inst.yearshtml){inst.dpDiv.find("select.ui-datepicker-year:first").replaceWith(inst.yearshtml)}origyearshtml=inst.yearshtml=null},0)}},_shouldFocusInput:function(inst){return inst.input&&inst.input.is(":visible")&&!inst.input.is(":disabled")&&!inst.input.is(":focus")},_checkOffset:function(inst,offset,isFixed){var dpWidth=inst.dpDiv.outerWidth(),dpHeight=inst.dpDiv.outerHeight(),inputWidth=inst.input?inst.input.outerWidth():0,inputHeight=inst.input?inst.input.outerHeight():0,viewWidth=document.documentElement.clientWidth+(isFixed?0:$(document).scrollLeft()),viewHeight=document.documentElement.clientHeight+(isFixed?0:$(document).scrollTop());offset.left-=this._get(inst,"isRTL")?dpWidth-inputWidth:0;offset.left-=isFixed&&offset.left===inst.input.offset().left?$(document).scrollLeft():0;offset.top-=isFixed&&offset.top===inst.input.offset().top+inputHeight?$(document).scrollTop():0;offset.left-=Math.min(offset.left,offset.left+dpWidth>viewWidth&&viewWidth>dpWidth?Math.abs(offset.left+dpWidth-viewWidth):0);offset.top-=Math.min(offset.top,offset.top+dpHeight>viewHeight&&viewHeight>dpHeight?Math.abs(dpHeight+inputHeight):0);return offset},_findPos:function(obj){var position,inst=this._getInst(obj),isRTL=this._get(inst,"isRTL");while(obj&&(obj.type==="hidden"||obj.nodeType!==1||$.expr.filters.hidden(obj))){obj=obj[isRTL?"previousSibling":"nextSibling"]}position=$(obj).offset();return[position.left,position.top]},_hideDatepicker:function(input){var showAnim,duration,postProcess,onClose,inst=this._curInst;if(!inst||input&&inst!==$.data(input,PROP_NAME)){return}if(this._datepickerShowing){showAnim=this._get(inst,"showAnim");duration=this._get(inst,"duration");postProcess=function(){$.datepicker._tidyDialog(inst)};if($.effects&&($.effects.effect[showAnim]||$.effects[showAnim])){inst.dpDiv.hide(showAnim,$.datepicker._get(inst,"showOptions"),duration,postProcess)}else{inst.dpDiv[showAnim==="slideDown"?"slideUp":showAnim==="fadeIn"?"fadeOut":"hide"](showAnim?duration:null,postProcess)}if(!showAnim){postProcess()}this._datepickerShowing=false;onClose=this._get(inst,"onClose");if(onClose){onClose.apply(inst.input?inst.input[0]:null,[inst.input?inst.input.val():"",inst])}this._lastInput=null;if(this._inDialog){this._dialogInput.css({position:"absolute",left:"0",top:"-100px"});if($.blockUI){$.unblockUI();$("body").append(this.dpDiv)}}this._inDialog=false}},_tidyDialog:function(inst){inst.dpDiv.removeClass(this._dialogClass).unbind(".ui-datepicker-calendar")},_checkExternalClick:function(event){if(!$.datepicker._curInst){return}var $target=$(event.target),inst=$.datepicker._getInst($target[0]);if($target[0].id!==$.datepicker._mainDivId&&$target.parents("#"+$.datepicker._mainDivId).length===0&&!$target.hasClass($.datepicker.markerClassName)&&!$target.closest("."+$.datepicker._triggerClass).length&&$.datepicker._datepickerShowing&&!($.datepicker._inDialog&&$.blockUI)||$target.hasClass($.datepicker.markerClassName)&&$.datepicker._curInst!==inst){$.datepicker._hideDatepicker()}},_adjustDate:function(id,offset,period){var target=$(id),inst=this._getInst(target[0]);if(this._isDisabledDatepicker(target[0])){return}this._adjustInstDate(inst,offset+(period==="M"?this._get(inst,"showCurrentAtPos"):0),period);this._updateDatepicker(inst)},_gotoToday:function(id){var date,target=$(id),inst=this._getInst(target[0]);if(this._get(inst,"gotoCurrent")&&inst.currentDay){inst.selectedDay=inst.currentDay;inst.drawMonth=inst.selectedMonth=inst.currentMonth;inst.drawYear=inst.selectedYear=inst.currentYear}else{date=new Date;inst.selectedDay=date.getDate();inst.drawMonth=inst.selectedMonth=date.getMonth();inst.drawYear=inst.selectedYear=date.getFullYear()}this._notifyChange(inst);this._adjustDate(target)},_selectMonthYear:function(id,select,period){var target=$(id),inst=this._getInst(target[0]);inst["selected"+(period==="M"?"Month":"Year")]=inst["draw"+(period==="M"?"Month":"Year")]=parseInt(select.options[select.selectedIndex].value,10);this._notifyChange(inst);this._adjustDate(target)},_selectDay:function(id,month,year,td){var inst,target=$(id);if($(td).hasClass(this._unselectableClass)||this._isDisabledDatepicker(target[0])){return}inst=this._getInst(target[0]);inst.selectedDay=inst.currentDay=$("a",td).html();inst.selectedMonth=inst.currentMonth=month;inst.selectedYear=inst.currentYear=year;this._selectDate(id,this._formatDate(inst,inst.currentDay,inst.currentMonth,inst.currentYear))},_clearDate:function(id){var target=$(id);this._selectDate(target,"")},_selectDate:function(id,dateStr){var onSelect,target=$(id),inst=this._getInst(target[0]);dateStr=dateStr!=null?dateStr:this._formatDate(inst);if(inst.input){inst.input.val(dateStr)}this._updateAlternate(inst);onSelect=this._get(inst,"onSelect");if(onSelect){onSelect.apply(inst.input?inst.input[0]:null,[dateStr,inst])}else if(inst.input){inst.input.trigger("change")}if(inst.inline){this._updateDatepicker(inst)}else{this._hideDatepicker();this._lastInput=inst.input[0];if(typeof inst.input[0]!=="object"){inst.input.focus()}this._lastInput=null}},_updateAlternate:function(inst){var altFormat,date,dateStr,altField=this._get(inst,"altField");if(altField){altFormat=this._get(inst,"altFormat")||this._get(inst,"dateFormat");date=this._getDate(inst);dateStr=this.formatDate(altFormat,date,this._getFormatConfig(inst));$(altField).each(function(){$(this).val(dateStr)})}},noWeekends:function(date){var day=date.getDay();return[day>0&&day<6,""]},iso8601Week:function(date){var time,checkDate=new Date(date.getTime());checkDate.setDate(checkDate.getDate()+4-(checkDate.getDay()||7));time=checkDate.getTime();checkDate.setMonth(0);checkDate.setDate(1);return Math.floor(Math.round((time-checkDate)/864e5)/7)+1},parseDate:function(format,value,settings){if(format==null||value==null){throw"Invalid arguments"}value=typeof value==="object"?value.toString():value+"";if(value===""){return null}var iFormat,dim,extra,iValue=0,shortYearCutoffTemp=(settings?settings.shortYearCutoff:null)||this._defaults.shortYearCutoff,shortYearCutoff=typeof shortYearCutoffTemp!=="string"?shortYearCutoffTemp:(new Date).getFullYear()%100+parseInt(shortYearCutoffTemp,10),dayNamesShort=(settings?settings.dayNamesShort:null)||this._defaults.dayNamesShort,dayNames=(settings?settings.dayNames:null)||this._defaults.dayNames,monthNamesShort=(settings?settings.monthNamesShort:null)||this._defaults.monthNamesShort,monthNames=(settings?settings.monthNames:null)||this._defaults.monthNames,year=-1,month=-1,day=-1,doy=-1,literal=false,date,lookAhead=function(match){var matches=iFormat+1<format.length&&format.charAt(iFormat+1)===match;if(matches){iFormat++}return matches},getNumber=function(match){var isDoubled=lookAhead(match),size=match==="@"?14:match==="!"?20:match==="y"&&isDoubled?4:match==="o"?3:2,digits=new RegExp("^\\d{1,"+size+"}"),num=value.substring(iValue).match(digits);if(!num){throw"Missing number at position "+iValue}iValue+=num[0].length;return parseInt(num[0],10)},getName=function(match,shortNames,longNames){var index=-1,names=$.map(lookAhead(match)?longNames:shortNames,function(v,k){return[[k,v]]}).sort(function(a,b){return-(a[1].length-b[1].length)});$.each(names,function(i,pair){var name=pair[1];if(value.substr(iValue,name.length).toLowerCase()===name.toLowerCase()){index=pair[0];iValue+=name.length;return false}});if(index!==-1){return index+1}else{throw"Unknown name at position "+iValue}},checkLiteral=function(){if(value.charAt(iValue)!==format.charAt(iFormat)){throw"Unexpected literal at position "+iValue}iValue++};for(iFormat=0;iFormat<format.length;iFormat++){if(literal){if(format.charAt(iFormat)==="'"&&!lookAhead("'")){literal=false}else{checkLiteral()}}else{switch(format.charAt(iFormat)){case"d":day=getNumber("d");break;case"D":getName("D",dayNamesShort,dayNames);break;case"o":doy=getNumber("o");break;case"m":month=getNumber("m");break;case"M":month=getName("M",monthNamesShort,monthNames);break;case"y":year=getNumber("y");break;case"@":date=new Date(getNumber("@"));year=date.getFullYear();month=date.getMonth()+1;day=date.getDate();break;case"!":date=new Date((getNumber("!")-this._ticksTo1970)/1e4);year=date.getFullYear();month=date.getMonth()+1;day=date.getDate();break;case"'":if(lookAhead("'")){checkLiteral()}else{literal=true}break;default:checkLiteral()}}}if(iValue<value.length){extra=value.substr(iValue);if(!/^\s+/.test(extra)){throw"Extra/unparsed characters found in date: "+extra}}if(year===-1){year=(new Date).getFullYear()}else if(year<100){year+=(new Date).getFullYear()-(new Date).getFullYear()%100+(year<=shortYearCutoff?0:-100)}if(doy>-1){month=1;day=doy;do{dim=this._getDaysInMonth(year,month-1);if(day<=dim){break}month++;day-=dim}while(true)}date=this._daylightSavingAdjust(new Date(year,month-1,day));if(date.getFullYear()!==year||date.getMonth()+1!==month||date.getDate()!==day){throw"Invalid date"}return date},ATOM:"yy-mm-dd",COOKIE:"D, dd M yy",ISO_8601:"yy-mm-dd",RFC_822:"D, d M y",RFC_850:"DD, dd-M-y",RFC_1036:"D, d M y",RFC_1123:"D, d M yy",RFC_2822:"D, d M yy",RSS:"D, d M y",TICKS:"!",TIMESTAMP:"@",W3C:"yy-mm-dd",_ticksTo1970:((1970-1)*365+Math.floor(1970/4)-Math.floor(1970/100)+Math.floor(1970/400))*24*60*60*1e7,formatDate:function(format,date,settings){if(!date){return""}var iFormat,dayNamesShort=(settings?settings.dayNamesShort:null)||this._defaults.dayNamesShort,dayNames=(settings?settings.dayNames:null)||this._defaults.dayNames,monthNamesShort=(settings?settings.monthNamesShort:null)||this._defaults.monthNamesShort,monthNames=(settings?settings.monthNames:null)||this._defaults.monthNames,lookAhead=function(match){var matches=iFormat+1<format.length&&format.charAt(iFormat+1)===match;if(matches){iFormat++}return matches},formatNumber=function(match,value,len){var num=""+value;if(lookAhead(match)){while(num.length<len){num="0"+num}}return num},formatName=function(match,value,shortNames,longNames){return lookAhead(match)?longNames[value]:shortNames[value]},output="",literal=false;if(date){for(iFormat=0;iFormat<format.length;iFormat++){if(literal){if(format.charAt(iFormat)==="'"&&!lookAhead("'")){literal=false}else{output+=format.charAt(iFormat)}}else{switch(format.charAt(iFormat)){case"d":output+=formatNumber("d",date.getDate(),2);break;case"D":output+=formatName("D",date.getDay(),dayNamesShort,dayNames);break;case"o":output+=formatNumber("o",Math.round((new Date(date.getFullYear(),date.getMonth(),date.getDate()).getTime()-new Date(date.getFullYear(),0,0).getTime())/864e5),3);break;case"m":output+=formatNumber("m",date.getMonth()+1,2);break;case"M":output+=formatName("M",date.getMonth(),monthNamesShort,monthNames);break;case"y":output+=lookAhead("y")?date.getFullYear():(date.getYear()%100<10?"0":"")+date.getYear()%100;break;case"@":output+=date.getTime();break;case"!":output+=date.getTime()*1e4+this._ticksTo1970;break;case"'":if(lookAhead("'")){output+="'"}else{literal=true}break;default:output+=format.charAt(iFormat)}}}}return output},_possibleChars:function(format){var iFormat,chars="",literal=false,lookAhead=function(match){var matches=iFormat+1<format.length&&format.charAt(iFormat+1)===match;if(matches){iFormat++}return matches};for(iFormat=0;iFormat<format.length;iFormat++){if(literal){if(format.charAt(iFormat)==="'"&&!lookAhead("'")){literal=false}else{chars+=format.charAt(iFormat)}}else{switch(format.charAt(iFormat)){case"d":case"m":case"y":case"@":chars+="0123456789";break;case"D":case"M":return null;case"'":if(lookAhead("'")){chars+="'"}else{literal=true}break;default:chars+=format.charAt(iFormat)}}}return chars},_get:function(inst,name){return inst.settings[name]!==undefined?inst.settings[name]:this._defaults[name]},_setDateFromField:function(inst,noDefault){if(inst.input.val()===inst.lastVal){return}var dateFormat=this._get(inst,"dateFormat"),dates=inst.lastVal=inst.input?inst.input.val():null,defaultDate=this._getDefaultDate(inst),date=defaultDate,settings=this._getFormatConfig(inst);try{date=this.parseDate(dateFormat,dates,settings)||defaultDate}catch(event){dates=noDefault?"":dates}inst.selectedDay=date.getDate();inst.drawMonth=inst.selectedMonth=date.getMonth();inst.drawYear=inst.selectedYear=date.getFullYear();inst.currentDay=dates?date.getDate():0;inst.currentMonth=dates?date.getMonth():0;inst.currentYear=dates?date.getFullYear():0;this._adjustInstDate(inst)},_getDefaultDate:function(inst){return this._restrictMinMax(inst,this._determineDate(inst,this._get(inst,"defaultDate"),new Date))},_determineDate:function(inst,date,defaultDate){var offsetNumeric=function(offset){var date=new Date;date.setDate(date.getDate()+offset);return date},offsetString=function(offset){try{return $.datepicker.parseDate($.datepicker._get(inst,"dateFormat"),offset,$.datepicker._getFormatConfig(inst))}catch(e){}var date=(offset.toLowerCase().match(/^c/)?$.datepicker._getDate(inst):null)||new Date,year=date.getFullYear(),month=date.getMonth(),day=date.getDate(),pattern=/([+\-]?[0-9]+)\s*(d|D|w|W|m|M|y|Y)?/g,matches=pattern.exec(offset);while(matches){switch(matches[2]||"d"){case"d":case"D":day+=parseInt(matches[1],10);break;case"w":case"W":day+=parseInt(matches[1],10)*7;break;case"m":case"M":month+=parseInt(matches[1],10);day=Math.min(day,$.datepicker._getDaysInMonth(year,month));break;case"y":case"Y":year+=parseInt(matches[1],10);day=Math.min(day,$.datepicker._getDaysInMonth(year,month));break}matches=pattern.exec(offset)}return new Date(year,month,day)},newDate=date==null||date===""?defaultDate:typeof date==="string"?offsetString(date):typeof date==="number"?isNaN(date)?defaultDate:offsetNumeric(date):new Date(date.getTime());newDate=newDate&&newDate.toString()==="Invalid Date"?defaultDate:newDate;if(newDate){newDate.setHours(0);newDate.setMinutes(0);newDate.setSeconds(0);newDate.setMilliseconds(0)}return this._daylightSavingAdjust(newDate)
},_daylightSavingAdjust:function(date){if(!date){return null}date.setHours(date.getHours()>12?date.getHours()+2:0);return date},_setDate:function(inst,date,noChange){var clear=!date,origMonth=inst.selectedMonth,origYear=inst.selectedYear,newDate=this._restrictMinMax(inst,this._determineDate(inst,date,new Date));inst.selectedDay=inst.currentDay=newDate.getDate();inst.drawMonth=inst.selectedMonth=inst.currentMonth=newDate.getMonth();inst.drawYear=inst.selectedYear=inst.currentYear=newDate.getFullYear();if((origMonth!==inst.selectedMonth||origYear!==inst.selectedYear)&&!noChange){this._notifyChange(inst)}this._adjustInstDate(inst);if(inst.input){inst.input.val(clear?"":this._formatDate(inst))}},_getDate:function(inst){var startDate=!inst.currentYear||inst.input&&inst.input.val()===""?null:this._daylightSavingAdjust(new Date(inst.currentYear,inst.currentMonth,inst.currentDay));return startDate},_attachHandlers:function(inst){var stepMonths=this._get(inst,"stepMonths"),id="#"+inst.id.replace(/\\\\/g,"\\");inst.dpDiv.find("[data-handler]").map(function(){var handler={prev:function(){$.datepicker._adjustDate(id,-stepMonths,"M")},next:function(){$.datepicker._adjustDate(id,+stepMonths,"M")},hide:function(){$.datepicker._hideDatepicker()},today:function(){$.datepicker._gotoToday(id)},selectDay:function(){$.datepicker._selectDay(id,+this.getAttribute("data-month"),+this.getAttribute("data-year"),this);return false},selectMonth:function(){$.datepicker._selectMonthYear(id,this,"M");return false},selectYear:function(){$.datepicker._selectMonthYear(id,this,"Y");return false}};$(this).bind(this.getAttribute("data-event"),handler[this.getAttribute("data-handler")])})},_generateHTML:function(inst){var maxDraw,prevText,prev,nextText,next,currentText,gotoDate,controls,buttonPanel,firstDay,showWeek,dayNames,dayNamesMin,monthNames,monthNamesShort,beforeShowDay,showOtherMonths,selectOtherMonths,defaultDate,html,dow,row,group,col,selectedDate,cornerClass,calender,thead,day,daysInMonth,leadDays,curRows,numRows,printDate,dRow,tbody,daySettings,otherMonth,unselectable,tempDate=new Date,today=this._daylightSavingAdjust(new Date(tempDate.getFullYear(),tempDate.getMonth(),tempDate.getDate())),isRTL=this._get(inst,"isRTL"),showButtonPanel=this._get(inst,"showButtonPanel"),hideIfNoPrevNext=this._get(inst,"hideIfNoPrevNext"),navigationAsDateFormat=this._get(inst,"navigationAsDateFormat"),numMonths=this._getNumberOfMonths(inst),showCurrentAtPos=this._get(inst,"showCurrentAtPos"),stepMonths=this._get(inst,"stepMonths"),isMultiMonth=numMonths[0]!==1||numMonths[1]!==1,currentDate=this._daylightSavingAdjust(!inst.currentDay?new Date(9999,9,9):new Date(inst.currentYear,inst.currentMonth,inst.currentDay)),minDate=this._getMinMaxDate(inst,"min"),maxDate=this._getMinMaxDate(inst,"max"),drawMonth=inst.drawMonth-showCurrentAtPos,drawYear=inst.drawYear;if(drawMonth<0){drawMonth+=12;drawYear--}if(maxDate){maxDraw=this._daylightSavingAdjust(new Date(maxDate.getFullYear(),maxDate.getMonth()-numMonths[0]*numMonths[1]+1,maxDate.getDate()));maxDraw=minDate&&maxDraw<minDate?minDate:maxDraw;while(this._daylightSavingAdjust(new Date(drawYear,drawMonth,1))>maxDraw){drawMonth--;if(drawMonth<0){drawMonth=11;drawYear--}}}inst.drawMonth=drawMonth;inst.drawYear=drawYear;prevText=this._get(inst,"prevText");prevText=!navigationAsDateFormat?prevText:this.formatDate(prevText,this._daylightSavingAdjust(new Date(drawYear,drawMonth-stepMonths,1)),this._getFormatConfig(inst));prev=this._canAdjustMonth(inst,-1,drawYear,drawMonth)?"<a class='ui-datepicker-prev ui-corner-all' data-handler='prev' data-event='click'"+" title='"+prevText+"'><span class='ui-icon ui-icon-circle-triangle-"+(isRTL?"e":"w")+"'>"+prevText+"</span></a>":hideIfNoPrevNext?"":"<a class='ui-datepicker-prev ui-corner-all ui-state-disabled' title='"+prevText+"'><span class='ui-icon ui-icon-circle-triangle-"+(isRTL?"e":"w")+"'>"+prevText+"</span></a>";nextText=this._get(inst,"nextText");nextText=!navigationAsDateFormat?nextText:this.formatDate(nextText,this._daylightSavingAdjust(new Date(drawYear,drawMonth+stepMonths,1)),this._getFormatConfig(inst));next=this._canAdjustMonth(inst,+1,drawYear,drawMonth)?"<a class='ui-datepicker-next ui-corner-all' data-handler='next' data-event='click'"+" title='"+nextText+"'><span class='ui-icon ui-icon-circle-triangle-"+(isRTL?"w":"e")+"'>"+nextText+"</span></a>":hideIfNoPrevNext?"":"<a class='ui-datepicker-next ui-corner-all ui-state-disabled' title='"+nextText+"'><span class='ui-icon ui-icon-circle-triangle-"+(isRTL?"w":"e")+"'>"+nextText+"</span></a>";currentText=this._get(inst,"currentText");gotoDate=this._get(inst,"gotoCurrent")&&inst.currentDay?currentDate:today;currentText=!navigationAsDateFormat?currentText:this.formatDate(currentText,gotoDate,this._getFormatConfig(inst));controls=!inst.inline?"<button type='button' class='ui-datepicker-close ui-state-default ui-priority-primary ui-corner-all' data-handler='hide' data-event='click'>"+this._get(inst,"closeText")+"</button>":"";buttonPanel=showButtonPanel?"<div class='ui-datepicker-buttonpane ui-widget-content'>"+(isRTL?controls:"")+(this._isInRange(inst,gotoDate)?"<button type='button' class='ui-datepicker-current ui-state-default ui-priority-secondary ui-corner-all' data-handler='today' data-event='click'"+">"+currentText+"</button>":"")+(isRTL?"":controls)+"</div>":"";firstDay=parseInt(this._get(inst,"firstDay"),10);firstDay=isNaN(firstDay)?0:firstDay;showWeek=this._get(inst,"showWeek");dayNames=this._get(inst,"dayNames");dayNamesMin=this._get(inst,"dayNamesMin");monthNames=this._get(inst,"monthNames");monthNamesShort=this._get(inst,"monthNamesShort");beforeShowDay=this._get(inst,"beforeShowDay");showOtherMonths=this._get(inst,"showOtherMonths");selectOtherMonths=this._get(inst,"selectOtherMonths");defaultDate=this._getDefaultDate(inst);html="";dow;for(row=0;row<numMonths[0];row++){group="";this.maxRows=4;for(col=0;col<numMonths[1];col++){selectedDate=this._daylightSavingAdjust(new Date(drawYear,drawMonth,inst.selectedDay));cornerClass=" ui-corner-all";calender="";if(isMultiMonth){calender+="<div class='ui-datepicker-group";if(numMonths[1]>1){switch(col){case 0:calender+=" ui-datepicker-group-first";cornerClass=" ui-corner-"+(isRTL?"right":"left");break;case numMonths[1]-1:calender+=" ui-datepicker-group-last";cornerClass=" ui-corner-"+(isRTL?"left":"right");break;default:calender+=" ui-datepicker-group-middle";cornerClass="";break}}calender+="'>"}calender+="<div class='ui-datepicker-header ui-widget-header ui-helper-clearfix"+cornerClass+"'>"+(/all|left/.test(cornerClass)&&row===0?isRTL?next:prev:"")+(/all|right/.test(cornerClass)&&row===0?isRTL?prev:next:"")+this._generateMonthYearHeader(inst,drawMonth,drawYear,minDate,maxDate,row>0||col>0,monthNames,monthNamesShort)+"</div><table class='ui-datepicker-calendar'><thead>"+"<tr>";thead=showWeek?"<th class='ui-datepicker-week-col'>"+this._get(inst,"weekHeader")+"</th>":"";for(dow=0;dow<7;dow++){day=(dow+firstDay)%7;thead+="<th"+((dow+firstDay+6)%7>=5?" class='ui-datepicker-week-end'":"")+">"+"<span title='"+dayNames[day]+"'>"+dayNamesMin[day]+"</span></th>"}calender+=thead+"</tr></thead><tbody>";daysInMonth=this._getDaysInMonth(drawYear,drawMonth);if(drawYear===inst.selectedYear&&drawMonth===inst.selectedMonth){inst.selectedDay=Math.min(inst.selectedDay,daysInMonth)}leadDays=(this._getFirstDayOfMonth(drawYear,drawMonth)-firstDay+7)%7;curRows=Math.ceil((leadDays+daysInMonth)/7);numRows=isMultiMonth?this.maxRows>curRows?this.maxRows:curRows:curRows;this.maxRows=numRows;printDate=this._daylightSavingAdjust(new Date(drawYear,drawMonth,1-leadDays));for(dRow=0;dRow<numRows;dRow++){calender+="<tr>";tbody=!showWeek?"":"<td class='ui-datepicker-week-col'>"+this._get(inst,"calculateWeek")(printDate)+"</td>";for(dow=0;dow<7;dow++){daySettings=beforeShowDay?beforeShowDay.apply(inst.input?inst.input[0]:null,[printDate]):[true,""];otherMonth=printDate.getMonth()!==drawMonth;unselectable=otherMonth&&!selectOtherMonths||!daySettings[0]||minDate&&printDate<minDate||maxDate&&printDate>maxDate;tbody+="<td class='"+((dow+firstDay+6)%7>=5?" ui-datepicker-week-end":"")+(otherMonth?" ui-datepicker-other-month":"")+(printDate.getTime()===selectedDate.getTime()&&drawMonth===inst.selectedMonth&&inst._keyEvent||defaultDate.getTime()===printDate.getTime()&&defaultDate.getTime()===selectedDate.getTime()?" "+this._dayOverClass:"")+(unselectable?" "+this._unselectableClass+" ui-state-disabled":"")+(otherMonth&&!showOtherMonths?"":" "+daySettings[1]+(printDate.getTime()===currentDate.getTime()?" "+this._currentClass:"")+(printDate.getTime()===today.getTime()?" ui-datepicker-today":""))+"'"+((!otherMonth||showOtherMonths)&&daySettings[2]?" title='"+daySettings[2].replace(/'/g,"&#39;")+"'":"")+(unselectable?"":" data-handler='selectDay' data-event='click' data-month='"+printDate.getMonth()+"' data-year='"+printDate.getFullYear()+"'")+">"+(otherMonth&&!showOtherMonths?"&#xa0;":unselectable?"<span class='ui-state-default'>"+printDate.getDate()+"</span>":"<a class='ui-state-default"+(printDate.getTime()===today.getTime()?" ui-state-highlight":"")+(printDate.getTime()===currentDate.getTime()?" ui-state-active":"")+(otherMonth?" ui-priority-secondary":"")+"' href='#'>"+printDate.getDate()+"</a>")+"</td>";printDate.setDate(printDate.getDate()+1);printDate=this._daylightSavingAdjust(printDate)}calender+=tbody+"</tr>"}drawMonth++;if(drawMonth>11){drawMonth=0;drawYear++}calender+="</tbody></table>"+(isMultiMonth?"</div>"+(numMonths[0]>0&&col===numMonths[1]-1?"<div class='ui-datepicker-row-break'></div>":""):"");group+=calender}html+=group}html+=buttonPanel;inst._keyEvent=false;return html},_generateMonthYearHeader:function(inst,drawMonth,drawYear,minDate,maxDate,secondary,monthNames,monthNamesShort){var inMinYear,inMaxYear,month,years,thisYear,determineYear,year,endYear,changeMonth=this._get(inst,"changeMonth"),changeYear=this._get(inst,"changeYear"),showMonthAfterYear=this._get(inst,"showMonthAfterYear"),html="<div class='ui-datepicker-title'>",monthHtml="";if(secondary||!changeMonth){monthHtml+="<span class='ui-datepicker-month'>"+monthNames[drawMonth]+"</span>"}else{inMinYear=minDate&&minDate.getFullYear()===drawYear;inMaxYear=maxDate&&maxDate.getFullYear()===drawYear;monthHtml+="<select class='ui-datepicker-month' data-handler='selectMonth' data-event='change'>";for(month=0;month<12;month++){if((!inMinYear||month>=minDate.getMonth())&&(!inMaxYear||month<=maxDate.getMonth())){monthHtml+="<option value='"+month+"'"+(month===drawMonth?" selected='selected'":"")+">"+monthNamesShort[month]+"</option>"}}monthHtml+="</select>"}if(!showMonthAfterYear){html+=monthHtml+(secondary||!(changeMonth&&changeYear)?"&#xa0;":"")}if(!inst.yearshtml){inst.yearshtml="";if(secondary||!changeYear){html+="<span class='ui-datepicker-year'>"+drawYear+"</span>"}else{years=this._get(inst,"yearRange").split(":");thisYear=(new Date).getFullYear();determineYear=function(value){var year=value.match(/c[+\-].*/)?drawYear+parseInt(value.substring(1),10):value.match(/[+\-].*/)?thisYear+parseInt(value,10):parseInt(value,10);return isNaN(year)?thisYear:year};year=determineYear(years[0]);endYear=Math.max(year,determineYear(years[1]||""));year=minDate?Math.max(year,minDate.getFullYear()):year;endYear=maxDate?Math.min(endYear,maxDate.getFullYear()):endYear;inst.yearshtml+="<select class='ui-datepicker-year' data-handler='selectYear' data-event='change'>";for(;year<=endYear;year++){inst.yearshtml+="<option value='"+year+"'"+(year===drawYear?" selected='selected'":"")+">"+year+"</option>"}inst.yearshtml+="</select>";html+=inst.yearshtml;inst.yearshtml=null}}html+=this._get(inst,"yearSuffix");if(showMonthAfterYear){html+=(secondary||!(changeMonth&&changeYear)?"&#xa0;":"")+monthHtml}html+="</div>";return html},_adjustInstDate:function(inst,offset,period){var year=inst.drawYear+(period==="Y"?offset:0),month=inst.drawMonth+(period==="M"?offset:0),day=Math.min(inst.selectedDay,this._getDaysInMonth(year,month))+(period==="D"?offset:0),date=this._restrictMinMax(inst,this._daylightSavingAdjust(new Date(year,month,day)));inst.selectedDay=date.getDate();inst.drawMonth=inst.selectedMonth=date.getMonth();inst.drawYear=inst.selectedYear=date.getFullYear();if(period==="M"||period==="Y"){this._notifyChange(inst)}},_restrictMinMax:function(inst,date){var minDate=this._getMinMaxDate(inst,"min"),maxDate=this._getMinMaxDate(inst,"max"),newDate=minDate&&date<minDate?minDate:date;return maxDate&&newDate>maxDate?maxDate:newDate},_notifyChange:function(inst){var onChange=this._get(inst,"onChangeMonthYear");if(onChange){onChange.apply(inst.input?inst.input[0]:null,[inst.selectedYear,inst.selectedMonth+1,inst])}},_getNumberOfMonths:function(inst){var numMonths=this._get(inst,"numberOfMonths");return numMonths==null?[1,1]:typeof numMonths==="number"?[1,numMonths]:numMonths},_getMinMaxDate:function(inst,minMax){return this._determineDate(inst,this._get(inst,minMax+"Date"),null)},_getDaysInMonth:function(year,month){return 32-this._daylightSavingAdjust(new Date(year,month,32)).getDate()},_getFirstDayOfMonth:function(year,month){return new Date(year,month,1).getDay()},_canAdjustMonth:function(inst,offset,curYear,curMonth){var numMonths=this._getNumberOfMonths(inst),date=this._daylightSavingAdjust(new Date(curYear,curMonth+(offset<0?offset:numMonths[0]*numMonths[1]),1));if(offset<0){date.setDate(this._getDaysInMonth(date.getFullYear(),date.getMonth()))}return this._isInRange(inst,date)},_isInRange:function(inst,date){var yearSplit,currentYear,minDate=this._getMinMaxDate(inst,"min"),maxDate=this._getMinMaxDate(inst,"max"),minYear=null,maxYear=null,years=this._get(inst,"yearRange");if(years){yearSplit=years.split(":");currentYear=(new Date).getFullYear();minYear=parseInt(yearSplit[0],10);maxYear=parseInt(yearSplit[1],10);if(yearSplit[0].match(/[+\-].*/)){minYear+=currentYear}if(yearSplit[1].match(/[+\-].*/)){maxYear+=currentYear}}return(!minDate||date.getTime()>=minDate.getTime())&&(!maxDate||date.getTime()<=maxDate.getTime())&&(!minYear||date.getFullYear()>=minYear)&&(!maxYear||date.getFullYear()<=maxYear)},_getFormatConfig:function(inst){var shortYearCutoff=this._get(inst,"shortYearCutoff");shortYearCutoff=typeof shortYearCutoff!=="string"?shortYearCutoff:(new Date).getFullYear()%100+parseInt(shortYearCutoff,10);return{shortYearCutoff:shortYearCutoff,dayNamesShort:this._get(inst,"dayNamesShort"),dayNames:this._get(inst,"dayNames"),monthNamesShort:this._get(inst,"monthNamesShort"),monthNames:this._get(inst,"monthNames")}},_formatDate:function(inst,day,month,year){if(!day){inst.currentDay=inst.selectedDay;inst.currentMonth=inst.selectedMonth;inst.currentYear=inst.selectedYear}var date=day?typeof day==="object"?day:this._daylightSavingAdjust(new Date(year,month,day)):this._daylightSavingAdjust(new Date(inst.currentYear,inst.currentMonth,inst.currentDay));return this.formatDate(this._get(inst,"dateFormat"),date,this._getFormatConfig(inst))}});function bindHover(dpDiv){var selector="button, .ui-datepicker-prev, .ui-datepicker-next, .ui-datepicker-calendar td a";return dpDiv.delegate(selector,"mouseout",function(){$(this).removeClass("ui-state-hover");if(this.className.indexOf("ui-datepicker-prev")!==-1){$(this).removeClass("ui-datepicker-prev-hover")}if(this.className.indexOf("ui-datepicker-next")!==-1){$(this).removeClass("ui-datepicker-next-hover")}}).delegate(selector,"mouseover",function(){if(!$.datepicker._isDisabledDatepicker(instActive.inline?dpDiv.parent()[0]:instActive.input[0])){$(this).parents(".ui-datepicker-calendar").find("a").removeClass("ui-state-hover");$(this).addClass("ui-state-hover");if(this.className.indexOf("ui-datepicker-prev")!==-1){$(this).addClass("ui-datepicker-prev-hover")}if(this.className.indexOf("ui-datepicker-next")!==-1){$(this).addClass("ui-datepicker-next-hover")}}})}function extendRemove(target,props){$.extend(target,props);for(var name in props){if(props[name]==null){target[name]=props[name]}}return target}$.fn.datepicker=function(options){if(!this.length){return this}if(!$.datepicker.initialized){$(document).mousedown($.datepicker._checkExternalClick);$.datepicker.initialized=true}if($("#"+$.datepicker._mainDivId).length===0){$("body").append($.datepicker.dpDiv)}var otherArgs=Array.prototype.slice.call(arguments,1);if(typeof options==="string"&&(options==="isDisabled"||options==="getDate"||options==="widget")){return $.datepicker["_"+options+"Datepicker"].apply($.datepicker,[this[0]].concat(otherArgs))}if(options==="option"&&arguments.length===2&&typeof arguments[1]==="string"){return $.datepicker["_"+options+"Datepicker"].apply($.datepicker,[this[0]].concat(otherArgs))}return this.each(function(){typeof options==="string"?$.datepicker["_"+options+"Datepicker"].apply($.datepicker,[this].concat(otherArgs)):$.datepicker._attachDatepicker(this,options)})};$.datepicker=new Datepicker;$.datepicker.initialized=false;$.datepicker.uuid=(new Date).getTime();$.datepicker.version="1.10.4"})(jQuery);if(!Modernizr.csstransforms){$("body").addClass("no-transforms")}else{$("body").addClass("has-transforms")}if(!Modernizr.input.placeholder){$("body").addClass("no-placeholder")}(function(w,$){fontSpy=function(fontName,conf){var $html=$("html"),$body=$("body"),fontFamilyName=fontName;if(typeof fontFamilyName!=="string"||fontFamilyName===""){throw"A valid fontName is required. fontName must be a string and must not be an empty string."}var defaults={font:fontFamilyName,fontClass:fontFamilyName.toLowerCase().replace(/\s/g,""),success:function(){},failure:function(){},testFont:"Courier New",testString:"QW@HhsXJ",glyphs:"",delay:50,timeOut:1e3,callback:$.noop};var config=$.extend(defaults,conf);var $tester=$("<span>"+config.testString+config.glyphs+"</span>").css("position","absolute").css("top","-9999px").css("left","-9999px").css("visibility","hidden").css("fontFamily",config.testFont).css("fontSize","250px");$body.append($tester);var fallbackFontWidth=$tester.outerWidth();$tester.css("fontFamily",config.font+","+config.testFont);var failure=function(){$html.addClass("no-"+config.fontClass);if(config&&config.failure){config.failure()}config.callback(new Error("FontSpy timeout"));$tester.remove()};var success=function(){config.callback();$html.addClass(config.fontClass);if(config&&config.success){config.success()}$tester.remove()};var retry=function(){setTimeout(checkFont,config.delay);config.timeOut=config.timeOut-config.delay};var checkFont=function(){var loadedFontWidth=$tester.outerWidth();if(fallbackFontWidth!==loadedFontWidth){success()}else if(config.timeOut<0){failure()}else{retry()}};checkFont()}})(this,jQuery);fontSpy("Elusive-Icons",{glyphs:"",timeout:5e3,failure:function(){if(!isIOS())$("body").addClass("iconset-inactive")}});var Recurring=function(){function addCustomRecurringTime(fnAddDate){var p=$("#date").val().split("-");var d=new Date(p[0],p[1]-1,p[2],-(new Date).getTimezoneOffset()/60+1,0,0,0);var recurType=$("#recur-type").attr("data-type")||$("#recur-type").val();var weekdayOfMonth=parseInt((d.getUTCDate()-1)/7);for(var i=0;i<$("#recur-times").val();++i){var originalDate=d.getUTCDate();rd=""+d.getUTCFullYear()+"-"+(d.getUTCMonth()+1)+"-"+d.getUTCDate();fnAddDate(rd);if(recurType=="daily"){d.setUTCDate(d.getUTCDate()+1)}else if(recurType=="weekly"){d.setUTCDate(d.getUTCDate()+7)}else if(recurType=="biweekly"){d.setUTCDate(d.getUTCDate()+14)}else if(recurType=="triweekly"){d.setUTCDate(d.getUTCDate()+21)}else if(recurType=="monthly"){d.setUTCMonth(d.getUTCMonth()+1);if(d.getUTCDate()!=originalDate){d.setUTCDate(originalDate)}}else if(recurType=="quadweekly"){d.setUTCDate(d.getUTCDate()+28)}else if(recurType=="monthly-day"){var weekday=d.getUTCDay();d.setUTCMonth(d.getUTCMonth()+1);d.setUTCDate(1);var weekdayOfFirst=d.getUTCDay();if(weekdayOfFirst>weekday)weekday+=7;d.setUTCDate(weekdayOfMonth*7+(weekday-weekdayOfFirst)+1)}}}function updateRecurringTime(startDate,startTime){var weekday=new Array(7);weekday[0]="Sunday";weekday[1]="Monday";weekday[2]="Tuesday";weekday[3]="Wednesday";weekday[4]="Thursday";weekday[5]="Friday";weekday[6]="Saturday";var months=new Array(12);months[0]="January";months[1]="February";months[2]="March";months[3]="April";months[4]="May";months[5]="June";months[6]="July";months[7]="August";months[8]="September";months[9]="October";months[10]="November";months[11]="December";var dateEnding=new Array(31);dateEnding[1]="st";dateEnding[2]="nd";dateEnding[3]="rd";dateEnding[4]="th";dateEnding[5]="th";dateEnding[6]="th";dateEnding[7]="th";dateEnding[8]="th";dateEnding[9]="th";dateEnding[10]="th";dateEnding[11]="th";dateEnding[12]="th";dateEnding[13]="th";dateEnding[14]="th";dateEnding[15]="th";dateEnding[16]="th";dateEnding[17]="th";dateEnding[18]="th";dateEnding[19]="th";dateEnding[20]="th";dateEnding[21]="st";dateEnding[22]="nd";dateEnding[23]="rd";dateEnding[24]="th";dateEnding[25]="th";dateEnding[26]="th";dateEnding[27]="th";dateEnding[28]="th";dateEnding[29]="th";dateEnding[30]="th";dateEnding[31]="st";var p=startDate.split("-");var date=new Date(p[0],p[1]-1,p[2],-(new Date).getTimezoneOffset()/60+1,0,0,0);var dow=weekday[date.getUTCDay()];var weekdayOfMonth=parseInt((date.getUTCDate()-1)/7)+1;$("#recur-weekly").text("Every "+dow);$("#recur-biweekly").text("Every other "+dow);$("#recur-triweekly").text("Every third "+dow);$("#recur-quadweekly").text("Every fourth "+dow);$("#recur-monthly").text("The "+date.getUTCDate()+dateEnding[date.getUTCDate()]+" of every month");$("#recur-monthly-day").text("The "+weekdayOfMonth+dateEnding[weekdayOfMonth]+" "+dow+" of every month");$("#recur-time").text(startTime);$("#recur-start").text(months[date.getUTCMonth()]+" "+date.getUTCDate()+dateEnding[date.getUTCDate()]+", "+date.getUTCFullYear())}return{addCustomRecurringTime:addCustomRecurringTime,updateRecurringTime:updateRecurringTime}}();var FriendlyDates=function(){var weekday=new Array(7);weekday[0]="Sunday";weekday[1]="Monday";weekday[2]="Tuesday";weekday[3]="Wednesday";weekday[4]="Thursday";weekday[5]="Friday";weekday[6]="Saturday";var months=new Array(12);months[0]="January";months[1]="February";months[2]="March";months[3]="April";months[4]="May";months[5]="June";months[6]="July";months[7]="August";months[8]="September";months[9]="October";months[10]="November";months[11]="December";var dateEnding=new Array(31);dateEnding[1]="st";dateEnding[2]="nd";dateEnding[3]="rd";dateEnding[4]="th";dateEnding[5]="th";dateEnding[6]="th";dateEnding[7]="th";dateEnding[8]="th";dateEnding[9]="th";dateEnding[10]="th";dateEnding[11]="th";dateEnding[12]="th";dateEnding[13]="th";dateEnding[14]="th";dateEnding[15]="th";dateEnding[16]="th";dateEnding[17]="th";dateEnding[18]="th";dateEnding[19]="th";dateEnding[20]="th";dateEnding[21]="st";dateEnding[22]="nd";dateEnding[23]="rd";dateEnding[24]="th";dateEnding[25]="th";dateEnding[26]="th";dateEnding[27]="th";dateEnding[28]="th";dateEnding[29]="th";dateEnding[30]="th";dateEnding[31]="st";return{dateEnding:dateEnding,months:months,weekday:weekday}}();function formatTimeForHuman(d){if(!d)return"";if(typeof d=="string"){if(d.toLowerCase().indexOf("am")>-1||d.toLowerCase().indexOf("pm")>-1||d.toLowerCase().indexOf("a.m.")>-1||d.toLowerCase().indexOf("p.m.")>-1){return d}var parts=d.split(/:/);if(parts.length!=2){return d}d=new Date;d.setUTCHours(parts[0]);d.setUTCMinutes(parts[1])}var ampm=d.getUTCHours()<12?"am":"pm";var min=""+d.getUTCMinutes();if(min.length==1){min="0"+min}var hour=d.getUTCHours();if(hour>12){hour-=12}return hour+":"+min+ampm}function newUTCDate(year,month,day,hour,minute){if(typeof hour=="undefined")hour=0;if(typeof minute=="undefined")minute=0;var date=new Date(year,month,day,hour,minute,0,0);return new Date(date.getTime()-date.getTimezoneOffset()*6e4)}function dateTimeObjectFromString(dt){var matches=dt.match(/(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{2})/);if(matches&&matches.length==6){return newUTCDate(matches[1],matches[2]-1,matches[3],matches[4],matches[5])}}function parseTime(timeStr,dt){if(!dt){dt=new Date}var time=timeStr.match(/(\d+)(?:[:.](\d\d))?\s*(p?)/i);if(!time){return NaN}var hours=parseInt(time[1],10);if(hours==12&&!time[3]){if(timeStr.match(/.+(a.?)$/)){hours=0}}else{hours+=hours<12&&time[3]?12:0}dt.setUTCHours(hours);dt.setUTCMinutes(parseInt(time[2],10)||0);dt.setUTCSeconds(0,0);return dt}function dateObjectFromString(d){if(!d)return d;var parts=d.split(/-/);if(parts.length!=3){return null}var d=newUTCDate(parts[0],parts[1]-1,parts[2]);return d}function formatDateForHuman(d){if(typeof d=="string"){var dt=dateObjectFromString(d)}else{var dt=d}if(!dt){return d}return FriendlyDates.months[dt.getUTCMonth()]+" "+dt.getUTCDate()+", "+dt.getUTCFullYear()}function formatForTimeElement(d){if(!d)return"";var ampm=d.getUTCHours()<12?"am":"pm";var min=""+d.getUTCMinutes();if(min.length==1){min="0"+min}var hour=""+d.getUTCHours();if(hour.length==1){hour="0"+hour}return hour+":"+min}function formatForDateElement(d){if(!d)return"";var year=d.getUTCFullYear()+"";var month=d.getUTCMonth()+1+"";var day=d.getUTCDate()+"";if(month.length==1)month="0"+month;if(day.length==1)day="0"+day;return year+"-"+month+"-"+day}var Calendar=function($){var datePickerId="#date-picker";var chooseMonthId="#chooseMonthSched";var timesContainerId="#times";var customDateOptionsId="#custom-date-options";var dateFieldId="#date";var timeSelectSelector="#time-select";var customTimeId="#appt-custom";function loadCalendar(type,calendar,month,extraData){$(datePickerId).html('<span class="loading-text">Loading calendar...</span>');Progress.start();var postData={type:type,calendar:calendar,month:month};for(var k in extraData){postData[k]=extraData[k]}var url="schedule.php?action=showCalendar&admin=1&owner="+self.owner;$.post(url,postData,function(data){Progress.done();$(datePickerId).html(data+"&nbsp;");if($(chooseMonthId)[0])$(chooseMonthId)[0].onchange="";$(chooseMonthId).on("change",function(ev){self.showCalendar($(ev.target).val())});if($(".cmd-hide-calendar").length>0){$(timesContainerId).hide()}else if($(customTimeId).is(":hidden")){$(timesContainerId).show()}})}function toggleCustomTime(){if($(customDateOptionsId).is(":visible")){$(customDateOptionsId).hide(0);$(datePickerId+", "+timesContainerId).show(0)}else{$(customDateOptionsId).show(0);$(datePickerId+", "+timesContainerId).hide(0)}}function setupDatePickerEvents(showTimes){function selectActiveDay(ev){var day=$(ev.currentTarget).attr("day");$(datePickerId+" .selectedday").removeClass("selectedday");$(ev.currentTarget).addClass("selectedday");$(dateFieldId).val(day);showTimes()}$(datePickerId).on("click",".activeday",selectActiveDay);$(datePickerId).on("touchend",".activeday",selectActiveDay);$(dateFieldId).on("change",showTimes)}function showTimes(date,type,calendar,ignoreAppointment,extraData){Progress.start();var showSelect=isTouchDevice()||isMobile()?true:false;var postData={date:date,type:type,calendar:calendar,admin:1,ignoreAppointment:ignoreAppointment};for(var k in extraData){postData[k]=extraData[k]}var url="/schedule.php?action=availableTimes&admin=1&showSelect="+(showSelect?"1":"0")+"&owner="+self.owner;$(timesContainerId).html("Loading...");if(typeof enableSubmit=="function")enableSubmit();$.post(url,postData,function(data){Progress.done();$(timesContainerId).html(data);if(typeof enableSubmit=="function")enableSubmit()})}function checkConflicts(params,successCb,failureCb){$.post("/schedule.php?action=checkConflict&owner="+self.owner,params,function(data){var result={};try{result=JSON.parse(data)}catch(ex){return failureCb()}for(var i=0;i<result.length;i++){var elId=result[i]["id"];var why=result[i]["why"];var title="";if(why){if(why=="conflicts"){title="This conflicts with another appointment or is outside business hours"}else if(why=="reallypast"){title="This time is in the past"}else if(why=="resources"){title="Not enough rooms/resources are available for this appointment"}else if(why=="advance"){title="This time is really far in advance"}result[i]["title"]=title}}successCb(result)})}return{checkConflicts:checkConflicts,loadCalendar:loadCalendar,toggleCustomTime:toggleCustomTime,setupDatePickerEvents:setupDatePickerEvents,showTimes:showTimes,timeSelector:'#time-select:visible, .time-selection[type="radio"]:visible:checked, #appt-custom:visible, .always-date-custom #appt-custom'}}(jQuery);var Validate=function($){function validateField($el){$group=$el.closest(".form-group");var hasVal=false;if($el.hasClass("validate-checkboxes")){hasVal=$el.find('input[type="checkbox"]:checked').length>0}else{hasVal=$.trim($el.val())}if($el.hasClass("required")&&!hasVal){$group.addClass("has-error");return false}$group.removeClass("has-error");return true}function validate($form){var areAllValid=true;$form.find(".validate:visible, .validate-checkboxes:visible").each(function(){if(!validateField($(this)))areAllValid=false});if(!areAllValid){Flash.error("Please fill in all the required fields")}else{Flash.hide()}return areAllValid}function validateSubmit(ev){$form=$(ev.target);if(!validate($form)){$form.find('.has-error input[type="text"]').first().focus();ev.preventDefault()}}return{validate:validate,validateSubmit:validateSubmit}}(jQuery);Acuity.addController("#new-addon-btn",function($){$("#new-addon-btn").click(function(){$(".addon-form-actions").hide();$("#new-addon-form").slideDown(200,function(){$("#addon-name").focus()})});$(".cancel-new-addon").click(function(ev){$("#new-addon-form").slideUp(200,function(){$(".addon-form-actions").show()})})});Acuity.addController(".edit-addons-list",function($){var _lastUpdateRequest=null;$(".edit-addons-list").on("change",'input[type="checkbox"]',function(ev){if(_lastUpdateRequest){_lastUpdateRequest.abort()}$(".saving-notice").remove();var $saving=$('<span class="saving-notice text-muted margin-left"><div class="progress-spinner small"></div> Saving...</span>');var $label=$(ev.currentTarget).parent().find(".addon-name-label").append($saving);var isEnabled=$(ev.currentTarget).is(":checked");var $form=$("#update-type-addons-form");_lastUpdateRequest=$.post($form.attr("action"),$form.serialize(),function(data){_lastUpdateRequest=null;$saving.html('<span class="text-success">'+(isEnabled?"Enabled":"Disabled")+" Add-On</span>").fadeOut(2500,function(){$saving.remove()})}).fail(function(){$(".save-enabled-addons").show();Flash.error("Failed to save enabled types, please try clicking the &quot;Save Enabled Add-Ons&quot; button.")})});function getAddonContainer(ev){return $(ev.currentTarget).closest("li")}function hideEditingAddon(ev){var $container=getAddonContainer(ev);if($container.length==0){$container=$(".edit-addons-list li:has(.addon-editing:visible)")}$container.find(".addon-rendered").show();$container.find(".addon-editing").hide()}$(".edit-addon").click(function(ev){var $container=getAddonContainer(ev);$container.find(".addon-rendered").hide();$container.find(".addon-editing").show()});$(".cancel-edit-addon").click(function(ev){hideEditingAddon(ev)});$("#update-type-addons-form").on("submit",function(ev){ev.preventDefault();$(".update-addon-btn:visible").click()});$(".update-addon-btn").click(function(ev){var $container=getAddonContainer(ev).removeClass("highlight-fade");var $btn=$(ev.currentTarget);var id=$container.attr("data-id");var name=$container.find('input[name="name"]').val();var duration=Math.min($container.find('input[name="duration"]').val(),60*24);var price=$container.find('input[name="price"]').val();var hidden=$container.find('input[name="hidden"]:checked').val();$btn.button("loading");var opts={name:name,duration:duration,price:price,hidden:hidden};var enabledAddonNames=$container.find('input[name="addonTypes[]"]:checked').map(function(){return escapeHtml($(this).data("name"))}).get();if($container.find('input[name="addonTypes[]"]').length){opts["setAddonTypes"]=true;opts["addonTypes"]=$container.find('input[name="addonTypes[]"]:checked').map(function(){return $(this).val()}).get()}$.post("/appointments.php?action=updateAddon&id="+id,opts,function(data){try{var response=JSON.parse(data)
}catch(ex){var response={message:"Unable to update addon"}}if(response.success){Flash.notice(response.message);hideEditingAddon(ev);$container.addClass("highlight-fade");$container.find(".addon-name-label").text(name);$container.find(".is-hidden").toggle(!!hidden);if(price!=0){$container.find(".addon-price-label").text($container.attr("data-currency")+price)}else{$container.find(".addon-price-label").text("")}if(duration!=0&&!isNaN(duration)){$container.find(".addon-duration-label").text(duration+" minutes")}else{$container.find(".addon-duration-label").text("")}if($container.find(".addon-type-list").length){$container.find(".addon-type-list").html('<span class="addon-type-name">'+enabledAddonNames.join('</span><span class="addon-type-name">')+"</span>")}}else{Flash.error(response.message)}}).fail(function(){Flash.error("Failed to update addon")}).always(function(){$btn.button("reset")})})});var appointmentDetailController=function($){$("#appointmentType").change(function(ev){$("#addons-container").html("");$.get("/schedule.php",{type:$("#appointmentType").val(),action:"getAddonsPartial"},function(data){$("#addons-container").html('<div class="addons-list">'+data+"</div>")})});$(".edit-appointment").click(Acuity.wrap(function(ev){var $realTarget=$(ev.target);if($realTarget.attr("target")=="_blank"){return}ev.preventDefault();$("#appointment-details-page").toggleClass("form-hidden");if($(ev.currentTarget).hasClass("edit-appointment-notes")){$("#appt-notes").focus()}}));$(".view-payments").click(function(ev){$(".appointment-payments, .view-payments").toggle()});$(".cancel-appointment-edit").click(Acuity.wrap(function(ev){ev.preventDefault();$("#appointment-details-page").addClass("form-hidden")}));$(".cancel-appt-popup").click(function(ev){ev.stopPropagation()});$("body:has(#appointment-details-page)").on("click",".btn-hide-popover",function(ev){ev.stopImmediatePropagation();ev.preventDefault();$('#appointment-details-page [data-toggle="popover"]').popover("hide")});if(!window.attachedCancelApptNoEmail){window.attachedCancelApptNoEmail=true;$("body").on("click","#cancel-no-email-btn",function(ev){$(ev.currentTarget).button("loading").closest("form").find("#no-email").attr("value","1");$("#cancel-yes-email-btn").hide()});$("body").on("click","#cancel-yes-email-btn",function(ev){$(ev.currentTarget).button("loading");$("#cancel-no-email-btn").hide()});$("body").on("click","#cancel-add-note",function(ev){$(ev.currentTarget).parent().empty().closest(".checkbox").after('<div class="form-group"><label for="cancel-note">Include note in e-mail to client:</label><textarea id="cancel-note" name="note" placeholder="Note e-mailed to client" class="form-control"></textarea></div>').next().find("textarea").focus();$("#cancel-no-email-btn").attr("disabled",true);ev.stopImmediatePropagation();ev.preventDefault()})}$("#appointment-details-page").submit(function(ev){$("#appointment-details-page [data-loading-text]").button("loading")});$('#appointment-details-page [data-toggle="popover"]').popover()};Acuity.addController("#appointment-details-page",appointmentDetailController);var appointmentTypesController=function($){$(".type-category-name .field-rendered h4").click(function(ev){$(ev.target).closest(".type-category-name").removeClass("form-hidden");$(ev.target).closest(".type-category-name").find(".form-control").focus()});$(".type-category-name .field-input a").click(function(ev){$(ev.target).closest(".type-category-name").addClass("form-hidden")});$(".sortableList").sortable({distance:10,handle:".list-item-title",cancel:"textarea,input,.direct-link-content",update:function(ev,ui){$.post("appointments.php?action=updateAppointmentTypeOrder",$(ev.target).sortable("serialize"),function(data){Flash.notice("Successfully saved order",3e3)}).fail(function(){Flash.error("Failed to save order")})}});$(".sortableList .list-item-title").disableSelection();$('[data-toggle="tooltip"]').tooltip()};Acuity.addController("#appointments-types-page",appointmentTypesController);Acuity.addController(".advance-time-marker",function(ev){$("#appointment-content").on("mousemove",".advance-time-marker",function(ev){var $target=$(ev.currentTarget);var $tooltip=$target.next(".tooltip");var parentOffset=$target.parent().offset();var relY=ev.pageY-parentOffset.top-$tooltip.height()/2;$tooltip.css({top:relY+"px"})})});var appointmentsTouchController=function($,appointmentsController){var startClickEvent=isTouchDevice()?"click":"click";var currentDate=undefined;var currentCalendarId=undefined;var currentTime=undefined;var currentMinutes=undefined;var currentTouchLeft=undefined;var currentTouchTop=undefined;var isLongtouch=isNewAppointmentLongtouch=false;var currentTopPosition=undefined;var $currentAppointmentListing=undefined;var $currentSelectedAppointment=undefined;var lastDragTime=new Date;var longpressTimer=null;function isAppointment(el){var $appt=$(el).closest(".appointment");return $appt.length&&$appt.get(0).id.indexOf("appt:")>-1}function roundTime(time){var coeff=1e3*60*5;var rounded=new Date(Math.round(time.getTime()/coeff)*coeff);return rounded}function showNewAppointment(date,time,calendarId){date=date||currentDate;time=time||currentTime;calendarId=calendarId||currentCalendarId;var uri="appointments.php?action=new&time="+formatForTimeElement(roundTime(time))+"&date="+date+"&calendar="+calendarId;if(typeof respond!="undefined"&&!respond.mediaQueriesSupported){document.location=uri}else{Details.loadUri(uri)}}function isDragging(){return!!$currentSelectedAppointment||new Date-lastDragTime<100}function showTimeMarker(){var $mousePosition=$(".mouse-position",$currentAppointmentListing);$mousePosition.show(0);$mousePosition.css({top:currentTopPosition+"px"});var left=($currentAppointmentListing.width()-60)/2;$mousePosition.html('<div class="tooltip top in" style="top: -32px; left: '+left+'px; display: block;"><div class="tooltip-arrow"></div><div class="tooltip-inner">'+formatTimeForHuman(roundTime(currentTime))+"</div></div>")}function hideTimeMarker(){$(".mouse-position").hide(0)}function resetSelectedAppointment(){$currentSelectedAppointment.removeClass("is-dragging").html($currentSelectedAppointment.attr("data-origin-html"));$currentSelectedAppointment.detach().appendTo($currentSelectedAppointment.$startAppointmentListing);$currentSelectedAppointment.css({top:$currentSelectedAppointment.startTopElement+"px"})}function moveSelectedAppointment(){$currentSelectedAppointment.removeClass("is-dragging");var apptId=$currentSelectedAppointment.attr("id").split(":")[1];Details.loadUri("/appointments.php?action=reschedule&backto=none&appt="+apptId+"&date="+$currentSelectedAppointment.$prevAppointmentListing.attr("date")+"&time="+formatForTimeElement($currentSelectedAppointment.newStart)+"&calendar="+$currentSelectedAppointment.$prevAppointmentListing.attr("calendar"));resetSelectedAppointment()}function startDraggingAppointment(appt){if(!$currentAppointmentListing)return;$currentSelectedAppointment=appt;$currentSelectedAppointment.attr("data-origin-html",$currentSelectedAppointment.html());$currentSelectedAppointment.startTopElement=$currentSelectedAppointment.position().top;$currentSelectedAppointment.startTopPosition=currentTopPosition;$currentSelectedAppointment.startMinutes=currentMinutes;$currentSelectedAppointment.$startAppointmentListing=$currentAppointmentListing;$currentSelectedAppointment.$prevAppointmentListing=$currentAppointmentListing}function dragSelectedAppointment(){if(!$currentSelectedAppointment){return}var currentTimeslot=Math.round((currentTopPosition-$currentSelectedAppointment.startTopPosition)/timeSlotHeight);var yd=timeSlotHeight*currentTimeslot;$currentSelectedAppointment.css({top:$currentSelectedAppointment.startTopElement+yd+"px"});if($currentSelectedAppointment.$prevAppointmentListing.get(0)!=$currentAppointmentListing.get(0)){$currentSelectedAppointment.detach().appendTo($currentAppointmentListing);$currentSelectedAppointment.$prevAppointmentListing=$currentAppointmentListing;$currentSelectedAppointment.addClass("is-dragging")}var start=new Date;start.setUTCHours($currentSelectedAppointment.attr("start").split(":")[0]);start.setUTCMinutes($currentSelectedAppointment.attr("start").split(":")[1]);var end=new Date;end.setUTCHours($currentSelectedAppointment.attr("end").split(":")[0]);end.setUTCMinutes($currentSelectedAppointment.attr("end").split(":")[1]);var minuteDifference=currentTimeslot*timeInterval;start.setUTCMinutes(start.getUTCMinutes()+minuteDifference);end.setUTCMinutes(end.getUTCMinutes()+minuteDifference);if(minuteDifference!=0){$currentSelectedAppointment.addClass("is-dragging")}if(!$currentSelectedAppointment.originalStart){$currentSelectedAppointment.originalStart=start}$currentSelectedAppointment.newStart=start;$currentSelectedAppointment.newEnd=end;$(".interval",$currentSelectedAppointment).text(formatTimeForHuman(start).toUpperCase()+"-"+formatTimeForHuman(end).toUpperCase())}var $unavailableBlock=null;function dragUnavailableTime(touchStartTime){if(!$unavailableBlock){$unavailableBlock=$('<div class="timeslot-column-0 timeslot unavailable is-dragging"></div>').appendTo($currentAppointmentListing);$unavailableBlock.css({top:touchStartTime/timeInterval*timeSlotHeight+"px",position:"absolute"});$unavailableBlock.startDate=$currentAppointmentListing.attr("date");$unavailableBlock.calendarId=$currentAppointmentListing.attr("calendar");var difference=currentMinutes-touchStartTime;if(difference>0){$unavailableBlock.startTime=new Date(currentTime.getTime()-difference*60*1e3);$unavailableBlock.endTime=currentTime}else{$unavailableBlock.endTime=new Date(currentTime.getTime()-difference*60*1e3);$unavailableBlock.startTime=currentTime}$unavailableBlock.startTop=$unavailableBlock.position().top}else{var height=currentTopPosition-$unavailableBlock.startTop;if(height>0){$unavailableBlock.endTime=currentTime;$unavailableBlock.css({top:$unavailableBlock.startTop,height:height+"px"})}else{$unavailableBlock.startTime=currentTime;$unavailableBlock.css({top:currentTopPosition+"px",height:Math.abs(height)+"px"})}}$unavailableBlock.text("Block off from "+formatTimeForHuman($unavailableBlock.startTime)+" - "+formatTimeForHuman($unavailableBlock.endTime))}function stopDraggingUnavailableTime(){if($unavailableBlock){Details.loadUri("/appointments.php?action=newBlockHtml&calendarID="+$unavailableBlock.calendarId+"&date="+$unavailableBlock.startDate+"&startTime="+formatForTimeElement($unavailableBlock.startTime)+"&endTime="+formatForTimeElement($unavailableBlock.endTime));$unavailableBlock.remove();$unavailableBlock=null}}$(".appointment-list-container").on("touchmove mousemove mousedown touchstart",".appointmentListing",function(ev){$prevAppointmentListing=$currentAppointmentListing;var $appointmentListing=$currentAppointmentListing=$(ev.currentTarget);if(ev.originalEvent.touches){var touch=ev.originalEvent.touches[0];var x=touch.clientX;$(".appointmentListing").each(function(e){if(x>$(this).offset().left&&x<$(this).offset().left+$(this).outerWidth()){$appointmentListing=$currentAppointmentListing=$(this)}})}if(isNewAppointmentLongtouch&&$prevAppointmentListing!=$currentAppointmentListing){hideTimeMarker()}var offset=$appointmentListing.offset();var topPos=(ev.pageY||ev.originalEvent.pageY)-offset.top;clickTimePrecision=clickTimePrecision||5;var minutes=clickTimePrecision*Math.round(minutesPerPixel*topPos/clickTimePrecision);var d=new Date;d.setUTCHours(0);d.setUTCMinutes(absOpenMinute+minutes);currentTouchLeft=(ev.originalEvent.clientX||ev.pageX||ev.originalEvent.pageX)-offset.left;currentTouchTop=(ev.originalEvent.clientY||ev.pageY||ev.originalEvent.pageY)-offset.top;currentTopPosition=topPos;currentMinutes=minutes;currentTime=d;currentDate=$appointmentListing.attr("date");currentCalendarId=$appointmentListing.attr("calendar")||"";if(isNewAppointmentLongtouch){showTimeMarker();ev.preventDefault()}if($currentSelectedAppointment){dragSelectedAppointment();ev.preventDefault()}});var skipNextTouch=false;$(document).on("mouseup touchend touchcancel touchleave",function(){if($currentSelectedAppointment&&(formatForTimeElement($currentSelectedAppointment.originalStart)!=formatForTimeElement($currentSelectedAppointment.newStart)||$currentSelectedAppointment.$startAppointmentListing.get(0)!=$currentAppointmentListing.get(0))){moveSelectedAppointment();lastDragTime=new Date}else if($currentSelectedAppointment&&$currentSelectedAppointment.hasClass("is-dragging")){resetSelectedAppointment()}$currentSelectedAppointment=undefined});if(isTouchDevice()){$(".appointment-list-container").on("touchend touchcancel touchleave",function(ev){if(isAndroid()){return}if(longpressTimer){clearTimeout(longpressTimer);longpressTimer=undefined}if(isNewAppointmentLongtouch){showNewAppointment();isNewAppointmentLongtouch=false}isLongtouch=false;hideTimeMarker()}).on("touchstart",function(ev){if(isAndroid()){return}if(skipNextTouch){skipNextTouch=false;return}var touchStartTime=currentMinutes;var touchStartLeft=currentTouchLeft;var touchStartTop=currentTouchTop;longpressTimer=setTimeout(function(){if(touchStartTime==currentMinutes&&Math.abs(touchStartLeft-currentTouchLeft)<8&&Math.abs(touchStartTop-currentTouchTop)<8){if(!isDragging()&&$(ev.target).hasClass("appointmentListing")){showTimeMarker();isNewAppointmentLongtouch=true}else if(isAppointment(ev.target)){$appt=$(ev.target).closest(".appointment");$appt.addClass("is-dragging");startDraggingAppointment($appt)}isLongtouch=true}},750)})}var lastTouchEvent=null;function isTouchRelated(){var now=new Date;return!isAndroid()&&lastTouchEvent&&now-lastTouchEvent<1e3}$(".appointment-list-container").on("touchstart touchend touchleave touchcancel",function(ev){lastTouchEvent=new Date});var touchStartTime=undefined;var touchStartCurrentTime=undefined;var touchStartDate=undefined;var touchStartCalendarId=undefined;var isMouseDownInWhitespace=false;$(".appointment-list-container").on("mousedown",".appointmentListing",function(ev){if(isTouchRelated())return;if($(ev.target).hasClass("appointmentListing")){touchStartTime=currentMinutes;touchStartCurrentTime=currentTime;touchStartDate=currentDate;touchStartCalendarId=currentCalendarId;showTimeMarker();isMouseDownInWhitespace=true}else if(isAppointment(ev.target)){touchStartTime=undefined;touchStartCurrentTime=touchStartDate=touchStartCalendarId=undefined;startDraggingAppointment($(ev.target).closest(".appointment"))}else{touchStartTime=undefined}});$(".appointment-list-container").on("mouseup mouseleave",function(){hideTimeMarker();stopDraggingUnavailableTime();isMouseDownInWhitespace=false});$(".appointment-list-container").on("mouseup",".appointmentListing, .mouse-position",function(ev){if(isTouchRelated())return;if(typeof touchStartTime!="undefined"&&touchStartTime==currentMinutes){showNewAppointment(touchStartDate,touchStartCurrentTime,touchStartCalendarId)}});$(".appointment-list-container").on("mousemove",function(ev){if(isTouchRelated())return;if(touchStartTime!=currentMinutes){if(isMouseDownInWhitespace){dragUnavailableTime(touchStartTime)}hideTimeMarker()}});$(".calendar-daily-view-container").on("remove",function(){$prevAppointmentListing=undefined;$currentAppointmentListing=undefined;$currentSelectedAppointment=undefined});return{isDragging:isDragging}};var appointmentsController=function($){$(".container").removeClass("detail-nav-display");if(isMobile()){$(".container").removeClass("main-nav-display").removeClass("sticky-main-nav-display")}function getScrollbarHeight(){var div=$('<div style="width:50px;height:50px;overflow:hidden;position:absolute;top:-200px;left:-200px;"><div style="width:100px;"></div>');$("body").append(div);var w1=$("div",div).innerHeight();div.css("overflow-x","scroll");var w2=$("div",div).innerHeight();$(div).remove();return w1-w2}var scrollbarHeight=getScrollbarHeight();function resizeElements(){var offset=$(".calendar-daily-view-container").offset();if(!isTouchDevice()&&offset){var windowHeight=window.innerHeight?window.innerHeight:$(window).height();var newHeight=Math.max(200,windowHeight-offset.top-scrollbarHeight);$calendarActions=$(".calendar-actions");if($calendarActions.is(":visible")){newHeight-=$calendarActions.outerHeight()}else{newHeight=Math.max(350,newHeight)}$(".calendar-daily-view-container").css({height:newHeight+"px"})}setTimeout(function(){var newWidth=$("#appointment-content").width()+30;if(!isAndroid())$(".calendar-actions").width(newWidth)},200)}var resizeTimer=null;function deferResize(){if(resizeTimer)clearTimeout(resizeTimer);resizeTimer=setTimeout(resizeElements,100)}$(document).bind("closed.bs.alert",deferResize);$(window).resize(deferResize);setTimeout(resizeElements,500);var fastTouchEvent;if(isTouchDevice()){fastTouchEvent="click"}else{fastTouchEvent="click"}$(".calendar-actions, .client-nav, .right-top-nav, .appointment-content").on("click","a.detail-nav-link",function(ev){if(!ev.isDefaultPrevented()&&!isMetaKeyPressed(ev)&&$(ev.currentTarget).attr("href")){ev.preventDefault();ev.stopPropagation();ev.stopImmediatePropagation();Details.loadUri($(ev.currentTarget).attr("href"))}});function getUriForTarget(id){var uri="";if(id.indexOf("appt:")>-1){id=id.replace("appt:","");uri="/appointments.php?action=detail&ajax=1&id="+id}else if(id.indexOf("availability:")>-1){id=id.replace("availability:","");uri="/appointments.php?action=detailAvailableGroup&ajax=1&id="+id}else if(id.indexOf("block:")>-1){var date=$('[id="'+id+'"]').attr("data-date");id=id.replace("block:","");uri="/appointments.php?action=newBlockHtml&ajax=1&date="+date+"&id="+id}return uri}function scrollAppointmentViewToTarget(el){var $el=$(el);var $calendarViewContainer=$(".calendar-daily-view-container");var scrollAmount=$el.offset().left+$calendarViewContainer.scrollLeft()-$calendarViewContainer.offset().left-($(".timeListing-container").width()+$(".timeListing-container").not(".affixing").width());scrollAmount=Math.max(0,scrollAmount);$(".calendar-daily-view-container").animate({scrollLeft:scrollAmount},150)}$(".appointment-list-container").on("mousedown touchstart",".timeslot",function(ev){var uri=getUriForTarget(ev.currentTarget.id);if(uri)FastJax.preload(uri+"&ajax=1")});var preloadTimers={};$(".appointment-list-container").on("mouseenter",".timeslot",function(ev){var id=ev.currentTarget.id;preloadTimers[id]=setTimeout(function(){preloadTimers[id]=null;var uri=getUriForTarget(id);if(uri)FastJax.preload(uri+"&ajax=1")},100)});$(".appointment-list-container").on("mouseleave",".timeslot",function(ev){var timeout=preloadTimers[ev.currentTarget.id];if(timeout){clearTimeout(timeout)}});$(".appointment-list-container").on("click",".timeslot",function(ev){if(!touchController.isDragging()){Details.loadUri(getUriForTarget(ev.currentTarget.id));scrollAppointmentViewToTarget(ev.currentTarget)}});$("#appointment-content").on("click",".listingTitle",function(ev){if(!isCurrentlyWeekView())return;var $listing=$(this).nextAll(".appointmentListing");var date=$listing.attr("date");if(date){navigateAppointments("next",ev,"appointments.php?view=day&day="+date)}});$(".btn-filter-calendars").popover({html:true,template:'<div class="popover popover-medium"><div class="arrow"></div><div class="popover-inner"><div class="popover-content"><p></p></div></div></div>',content:function(){return $("#filter-calendars-popover-content").html()}});$(".btn-filter-calendars").click(function(ev){ev.preventDefault()});function hidePopover(){$(".popover").remove()}if(!document.hookedPjaxEvents){$(document).on("pjax:start",function(ev){hidePopover()});$(document).on("pjax:end",function(ev){if(ev.relatedTarget&&$(ev.relatedTarget).is("form")&&$(ev.target).hasClass("detail-nav")&&$("#appointment-content").length){if(!lastNavigateAppointments)return;var href=document.location.href;if(href.indexOf("action=")>-1||href.indexOf("undefined")>-1){href=lastNavigateAppointments}if(href.indexOf("?")===-1)href+="?";navigateAppointments("next",ev,href)}});$("body:has(#appointment-content)").on("click touchend","#monthly-calendar .calendar a",function(ev){if($("#appointment-content").length==0)return;Details.hide();navigateAppointments("next",ev,$(this).attr("href"))});$(window).on("click",function(e){$('[data-toggle="popover"]').each(function(){if(!$(this).is(e.target)&&$(this).has(e.target).length===0&&$(".popover").has(e.target).length===0){$(this).popover("hide")}})});document.hookedPjaxEvents=true}$(".btn-calendar").click(function(ev){ev.preventDefault()});if(!isTouchDevice())$(".btn-filter-calendars").tooltip();function initCalendar(){Affix.init();initTooltips();resizeElements();$("[data-appointment-id]").on("click",function(ev){if(isMetaKeyPressed(ev)||$(ev.target).is("input"))return;ev.preventDefault();var $target=$(ev.currentTarget);var url="/appointments.php?action=detail&id="+$target.attr("data-appointment-id");Details.loadUri(url,{dontScrollTop:true})});$("[data-class-id]").on("click",function(ev){if(isMetaKeyPressed(ev))return;ev.preventDefault();var $target=$(ev.currentTarget);var url="/appointments.php?action=detailAvailableGroup&id="+$target.attr("data-class-id");Details.loadUri(url,{dontScrollTop:true})});var currentDate=$("#current-date").val();if(currentDate){$(".btn-block-time").attr("href","appointments.php?action=newBlockHtml&day="+currentDate);$(".btn-offer-class").attr("href","appointments.php?action=addAvailableGroup&day="+currentDate)}var newTitle=$(".calendar-title-text").text();document.title=newTitle}initCalendar();var lastNavigateAppointments=document.location.href+"?";function navigateAppointments(direction,ev,hrefOverride){ev.preventDefault();hidePopover();var transitionOut=direction=="previous"?"fadeOutRightBig":"fadeOutLeftBig";var transitionIn=direction=="previous"?"fadeInLeftBig":"fadeInRightBig";var baseHref=(hrefOverride?hrefOverride:$(ev.currentTarget).attr("href")).replace(/#.*/,"");var href=baseHref+"&ajax=1&navAppts=1";lastNavigateAppointments=href.replace(/&ajax=1&navAppts=1/g,"");if(href.indexOf("view=day")>-1){$(".btn-month, .btn-week").removeClass("active")}Acuity.pushState(href.replace(/&ajax=1/g,"").replace(/ajax=1/g,"").replace(/&navAppts=1/g,""));if(href.indexOf("ajax=1")===-1)href+="&ajax=1";if(href.indexOf("navAppts=1")===-1)href+="&navAppts=1";if(typeof Acuity.loadPopoverCalendar=="function"&&$("#appointment-content").length){Acuity.loadPopoverCalendar(lastNavigateAppointments,$("#monthly-calendar"))}var loadingTimer=setTimeout(function(){$(".appointment-list-container").html('<div class="loading-container"><div class="progress-spinner"></div><br /><div class="loading-text margin-top">Loading...</div></div>')},300);$.get(href,function(data){clearTimeout(loadingTimer);$(".agenda").removeClass("agenda");$(".appointment-list-container").html(data);if($(".big-calendar-container").length){$(".appointment-list-container").addClass("viewing-month")}else{$(".appointment-list-container").removeClass("viewing-month")}initCalendar()})}$(".menu-toggler").on(fastTouchEvent,Acuity.wrap(function(ev){ev.preventDefault();ev.stopPropagation();var targetClass=$(ev.currentTarget).attr("data-class");Details.showMenu(targetClass)}));$(".main-nav").on(fastTouchEvent,"a",function(){$(".container").removeClass("display-nav")});function setActiveCalendarView(className){$(".calendar-nav .btn.active").removeClass("active");$(className).addClass("active")}function menuNavigate(ev,className,viewName){var currentDate=$("#current-date").val();if(currentDate){setActiveCalendarView(className);navigateAppointments("next",ev,"appointments.php?round=1&view="+viewName+"&day="+currentDate)}}$(".btn-today").on(fastTouchEvent,function(ev){var href=$(ev.currentTarget).attr("href");var isTodayVisible=$(".is-today").length>0;if(!isTodayVisible&&isCurrentlyWeekView()&&href){setActiveCalendarView(".btn-today");Acuity.goTo(href.replace("view=day","view=thisWeek"));ev.preventDefault()}});$(".btn-week").on(fastTouchEvent,function(ev){menuNavigate(ev,".btn-week","thisWeek");Details.hide()});$(".btn-month").on(fastTouchEvent,function(ev){menuNavigate(ev,".btn-month","thisMonth");Details.hide()});$(".appointment-list-container").on("click","#nav-previous",$.proxy(navigateAppointments,this,"previous"));$(".appointment-list-container").on("click","#nav-next",$.proxy(navigateAppointments,this,"next"));function setupColumns(isFirst){if($(".calendar-daily-view table").width()-$(".calendar-daily-view-container").width()>15){$(".calendar-daily-view-container").addClass("is-scrolling-wide");if(isFirst===true){$(".calendar-daily-view-container").addClass("animated").addClass("bounceX")}}else{$(".calendar-daily-view-container").removeClass("is-scrolling-wide")}var width=0;$(".appointmentListing").each(function(e){var columns=$(e).attr("data-num-columns");width+=columns*115});var pageWidth=Math.max(width,$(".calendar-daily-view-container").width());$(".calendar-daily-view").width(pageWidth)}setupColumns(true);$(window).resize(setupColumns);var touchController=appointmentsTouchController($,this);function toggleSticky(){if(!$(".container").hasClass("sticky-main-nav-display")){$(".container").addClass("sticky-main-nav-display").addClass("main-nav-display");$.get("appointments.php?action=showMenu&m=1")}else{$(".container").removeClass("sticky-main-nav-display").removeClass("main-nav-display");$(".show-main-menu").removeClass("active");setTimeout(function(){$(".show-main-menu").addClass("active")},300);setTimeout(function(){$(".show-main-menu").removeClass("active")},900);$.get("appointments.php?action=showMenu&m=0")}}$("body:has(#appointment-content) .close-main-menu").click(function(ev){ev.preventDefault();if($(".container").hasClass("main-nav-display")){Details.showMenu("main-nav-display")}toggleSticky()});$('[data-class="main-nav-display"]').click(function(){var $this=$(this);setTimeout(toggleSticky,50);setTimeout(function(){var $tt=$this.closest("div").find('.visible-main-nav-not-showing[data-toggle="tooltip"]:visible');$tt.tooltip("show");setTimeout(function(){$tt.tooltip("hide")},3e3)},500)});$(".new-appointment-link").click(function(ev){if(typeof respond!="undefined"&&!respond.mediaQueriesSupported){ev.preventDefault();document.location=$(ev.target).attr("href")}});$("#appointment-content").on("click",".big-calendar td.has-appts",function(ev){$(".highlight-fade").removeClass("highlight-fade");var date=$(this).attr("day");var $dateHeading=$("#date-"+date).closest("h3");if(date&&$dateHeading&&$dateHeading.length){Details.hide();var top=$dateHeading.position().top;$("body, html").animate({scrollTop:top+"px"},300);$dateHeading.nextUntil("h3").filter(".calendar-appt").addClass("highlight-fade")}});$(".hide-new-features").click(function(ev){$.get("/appointments.php?hidemessage=1")});$(".appointment-content").addClass("transitions-enabled")};Acuity.addController("#appointment-content",appointmentsController);var blockTimeController=function($){function setBlockType(){var type="";if(isAllDay()&&$("#end_date_textbox").val()==$("#start_date_textbox").val()){type="wholeSingleDay"}else if(isAllDay()&&$("#end_date_textbox").val()!=$("#start_date_textbox").val()){type="multipleDays"}else if(!isAllDay()&&!isRecurring()){type="singleDay"}else if(!isAllDay()&&isRecurring()&&!$("#end_date_textbox").val()){type="recurringTime"}else if(!isAllDay()&&isRecurring()&&$("#end_date_textbox").val()){type="recurringConstrained"}$("#type").val(type)}function isRecurring(){return $("#block-recurring-options").is(":visible")}function isAllDay(){return $("#allday").is(":checked")}function validateBlockTimes(){$("#times_group, #date-fields, .calendars-group").removeClass("has-error");if($('#singleCalendarID, .calendars-group [name="calendarID[]"]:checked').length==0){$(".calendars-group").addClass("has-error");return false}if(isAllDay()){var startTime=dateObjectFromString($("#start_date_textbox").val());var endTime=dateObjectFromString($("#end_date_textbox").val());if(startTime&&endTime&&startTime>endTime){$("#date_group").addClass("has-error");return false}}else{var startTime=parseTime($("#start_time").val());var endTime=parseTime($("#end_time").val());if(startTime&&endTime&&startTime>=endTime){$("#times_group").addClass("has-error");return false}}return true}function setDate(input,date){var z=$(input).val();var today=date;if(!today||today=="NaN")today=new Date;var dd=today.getUTCDate();var mm=today.getUTCMonth()+1;var yyyy=today.getUTCFullYear();if(dd<10){dd="0"+dd}if(mm<10){mm="0"+mm}today=yyyy+"-"+mm+"-"+dd;$(input).val(today)}function setRecurringDayOfWeek(){if(!$("#start_date_textbox").val()){var today=new Date;setDate("#start_date_textbox")}var startDate=dateObjectFromString($("#start_date_textbox").val());if(startDate)$("#dayOfWeek label:eq("+startDate.getUTCDay()+")").button("toggle")}function setAllDay(){if(isAllDay()){$("#end_date_group").show(0);$("#times_group").hide(0);$("#block-recurring-options").hide(0);$("#block-recurring").hide(0);if(!$("#end_date_textbox").val())$("#end_date_textbox").val($("#start_date_textbox").val());$("#start-label").hide(0);$("#date-fields").removeClass("col-xs-9").addClass("col-xs-12")}else{$("#end_date_group").hide(0);$("#times_group").show(0);$("#block-recurring").show(0).removeClass("active");$("#start-label").show(0);$("#date-fields").removeClass("col-xs-12").addClass("col-xs-9")}}function enableRecurring(){$("#start-label").text("Starting");$("#block-recurring-options").slideDown();setRecurringDayOfWeek()}function disableRecurring(){$("#start-label").text("Date");$("#block-recurring-options").slideUp()}$("#recur-until").on("change keyup",function(){if($("#recur-until").is(":visible")){$("#end_date_textbox").val($("#recur-until").val())}});$("#block-recurring").on("touchstart click",function(ev){ev.preventDefault();if(!$("#block-recurring-options").is(":visible")){enableRecurring()}else{disableRecurring()}});$("#dayOfWeek").on("change",function(){var selectedDay=$("#dayOfWeek input:checked").attr("data-day");var date=dateObjectFromString($("#start_date_textbox").val());if(selectedDay!=date.getUTCDay()){date.setUTCDate(date.getUTCDate()-date.getUTCDay()+parseInt(selectedDay));setDate("#start_date_textbox",date)}});$("#block-time-form").on("submit",function(ev){if(!validate(this)||!validateBlockTimes()){ev.preventDefault()}else{if($("#recur-until").is(":visible")){$("#end_date_textbox:hidden").val($("#recur-until").val())}$("#block-time-submit").button("loading")}});$("#block-time-form").on("submit change",function(){setBlockType()});$("#start_date_textbox").change(function(){var startDate=new Date($("#start_date_textbox").val());var endDate=new Date($("#end_date_textbox").val());if(!$("#end_date_textbox").val()||endDate<startDate){$("#end_date_textbox").val($("#start_date_textbox").val())}setRecurringDayOfWeek()});$("#allday").change(setAllDay);$("body:has(#block-time-page)").on("click",".btn-hide-popover",function(ev){ev.stopImmediatePropagation();$('#block-time-page [data-toggle="popover"]').popover("hide")});$('#block-time-page [data-toggle="popover"]').popover();setAllDay();setBlockType();setRecurringDayOfWeek();if($("#block-is-recurring").val()>0){$("#block-recurring").addClass("active");enableRecurring()}};Acuity.addController("#block-time-page",blockTimeController);Acuity.addController(".btn-bulk-reschedule",function($){$(".btn-bulk-reschedule").each(function(){var $this=$(this);$this.attr("disabled",true);$($this.data("appointment-container")).on("change",function(){var $checked=$($this.data("appointment-container")).find(".appt-checkbox:checked");$this.attr("disabled",$checked.length==0)})});$(".btn-bulk-reschedule").click(function(){var $this=$(this);var params="";var $checked=$($this.data("appointment-container")).find(".appt-checkbox:checked");if($checked.length==0){return}$checked.each(function(){params+="id[]="+$(this).val()+"&"});params+="back="+encodeURIComponent($this.data("back-url"));Details.loadUri("/appointments.php?action=bulkReschedule&"+params)})});Acuity.addController(".appointment-bulk-reschedule-page",function($){function checkConflicts(){var times=[];
var ignoreAppointments=[];$(".appt-reschedule-container .appt-time").each(function(){var $this=$(this);times.push({datetime:$this.val(),calendarID:$this.data("calendar"),type:$this.data("type"),id:$this.data("id")});ignoreAppointments.push($this.data("id"))});var data={times:times,ignoreAppointments:ignoreAppointments};Calendar.checkConflicts(data,function(result){$(".has-conflict").removeClass("has-conflict");for(var i=0;i<result.length;i++){if(result[i].why){var $el=$('[data-id="'+result[i].id+'"]');$el.closest("div").addClass("has-conflict").find(".conflict-message").text(result[i].title)}}})}function adjustTimes(){var adjustTypeMultiplier=$('[name="adjustType"]').val()=="-"?-1:1;var adjustmentMinutes=adjustTypeMultiplier*(parseFloat($('[name="adjustHours"]').val())*60+parseFloat($('[name="adjustDays"]').val())*24*60);if(!adjustmentMinutes){adjustmentMinutes=0}if(adjustmentMinutes==0){$(".appt-reschedule-container .adjusted").removeClass("adjusted");$(".appt-reschedule-container .appt-time").each(function(){$(this).val($(this).data("original-value"))})}else{$(".appt-reschedule-container .appt-time").each(function(){var $this=$(this);var originalTime=dateTimeObjectFromString($this.data("original-value"));newDateTime=new Date(originalTime.getTime()+adjustmentMinutes*6e4);$this.val(formatForDateElement(newDateTime)+" "+formatForTimeElement(newDateTime)).change();var newDateTimeString=FriendlyDates.weekday[newDateTime.getUTCDay()]+", "+formatDateForHuman(newDateTime)+" "+formatTimeForHuman(newDateTime);$this.closest("div").find("h4").addClass("adjusted").find(".new-datetime").text(newDateTimeString)})}checkConflicts()}var debouncedAdjustTimes=debounce(adjustTimes,100);function enableSubmit(){var isDifferent=false;$("[data-original-value]").each(function(){if($(this).val()!=$(this).data("original-value")){isDifferent=true}});$(".reschedule-btn-group .btn").prop("disabled",!isDifferent)}enableSubmit();$(".appointment-bulk-reschedule-page").on("change",debounce(enableSubmit,50));function showAdjustOptions(){var isSet=$('[name="adjustType"]').val()=="set";$(".set-amounts-container").toggle(isSet);$(".adjust-amounts-container").toggle(!isSet)}showAdjustOptions();$('[name="adjustType"]').change(showAdjustOptions);$(".adjust-container").on("change keyup",debouncedAdjustTimes);$(".adjust-set-days").change(function(){$('[name="adjustDays"]').val($(this).val())});$(".adjust-set-hours").change(function(){$('[name="adjustHours"]').val($(this).val())});$(".class-reschedule-container select").change(function(){$(this).closest("div").find(".datetime").toggleClass("adjusted",$(this).val()!=$(this).data("original-value"))});$('.appointment-bulk-reschedule-page [name="no-email"]').click(function(ev){$(".appointment-bulk-reschedule-page").append('<input type="hidden" name="no-email" value="1" />')});$(".appointment-bulk-reschedule-page").submit(function(ev){$("#reschedule-submit").button("loading")})});Acuity.addController(".calendar-selection-container, #filter-calendars-popover-content",function($){if(Acuity.initializedCalendarSelection)return;Acuity.initializedCalendarSelection=true;function getContainer(ev){return $(ev.currentTarget).closest(".calendar-selection-container")}$("body").on("change",".select-all-filter-calendars",function(ev){var $container=getContainer(ev);var selectAll=$container.find(".select-all-filter-calendars").prop("checked");$container.find(".filter-calendar").prop("checked",selectAll)});$(document.body).on("change",".filter-calendar-family",function(ev){var $container=getContainer(ev);var parentId=$(ev.currentTarget).attr("data-parent-id");var $children=$container.find(".filter-calendar[data-parent-calendar="+parentId+"]");$children.prop("checked",$children.not(":checked").length!=0)});$(document.body).on("click",".filter-calendar",function(ev){var $container=getContainer(ev);var parentId=$(ev.currentTarget).attr("data-parent-calendar");var allChildrenChecked=$container.find(".filter-calendar[data-parent-calendar="+parentId+"]").not(":checked").length==0;$container.find(".filter-calendar-family[data-parent-id="+parentId+"]").prop("checked",allChildrenChecked)})});Acuity.addController("#certificateCode",function($){function checkCode(){checkTimer=null;$msg=$("#certificateCode-error-message");$container=$("#certificateCode-container");$.post("/appointments.php?action=checkCode&code="+$("#certificateCode").val()+"&type="+$("#appointmentType").val(),function(data){var json=JSON.parse(data);if(json.error){$container.addClass("has-error").removeClass("has-success");$(".icon-ok",$container).addClass("hidden")}else{$container.removeClass("has-error").addClass("has-success");$(".icon-ok",$container).removeClass("hidden")}$msg.text(json.message)})}var checkTimer=null;function queueCheckCode(){if(checkTimer)clearTimeout(checkTimer);checkTimer=setTimeout(checkCode,300)}var codesSource=function(query,cb){$.get("/schedule.php",{action:"getCodes",type:$("#appointmentType").val(),email:$("#clientID").attr("data-client-email")||$('[name="email"]').val()},function(data){try{cb(JSON.parse(data))}catch(er){}})};$("#certificateCode").typeahead({hint:false,highlight:true,minLength:0},{displayKey:"code",source:codesSource,templates:{suggestion:function(data){var html=data.code+' <div class="text-muted">'+data.name+"</div>";if(data.expires){html+='<div class="text-muted small">Expires: '+formatDateForHuman(data.expires)+"</div>"}return html}}}).focus(function(ev){var ev=$.Event("keydown");ev.keyCode=ev.which=40;$("#certificateCode").trigger(ev);return true}).on("typeahead:autocompleted typeahead:selected",function(ev,suggestion,dataSet){if(suggestion.code)$("#certificateCode").val(suggestion.code);queueCheckCode()});$("#certificateCode").on("change keyup",queueCheckCode)});var classDetailController=function($){$(".notes-form").submit(function(ev){ev.preventDefault();$form=$(ev.currentTarget);$submit=$(".btn-default",$form);$submit.button("loading");$.post($form.attr("action"),$form.serialize(),function(data){$apptRow=$form.closest(".calendar-appt");$apptRow.addClass("form-hidden");$(".appt-notes",$apptRow).text($(".form-control",$form).val())}).fail(function(){Flash.error("Couldn't save notes, please try again.")}).always(function(){$submit.button("reset")})});$(".edit-appt-notes").click(function(ev){ev.preventDefault();$apptRow=$(ev.target).closest(".calendar-appt");$apptRow.removeClass("form-hidden");$(".form-control",$apptRow).get(0).focus()});$(".edit-class").click(Acuity.wrap(function(ev){ev.preventDefault();$("#class-details-page").toggleClass("form-hidden")}));$(".cancel-class-edit").click(Acuity.wrap(function(ev){ev.preventDefault();$("#class-details-page").addClass("form-hidden")}));function checkConflict(){var calendarID=$('#class-details-page [name="calendar"]').val();var typeID=$('#class-details-page [name="type"]').val();var opts={calendarID:calendarID,typeID:typeID,times:[]};$('#class-details-page [name="date[]"]').each(function(){var $date=$(this);var $time=$date.parent().find('[name="time[]"]');if($date.val()&&$time.val()){opts.times.push({date:$date.val(),time:$time.val()})}});$(".alert-class-conflict").hide();if(!opts.calendarID||!opts.typeID||!opts.times){return}$.post("/appointments.php?action=checkClassConflict",opts,function(data){if(data){$(".alert-class-conflict").show().html(data)}else{$(".alert-class-conflict").hide()}}).fail(function(){$(".alert-class-conflict").hide()})}$("#class-details-page").on("change",'[name="calendar"], [name="type"], [name="time[]"], [name="date[]"]',function(ev){checkConflict()});$(".class-appointment-list .btn-check-all").click(function(ev){ev.preventDefault();$(".class-appointment-list .appt-checkbox").each(function(){$(this).prop("checked",!$(this).prop("checked")).change()})});$("#offer-recurring-link").click(function(ev){var time=parseTime($("#time").val());if(!time){Flash.error("Please enter a start time for the class, like <strong>10:00am</strong>");return}time=formatTimeForHuman(time);$("#time").val(time);Recurring.updateRecurringTime($("#date").val(),time);$("#recur-settings").slideDown(200);$("#save-changes-row, #initial-time-setting").hide(0)});$("#additional-times").on("click",".additional-time a",function(ev){$(this).closest(".additional-time").remove()});function hideRecurring(){$("#recur-settings").slideUp(200);$("#save-changes-row, #initial-time-setting").show(0)}$("#cancel-recurring").click(hideRecurring);$("#add-recur-times").click(function(ev){hideRecurring();$additionalTimes=$("#additional-times");var time=$("#time").val();var isFirst=true;Recurring.addCustomRecurringTime(function(date){if(isFirst){isFirst=false;return}$additionalTimes.append('<div class="additional-time"><input type="text" class="form-control datepicker" name="date[]" size="12" value="'+date+'" /><input type="text" class="form-control" name="time[]" value="'+time+'" size="6" /> <a href="#">Remove</a><div>')});$additionalTimes.find(".datepicker").datepicker({dateFormat:"yy-mm-dd"})});$("#class-details-page").submit(function(ev){if(!validate($("#class-details-page"))){ev.preventDefault()}})};Acuity.addController("#class-details-page",classDetailController);var clientDetailController=function($){$(".edit-client").click(function(ev){ev.preventDefault();$("#client-details-page, #bulk-cancel-form").toggleClass("form-hidden");if($(ev.currentTarget).hasClass("edit-client-notes")){$("#client-notes").focus()}});$(".cancel-client-edit").click(function(ev){ev.preventDefault();$("#client-details-page, #bulk-cancel-form").addClass("form-hidden")});$(".appt-checkbox").change(apptCheckboxChanged);$("#check-all-appt").click(checkAll);function checkAll(){$(".appt-checkbox").each(function(){$(this).prop("checked",!$(this).prop("checked")).change()});apptCheckboxChanged()}function apptCheckboxChanged(){$("#cancel-appts-btn").attr("disabled",$(".appt-checkbox:checked").length==0)}$("#bulk-cancel-form").on("click",'[name="no-email"]',function(ev){$("#bulk-cancel-form").append('<input type="hidden" name="no-email" value="1" />')});$("#bulk-cancel-form").on("click","#cancel-add-note-bulk",function(ev){$(ev.currentTarget).parent().empty().html('<label for="cancel-note">Include note in e-mail to client:</label><textarea id="cancel-note" name="note" placeholder="Note e-mailed to client" class="form-control"></textarea>').find("textarea").focus();$('#bulk-cancel-form [name="no-email"]').attr("disabled",true);ev.preventDefault();ev.stopImmediatePropagation()});$('#bulk-cancel-form [data-toggle="popover"]').on("shown.bs.popover",function(){$(".btn-hide-popover").click(function(ev){ev.preventDefault();ev.stopImmediatePropagation();$('#bulk-cancel-form [data-toggle="popover"]').popover("hide")})});$('.client-details [data-toggle="popover"]').popover();$('#bulk-cancel-form [data-toggle="popover"]').popover()};Acuity.addController("#client-details-page",clientDetailController);Acuity.addController(".client-nav",function($){var delay=function(){var timer=0;return function(callback,ms){clearTimeout(timer);timer=setTimeout(callback,ms)}}();var $clientInput=$("#client-search input");$clientInput.focus().val($clientInput.val());var searchXhr=null;var currentlyShowingSearch=null;function doSearch(){var search=$("#client-search input").val().replace(/\\/g,"");if(search!=currentlyShowingSearch){$("#client-search-results").html("Searching for <strong>"+$("#client-search input").val()+"</strong>...")}if(searchXhr){searchXhr.abort()}searchXhr=$.get("/clients.php?action=search&ajax=1&defaultFullList="+$("#client-search-results").hasClass("search-only")+"&q="+encodeURIComponent(search),function(data){currentlyShowingSearch=search;$("#client-search-results").html(data)})}lastClientPaneHref="";function loadHrefIntoClientPane(href){lastClientPaneHref=href;$.get(href+"&ajax=1&standalone=1",function(data){$(".client-details-pane").html(data);Acuity.init()}).fail(function(){Flash.error("Failed to load client, please try again.")})}function reloadClientPane(){if(lastClientPaneHref){loadHrefIntoClientPane(lastClientPaneHref)}}if(!window.initClientList){window.initClientList=true;$(document).on("pjax:end",function(ev){if($(".client-nav").length==0)return;if($(ev.target).hasClass("detail-nav")){reloadClientPane()}$(".client-nav, .client-details-pane").css({marginTop:0});if($("#refresh-client-list").length){doSearch()}})}$(".client-details-pane").on("submit","form.detail-nav-link",function(event){var el=event.currentTarget;if(!event.isDefaultPrevented()&&!el.hasAlreadySubmitted){$.pjax.submit(event,".client-details-pane",{timeout:0,url:el.action+"&ajax=1&standalone=1",push:false});el.hasAlreadySubmitted=true}});$(".client-details-pane").on("click",".client-details-pane-link",function(ev){if(!ev.isDefaultPrevented()){$clientPane=$(".client-details-pane").html(Acuity.loadingHtml);loadHrefIntoClientPane($(ev.currentTarget).attr("href"));ev.preventDefault()}});$(".client-nav, .client-details-pane").on("click",".detail-nav-link",function(ev){if(!$(ev.currentTarget).attr("href")){return}ev.preventDefault();Details.loadUri($(this).attr("href"),{dontScrollTop:true})});var clientBaseTop=-1;$(".client-nav").on("click",".show-client-btn",function(ev){var $clientPane=$(".client-details-pane");if($clientPane.length==0)return;ev.preventDefault();$(".show-client-btn.selected-client").removeClass("selected-client");$(this).addClass("selected-client");$(".preferences-container").addClass("showing-client-pane");if(clientBaseTop<0){clientBaseTop=$clientPane.offset().top}$clientPane.html(Acuity.loadingHtml).css({marginTop:Math.max(0,$(window).scrollTop()-clientBaseTop)+"px"});loadHrefIntoClientPane($(this).attr("href"))});$(".client-details-pane").on("click",".btn-close-client-pane",function(ev){ev.preventDefault();$(".show-client-btn.selected-client").removeClass("selected-client");$(".preferences-container").removeClass("showing-client-pane")});$(".client-nav").on("click",".add-one-client",function(){Details.loadHtml($("#add-client-template").html());$(".add-client-form").submit(Validate.validateSubmit);$(".add-client-form .form-control").first().focus()});$(".client-nav").on("keyup","#client-search input",function(ev){var $target=$(ev.currentTarget);$target.attr("value",$target.val());delay(window.Acuity.wrap(doSearch),650)});$(".client-nav").on("submit","#client-search",function(ev){ev.preventDefault();ev.stopImmediatePropagation();window.Acuity.wrap(doSearch)()})});Acuity.Confirm=function($){function confirmSuccess($this){var href=$this.attr("data-confirm-href");if($this.hasClass("confirm-detail-nav-link")&&$this.closest(".detail-nav").length>0){Details.loadUri(href)}else{document.location.href=href}}function cleanDoubleConfirm(val){return $.trim(val).replace(/["']/g,"").toUpperCase()}function showConfirm($this,onsuccess,doubleConfirm){var $parent=$this.parent();var promptText=$this.attr("data-confirm-prompt")||"Are you sure?";promptText=promptText.replace(/\\n/g,"\n");var $prompt=$('<div class="confirm-prompt" />').text(promptText);$prompt.html($prompt.html().replace(/\n/g,"<br />"));if(doubleConfirm){$prompt.append('<div class="double-confirm-group"><input type="text" class="form-control double-confirm" placeholder="Type '+doubleConfirm+' to confirm" />'+'<div class="double-confirm-error help-block error-message">That doesn\'t match, please type <strong>'+doubleConfirm+"</strong> to confirm</div></div>")}$prompt.append('<div class=""><a href="#" class="btn btn-default btn-confirm margin-top margin-right margin-bottom">OK</a> <a href="#" class="margin-top btn-cancel">Cancel</a></div>');var placement=$this.attr("data-placement");if(!placement){var minHeightOfPopover=250;if($this.offset().top-$(window).scrollTop()<minHeightOfPopover){placement="bottom"}else{placement="top"}}$this.popover({content:$prompt,html:true,placement:placement,trigger:"manual"}).on("shown.bs.popover",function(){if(doubleConfirm){$parent.find(".double-confirm").focus()}else{$parent.find(".btn-confirm").focus()}});$parent.off("keypress.AcuityConfirm",".double-confirm").on("keypress.AcuityConfirm",".double-confirm",function(ev){if(ev.which==13){$parent.find(".btn-confirm").click();ev.preventDefault()}});$parent.off("click.AcuityConfirm",".btn-cancel").on("click.AcuityConfirm",".btn-cancel",function(){$this.popover("hide")});$parent.off("click.AcuityConfirm",".btn-confirm").on("click.AcuityConfirm",".btn-confirm",function(){var doubleConfirmVal=cleanDoubleConfirm($parent.find(".double-confirm").val());if(!doubleConfirm||doubleConfirmVal.toUpperCase()==doubleConfirm.toUpperCase()){$this.popover("hide");onsuccess()}else{$parent.find(".double-confirm-group").addClass("has-error")}});$this.popover("show")}Acuity.addController("form[data-confirm-action]",function(ev){$("form[data-confirm-action]").on("submit",function(ev){var $this=$(this);var promptText=$this.attr("data-confirm-prompt").replace(/\\n/g,"\n");var doubleConfirm=cleanDoubleConfirm($this.attr("data-confirm-double"));if(doubleConfirm){if(cleanDoubleConfirm(prompt(promptText))==doubleConfirm){$this.attr("action",$this.attr("data-confirm-action"));return}else{Flash.error("That didn't match, please try again and type <strong>"+doubleConfirm+"</strong> to confirm")}}else{if(confirm(promptText)){$this.attr("action",$this.attr("data-confirm-action"));return}}ev.preventDefault()})});$(document).on("click","button[data-confirm-prompt]",function(ev){var $this=$(this);var promptText=$this.attr("data-confirm-prompt");ev.preventDefault();showConfirm($this,function(){$this.closest("form").append($('<input type="hidden" name="'+$this.attr("name")+'" value="'+$this.attr("data-value")+'" />')).submit()})});$(document).on("click","[data-confirm-href]",function(ev){ev.preventDefault();var $this=$(this);var doubleConfirm=$this.attr("data-confirm-double");showConfirm($this,function(){confirmSuccess($this)},doubleConfirm)})}(jQuery);var couponsController=function($){function showOpts(){$("#specificTypes").toggle($("#canBeUsed").val()=="specific");$("#specificProducts").toggle($("#canBeUsed").val()=="products");$("#custom-uses").toggle($("#numUses").val()=="custom");if($("#numUses").val()=="custom"){$('[name="customNumUses"]').focus()}}$("#canBeUsed, #numUses").change(showOpts);$("#single-code").on("keyup change",function(ev){var $code=$("#single-code");if(/[^a-zA-Z0-9%$+-]/.test($code.val())){$code.closest(".form-group").addClass("has-error")}else{$code.closest(".form-group").removeClass("has-error")}});$("#select-all-types").change(function(ev){$("#specificTypes .type-checkbox").prop("checked",$(this).prop("checked"))});$("#select-all-products").change(function(ev){$("#specificProducts .type-checkbox").prop("checked",$(this).prop("checked"))});$("#coupon-edit-page .detail-link").click(function(ev){ev.preventDefault();Details.loadUri($(ev.target).attr("href"))});$("#button-show-multiple-codes").click(function(ev){$(".hide-multiple-coupon-codes").hide();$("#single-code").prop("disabled",true);$(".show-multiple-coupon-codes").show();$("#multiple-codes").prop("disabled",false);if(!$("#multiple-codes").val()){$("#multiple-codes").val($("#single-code").val())}});var $redeemedCodes=$(".code-redeemed");$("#discountAmount, #discountType").on("change keyup",function(){if($redeemedCodes.length){$(".redeemed-code-warning").show()}});function toggleChecked(){var $el=$(this);$el.closest(".checkbox").toggleClass("is-checked",$el.is(":checked"))}$('#specificProducts [type="checkbox"]').on("change",toggleChecked).each(toggleChecked);var allChecked=$("#specificTypes .type-checkbox").length==$("#specificTypes .type-checkbox:checked").length;$("#select-all-types").prop("checked",allChecked);showOpts();$(function(){$("#expiration").datepicker({dateFormat:"yy-mm-dd"})});$("#coupon-edit-page").submit(Validate.validateSubmit)};Acuity.addController("#coupon-edit-page",couponsController);Acuity.addController(".show-direct-link",function($){$(".show-direct-link").click(function(ev){ev.preventDefault();var $content=$(this).next(".direct-link-content");if($content.length==0){$content=$(this).closest("li, .calendar-list-item").find(".direct-link-content")}$content.toggleClass("showing-direct-link");$(this).toggleClass("showing-direct-link");$(".copy-btn").click(function(ev){ev.preventDefault()});var clipboard=new Clipboard(".copy-btn");clipboard.on("success",function(e){var $trigger=$(e.trigger).tooltip({title:"Copied!",trigger:"manual"}).tooltip("show");setTimeout(function(){$trigger.tooltip("destroy")},3e3)})})});Acuity.addController(".edit-hidden-form",function($){$(".edit-hidden-form").click(function(ev){$(ev.currentTarget).closest("form").removeClass("form-hidden")})});var editTypeController=function($){$(".show-on-click").click(function(ev){ev.preventDefault();var targetSelector=$(ev.currentTarget).attr("data-target");var $target=$(targetSelector);if($target.length){$target.slideDown(200,function(){$target.find("input, textarea").focus()});$(ev.currentTarget).hide()}});$("#name").on("keyup change",function(){var name=$("#name").val();if(!$.trim(name)){$("#name-title").html('<span class="text-muted"><em>No name</em></span>')}else{$("#name-title").text(name)}});$('[name="isSeries"]').change(function(ev){$(".show-for-series-message").toggle($(ev.currentTarget).is(":checked"))});$("#groupname").change(function(){if($("#groupname").val()=="(new)"){$("#new_group").show(0).focus()}else{$("#new_group").hide(0)}});function showAdminOnlyText(){var isAdminOnly=$("#admin-only").is(":checked");$("#admin-only-text").toggle(isAdminOnly);$("#admin-only-off-text").toggle(!isAdminOnly)}$("#admin-only").bootstrapSwitch({onSwitchChange:showAdminOnlyText});$("#admin-only").change(showAdminOnlyText);showAdminOnlyText();$(".show-direct-link-inline").click(function(ev){$(".show-direct-link").click();$("body").scrollTop(0)});$("#is_group").change(function(){if($("#is_group").prop("checked")){$("#group").slideDown(200);if($("#group_max").val()=="0"){$("#group_max").val("8")}$("#group_max").focus();$("#padding-before-container").hide();$('input[name="paddingMinutesBefore"]').val(0)}else{$("#group").slideUp(200);$("#group_max").val("0");$("#padding-before-container").show()}});$("#show-past-classes").change(function(){if($(this).prop("checked")){$(".past-class").show(0);$("#show-word").text("Hide")}else{$(".past-class").hide(0);$("#show-word").text("Show")}});$(".class-checkbox").change(function(ev){$("#submit-delete-classes").prop("disabled",$(".class-checkbox:checked").length==0)});$(".class-offering").click(function(ev){ev.preventDefault();Details.loadUri($(this).attr("href"))});$(".btn-offer-class").click(function(ev){ev.preventDefault();Details.loadUri($(this).attr("href"))});$(".edit-type-form").submit(function(ev){Validate.validateSubmit(ev);if(!parseInt($("#duration").val())){$("#duration").focus().closest(".form-group").addClass("has-error");ev.preventDefault()}var calendars=$('input[name="calendars[]"]:visible');if(calendars.length&&!calendars.is(":checked")&&!$("#is_group").is(":checked")){$("#calendars-container").addClass("has-error").find("input").first().focus();ev.preventDefault()}else{$("#calendars-container").removeClass("has-error")}});makeEditor($("#confirmation"),{plugins:["advanced","fontfamily","fontsize","fontcolor"],buttons:["html","formatting","bold","italic","underline","image","link"],minHeight:120,convertDivs:false,replaceDivs:false,imageUpload:"/upload.php",imageUploadErrorCallback:function(json){Flash.error(json.error,35e3)},toolbarFixed:false});$(".color-choice").click(function(ev){$(".color-choice-selected").removeClass("color-choice-selected");$target=$(this).addClass("color-choice-selected");$("#color").slideUp(300);$("#color").val($target.attr("data-color"))});$("#custom-color").click(function(ev){$(".color-choice-selected").removeClass("color-choice-selected");$("#color").slideDown(300).val("").focus()});if(!$("#name").val()){$("#name").focus()}};Acuity.addController("#edit-type-page",editTypeController);Acuity.addController(".feature-rating-group",function($){$(".btn-feature-rating").click(function(ev){var rating=$(this).text();var key=$(this).attr("data-feature");$.get("/appointments.php",{action:"rate",rating:rating,key:key});$(this).closest(".feature-rating-group").hide().closest(".single-feature-announcement-container").find(".feature-rating-description").show().find("textarea").focus()});$(".feature-send-btn").click(function(ev){var $container=$(this).closest(".feature-rating-description");var rating=$container.find("textarea").val();var key=$container.find("textarea").attr("data-feature");$.get("/appointments.php",{action:"rate",rating:rating,key:key});$container.html("Thank you!")})});var formEditController=function($){function removeHighlight(){$(".highlight-button-container").removeClass("highlight-button-container")}$(".highlight-label").click(removeHighlight);$(".new-widget").on("click dragend",function(ev){removeHighlight();var widgetId=parseInt($(this).attr("data-widget"));var isPaidOnly=parseInt($(this).attr("data-paid-only"));$("#widget").val(widgetId);$("#options").toggle(needOptions.indexOf(widgetId)>-1);$("#add-to-form-btn").attr("value","Add "+$(this).text()+" to Form");var isMailinglist=!!$('input[name="mailinglist"]').size();var placeholder="How old are you?";if(widgetId==5||widgetId==2){placeholder=isMailinglist?"Do you want to join our mailing list?":"Do you agree with the policy?"}else if(widgetId==6){placeholder="Please upload your resume"}else if(widgetId==7){placeholder="What is your address?"}else if(widgetId==8){placeholder="Check all of the symptoms you have:"}$("#fieldName").attr("placeholder","ex. "+placeholder);$newField=$("#new-field");$newField.slideDown(300,function(){$("#fieldName").focus()});if(isPaidOnly){$newField.find(".paid-only").show(0);$newField.find(".new-field-container").hide(0)}else{$newField.find(".paid-only").hide(0);$newField.find(".new-field-container").show(0)}var fieldHeight=Math.min($newField.height(),150);$("body, html").animate({scrollTop:$newField.position().top+fieldHeight+"px"},100)});$(".edit-field").click(function(ev){ev.preventDefault();$(".form-field").addClass("form-hidden").removeClass("alert").removeClass("alert-success");$(this).closest(".form-field").removeClass("form-hidden").addClass("alert").addClass("alert-success");$("#edit-field").val($(this).attr("data-field-id"))});$(".cancel-edit-field").click(function(ev){$(this).closest(".form-field").addClass("form-hidden").removeClass("alert").removeClass("alert-success");$("#edit-field").val("")});$("#cancel-add-form").click(function(){$("#new-field").slideUp(300)});$(".sortableList").sortable({update:function(ev,ui){$.post("forms.php?action=updateFieldPosition",$(ev.target).sortable("serialize",{key:"fieldsList[]"}),function(data){Flash.notice("Successfully saved order",3e3)}).fail(function(){Flash.error("Failed to save order")})}});$(".sortableList input").bind("click.sortable mousedown.sortable",function(ev){ev.target.focus()});$("#form-edit-page").submit(Validate.validateSubmit);$('[data-toggle="tooltip"]').tooltip()};Acuity.addController("#form-edit-page",formEditController);var formsController=function($){$(".sortableList").sortable({distance:10,update:function(ev,ui){$.post("forms.php?action=updateFormPosition",$(ev.target).sortable("serialize",{key:"formsList[]"}),function(data){Flash.notice("Successfully saved order",3e3)}).fail(function(){Flash.error("Failed to save order")})}}).disableSelection();$('[data-toggle="tooltip"]').tooltip()};Acuity.addController("#forms-page",formsController);Acuity.addController("#trial-notice-content",function($){function initTrialNotice(){$(".trial-notice-bar").remove();$(".getting-started-not-showing").removeClass("getting-started-not-showing");var $_container=$('<div class="trial-notice-bar">'+$("#trial-notice-content").html()+"</div>").prependTo(document.body)}initTrialNotice()});Acuity.addController("#getting-started-content",function($){var keepHelpClosed=false;function openHelp(){keepHelpClosed=false;$container=getContainer();$container.addClass("is-opened");$container.find(".collapsed-open").slideDown();$container.find(".collapsed-closed").slideUp()}function showHelp(){keepHelpClosed=false;$container=getContainer();$container.addClass("is-opened");$container.find(".collapsed-open").show();$container.find(".collapsed-closed").hide()}function closeHelp(){$container=getContainer();$container.removeClass("is-opened");$container.find(".collapsed-open").slideUp(150);$container.slideUp(140)}function isHelpOpen(){return getContainer().hasClass("is-opened")}function toggleHelp(){if(isHelpOpen()){closeHelp()}else{openHelp()}}function showSubmitStaffLabels(){var hasStaff=$(".extra-staff-container input").length>0;$(".submit-label-just-me").toggle(!hasStaff);$(".submit-label-with-staff").toggle(hasStaff)}function initGettingStarted(){$(".getting-started-container").remove();$(".trial-notice-bar").remove();var $_helpContainer=$('<div class="getting-started-container">'+$("#getting-started-content").html()+"</div>").prependTo(document.body);$(".getting-started-not-showing").removeClass("getting-started-not-showing");Acuity.init();$(".close-getting-started").click(function(ev){keepHelpClosed=true;closeHelp();ev.preventDefault();$.get($(this).attr("href")+"&ajax=1");$(".btn-help").tooltip({title:"You can find the Welcome Guide again under here",placement:"left"});$(".btn-show-welcome-guide").show();$(".btn-help").tooltip("show");setTimeout(function(){$(".btn-help").tooltip("hide")},15e3)});$(".collapsed-closed.btn-getting-started").click(function(ev){openHelp()});$(".btn-add-staff").click(function(ev){ev.preventDefault();var placeholders=["Liz Lemon","Steve Urkel","Joey Tribbiani","Homer Simpson","Tobias Fünke"];var placeholder=placeholders[$(".extra-staff-container input").length%placeholders.length];$('<div class="form-group"><input type="text" class="form-control" name="extraStaff[]" placeholder="ex. '+placeholder+'" /> <a class="remove-staff" href="#">(remove)</a></div>').appendTo(".extra-staff-container").on("click",".remove-staff",function(ev){ev.preventDefault();$(this).closest(".form-group").remove();showSubmitStaffLabels()}).find("input").focus();showSubmitStaffLabels()});$(".btn-show-extra-steps").click(function(ev){$(".getting-started-extra-steps").show();$(".getting-started-core-steps").hide()});$(".btn-show-core-steps").click(function(ev){$(".getting-started-extra-steps").hide();$(".getting-started-core-steps").show()});return $_helpContainer}function getContainer(){var $_helpContainer=$(".getting-started-container");if(!$_helpContainer||!$_helpContainer.length){$_helpContainer=initGettingStarted()}return $_helpContainer}initGettingStarted()});Acuity.addController(".faq-search",function($){function showDynamicHelp(s){$(".dynamic-help").toggle(s);$("#static-help").toggle(!s)}var logTimer=null;function logSearch(){if(logTimer)clearTimeout(logTimer);logTimer=setTimeout(function(){$.get("/help.php?a=3&q="+encodeURIComponent($("#search").val()))},5e3)}function doSearch(){var search=$("#search").val();if(!search){showDynamicHelp(false);return}logSearch();$.get("/help.php?a=1&q="+encodeURIComponent(search),function(data){showDynamicHelp(true);$("#dynamic-help").html(data)}).fail(function(){showDynamicHelp(false)})}var timer=null;function delayedSearch(){if(timer)clearTimeout(timer);timer=setTimeout(doSearch,600)}$("#search").focus().on("keyup change paste",function(ev){delayedSearch()});$(".article-vote").click(function(ev){ev.preventDefault();var $target=$(ev.currentTarget);$.get($target.attr("href"));$target.closest(".vote-container").html('Thank you. What info are you looking for?<br /><textarea name="" class="form-control" row="3"></textarea><input type="button" class="btn btn-primary" value="Send Feedback" />').find("textarea").focus()});$(".vote-container").on("click",'input[type="button"]',function(ev){var $target=$(ev.currentTarget).closest(".vote-container");var feedback=$target.find("textarea").val();$target.html("Sending...");$.post("/help.php?action=feedback&id="+$target.attr("data-article"),{feedback:feedback}).always(function(){$target.html("Thank you!")
})})});Acuity.addController(".live-chat",function($){function tryOlark(){if(window.OLARK_AVAILABLE&&$(".can-live-chat").length){$(".live-chat").show(0);return true}else{setTimeout(tryOlark,1e3);return false}}tryOlark()});Acuity.addController(".contact-support",function($){$("body").on("click","a.contact-support",function(ev){ev.preventDefault();ev.stopImmediatePropagation();var $a=$(ev.currentTarget);var subject=$a.data("subject")||"";var message=$a.data("message")||"";Details.loadHtml($("#support-form-template").html());$("#help-subject").attr("placeholder",$a.data("subject-placeholder")).val(subject);$("#help-message").attr("placeholder",$a.data("message-placeholder")).val(message);$(subject?"#help-message":"#help-subject").focus();if(typeof FS!="undefined"){$("#fullstory").val(FS.getCurrentSessionURL())}$("#help-feeling").change(function(ev){$("#help-feeling-other").toggle($(ev.currentTarget).val()=="other");$("#help-feeling-other:visible").focus()});$(".support-form").submit(Validate.validateSubmit)})});Acuity.addController(".btn-help",function($){function loadHelpForPage(){var convos=$("[data-response-convo]").map(function(){return $(this).data("response-convo")}).get();$(".btn-help.has-support-responses").removeClass("has-support-responses");$.get("/help.php",{action:"inline",url:document.location.href,viewedConvos:convos},function(data){$(".help-for-page-container").html(data)})}setTimeout(function(){$(".btn-help.has-support-responses").addClass("animated").addClass("pulse")},400);$(".btn-help").click(function(ev){ev.preventDefault();Details.loadHtml($("#inline-help-popup-template").html());if($(".getting-started-container:visible").length==0){$(".btn-show-welcome-guide").show()}loadHelpForPage()})});Acuity.addController(".change-view-container",function($){function switchToView(ev,className){var $current=$(ev.currentTarget);var $container=$current.closest(".change-view-container");if(typeof window.onbeforeunload=="function"){var beforeUnloadConfirm=window.onbeforeunload();if(beforeUnloadConfirm&&!confirm(beforeUnloadConfirm)){ev.preventDefault();return}}if(!className){className=$current.attr("data-pane");var href=$current.attr("href");if(href){Acuity.pushState(href)}}if(className){ev.preventDefault()}else{$container.addClass("loading")}$container.find(".active-view").removeClass("active-view");$current.closest("span").addClass("active-view");$container.find("[data-pane]").each(function(){var paneClass=$(this).attr("data-pane");if(paneClass)$(paneClass).hide()});$(className).show();$container.trigger("acuity:tabShown",{pane:className})}function initViewContainer(){var $this=$(this);if(!$this.attr("data-initialized-hnav")){$this.addClass("animating");$this.find(".view-btn a").click(function(ev){switchToView(ev)});$this.attr("data-initialized-hnav",true)}}$(".change-view-container").each(initViewContainer)});Acuity.addController("#import-form",function($){$("#import-form").submit(function(ev){$(".btn").button("loading")})});Acuity.addController(".integration-details",function(ev,$container){$(".integration-details").each(function(){var key=$(this).attr("data-key");var apptId=$(this).attr("data-appt");var $container=$(this);$.get("/app.php?action=appointment_details&apptId="+apptId+"&key="+key,function(data){$container.html(data);Acuity.init()}).fail(function(){$container.text("Failed to load")})})});Acuity.addController(".integration-quick-links",function($){$(".btn-setup-integration").click(function(ev){ev.preventDefault();Details.loadUri($(ev.currentTarget).attr("href"),{dontScrollTop:true})})});function isOnAppointmentsPage(){return $("#appointment-content").length>0}Mousetrap.bind("shift+n",function(){Details.loadUri("appointments.php?action=new")});Mousetrap.bind("shift+b",function(){Details.loadUri("appointments.php?action=newBlockHtml")});Mousetrap.bind("shift+s",function(){if(window.CLIENT_PAGE)window.open(window.CLIENT_PAGE,"_blank")});Mousetrap.bind("left",function(){$container=$(".calendar-daily-view-container");if($container.length)$container.scrollLeft($container.scrollLeft()-40)});Mousetrap.bind("right",function(){$container=$(".calendar-daily-view-container");if($container.length)$container.scrollLeft($container.scrollLeft()+40)});Mousetrap.bind("up",function(){$container=$(".calendar-daily-view-container");if($container.length)$container.scrollTop($container.scrollTop()-40)});Mousetrap.bind("down",function(){$container=$(".calendar-daily-view-container");if($container.length)$container.scrollTop($container.scrollTop()+40)});Mousetrap.bind("shift+m",function(){if(isOnAppointmentsPage()){$(".sticky-main-nav-display").removeClass("sticky-main-nav-display");Details.showMenu("main-nav-display")}});Mousetrap.bind("shift+l",function(){Acuity.goTo("/clients.php")});Acuity.addController(".main-nav-container",function($){$(".nav-with-children").click(function(ev){$(".current-nav").removeClass("current-nav");$(this).closest("li").addClass("current-nav")})});Acuity.addController("#monthly-calendar",function(ev){if(window.changeChooseMonth)return;function getCurrentView(){return isCurrentlyWeekView()?"thisWeek":"day"}$("body").on("click","#monthly-calendar .calendarHeading a",function(ev){ev.preventDefault();var $container=$(ev.target).closest("#monthly-calendar");loadPopoverCalendar($(this).attr("href").replace("view=day","view="+getCurrentView())+"&showMonth=1",$container)});window.changeChooseMonth=function(){var url="/appointments.php?view="+getCurrentView()+"&day="+$("#chooseMonth").val()+"&showMonth=1";loadPopoverCalendar(url,$("#monthly-calendar"))};function loadPopoverCalendar(url,$container){$container.find(".calendar").html('<div class="progress-spinner small">Loading...</div>');$.get(url+"&action=ajaxCal",function(data){$container.html(data)})}Acuity.loadPopoverCalendar=loadPopoverCalendar});Acuity.addController(".view-order-page",function($){$(".btn-view-subscription").click(function(ev){ev.preventDefault();Details.loadUri($(this).attr("href"))})});var SquarePayments=function(){var requestCardNonce=function(){};var initSquarePayments=function(applicationId){if(typeof paymentForm!="undefined")paymentForm.destroy();paymentForm=new SqPaymentForm({applicationId:applicationId,inputClass:"sq-input",inputStyles:[{fontSize:"15px"}],cardNumber:{elementId:"CardNumber",placeholder:"•••• •••• •••• ••••"},cvv:{elementId:"CVV",placeholder:"CVV"},expirationDate:{elementId:"sq-expiration-date",placeholder:"MM/YY"},postalCode:{elementId:"billing-zip"},callbacks:{cardNonceResponseReceived:function(errors,nonce,cardData){if(errors){var errorMessage="";errors.forEach(function(error){errorMessage+=error.message+"<br />\n"});Flash.error(errorMessage);$('[name="card_no"]').val("")}else{$(".credit-card-form .has-error").removeClass("has-error");$('[name="card_no"]').val(nonce);$('[name="zip"]').val(cardData["billing_postal_code"]);$(".credit-card-form").closest("form").submit()}},unsupportedBrowserDetected:function(){Flash.error("Cannot enter credit cards through Square, your browser is not supported.")},inputEventReceived:function(inputEvent){$('[name="card_no"]').val("");$(".credit-card-form .has-error").removeClass("has-error");switch(inputEvent.eventType){case"focusClassAdded":break;case"focusClassRemoved":break;case"errorClassAdded":break;case"errorClassRemoved":break;case"cardBrandChanged":break;case"postalCodeChanged":break}}}});paymentForm.build();requestCardNonce=function(){paymentForm.requestCardNonce()};if($('[name="card_no"]').length==0){$("#CardNumber").after('<input type="hidden" name="card_no" value="" />')}if($('[name="zip"]').length==0){$("#billing-zip").after('<input type="hidden" name="zip" value="" />')}$(".square-loading-indicator").hide();$(".credit-card-form").show()};function init(){if(typeof squareApplicationId!="undefined"){async("https://js.squareup.com/v2/paymentform",function(){initSquarePayments(squareApplicationId)})}}function doRequestCardNonce(){return requestCardNonce()}function isUsingSquare(){return $(".sq-input").length>0}function isSquareNonceSet(){return!isUsingSquare()||$('[name="card_no"]').val()}return{init:init,requestCardNonce:doRequestCardNonce,isSquareNonceSet:isSquareNonceSet}}();Acuity.addController("#appointment-pay-page",function($){SquarePayments.init();$paymentSources=$('#appointment-pay-page input[name="paymentSource"]');$("#appointment-pay-page").submit(function(ev){Validate.validateSubmit(ev);$(".not-fully-paid").hide();var amount=parseFloat($("#amount").val());var maxAmount=parseFloat($("#max-amount").val());if(amount>maxAmount){$("#amount").closest(".form-group").addClass("has-error")}if($paymentSources.filter(":checked").length==0){$(".payment-source-list").addClass("has-error")}else{$(".payment-source-list").removeClass("has-error")}if($paymentSources.filter(":checked").val()=="new"&&!SquarePayments.isSquareNonceSet()){SquarePayments.requestCardNonce();ev.preventDefault();return}if($("#appointment-pay-page .has-error").length==0){$('#appointment-pay-page input[type="submit"]').button("loading")}else{ev.preventDefault()}});$("#amount").on("change keyup",function(ev){var amountOwed=parseFloat($("#amount-owed").val());var amount=parseFloat($(ev.currentTarget).val());if(amountOwed>amount&&amount){$(".not-fully-paid").show()}else{$(".not-fully-paid").hide()}});$paymentSources.change(function(ev){var val=$(ev.currentTarget).val();if(val=="new"){$("#new-credit-card-container").slideDown(200).find('input[value=""]').first().focus();$("#cash-container").slideUp(200)}else if(val=="cash"){$("#cash-container").slideDown(200).find("input").focus();$("#new-credit-card-container").slideUp(200)}else{$("#new-credit-card-container, #cash-container").slideUp(200);$("#amount").focus()}$(".pay-credit-card-warning, .btn-pay-now").toggle(val!="cash");$(".btn-add-payment").toggle(val=="cash")});if($paymentSources.length==1){$paymentSources.prop("checked",true).change()}});var paymentController=function($){var transformType={visa:"visa",mastercard:"master",discover:"discover",amex:"american_express"};var transformTypeHuman={visa:"Visa",mastercard:" Master Card",discover:"Discover",amex:"American Express"};$(".credit-card-form select").addClass("form-control").addClass("inline-field");$cardGroup=$('.credit-card-form .form-group:has([name="card_no"])');$cardNo=$('.credit-card-form [name="card_no"]');var errorTimeout=null;$cardNo.validateCreditCard(function(result){if(result.card_type){$("#card_type").val(transformType[result.card_type.name])}if(result.length_valid&&result.luhn_valid){clearTimeout(errorTimeout);$cardGroup.removeClass("has-error").addClass("has-success")}else{clearTimeout(errorTimeout);$cardGroup.removeClass("has-success").removeClass("has-error");errorTimeout=setTimeout(function(){if($cardNo.val())$cardGroup.addClass("has-error")},1e3)}},{accept:["visa","mastercard","discover","amex"]});$("#cc-form").submit(function(ev){if(Validate.validate($(this))){$("#cc-form [data-loading-text]").button("loading")}else{ev.preventDefault();$(".has-error input").focus()}})};Acuity.addController(".credit-card-form",paymentController);var preferencesController=function($){$toggle=$(".toggle-main-nav");if($toggle.attr("initialized-contoller")){return}Acuity.hideMainNav=function(){$(".main-nav-container").addClass("hide-sm-nav");if(isMobile()){}};$toggle.attr("initialized-contoller",true);$toggle.click(function(ev){if($(".main-nav-container").hasClass("hide-sm-nav")){Details.hide();$(".main-nav-container").removeClass("hide-sm-nav");$(".main-nav").slideDown(200)}else{$(".main-nav").slideUp(200,function(){Acuity.hideMainNav();$(".main-nav").removeAttr("style")})}})};Acuity.addController(".toggle-main-nav",preferencesController);Acuity.addController(".preferences-app-settings",function($){$(".preferences-app-settings").delegate("#intakeFormID","change",function(e){$input=$(this);$(".wufoo-details").removeClass("hide").find(".wufoo-form-id").text($input.val()).end().find(".wufoo-form-name").text($input.find("option:selected").text())}).delegate('[name="syncType"]',"change",function(e){$(".app-invoice-settings").toggle(!!$(this).val())});$gotoSettings=$(".preferences-app-settings .virtual-meeting-settings");if($gotoSettings.size()){$gotoSettings.on("change",".call-settings input",function(){$gotoSettings.find(".conference-number").toggle($(this).prop("checked"))})}});Acuity.addController("#preferences-appearance-page",function($){var defaultColorPalette=[["black","#5a5a5a","white"],["#61B7B8","#D8394F","#EA8C3A"],["#E3DE7D","#469D6E","#6D5177"],["#DAC5D3","#ADCDB8","#F1EFBC"],["#F4C9A1","#EFACAE","#D4E3E2"]];var darkColorPalette=[["#000000","#666666","#999999"],["#6D5177","#0066cc","#61B7B8"],["#D8394F","#EA8C3A","#e3d37d"],["#00af32","#469D6E"]];$(function(){var spectrumOptions={showInput:true,allowEmpty:true,clickoutFiresChange:true,preferredFormat:"hex",showPalette:true,appendTo:"parent",palette:defaultColorPalette,move:function(color){$(this).val(color)}};$("#headerBackgroundColor, #headerTextColor, #backgroundColor, #textColor").spectrum(spectrumOptions);spectrumOptions["palette"]=darkColorPalette;$("#linkColor").spectrum(spectrumOptions);$("#headerBackgroundColor, #headerTextColor, #backgroundColor, #textColor, #linkColor").change(function(ev){if($(this).val().indexOf("#")===-1&&$(this).val()){$(this).val("#"+$(this).spectrum("get").toHexString())}});makeEditor($("#description"),{imageUpload:"/upload.php",convertDivs:false,replaceDivs:false,toolbarFixed:false,imageUploadErrorCallback:function(json){Flash.error(json.error,35e3)},focusCallback:function(e){this.placeholder.remove()},plugins:["fontfamily","fontsize","fontcolor"],buttons:["html","formatting","bold","italic","underline","deleted","unorderedlist","orderedlist","outdent","indent","image","table","link","alignment","horizontalrule"]})});function getTemplateClass(t){return"template-"+(t!=""?t:"standard")}function updateTemplateClass(){$('[name="template"]').each(function(){$("#preferences-appearance-page").removeClass(getTemplateClass($(this).val()))});var selectedTemplate=$('[name="template"]:checked').val();$("#preferences-appearance-page").addClass(getTemplateClass(selectedTemplate))}$('[name="template"]').change(updateTemplateClass);updateTemplateClass();var formHasChanged=false;$("#preferences-appearance-page").change(function(){formHasChanged=true});$("#preferences-appearance-page").submit(function(){formHasChanged=false});window.Acuity.onbeforeunload(function(){if(formHasChanged){if(confirm('You have unsaved changes!\nClick "Save Changes" to save your customization.\n\nAre you sure you want to abandon your changes?')){formHasChanged=false;return true}else{return false}}else{return true}});function getColorFromInput(selector){var val=$(selector).val();if(!val){return""}if(val[0]!="#"){val="#"+val}return val}$(".btn-change-font").click(function(ev){ev.preventDefault();$(this).closest(".font-container").find(".font-item-hidden, .font-item-selected").removeClass("font-item-hidden").removeClass("font-item-selected")});$(".font-container").change(function(ev){var $this=$(this);$this.find(".font-item-selected").removeClass("font-item-selected");$this.find("input:checked").closest(".radio").addClass("font-item-selected");$this.find("input:not(:checked)").closest(".radio").addClass("font-item-hidden")})});Acuity.addController(".availability-calendar-container",function($){var $calendar=$(".availability-calendar-container");var animatePopoverClass="fadeInUp";var hasChangedRegularHours=false;function previewRegularHoursForDay(dow){var newHours="";if($("#is-regular-hours").is(":checked")){newHours=$('.regular-hours textarea[data-dow="'+dow+'"]').val()}$('.big-calendar .day:not(.day-with-overridden-hours) .availability-entry[data-dow="'+dow+'"]').attr("data-hours",newHours).text(newHours)}function refreshPendingRegularHours(){$(".regular-hours textarea[data-dow]").each(function(){previewRegularHoursForDay($(this).attr("data-dow"))})}$(".regular-hours textarea[data-dow]").change(function(){hasChangedRegularHours=true;previewRegularHoursForDay($(this).attr("data-dow"))});$(".regular-hours-btn-group, #is-regular-hours").change(function(){hasChangedRegularHours=true;refreshPendingRegularHours()});function highlightDateRange(startDate,endDate){$(".selected-day").removeClass("selected-day");var startDate=dateObjectFromString(startDate);var endDate=dateObjectFromString(endDate);var incDate=startDate;for(var i=0;i<31;i++){var date=formatForDateElement(incDate);$('.availability-calendar-container td[day="'+date+'"]').addClass("selected-day");incDate.setDate(incDate.getDate()+1);if(incDate>endDate)break}}function initCalendar(){$('[data-toggle="tooltip"]').tooltip();$calendar.find(".day").popover({container:"#availability_specific",content:showPopover,placement:"top",animation:false,html:true}).on("shown.bs.popover",function(){$(".popover").addClass("fast-animated").addClass(animatePopoverClass);$(".popover-content:visible .hours").focus()}).on("hide.bs.popover",function(){$(".popover").removeClass("fast-animated").removeClass(animatePopoverClass);$(".selected-day").removeClass("selected-day");var $content=$(".popover-content");setTimeout(function(){$content.html("")},300)})}function hidePopovers(){$calendar.find(".day").popover("hide")}$(".availability-calendar-container").on("click",".calendar-heading a",function(ev){ev.preventDefault();ev.stopImmediatePropagation();hidePopovers();var href=$(ev.currentTarget).attr("href")+"&action=availabilityMonth";$(".calendar-title").html('<div class="loading-container"><span class="progress-spinner small"></span> Loading...</div>');$.get(href,function(data){$(".availability-calendar-container").html(data);initCalendar()})});$(".availability-calendar-container").on("click",".availability-calendar-note a",function(ev){hidePopovers()});function showPopover(){var that=this;$calendar.find(".day").not(this).popover("hide");var isOverridden=$(this).hasClass("day-with-overridden-hours");var hours=$(this).find("[data-hours]").attr("data-hours");var date=$(this).find("[data-printable-date]").attr("data-printable-date");var systemDate=$(this).find("[data-date]").attr("data-date");var dateMessage=$(this).find("[data-message]").attr("data-message");var templateHtml=$("#availability-popover-template").html();function getEndDate(){var endDate=$template.find('input[name="end-date"]').val();if(!endDate){endDate=systemDate}return endDate}function enableDays(){AvailabilityRow.enableDays($template.find(".availability-row"),systemDate,getEndDate());var $enabledInputs=$template.find(".availability-row input").not("[disabled]");if($enabledInputs.length==1){$template.addClass("setting-one-day")}else{$template.removeClass("setting-one-day")}highlightDateRange(systemDate,getEndDate());setTimeout(function(){if(!isTouchDevice())$enabledInputs.first().focus()},10)}function postInitCalendar(url,data){$.post(url,data,function(data){$(".day").popover("hide");$(".availability-calendar-container").html(data);initCalendar();refreshPendingRegularHours()}).fail(function(){Flash.error("Failed to save hours, please try again")}).always(function(){$template.find(".btn-primary").button("reset")})}function saveHours(ev){ev.preventDefault();var $form=$(ev.currentTarget);$template.find(".btn-primary").button("loading");var endDate=getEndDate();postInitCalendar($form.attr("action"),{date:systemDate,endDate:endDate,everyOther:$template.find(".every-other input:visible:checked").val(),hoursSet:{Sunday:$template.find('input[name="hours[Sunday]"]:visible').val(),Monday:$template.find('input[name="hours[Monday]"]:visible').val(),Tuesday:$template.find('input[name="hours[Tuesday]"]:visible').val(),Wednesday:$template.find('input[name="hours[Wednesday]"]:visible').val(),Thursday:$template.find('input[name="hours[Thursday]"]:visible').val(),Friday:$template.find('input[name="hours[Friday]"]:visible').val(),Saturday:$template.find('input[name="hours[Saturday]"]:visible').val()}})}function removeOverride(ev){ev.preventDefault();var $btn=$(ev.currentTarget);$template.find(".btn-primary").button("loading");postInitCalendar($btn.attr("href")+"&ajax=1",{date:systemDate})}var $template=$("<div />").html(templateHtml);if(isOverridden){$template.find(".revert-hours").show()}var startDateObj=dateObjectFromString(systemDate);if(startDateObj&&new Date-startDateObj>1e3*60*60*24){$template.find(".date-past-warning").show();$template.find(".btn-primary").hide()}if(hasChangedRegularHours){$template.find(".date-generic-warning").html($("#hours-changed-message").html()).show()}if(dateMessage){$template.find(".date-details-message").html(dateMessage).show()}$template.find(".switch-to-regular").click(function(ev){$template.find(".switch-to-regular-confirm").show();$template.find(".switch-to-regular").hide()});$template.find(".switch-to-regular-cancel").click(function(ev){$template.find(".switch-to-regular-confirm").hide();$template.find(".switch-to-regular").show()});$template.find(".btn-remove-override").click(removeOverride);$template.find('input[name="end-date"]').val(systemDate);$template.find(".heading").text(date);$template.find(".close, .cancel-set-hours").click(function(){$(that).popover("hide")});$template.find('[data-toggle="tooltip"][value=""]').tooltip();$template.find(".set-end-btn").click(function(ev){$(ev.currentTarget).hide();$template.find(".end-date").show().find("input").datepicker({dateFormat:"yy-mm-dd"}).focus().change(function(){enableDays()})});$template.find("form").submit(saveHours);enableDays();$template.find(".availability-col input:not([disabled])").val(hours);return $template}initCalendar()});var preferencesCalendarsController=function($){function showUsers(){Details.loadHtml($("#showUsersModal").html())}$("#chooseCalendar-select").change(function(){$("#chooseCalendar").submit()});$("#delete-calendar").click(function(ev){Details.loadHtml($("#delete-template").html())});if($(".new-calendar-form").length){$("#name").focus()}$("#calendar-replyto-prompt a").click(function(ev){ev.preventDefault();$("#calendar-replyto-prompt").hide();$("#calendar-replyto-input").show().find('[name="replyTo"]').focus()});$('[name="replyTo"]').keyup(function(){var replyTo=$(this).val()?$(this).val():$(this).attr("placeholder");$(".calendar-replyto-label").text(replyTo)});$("#maxPerDaySelect").change(function(ev){var isLimited=$(ev.currentTarget).val()==1;$("#maxPerDayContainer").toggle(isLimited);if(isLimited&&$("#maxPerDay").val()==0){$("#maxPerDay").val(5).focus()}});$(".override-block-hours").click(function(){$(".default-block-hours, .overridden-block-hours").toggle();$('[name="blockHours"]:visible').focus();$('[name="useBlockHours"]').val($('[name="useBlockHours"]').val()*-1).change()});$("#concurrent").on("keyup change",function(ev){var val=$("#concurrent").val();if(!val)return;var num=parseInt(val);$("#double-booking-label").toggle(num>1);$(".appointments-plural").toggle(num!=1)})};Acuity.addController(".calendar-form",preferencesCalendarsController);Acuity.addController(".calendar-list-container",function($){$(".calendar-name-container[data-id]").click(function(ev){if(ev.isDefaultPrevented())return;var id=$(ev.currentTarget).attr("data-id");Acuity.goTo("/preferences.php?tab=schedule&calendar="+id)})});var importExportController=function($){$(".custom-export-form-btn").click(function(ev){$(".well").hide();$(".custom-export-form").show();$("#minDay, #maxDay").datepicker({dateFormat:"yy-mm-dd"});track("appointments_excel_export")});$(".custom-export-form .export-form").change(function(){$(".export-forms-warning").toggle($(".export-form:checked").length>0)});$(".btn-client-export").click(function(ev){$(".well").hide();$(".custom-client-export-form").show();track("client_excel_export")});$(".import-clients-btn").click(function(ev){$(".well").hide();$(".import-clients-form").show()});$(".import-appointments-btn").click(function(ev){$(".well").hide();$(".import-appointments-form").show()});$("#minDay").change(function(ev){if(!$("#maxDay").val())$("#maxDay").val($("#minDay").val())})};Acuity.addController(".custom-export-form",importExportController);var preferencesMyAccountController=function($){function isGoodPasword(){var pw=$("#password").val();var containsLetters=new RegExp(/[a-zA-Z]/);var containsNonLetter=new RegExp(/[^a-zA-Z]/);return pw.length>=6&&containsLetters.test(pw)&&containsNonLetter.test(pw)}$("[data-sidebar-href]").click(function(ev){ev.preventDefault();Details.loadUri($(this).attr("href"))});if(document.location.href.indexOf("updateBilling=1")>=0){$("#update_billing").click()}$(".cancel-downgrade").click(function(){Details.loadHtml($("#downgrade-confirm").html())});$(".cancel-subscription").click(function(){Details.loadHtml($("#downgrade-confirm-cancel").html())});$("#cancel-delete").click(function(){Details.loadHtml($("#delete-confirm").html())});$("#change-password-btn").click(function(){$("#is-changing-password").val("yes");$("#change-password").show(0);$("#change-password-btn").hide(0);$('#change-password input[type="text"]:first').focus()});$("#change-password").closest("form").submit(function(ev){if($("#is-changing-password").val()){Validate.validateSubmit(ev);if(!isGoodPasword()){$("#password").focus().closest(".form-group").addClass("has-error");ev.preventDefault()}}})};Acuity.addController("#my-account-page, .receipt-detail-container",preferencesMyAccountController);Acuity.addController("#preferences-notifications-page",function($){$(".notifications-nav").on("acuity:tabShown",function(ev,data){if(data.pane==".email_reminder"){$("ul.email_reminder .subnav").removeClass("active");$("ul.email_reminder .subnav").first().addClass("active")}});function showLoading(id){hideEditor($("#"+id));$("#"+id+"_loading").show()}function hideLoading(id){showEditor($("#"+id));$("#"+id+"_loading").hide()}function initTemplateActions(emailType){var $select=$('select[data-type="'+emailType+'"]');var revert=$(".revert_"+emailType);revert.attr("href","preferences.php?action=revert&email="+emailType+"&type="+$select.val());var $opt=$select.find(":selected");var text=$opt.text();if(text.indexOf("custom e-mail")>-1||text.indexOf("disabled")>-1){revert.show(0)}else{revert.hide(0)}var $subject=$('[name="subject_'+emailType.replace("email_","")+'"]');if($select.val()!="default"){$subject.prop("readonly",true).tooltip({title:"The default subject is used for all appointment types"})}else{$subject.prop("readonly",false).tooltip("destroy")}if(text.indexOf("disabled")==-1&&$select.val()!="default"){$(".disable_"+emailType).attr("data-confirm-href","preferences.php?action=disable&email="+emailType+"&type="+$select.val()).show()}else{$(".disable_"+emailType).hide()}}$("[data-type]").change(function(ev){var textareaId="html_"+$(this).attr("data-type");showLoading(textareaId);var emailType=$(this).attr("data-type");initTemplateActions(emailType);var type=$(this).val();$.post("preferences.php?action=getTemplate",{email:$(this).attr("data-type"),type:type},function(data){hideLoading(textareaId);setEditor($("#"+textareaId),data)})});function showTab(tab){$("#notificationTab").val(tab);$('.form-control:visible[value=""]').first().focus()}$(".notifications-nav a").click(function(ev){ev.preventDefault();var tab=$(this).attr("data-pane").replace("#","").replace(".","");showTab(tab)});$("[data-type]").each(function(){initTemplateActions($(this).attr("data-type"))});showTab($("#notificationTab").val()||"email_confirmation");var previousLeft=0;var previousTop=0;function showInsert(that){var toolbar=that.$toolbar;var $reInsert=$(".re-acuityInsert",toolbar);if(!$reInsert.length||!$reInsert.position().left)return;$reInsert.click()}if(!document.body.hookedHideRedactor){document.body.hookedHideRedactor=true;$(document.body).click(function(){$(".redactor_dropdown_box_insert").hide();$(".re-acuityInsert").removeClass("redactor_act").removeClass("dropact")})}function openPopup(url,width,height,title){var w=width;var h=height;var left=window.screen.width/2-w/2;var top=window.screen.height/2-h/2;var win=window.open(url,"_blank","toolbar=no, location=no, directories=no, status=no, menubar=no, scrollbars=yes, resizable=no, copyhistory=no, width="+w+", height="+h+", top="+top+", left="+left);if(win.moveTo)win.moveTo(left,top);win.focus();return win}$(".preview-notifications").click(function(ev){ev.preventDefault();$textarea=$(ev.currentTarget).closest("fieldset").find("textarea");var content=getEditorData($textarea);var now=new Date;var replacements={"%first%":"[First]","%last%":"[Last]","%phone%":"(123) 555-1234","%email%":"george.bluth@example.com","%type%":"[Appointment Type]","%duration%":"[X] minutes","%price%":"$XX.00","%time%":FriendlyDates.weekday[now.getUTCDay()]+", "+FriendlyDates.months[now.getUTCMonth()]+" "+now.getUTCDate()+", "+now.getUTCFullYear()+" 10:30am","%tz%":"EST","%calendar%":"[Calendar Name]","%viewlink%":'<a href="#">change/cancel appointment</a>',"%payhref%":"#","%viewhref%":"#","%export%":'<a href="#">iCal/Outlook export</a>',"%oldtime%":FriendlyDates.weekday[now.getUTCDay()]+", "+FriendlyDates.months[now.getUTCMonth()]+" "+now.getUTCDate()+", "+now.getUTCFullYear()+" 6:45am","%oldcalendar%":"Calendar Name","%receipt%":'<table border="0" class="table"><thead><tr><th>Item</th><th>Unit Price</th><th>Quantity</th><th>Total</th></tr></thead><tbody><tr style="background-color: #FFFFFF"><td>Massage Gift Certificate</td><td>$75.00</td><td>1</td><td>$75</td></tr><tr style="background-color: #EFEFEF"><td colspan="4"><em>Certificate code: ABCD1234 <a href="#" target="_blank">Schedule</a></em></td></tr></tbody></table>',"%total%":"$75.00","%notes%":'Notes from client, e.g. "I live on 123 Main St, Somewhere, USA"',"%schedule%":'<a href="#">Schedule</a>',"%location%":"[call in info or location]","%code%":'ABCD1234 <a href="#">Schedule</a>',"%rawcode%":"ABCD1234","%product%":"[Subscription Name]","%subscrhref%":"#","%typedescription%":"[Description of appointment type]","%typecategory%":"[Category of appointment type]"};for(var key in replacements){var replacement=$('[data-replacement="'+key+'"]').val();if(!replacement){replacement=replacements[key]}content=content.replace(new RegExp(key,"g"),replacement)}for(var key in _customInsertFields){var question=_customInsertFields[key];if(key&&question!="header"){var replacement="[Answer to: "+question+"]";content=content.replace(new RegExp(key,"g"),replacement)}}content=content.replace(new RegExp("(%form:[0-9]+(:[a-zA-Z0-9_]*)?%)","g"),'<span style="color:#c00">[Not Found: $1]</span>');content='<!DOCTYPE html><div style="background:#e2efe6;padding:10px;text-align:center;color:#1d6435;">This is a preview, the fields below will be filled in depending on which appointment the client books</div>'+content;var win=openPopup("about:blank",700,650,"E-mail Preview");win.document.write(content);win.document.close()});$("#preferences-notifications-page textarea").each(function(){var insertFields=_customInsertFields;if($(this).attr("name")=="html_email_order"||$(this).attr("name")=="html_email_subscr_renew"||$(this).attr("name")=="html_email_subscr_cancel"){insertFields=null}makeEditor($(this),{plugins:["advanced","fontfamily","fontsize","fontcolor","advanced","acuityInsert"],buttons:["html","formatting","bold","italic","underline","deleted","unorderedlist","orderedlist","outdent","indent","image","table","link","alignment","horizontalrule"],minHeight:300,convertDivs:false,replaceDivs:false,imageUpload:"/upload.php",imageUploadErrorCallback:function(json){Flash.error(json.error,35e3)},convertVideoLinks:false,toolbarFixed:false,enabledInsert:$(this).attr("data-enable-insert"),customInsertFields:insertFields,initCallback:function(){var that=this;setTimeout(function(){showInsert(that)},300)}})});function adminReminderChanged(ev){$(".admin-reminder-settings:checked").each(function(){var $this=$(this);$("."+$this.attr("name")+"-enabled").toggle($this.val()==1)})}adminReminderChanged();$(".admin-reminder-settings").change(adminReminderChanged);$("form#preferences-notifications-page").submit(function(ev){var $subjectBlock=$("#email_reminder2, #email_reminder3").find(".subject-block:visible");
var $subject=$subjectBlock.find("input:visible");if($subject.length==0||$subject.val()){$subjectBlock.removeClass("has-error");return}$subjectBlock.addClass("has-error");if($subject.is("[readonly]")){$subjectBlock.find(".subject-readonly").show()}ev.preventDefault()});$('input[name="reminderTime"], input[name="reminderTime2"], input[name="reminderTime3"]').keyup(function(ev){var $target=$(ev.currentTarget);var name=$target.attr("name");var val=parseInt($target.val());if(val)$("."+name).text(val);else $("."+name).html("?")});$("#sendClientSms").change(function(ev){$("#slash-text-message").toggle($("#sendClientSms").prop("checked"))});function showFollowup(){if($("#disableFollowup").val()){$("#send-followup").hide()}else{$("#send-followup").show().find("input").focus()}}$("#disableFollowup").change(showFollowup);showFollowup()});Acuity.addController("#preferences-payments-page",function($){$("#paymentOptional").change(function(ev){var paymentOptional=$("#paymentOptional").val();$("#deposit-amount").toggle(paymentOptional=="d");$("#deposit-amount-dollar").toggle(paymentOptional=="o");$("#custom-payment").toggle(paymentOptional=="c");$(".main-payment-options-group .show-full-payment-container").toggle(paymentOptional=="d"||paymentOptional=="o"||paymentOptional=="v")});$("#paymentOptional").change();$(".custom-paymentOptional select").change(function(ev){var $target=$(ev.currentTarget);var $container=$target.closest(".custom-paymentOptional");var paymentOptional=$target.val();$container.find(".custom-deposit-amount").toggle(paymentOptional=="d");$container.find(".custom-deposit-amount:visible input").focus();$container.find(".custom-deposit-amount-dollar").toggle(paymentOptional=="o");$container.find(".custom-deposit-amount-dollar:visible input").focus();$container.find(".show-full-payment-container").toggle(paymentOptional=="d"||paymentOptional=="o"||paymentOptional=="v")});var originalType=$("#paymentType").val();function paymentTypeChanged(){$(".paymenttype").hide(0);var type=$("#paymentType").val();$(".change-processor-warning").toggle(type!=originalType);$('option[value="v"]').toggle(type=="stripe"||type=="square"||type=="braintree");$("#tipping-container").toggle(type!="paypal");if(type=="stripe_paypal"){type="stripe"}if(type=="authorizenet"||type=="stripe"||type=="braintree"||type=="square"){$("#payment_cc").removeClass("type-braintree").removeClass("type-authorizenet").removeClass("type-stripe").removeClass("type-square").addClass("type-"+type);type="cc"}var paymentFieldset=$("#payment_"+type);paymentFieldset.show(0);if($("#paymentType").val().indexOf("paypal")>-1){$("#payment_paypal").show(0)}if(type&&type!="none"){$("#is-payment-required").show(0)}else{$("#is-payment-required").hide(0)}}$("#paymentType").change(paymentTypeChanged);paymentTypeChanged();$("#preferences-payments-page form").submit(Validate.validateSubmit)});Acuity.addController("#scheduling-restrictions",function($){$("#interval-auto a").click(function(ev){ev.preventDefault();$("#interval-auto").hide();$("#interval-manual").show();if($("#interval").val()==0){$("#interval").val($("#calculated-interval").text())}$("#interval").focus()});$("#interval-manual a").click(function(ev){ev.preventDefault();$("#interval-auto").show();$("#interval-manual").hide();$("#interval").val("0")});$(".overridden-calendar-prompt a").click(function(ev){$(".overridden-calendar-prompt, .overridden-calendar-list").toggle()})});var AvailabilityRow=function(){function parseISO8601(dateStringInRange){var isoExp=/^\s*(\d{4})-(\d\d)-(\d\d)\s*$/,date=new Date(NaN),month,parts=isoExp.exec(dateStringInRange);if(parts){month=+parts[2];date.setUTCFullYear(parts[1],month-1,parts[3]);if(month!=date.getUTCMonth()+1){date.setTime(NaN)}}return date}function enableDays(container,startDate,endDate){startDate=parseISO8601(startDate);endDate=parseISO8601(endDate);var moreThanAWeek=endDate-startDate>=1e3*60*60*24*7;var moreThanTwoWeeks=endDate-startDate>=1e3*60*60*24*7*2;var daysOfWeek=new Array;var startDayWeek=startDate.getUTCDay();var endDayWeek=endDate.getUTCDay();var dateHeading=container.prev(".date-heading");if(moreThanTwoWeeks){$(dateHeading).addClass("more-than-two-weeks")}else{$(dateHeading).removeClass("more-than-two-weeks")}container.find("input[day-num]").each(function(){var e=$(this);var eDayNum=e.attr("day-num");if(endDate<startDate){e.attr("disabled",true);e.addClass("disabled")}else if(moreThanAWeek||startDayWeek<=eDayNum&&eDayNum<=endDayWeek&&startDayWeek<=endDayWeek||(eDayNum>=startDayWeek||eDayNum<=endDayWeek)&&startDayWeek>endDayWeek){e.attr("disabled",false);e.removeClass("disabled")}else{e.attr("disabled",true);e.addClass("disabled")}})}return{enableDays:enableDays}}();var preferencesScheduleController=function($){function onDateRowChanged(el,isInit){el.next(".date-for-hours").find(".date-label").text(formatDateForHuman(el.val()));var otherDate=null;var startDate=null;var endDate=null;if(el.attr("id").indexOf("date-end-value-")>-1){var id=el.attr("id").replace("date-end-value-","");otherDate=startDate=$("#date-start-value-"+id);endDate=el}else if(el.attr("id").indexOf("date-start-value-")>-1){var id=el.attr("id").replace("date-start-value-","");otherDate=endDate=$("#date-end-value-"+id);startDate=el}if(otherDate&&!$(otherDate).val()){otherDate.val(el.val());otherDate.next(".date-for-hours").find(".date-label").text(formatDateForHuman(el.val()))}if(startDate&&endDate){var container=$("#date-hours-"+id);AvailabilityRow.enableDays(container,startDate.val(),endDate.val());if(!isInit)container.find("input:not([disabled])").first().focus()}}$("#availability-form").on("change",'.date-heading input[type="hidden"]',function(ev){onDateRowChanged($(ev.target))});function showDatePicker(target){var $dateForHours=$(target).closest(".date-for-hours");var $input=$dateForHours.addClass("showing-datepicker").prev("input");$input.datepicker({dateFormat:"yy-mm-dd",onClose:function(date){$dateForHours.removeClass("showing-datepicker")}}).datepicker("show");return $input}$("#availability-form").on("click",".date-for-hours",function(ev){ev.preventDefault();showDatePicker(ev.target)});$(function(){$('.date-heading input[type="hidden"]').each(function(){onDateRowChanged($(this),true)})});$("#availability-form").on("change","input",function(ev){Flash.hide()});function isLastSubmitRecent(){var now=new Date;return lastSubmitTime&&now-lastSubmitTime<300}var lastSubmitTime=null;$("#availability-form").submit(function(ev){if(isLastSubmitRecent()){ev.preventDefault();return}lastSubmitTime=new Date});$(".save-hours-btn").mousedown(function(ev){$("#availability-form").submit()});$(".regular-hours textarea, .regular-hours input").on("change keydown",function(ev){$(".save-hours-btn").show()});$("#chooseCalendar-select").change(function(){$('#chooseCalendar input[name="hnav"]').val(document.location.href.indexOf("hnav=1")>-1?"1":"");$("#chooseCalendar").submit()});var expandedWidth=240;$("#availability-form").on("focus",'.availability-col .form-control[type="text"]',function(ev){var $target=$(ev.target);if($target.width()<expandedWidth){$target.animate({width:expandedWidth+"px"},300)}});$("#availability-form").on("blur",'.availability-col .form-control[type="text"]',function(ev){var $target=$(ev.target);if($target.width()<=expandedWidth){$target.animate({width:expandedWidth/2+"px"},300)}});function availabilityTagClasses(field,editor,tags){var longTimeDifference=1e3*60*60*8;$("li",editor).each(function(){var $li=$(this);var tag=$li.find(".tag-editor-tag").text();if(typeof tag=="undefined"){return}var parts=tag.split("-");if(parts.length==2){var start=parseTime(parts[0]);var endsAtMidnight=false;if(parts[1]=="12:00am"||parts[1]=="00:00"){var end=parseTime("11:59pm");endsAtMidnight=true}else{var end=parseTime(parts[1])}var difference=end-start;if(endsAtMidnight){$li.find(".tag-editor-tag").html(parts[0]+'-<wbr><span class="highlight-time-in-range">'+parts[1]+"</span>")}else if(start<parseTime("7:00am")){$li.find(".tag-editor-tag").html('<span class="highlight-time-in-range">'+parts[0]+"</span>-<wbr>"+parts[1])}if(difference>longTimeDifference){$li.addClass("tag-long-range")}else{$li.removeClass("tag-long-range")}}else{$li.removeClass("tag-long-range")}})}$(".availability-col").on("focus",".tag-editor input",function(){var $this=$(this);setTimeout(function(){var val=$this.val();var caretPos=$this.caret();var $textarea=$this.closest(".availability-col").find("textarea");$textarea.tagEditor("destroy");if($textarea.val()&&val){$textarea.val($textarea.val().replace(/,/g,", "));var valPosition=$textarea.val().indexOf(val);$textarea.caret(valPosition+caretPos)}else{$textarea.caret(-1)}},0)});$(".availability-col textarea").blur(function(ev){initTagEditor($(this))});function initTagEditor($el){if($el.hasClass("tag-editor-hidden-src")||$el.closest(".regular-hours").length==0){return false}$el.tagEditor({delimiter:",;\n",placeholder:"Closed",sortable:false,onChange:function(field,editor,tags){availabilityTagClasses(field,editor,tags);$(field).change()}});availabilityTagClasses(null,$el.tagEditor("getTags")[0].editor)}$(".availability-col textarea").each(function(){initTagEditor($(this))});function showAvailableTimesPreview($availabilityCol){var $previewContainer=$(".available-times-preview-container").show();var dayOfWeek=$availabilityCol.find(".day-of-week").text();$previewContainer.find(".day-of-week").text(dayOfWeek);$previewContainer.find(".start-times").html("Loading...");$.get("/preferences.php",{action:"previewStartTimes",times:$availabilityCol.find("textarea").val(),type:$("#previewType").val(),calendar:$("#thisCalendar").val()}).done(function(data){var result=JSON.parse(data);var times=result["times"];var longTimes=times.join(", ");var numSampleShortTimes=3;if(times.length>numSampleShortTimes*2+1){var start=times.slice(0,numSampleShortTimes);var end=times.slice(times.length-numSampleShortTimes);var shortTimes=start.join(", ")+", ..., "+end.join(", ")}else{var shortTimes=longTimes}if(shortTimes){var $startTimes=$previewContainer.find(".start-times").text(shortTimes);$previewContainer.find(".start-times-caveat").show();if(shortTimes!=longTimes){$startTimes.attr("long-times",longTimes).tooltip({title:"Click to view all times"})}}else{$previewContainer.find(".start-times-caveat").hide();$previewContainer.find(".start-times").text("nothing, this day is closed")}}).error(function(err){$previewContainer.find(".start-times").text("Error, failed to load start times, please refresh the page and try again")})}$(".available-times-preview-container .start-times").click(function(){var $this=$(this);$this.text($this.attr("long-times")).removeAttr("long-times").tooltip("destroy")});$("#availability-form").on("focus",".availability-col .tag-editor, .availability-col textarea",function(ev){$(".availability-col.selected-day").removeClass("selected-day");var $availabilityCol=$(this).closest(".availability-col").addClass("selected-day");showAvailableTimesPreview($availabilityCol)});$("#previewType").change(function(ev){showAvailableTimesPreview($(".availability-col.selected-day"))});$("#availability-form").on("change",".availability-col .form-control",function(ev){showAvailableTimesPreview($(this).closest(".availability-col"));var $el=$(ev.target).removeClass("animated").removeClass("bounce");var origTime=$el.val();new $.post("preferences.php?action=standardizeJson",{t:origTime},function(data){var newTime=origTime;var error="";try{var data=JSON.parse(data);newTime=data.newTime;error=data.error}catch(e){}if(error){Flash.error(error,35e3)}if(newTime!=origTime){$el.tagEditor("destroy");$el.val(newTime).change();initTagEditor($el);$el.addClass("animated").addClass("bounce");if(!error&&newTime==""&&/[0-9]/.test(origTime)){Flash.error("We didn't quite understand what you meant by \""+escapeHtml(origTime)+'".<br />Did you include am/pm? Enter a time like <strong>9:00am-5:00pm</strong>, multiple times can be separated by commas.',31e3)}else if(!error){Flash.hide()}}})});function removeDateRow(id){if(confirm("Are you sure you want to remove these dates? It will revert to the default availability.")){$("#date-heading-"+id).slideUp(200,function(){$("#date-heading-"+id).remove()});$("#date-hours-"+id).slideUp(200,function(){$("#date-hours-"+id).remove()});$("#date-hours-"+id).closest("form").change()}}$("#availability-form").on("click",".delete-date",function(ev){var rowId=$(ev.target).attr("data-row-id");if(rowId){removeDateRow(rowId)}});var dateRowCount=1;$(".override-normal-hours-btn").click(function(){$paid=$("#paid-warning");if($paid.attr("data-show")){$paid.show()}else{$("#warning-no-hours").hide(0);var html=$("#row-template").html();var rowId="s"+dateRowCount++;html=html.replace(/\[ID\]/g,rowId);$("#availability-table").append(html);showDatePicker($("#date-start-"+rowId+" .date-label"));$("html, body").scrollTop(Math.max(0,$(".save-hours-btn").offset().top-$(window).height()+$(".save-hours-btn").height()))}});$(".btn-cancel-no-regular-hours").click(function(){$("#is-regular-hours").prop("checked",true).change()});function changeRegularHoursElements(){var isRegularHours=$("#is-regular-hours").prop("checked");$(".hide-if-regular-hours").toggle(!isRegularHours);$(".show-if-regular-hours").toggle(isRegularHours);$('input[name="is-regular-hours"]').val(isRegularHours?1:-1)}changeRegularHoursElements();$(".regular-hours-btn-group, #is-regular-hours").on("change click",function(ev){if($("#is-regular-hours").prop("checked")){$("#warning-no-hours").hide(0);$(".regular-hours").show();$("#not-regular-hours-action").hide();$("#regular-override-btn").show(0)}else{$("#warning-no-hours").show(0);$(".regular-hours").hide();$("#not-regular-hours-action").show();$("#regular-override-btn").hide(0)}changeRegularHoursElements();$(".no-touch .availability-calendar-container").tooltip("hide")});$(".no-touch .availability-calendar-container:visible").tooltip("show");$("#availability-form").on("change",'.every-other input[type="checkbox"]',function(ev){var isChecked=$(ev.target).prop("checked");$row=$(ev.target).closest(".date-availability");if(isChecked){$row.addClass("has-every-other")}else{$row.removeClass("has-every-other")}});$("#chooseCalendar-select").focus(function(ev){$(".title-calendar-name").css({opacity:1e-4});$("#chooseCalendar-select").css({opacity:1})});function focusOnFirstRegularHours(){var $tagEditor=$("#normal-hours textarea:not(:empty):visible").first().closest(".availability-col").find(".tag-editor").click();if($tagEditor.length==0){$("#normal-hours textarea:not(:empty):visible").first().focus().select()}$("html,body").scrollTop(0);setTimeout(function(){$("html,body").scrollTop(0)},0)}setTimeout(focusOnFirstRegularHours,100)};Acuity.addController("#preferences-schedule",preferencesScheduleController);Acuity.addController(".type-availability-list",function($){var showOptionsSelector=".type-availability-options";function hideActiveCalendarOptions(){$(".group-availability-options.active, .group-availability-options a.active, .group-settings-pane.active").removeClass("active")}$(".type-availability-list .btn-delete").click(function(ev){$(ev.currentTarget).button("loading")});$("body").on("click",".cancel-calendar-edit",function(ev){ev.preventDefault();ev.stopImmediatePropagation();hideActiveCalendarOptions()});$("body").click(function(ev){if($(ev.target).closest(".group-availability-options").length==0){hideActiveCalendarOptions()}});function openGroupOptionsPane($link){hideActiveCalendarOptions();$link.addClass("active").closest(".group-availability-options").addClass("active");var $pane=$link.nextAll(".group-settings-pane").addClass("active");var href=$link.attr("href");$pane.html('<div class="pane-loading">Loading...</div>');if(href&&$pane.length){$.get(href+"&ajax=1",function(data){$pane.html(data);Acuity.init()})}}$(".group-availability-options a").click(function(ev){ev.preventDefault();openGroupOptionsPane($(ev.currentTarget))});$(".calendar-group .custom-limits-note").click(function(ev){ev.preventDefault();var $link=$(ev.currentTarget).closest(".calendar-group").find(".change-limits-btn");if($link.length==0){return}setTimeout(function(){openGroupOptionsPane($link)},0)});function serializeCalendarTypes(){var data="";$(".type-list").each(function(){var calendarId=$(this).attr("data-calendar-id");if(calendarId){if(data)data+="&";data+=$(this).sortable("serialize",{key:"types["+calendarId+"][]"})}});return data}function updateCalendarTypes(){var serialized=serializeCalendarTypes();if(lastUpdated!=serialized){lastUpdated=serialized;$.post("calendars.php?action=updateTypes",serialized,function(data){Flash.notice("Successfully saved groups",3e3)}).fail(function(){Flash.error("Failed to save type groups")})}}var lastUpdated="";$(".type-list").not(".new-calendar-group .type-list").sortable({connectWith:".type-list, .new-type-list",distance:10,cancel:".is-group-type",containment:".type-availability-list",placeholder:"sortable-type-placeholder",update:function(ev,ui){if(ui.sender)updateCalendarTypes();$(ev.target).closest(".calendar-group").toggleClass("has-no-types",$(ev.target).find(".type-item").length==0)}}).disableSelection();$(".new-calendar-group .type-list").sortable({items:"> .type-item",update:function(ev,ui){var typeId=ui.item[0].id.replace("type_","");if(typeId){$(".new-calendar-group .type-list-title").html('<div class="progress-spinner small"></div> Saving...');$.post("/calendars.php?action=newSub&parent="+$("#parent").val(),{"types[]":typeId},function(data){Acuity.goTo(data)}).fail(function(){Flash.error("Failed to create new calendar")})}}});var $previouslySelected=null;$(".new-group-target").click(function(ev){$(ev.currentTarget).closest(".new-calendar-group").removeClass("form-hidden").addClass("form-showing");$previouslySelected=$(".selected-group").removeClass("selected-group")});$(".cancel-new-group-form").click(function(ev){ev.preventDefault();$(ev.currentTarget).closest(".new-calendar-group").addClass("form-hidden").removeClass("form-showing");$previouslySelected.addClass("selected-group")});$(".add-new-schedule-btn").click(function(ev){Details.loadHtml($("#new-schedule-template").html())});function enableCreateScheduleButton(){var numEnabled=$('[name="types[]"]:checked').length;var $btn=$(".btn-new-schedule");$btn.prop("disabled",numEnabled==0);if(numEnabled==1){$btn.attr("value",$btn.attr("data-singular-text"))}else{$btn.attr("value",$btn.attr("data-plural-text"))}}$('[name="types[]"]').change(function(ev){enableCreateScheduleButton()});enableCreateScheduleButton();$(".calendar-group").click(function(ev){if(ev.isDefaultPrevented()||$(ev.target).closest(".group-settings-pane").length||$(ev.target).hasClass("btn-delete")){return}var calendarId=$(ev.currentTarget).attr("data-calendar-id");if(calendarId&&!$(ev.currentTarget).hasClass("selected-group")){Acuity.goTo("/preferences.php?tab=schedule&showTypes=1&calendar="+calendarId+"&lastTop="+$("#availability_specific").css("marginTop"),{scrollTo:false})}});$(".disabled-appointments .type-list-title").click(function(ev){$(".disabled-appointments .disabled-type-list-container").slideToggle(200)});$(".btn-toggle-availability-list").click(function(ev){ev.preventDefault();if(!$(".calendar-availability-container").hasClass("availability-list-visible")&&$(".type-availability-list .calendar-group:not(.new-calendar-group)").length==1){$(".new-group-target").click()}$(".calendar-availability-container").toggleClass("availability-list-visible")});$(".btn-undo-availability-groups").click(function(ev){$(".btn-undo-availability-groups").hide();$(".undo-availability-groups-container").show()});$(".btn-cancel-undo-availability-groups").click(function(ev){$(".btn-undo-availability-groups").show();$(".undo-availability-groups-container").hide()});$(".btn-final-undo-availability-groups").click(function(){$(this).button("loading")});var keylineOffset=14;if(!$(".selected-group").is(".is-parent-group")&&$(".selected-group").length!=0){$("#availability_specific").css({marginTop:$(".selected-group").position().top+keylineOffset+"px"});var selectedScreenTop=$(".selected-group").offset().top-$("body").scrollTop();if(selectedScreenTop<0||selectedScreenTop>$(window).height()/4){$("body, html").animate({scrollTop:$(".selected-group").offset().top-50+"px"},200)}}else{$("#availability_specific").css({marginTop:0})}});Acuity.addController("#syncing",function($){var $calendarSettings=$("#calendar-settings");if($calendarSettings.size()){(function(){var key=$calendarSettings.data("key");function init(){$calendarSettings.on("change",".calendar-calendars select",function(){var $calendar=$(this).closest(".calendar-app-acuity");var $select=$calendar.find(".calendar-calendars select");$calendar.find(".calendar-block").toggle(!!$select.val()).find(".calendar-block-name").text($select.find("option:selected").text());$calendar.find(".calendar-blocks").toggle(!!$select.val()&&!!$calendar.find(".calendar-block input").prop("checked"));$calendar.find(".calendar-calendars.has-error").removeClass("has-error").find(".help-block").hide();hideSelectedCalendarFromBlockOptions($calendar)}).on("change",".calendar-block input",function(){var $input=$(this);var $calendar=$input.closest(".calendar-app-acuity");$calendar.find(".calendar-blocks").toggle($input.prop("checked"));hideSelectedCalendarFromBlockOptions($calendar)}).on("change",".calendar-blocks select",function(){var $input=$(this);var $calendar=$input.closest(".calendar-app-acuity");var $selects=$calendar.find(".calendar-blocks select");var append=$selects.size()<10;$selects.each(function(){append=append&&!!$(this).val()});if(append){$calendar.find(".calendar-blocks").append($calendar.find(".calendar-blocks-template").html());hideSelectedCalendarFromBlockOptions($calendar)}})}function hideSelectedCalendarFromBlockOptions($calendar){var selected=$calendar.find(".calendar-calendars select").val();$calendar.find(".calendar-blocks option").each(function(){var $option=$(this);$option.toggle(!selected||selected!==$option.prop("value"))});$calendar.find(".calendar-blocks select").each(function(){if(selected&&$(this).val()===selected)$(this).val("")})}var count=0;function fetchCalendars(){var data={action:"calendars",count:count++};$.post("/app.php?action=proxy&key="+key+"&ajax=1",data,function(data){if(data.content){$(".calendars-loading").html(data.content);init()}else if(count<50){setTimeout(fetchCalendars,1e3)}},"json")}if($(".calendars-loading").size()){fetchCalendars()}else{init()}})()}$(".full-sync").change(function(ev){var calendarId=$(this).attr("data-calendar");$(ev.target).closest("td").find(".extra-sync").toggle(this.checked)});$("#set-google-reminder").change(function(ev){if($("#set-google-reminder").val()==1){if($("#google-reminder").val()==0){$("#google-reminder").val("15")}$("#google-reminder-time-container").show().find("input").focus()}else{$("#google-reminder-time-container").hide()}});$(".extra-sync").on("change","select",function(ev){$current=$(ev.currentTarget);var $extraSyncContainer=$current.closest(".extra-sync");var isEmptySelect=false;$extraSyncContainer.find("select").each(function(){if(!$(this).val())isEmptySelect=true});if(!isEmptySelect){var $clone=$current.closest("div").clone();$clone.find("option:selected").prop("selected",false);$extraSyncContainer.append($clone)}});function setSyncFromLabels(){$(".google-sync-to").each(function(){var label=$("option:selected",this).text();var calendarId=$(this).attr("data-calendar");$("#calendar-sync-from-"+calendarId).text(label)})}$(".google-sync-to").change(setSyncFromLabels);setSyncFromLabels();$("#syncing").delegate(".confirm-prompt .btn-confirm","click",function(e){$('#syncing .disable-app, #syncing input[name="Save"]').attr("disabled",true)})});Acuity.addController(".users-list-container",function($){$(".users-list-container #add-user-btn").click(function(ev){Details.loadHtml($("#addUserModal").html())});$(".users-list-container").on("click",".btn-edit-user",function(ev){var id=$(this).attr("data-user-id");Details.loadUri("preferences.php?action=editUser&id="+id)});$(".detail-nav").on("click","#change-password-prompt",function(ev){$("#change-password-prompt").hide(0);$("#change-password").show(0).find("input").focus()})});Acuity.addController(".edit-user-container",function($){var $calendarCheckboxes=$('.edit-user-container [name="calendars[]"]');function areAllChecked(){return $calendarCheckboxes.not(":checked").length==0}function checkboxChanged(){$("#check-all-calendars").prop("checked",areAllChecked())}$("#check-all-calendars").change(function(ev){$calendarCheckboxes.prop("checked",!areAllChecked())});$calendarCheckboxes.change(checkboxChanged);checkboxChanged()});var preferencesWebsiteIntegrationController=function($){$(".js-change-site-url").click(function(ev){$("#edit-subdomain-form").toggleClass("form-hidden");$("#subdomain").focus()});var rawIntegrationUrl="";$(".btn-embed-acuity-form").click(function(ev){ev.preventDefault();Details.loadHtml($("#template-embed-acuity-form").html());if($("#direct-link").val()&&rawIntegrationUrl){$('input[name="embed-url"]').val(rawIntegrationUrl)}$("#request-embed-form").submit(function(ev){if(!validate($(ev.currentTarget))){ev.preventDefault()}})});function checkSubdomain(){$.post("preferences.php?action=checkSubdomain",{subdomain:$("#subdomain").val()},function(data){if(data){$("#edit-subdomain-form .field-input").addClass("has-error");$("#edit-subdomain-form .help-block").text(data)}else{$("#edit-subdomain-form .field-input").removeClass("has-error");$("#edit-subdomain-form .help-block").text("")}})}$(".integration-code-snippet").focus(function(ev){var $this=$(this);setTimeout(function(){$this.select()},1)});checkTimeout=null;$("#subdomain").on("keydown change",function(){if(checkTimeout)clearTimeout(checkTimeout);checkTimeout=setTimeout(checkSubdomain,300)});$(".btn-embed-self").click(function(ev){$(".embed-self-container").show();$(".btn-embed-self").hide()});function addParamToUrl(url,param){if(!param)return url;var separator=url.indexOf("?")>0?"&":"?";var page=url.indexOf("schedule.php")>0?"":"schedule.php";return url+page+separator+param}$("#direct-link").change(function(ev){var param=$(ev.currentTarget).val();$(".js-change-site-url").toggle(!param);var text="";if(param){var selectedOptionText=$(ev.currentTarget).find("option:selected").text();selectedOptionText=selectedOptionText.replace("—","").trim();text="for "+selectedOptionText}$(".scheduling-link-text").text(text);$(".scheduling-url").each(function(){var $this=$(this);var baseUrl=$this.attr("data-base-url");if(!baseUrl){baseUrl=$this.attr("href");$this.attr("data-base-url",baseUrl)}var newUrl=addParamToUrl(baseUrl,param);$this.attr("href",newUrl);if($this.is("iframe"))$this.attr("src",newUrl);$this.find("strong").text(newUrl)});$(".integration-code-snippet").each(function(){var $integrationSnippet=$(this);var origSnippet=$integrationSnippet.attr("data-orig-snippet");if(!origSnippet){origSnippet=$integrationSnippet.val();$integrationSnippet.attr("data-orig-snippet",origSnippet)}var baseUrl=$integrationSnippet.attr("data-base-url");var newUrl=addParamToUrl(baseUrl,param);rawIntegrationUrl=newUrl;$integrationSnippet.val(origSnippet.replace(baseUrl,newUrl))})})};Acuity.addController("#preferences-website-integration",preferencesWebsiteIntegrationController);Acuity.addController("#request-embed-form",function($){var bypassCheckWebsite=false;function reallySubmitForm(){bypassCheckWebsite=true;$("#request-embed-form").submit()}$("#request-embed-form").submit(function(ev){$(".embed-username-group").find(".username-email-error").hide();if(!validate(ev.currentTarget)){ev.preventDefault();return}if(isBuilderUsernameEmail()&&!validateEmail($('input[name="username"]').val())){$(".embed-username-group").addClass("has-error");$(".embed-username-group .username-email-error").show();ev.preventDefault();ev.stopImmediatePropagation();return}if($('input[name="website"]').val().indexOf(".wordpress.com")>-1){$(".wordpresscom-error").show();ev.preventDefault();ev.stopImmediatePropagation();return}else{$(".wordpresscom-error").hide()}$(".checking-website-message").show();$(".check-website-error").hide();if(bypassCheckWebsite){return}$.get("/preferences.php",{action:"testEmbed",url:$('input[name="website"]').val(),username:$('input[name="username"]').val(),password:$('input[name="password"]').val()}).done(function(data){var result=JSON.parse(data);if(result.error){if(typeof result.message!="undefined"){$(".check-website-error").text("Couldn't send embed request: "+result.message).show()}if(result.error=="wordpress.com"){$(".wordpresscom-error .builder-name").text(result.builder);$(".wordpresscom-error").show()}}else if(result.builder){$('select[name="builder"]').val(result.builder);reallySubmitForm()}else{$(".website-builder-group").show();$('select[name="builder"]').val("Other").change();bypassCheckWebsite=true}}).fail(function(){reallySubmitForm()}).always(function(){$(".checking-website-message").hide()});ev.stopImmediatePropagation();ev.preventDefault()});function validateEmail(email){var re=/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;return re.test(email)}function isBuilderUsernameEmail(){var usernameIsEmailBuilders=["Squarespace.com","Vistaprint.com","Webs.com","Weebly.com","Wix.com"];var selectedBuilder=$('select[name="builder"]').val();return usernameIsEmailBuilders.indexOf(selectedBuilder)>=0}$('select[name="builder"]').change(function(ev){var selectedBuilder=$(ev.currentTarget).val();$(".other-builder-field").toggle(selectedBuilder=="Other");if($(".other-builder-field").is(":visible")){$(".other-builder-field input").focus()}})});Acuity.addController(".preview-container",function($){var hints={".login-container":{position:"right",hint:'Disable Client Log in &amp; Registration <a href="https://secure.acuityscheduling.com/preferences.php?tab=customize&hnav=options">under Scheduling Page Options</a>'},".step-pick-appointment":{position:"left",hint:'Translate or change what anything says in <a href="https://help.acuityscheduling.com/hc/en-us/articles/219149987" target="_blank">Change Scheduling Wording</a>'},".choose-date-time":{position:"left",hint:'Have clients in different time zones? Require clients choose their time zone when booking in <a href="/preferences.php?tab=customization">Customize Appearance</a>'},".select-calendar":{position:"left",hint:'Pool availability, or remove the "any available" choice, <a href="https://secure.acuityscheduling.com/preferences.php?tab=customize&hnav=options">under Scheduling Page Options</a>'},".appt-summary-pane":{position:"left",hint:'Ask more questions using custom <a href="/forms.php">Intake Form Questions</a>'},".appointment-time":{position:"left",hint:'Add more information to this page under <a href="https://help.acuityscheduling.com/hc/en-us/articles/219149217">Show a message after scheduling</a>'}};function sendMessage(action,settings){var ifr=$(".preview-container iframe").get(0);if(typeof JSON!="undefined"&&typeof JSON.stringify=="function"&&typeof ifr!="undefined"&&typeof ifr.contentWindow!="undefined"&&typeof ifr.contentWindow.postMessage=="function"){var data="acuity:"+action+":"+JSON.stringify(settings||{});ifr.contentWindow.postMessage(data,"*")}}$("[data-preview-highlight]").on("mouseover",function(){sendMessage("highlight",{selector:$(this).attr("data-preview-highlight")})});$("[data-preview-highlight]").on("mouseout",function(){sendMessage("stophighlight")});$("[data-preview-text]").on("keyup change preview.acuity",function(){sendMessage("text",{selector:$(this).attr("data-preview-text"),text:$(this).val()})});$("[data-preview-param]").on("change",function(){var $iframe=$(".preview-container iframe");$iframe.attr("src",$iframe.data("base-url")+"&"+$(this).data("preview-param"))});$('[name="html_customCss"]').on("change keypress",debounce(function(){sendMessage("css",{selector:"#custom-css",css:$(this).val()})},400));function positionHint($el,realTop){var iframe=$(".preview-container iframe").get(0);
if(!iframe){return}var scale=iframe.getBoundingClientRect().width/iframe.offsetWidth;var top=realTop*scale;if(top==0){$el.attr("data-hint-top",realTop).hide();return}$el.css({top:top+"px"}).attr("data-hint-top",realTop).show()}function updateHintPositions(){$("[data-hint-top]").each(function(){positionHint($(this),$(this).attr("data-hint-top"))})}function handleMessage(action,settings){if(action=="ypos"){if(typeof hints[settings.selector]=="undefined"){return}var selector=settings.selector+"-hint";positionHint($(selector),settings.top)}}function previewHtml(selector,html){sendMessage("html",{selector:selector,html:html});if(selector==".business-description"){sendMessage("toggle",{selector:".business-description-container",show:true})}}$("[data-preview-html]").on("keyup change preview.acuity",function(){previewHtml($(this).attr("data-preview-html"),$(this).val())});$("[data-preview-html].redactor").each(function(){var $el=$(this);$el.on("keyupCallback.redactor",function(){previewHtml($el.attr("data-preview-html"),this.code.get())})});$("[data-preview-css]").on("change move.spectrum preview.acuity",function(){sendMessage("css",{selector:$(this).attr("data-preview-css"),css:$(this).attr("data-preview-css").replace(/\$val/g,$(this).val())})});Acuity.previewOriginalOffset=$(".preview-container").offset();if(!window.initedPreview){window.initedPreview=true;$(window).on("message",function(ev){var data=ev.originalEvent.data;if(typeof data.split!="function")return;var parts=data.split(":");if(parts[0]=="sizing"){iframeLoaded()}});$(window).on("scroll",function(ev){if($(window).scrollTop()>Acuity.previewOriginalOffset.top&&!$(".preview-container").hasClass("preview-expanded")){$(".preview-container").addClass("fixed-scroll")}else if($(".preview-container").hasClass("fixed-scroll")){$(".preview-container").removeClass("fixed-scroll")}});$(window).on("message",function(ev){var origin=ev.origin||ev.originalEvent.origin;var data=ev.originalEvent.data;if(typeof data.split!="function"){return}var parts=data.split(":");if(parts.length<2||parts[0]!="acuity"){return}var action=parts[1];var settings={};if(parts.length>2){try{parts.shift();parts.shift();settings=JSON.parse(parts.join(":"))}catch(ex){}}handleMessage(action,settings)})}function initHints(){for(var selector in hints){if(hints[selector].inited)continue;sendMessage("watchY",{selectors:[selector]});$(".preview-hint-container").prepend($('<div class=""><i class="icon-asterisk"></i></div>').attr("data-hint",hints[selector].hint).addClass("preview-hint-"+hints[selector].position).addClass(selector.replace(".","")+"-hint"));hints[selector].inited=true}$(".preview-hint-left, .preview-hint-right").each(function(){var $hintButton=$(this);var timeout=null;$hintButton.hover(function(){var $this=$(this);clearTimeout(timeout);if($this.find(".hint-tooltip").length){return}$(".hint-tooltip").remove();$tooltip=$('<div class="hint-tooltip"></div>').html($hintButton.attr("data-hint"));$this.append($tooltip)},function(){var $this=$(this);timeout=setTimeout(function(){$this.find(".hint-tooltip").remove()},150)})})}function setBlokkify(enableBlokk){sendMessage("css",{selector:"base-blokkify",css:"@font-face {font-family: 'BLOKKNeue-Regular';src: url('https://d3gxy7nm8y4yjr.cloudfront.net/responsive/css/BLOKKNeue-Regular/webfonts/BLOKKNeue-Regular.eot');}@font-face {font-family: 'BLOKKNeue-Regular';src: url('https://d3gxy7nm8y4yjr.cloudfront.net/responsive/css/BLOKKNeue-Regular/webfonts/BLOKKNeue-Regular.woff') format('woff'),url('https://d3gxy7nm8y4yjr.cloudfront.net/responsive/css/BLOKKNeue-Regular/webfonts/BLOKKNeue-Regular.svg#BLOKKNeue-Regular') format('svg');}"});if(enableBlokk){sendMessage("css",{selector:"blokkify",css:".content * {font-family: 'BLOKKNeue-Regular' !important; word-spacing: -20px;}"})}else{sendMessage("css",{selector:"blokkify",css:""})}}setBlokkify(true);$("[data-preview-warn-change]").on("change",function(ev){$(".preview-container .change-warning-message").show()});function iframeLoaded(){setBlokkify($(".preview-container").hasClass("preview-not-expanded"));sendMessage("noembed");initHints();$("[data-preview-text], [data-preview-html] [data-preview-css]").trigger("preview.acuity")}$(".preview-container iframe").on("load",function(ev){iframeLoaded()});$(".btn-expand-preview").click(function(ev){$(".preview-container").addClass("preview-expanded").removeClass("preview-not-expanded").removeClass("fixed-scroll");setBlokkify(false);updateHintPositions();var previewTop=$(".preview-container").offset().top;if($(window).scrollTop()>previewTop){$("body, html").animate({scrollTop:previewTop+"px"},300)}});$(".btn-close-preview").click(function(ev){$(".preview-container").removeClass("preview-expanded").addClass("preview-not-expanded");setBlokkify(true);updateHintPositions()})});function clientIdChanged(){if($("#clientID").val()=="email"){$("#client-email").show().focus()}else{$("#client-email").val("").hide()}}Acuity.addController(".certificate-code-edit-container",function($){$("#clientID").change(clientIdChanged);clientIdChanged();$("#expires").datepicker({dateFormat:"yy-mm-dd"})});var productsController=function($){$(".showCatalog").change(function(){$("#save-btn").show(0)});$("#isCertificate").change(function(ev){if($(this).prop("checked")){$("#certificate").show(0)}else{$("#certificate").hide(0)}});$(".btn-add-code").click(function(ev){Details.loadHtml($("#add-code-template").html());$("#clientID").change(clientIdChanged)});$(".btn-edit-code").click(function(ev){ev.preventDefault();Details.loadUri($(this).attr("href"))});if(!$("#title").val()){$("#title").focus()}$("#products-edit-page .detail-link").click(function(ev){ev.preventDefault();Details.loadUri($(this).attr("href"))});$("#show-direct-link").click(function(ev){ev.preventDefault();$("#direct-link").toggle()});$(".show-appt-list").click(function(ev){var $container=$(ev.currentTarget).closest(".code-container");$container.find(".show-appt-list").hide();$container.find(".code-appt-list").show()});$(".types-to-redeem").change(function(){$(".types-to-redeem").removeClass("alert").removeClass("alert-danger")});$("#products-edit-page").submit(Validate.validateSubmit);$("#certificateMaxMinutesSelect").change(function(ev){$("#certificate").toggleClass("has-max-minutes",$("#certificateMaxMinutesSelect").val()=="minutes");$("#certificate").toggleClass("has-max-dollar",$("#certificateMaxMinutesSelect").val()=="dollar")});$("#printable").change(function(ev){var isPrintable=$(ev.currentTarget).is(":checked");$(".help-printable").toggle(isPrintable)});$(".help-printable a[data-url-template]").click(function(ev){ev.preventDefault();var image=$("#image-big").val();var url=$(ev.currentTarget).attr("data-url-template").replace("%TITLE%",encodeURIComponent($("#title").val())).replace("%DESCRIPTION%",encodeURIComponent($("#certificateDescription").val())).replace("%IMAGE%",encodeURIComponent(image)).replace("%EXPIRES%",encodeURIComponent($("#expiresAfterDays").val()));window.open(url,"_blank").focus()});$("#certificate").change(function(ev){if($(".code-container").length==0)return;$(".certificate-changed-warning").show()});function showRedeemableSummary(){var isMaxPooled=$("#certificateMaxMinutesSelect").val()!="0";var redeemable=[];$(".types-to-redeem input:visible").each(function(){var $this=$(this);if(!isMaxPooled&&$this.val()>0||isMaxPooled&&$this.is(":checked")){var text=$this.parent().find(".type-name").html();if(!isMaxPooled){text="("+$this.val()+") "+text+($this.val()>1?"s":"")}redeemable.push(text)}});var summary="";if(isMaxPooled){var maxAmount="";if($("#certificateMaxMinutesSelect").val()=="minutes"&&$('[name="certificateMaxMinutes"]').val()){maxAmount=$('[name="certificateMaxMinutes"]').val()+" minutes"}else if($("#certificateMaxMinutesSelect").val()=="dollar"&&$('[name="maxDollar"]').val()){maxAmount=$(".currency").first().html()+$('[name="maxDollar"]').val()}summary="This can be redeemed for "+(maxAmount||'<span class="text-danger">(please set what this can be redeemed for above)</span>')+" total of ";if(redeemable.length>1){summary+=" any combination of "}}else{summary="This can be redeemed for"}summary+=" <strong>"+redeemable.join("</strong> and <strong>")+"</strong>";if(isSubscription()&&$('[name="subscr_behavior"]').val()!="noop"){summary+=" "+getSubscriptionPeriod();if($('[name="subscr_behavior"]').val()=="rollover"){summary+=", rolling over unused appointments"}}$(".redeemable-summary").html(summary)}$("#certificateMaxMinutesSelect, #certificate, .form-group-price").on("change keyup",showRedeemableSummary);showRedeemableSummary();function updateOrder(){$.post("products.php?action=updateProductPosition",$(".sortableList").sortable("serialize",{key:"productsList[]"}),function(data){Flash.notice("Successfully saved order",3e3)}).fail(function(){Flash.error("Failed to save order")})}$(".sortableList").sortable({distance:10,update:function(ev,ui){updateOrder()}}).disableSelection();$(".reorder-move-up").click(function(ev){var current=$(ev.currentTarget).closest("li");current.prev().before(current);updateOrder()});$(".reorder-move-down").click(function(ev){var current=$(ev.currentTarget).closest("li");current.next().after(current);updateOrder()});function isSubscription(){return!!$('[name="is_subscription"]').val()}function getSubscriptionPeriod(){var $period=$('[name="subscr_period"]');return $period.find('option[value="'+$period.val()+'"]').text()}function getPrice(selector){if(!selector){selector="#price"}var price=parseFloat($(selector).val().trim());if(isNaN(price)){price=0}return price}$('#price, [name="subscr_setup"]').on("change keyup",function(ev){$(".product-price").text(getPrice());$(".product-price-setup").text((getPrice()+getPrice('[name="subscr_setup"]')).toFixed(2))});function updateTermsText(){$period=$('[name="subscr_period"]');if($period.length==0){return}var period=getSubscriptionPeriod();var $duration=$('[name="subscr_duration"]');if($duration.val()==0){var duration="forever"}else{var totalPrice=getPrice()*$duration.val()+getPrice('[name="subscr_setup"]');var duration="for a total of "+$duration.val()+" payments ("+$(".currency").text()+totalPrice.toFixed(2)+" total)"}var terms=period+" "+duration;$(".product-terms").text(terms)}$('[name="subscr_duration"], [name="subscr_period"], #price, [name="subscr_setup"]').on("keyup change",updateTermsText);updateTermsText();$('[name="subscr_agreed"]').change(function(ev){$(".submit-btn-group").toggle($('[name="subscr_agreed"]').is(":checked"))});function showFeesWarningIfNeeded(){var $notice=$(".alert-subscription-fees");if(!isSubscription()){$(".submit-btn-group").show();$notice.hide();return}if($notice.length==0||$notice.is(":visible")){return}$notice.show();$(".submit-btn-group").hide()}showFeesWarningIfNeeded();$("#price").on("change keyup",function(ev){$(".change-price-notice").show()});$(".used-codes-toggle a").click(function(ev){$(".used-codes-toggle a").hide();$(".used-codes-container").show()});$(".btn-show-subscription").click(function(ev){$("#products-edit-page").addClass("is-subscription");$('[name="is_subscription"]').val("true");$(".expires-after-group").hide()});$(".btn-hide-subscription").click(function(ev){$("#products-edit-page").removeClass("is-subscription");$('[name="is_subscription"]').val("");$(".expires-after-group").show()});$('[data-toggle="tooltip"]').tooltip()};Acuity.addController("#products-page, #products-edit-page",productsController);var reportsController=function($){function initTimeline(){if(typeof reportOptions!="undefined"&&reportOptions)$("#timeline").highcharts(reportOptions)}if(typeof $("#timeline").highcharts!="function"){async("//d3gxy7nm8y4yjr.cloudfront.net/responsive/js/highcharts.js",initTimeline)}else{initTimeline()}function initTable(){$(".report-table").tablesorter({textExtraction:function(node){var $node=$(node);var val=$node.attr("data-value");return typeof val!="undefined"?val:node.innerHTML}})}if(typeof $(".report-table").tablesorter!="function"){async("//d3gxy7nm8y4yjr.cloudfront.net/responsive/js/jquery.tablesorter.min.js",initTable)}else{initTable()}$(".btn-view-matching-appts").click(function(){$container=$(".view-matching-appts");if($container.is(":visible")){$container.slideUp()}else{$container.slideDown(200);$.post("/reports.php?action=detail",$("#report-form").serialize(),function(data){$container.html(data);$("body, html").animate({scrollTop:$container.position().top-200+"px"},300)})}});$(".view-matching-appts").on("click","[data-appointment-id]",function(ev){ev.stopImmediatePropagation();ev.preventDefault();Details.loadUri("/appointments.php?action=detail&id="+$(this).attr("data-appointment-id"))});$(".has-detail").click(function(ev){var id=$(ev.currentTarget).attr("data-type");$('.report-detail[data-type="'+id+'"]').toggle()});$(function(){$(".date-range").datepicker({dateFormat:"yy-mm-dd"});function showCustom(){$("#custom-date").toggle($("#type").val()=="custom")}$("#type").change(showCustom);showCustom()})};Acuity.addController("#reports-page",reportsController);var rescheduleAppointmentController=function($){function enableSubmit(){var disabled=false;if(!$("#date").val())disabled=true;if(!$(Calendar.timeSelector).val())disabled=true;if(!disabled){var $submitWarning=$("#submit-warning");$submitWarning.hide();var data={times:[{date:$("#date").val(),time:$(Calendar.timeSelector).val()}],calendarID:$("#calendar-list").val(),type:$("#appointmentType").val(),ignoreAppointments:[$("#apptId").val()]};Calendar.checkConflicts(data,function(result){if(result.length<=0){return}var why=result[0]["why"];var title=result[0]["title"];if(why=="reallypast"||why=="conflicts"||why=="resources"){$submitWarning.text(title);$submitWarning.show(0)}else{$submitWarning.hide(0)}});$.post("/schedule.php?action=checkConflict&owner="+self.owner,data,function(data){var result={};try{result=JSON.parse(data)}catch(ex){return}var why="";if(result.length>0){why=result[0]["why"]}})}else{$("#submit-warning").hide()}$(".reschedule-btn-group .btn").prop("disabled",disabled)}function showTimes(){var date=$("#date").val();if(!date){$("#times").html('<span class="need-to-pick-date"><i class="icon-chevron-left"></i> Choose a date</span>');return}var type=$("#appointmentType").val();var calendar=$("#calendar-list").val();var apptId=$("#apptId").val();enableSubmit();Calendar.showTimes(date,type,calendar,apptId)}function showCalendar(month){var type=$("#appointmentType").val();var calendar=$("#calendar-list").val();$("#times").html('<span class="need-to-pick-date"><i class="icon-chevron-left"></i> Choose a date</span>');if(!type||!calendar){$("#date-picker").text("Select date and calendar first");return}Calendar.loadCalendar(type,calendar,month)}self.showCalendar=showCalendar;$("#calendar-list").change(function(ev){showCalendar()});$("#custom-time").click(Calendar.toggleCustomTime);$("#appointment-reschedule-page").change(enableSubmit);$("#appointment-reschedule-page").on("click","input",enableSubmit);$("#appointment-reschedule-page").submit(function(ev){$("#reschedule-submit").button("loading")});$('#appointment-reschedule-page [name="no-email"]').click(function(ev){$("#appointment-reschedule-page").append('<input type="hidden" name="no-email" value="1" />')});$(function(){Calendar.setupDatePickerEvents(showTimes);showCalendar($("#date").val());enableSubmit()})};Acuity.addController("#appointment-reschedule-page",rescheduleAppointmentController);Acuity.addController("#new-resource",function($){var $quantity=$('input[name="quantity"]');$quantity.on("change keyup",function(ev){var qty=parseInt($(this).val());if(!qty){qty=1}$(".quantity-value").text(qty);$(".show-plural-quantity").toggle(qty!=1)});function toggleResourceForClass(){$(".show-resource-with-classes").toggle($("[data-is-group]:checked").length>0)}$("[data-is-group]").change(toggleResourceForClass);toggleResourceForClass();$(".check-all-in-group").change(function(){var isChecked=$(this).prop("checked");$('input[data-group-name="'+$(this).val()+'"]').prop("checked",isChecked)});function checkAllChecked($checkAllBox){var $typesInGroup=$('input[data-group-name="'+$checkAllBox.val()+'"]');var allAreChecked=$typesInGroup.length==$typesInGroup.filter(":checked").length;$checkAllBox.prop("checked",allAreChecked)}$('input[name="types[]"]').change(function(){checkAllChecked($('.check-all-in-group[value="'+$(this).attr("data-group-name")+'"]'));$(this).closest("div").find(".other-resources").toggle($(this).prop("checked"))});$(".check-all-in-group").each(function(){checkAllChecked($(this))});$("#new-resource").submit(function(ev){Validate.validateSubmit(ev)})});var scheduleAppointmentAutocomplete=function($,scheduleAppointmentController){var clientSource=debounce(function(query,cb){$.post("/appointments.php?action=autoJsonClient",{firstName:$("#firstName:focus").val(),lastName:$("#lastName:focus").val(),phone:$("#phone:focus").val(),email:$("#email:focus").val()},function(data){try{cb(JSON.parse(data))}catch(er){}})},200);if(window.USERID!=3635){$("#firstName, #lastName, #phone, #email").typeahead({hint:false},{displayKey:"name",source:clientSource,templates:{suggestion:function(data){return escapeHtml(data.firstName)+" "+escapeHtml(data.lastName)+' <span class="autocomplete-phone">'+escapeHtml(data.phone)+"</span>"}}})}$(document).on("typeahead:autocompleted typeahead:selected",function(ev,suggestion,dataSet){ev.preventDefault();$("#firstName, #lastName, #phone, #email").blur();if(suggestion.firstName)$("#firstName").val(suggestion.firstName);if(suggestion.lastName)$("#lastName").val(suggestion.lastName);if(suggestion.phone)$("#phone").val(suggestion.phone);if(suggestion.email)$("#email").val(suggestion.email);scheduleAppointmentController.enableSubmit()});$(document).on("typeahead:cursorchanged",function(ev,suggestion,dataSet){if(suggestion.firstName)$("#firstName:focus").val(suggestion.firstName);if(suggestion.lastName)$("#lastName:focus").val(suggestion.lastName);if(suggestion.phone)$("#phone:focus").val(suggestion.phone);if(suggestion.email)$("#email:focus").val(suggestion.email);scheduleAppointmentController.enableSubmit()})};var scheduleAppointmentController=function($){function enableRecurring(){$("#repeat-appt-btn").prop("disabled",false);Recurring.updateRecurringTime($("#date").val());var typeId=$("#appointmentType").val();if(self.isClass&&self.isClass[typeId]&&$(Calendar.timeSelector).val()){var isQuantityVisible=$(".group-quantity-container").is(":visible");var originalQuantity=$("#group-quantity").val();if(originalQuantity>1&&isQuantityVisible){$(".group-quantity-warning").show()}$(".group-quantity-container").show();$("#group-quantity").val(1)}else{$(".group-quantity-container").hide()}}$(".recur-btn").click(function(ev){ev.preventDefault();var recurType=$(this).text();recurType=recurType.charAt(0).toLowerCase()+recurType.slice(1);$("#recur-type").text(recurType);$("#recur-type").attr("data-type",$(this).attr("id").replace("recur-",""));$("#recur-settings").show(0);$(".schedule-actions").hide(0)});$(".btn-set-quantity").click(function(ev){var time=$(Calendar.timeSelector).val();var date=$("#date").val();var quantity=$("#group-quantity").val();for(var i=0;i<quantity;i++){addAdditionalTime(date,time)}resetTimes();cancelRecurring();enableSubmit()});function cancelRecurring(){$("#recur-settings").hide(0);$(".schedule-actions").show(0)}$("#recur-settings .btn").click(function(ev){ev.preventDefault();cancelRecurring()});$("#extra-times").on("click",".remove-time-link",function(ev){ev.preventDefault();$(ev.target).closest(".extra-time-container").remove();$(".tooltip").remove();enableSubmit()});function checkConflict(times,doAllChecks){var type=$("#appointmentType").val();var calendarID=$("#calendar-list").val();if(type&&calendarID){var data={times:times,calendarID:calendarID,type:type};if(doAllChecks){data["doAllChecks"]="true"}$(".addons-list input:checked").each(function(i){data["addons["+i+"]"]=$(this).val()});Calendar.checkConflicts(data,function(result){for(var i=0;i<result.length;i++){var elId=result[i]["id"];var why=result[i]["why"];if(why){$div=$("#"+elId);$div.addClass("time-conflict").tooltip({title:result[i]["title"],placement:"left"})}}})}}var checkConflictTimes=[];var checkConflictTimer=null;function queueCheckConflict(elId,date,time,doAllChecks){checkConflictTimes.push({id:elId,date:date,time:time});if(checkConflictTimer){clearTimeout(checkConflictTimer)}checkConflictTimer=setTimeout(function(){var times=jQuery.extend(true,{},checkConflictTimes);checkConflictTimes=[];checkConflict(times,doAllChecks)},50)}function resetTimes(){$("#date, #appt-custom").val("");showCalendar();enableSubmit();enableRecurring();$(".group-quantity-warning").hide()}var id=1;function addAdditionalTime(date,time){var $extraTimes=$("#extra-times");var readableTime=formatTimeForHuman(time);var elId="start_"+id++;var div='<div class="extra-time-container" id="'+elId+'"><span class="extra-time">'+readableTime+" on "+formatDateForHuman(date)+'</span> <a href="#" class="remove-time-link">remove</a><input type="hidden" name="time[]" class="a_time" value="'+time+'" /><input type="hidden" name="date[]" class="a_date" value="'+date+'" /></div>';$extraTimes.append(div);queueCheckConflict(elId,date,time)}Acuity.addSeriesTime=function(date,time,readableTime,dontShowRemove){addAdditionalTime(date,time)};function showIntakeForms(){$.get("/appointments.php",{action:"getForms",type:$("#appointmentType").val()},function(data){var data=$.trim(data);$("#forms-container").html(data);$(".show-if-has-forms").toggle(!!data)}).error(function(){$("#forms-container").html('Unable to load intake forms, <a href="#">retry</a>?').find("a").click(showIntakeForms)})}$("#add-recur-times").click(function(ev){var time=$(Calendar.timeSelector).val();Recurring.addCustomRecurringTime(function(date){addAdditionalTime(date,time)});resetTimes();enableSubmit()});$("#add-another-time").click(function(ev){ev.preventDefault();addAdditionalTime($("#date").val(),$(Calendar.timeSelector).val());resetTimes()});function updateCalendars(){var type=$("#appointmentType").val();var cs=self.typeToCalendars[type];if(!cs)return;if(cs.length){$(".no-calendars-error").hide()}else{$(".no-calendars-error").show()}var calendarList=$("#calendar-list")[0];calendarList.options.length=0;calendarList.options[0]=new Option("Choose calendar...",-1);for(var i=0;i<cs.length;i++){var l=calendarList.options.length;calendarList.options[l]=new Option(cs[i][1],cs[i][0])}if(cs.length<=1){calendarList.selectedIndex=1;$("#schedule-calendar-container").hide(0)}else{$("#schedule-calendar-container").show(0)}return cs.length}function toggleScheduleName(doOpen){var firstName=$('#schedule-name input[name="firstName"]').val();var lastName=$('#schedule-name input[name="lastName"]').val();if(firstName&&lastName){$("#schedule-name-toggle").html("<strong>"+escapeHtml(firstName)+" "+escapeHtml(lastName)+"</strong>")}else{if(doOpen){$("#schedule-name").collapse("show")}$("#schedule-name-toggle").html("Client Name")}}function toggleScheduleType(){var type=$("#appointmentType").val();if(type){var typeName=$("#appointmentType").find('option[value="'+type+'"]').text();var calendarID=$("#calendar-list").val();var calendarName="";if(calendarID&&calendarID!="-1"&&$("#calendar-list option").length>1){calendarName=" with "+$("#calendar-list").find('option[value="'+calendarID+'"]').text()}$("#schedule-type-toggle").html("<strong>"+escapeHtml(typeName)+escapeHtml(calendarName)+"</strong>");$("#schedule-time").collapse("show")}else{$("#schedule-type-toggle").html("Appointment Type")}}function toggleScheduleTime(doClose){var date=$("#date").val();var time=$(Calendar.timeSelector).val();if(date&&time){time=formatTimeForHuman(time);date=formatDateForHuman(date);$("#schedule-time-toggle").html("<strong>"+date+" at "+time+"</strong>")}else{$("#schedule-time-toggle").text("Date & Time")}}var dateSelector="#date, #extra-times .a_date";var timeSelector=Calendar.timeSelector+", #extra-times .a_time";var required=["#appointmentType","#calendar-list",'#schedule-name input[name="firstName"]','#schedule-name input[name="lastName"]',dateSelector,timeSelector];var requiredNames=["Appointment type","Calendar","First name","Last name","Appointment date","Appointment time"];var deferTimer=null;var hasSubmitted=false;function enableSubmit(){var missingRequired=false;var firstMissing="";var numMissing=0;for(var i=0;i<required.length;++i){if(!$(required[i]).last().val()||$(required[i]).last().val()=="-1"){missingRequired=true;numMissing+=1;if(!firstMissing)firstMissing=requiredNames[i]}}if(firstMissing&&numMissing==1){$("#submit-error").text(firstMissing+" is required");$("#submit-error").show(0)}else{$("#submit-error").hide(0)}if($(dateSelector).last().val()&&$(timeSelector).val()){$("#schedule-name").collapse("show")}if($(dateSelector).val()&&$(Calendar.timeSelector).val()){enableRecurring()}else{$("#repeat-appt-btn").prop("disabled",true)}var typeId=$("#appointmentType").val();if(self.isClass&&self.isClass[typeId]){if($(".always-date-custom").length==0&&$("#custom-date-options").is(":visible")){Calendar.toggleCustomTime();showCalendar();$("#appt-custom").val("")}else{if(!$("#custom-date-options").is(":visible")){$("#custom-time").hide(0)}else{$("#custom-time").show(0)}var isReadonly=$("#date").val()&&$("#appt-custom").val()||$("#appt-custom").prop("readonly");$("#date, #appt-custom").prop("readonly",isReadonly)}}else{$("#custom-time").show(0);$("#date, #appt-custom").prop("readonly",false)}$submitWarning=$("#submit-warning");var alertClass="alert alert-warning alert-overbooking";if(!missingRequired){if(deferTimer)clearTimeout(deferTimer);deferTimer=setTimeout(function(){if(hasSubmitted)return;var date=$(dateSelector).filter(function(){return $(this).val()}).val();var data={times:[{date:date,time:$(timeSelector).filter(function(){return $(this).val()}).val(),id:""}],type:$("#appointmentType").val(),calendarID:$("#calendar-list").val()};$(".addons-list input:checked").each(function(i){data["addons["+i+"]"]=$(this).val()});$.post("schedule.php?action=checkConflict&owner="+self.owner,data,function(data){var result=[];try{result=JSON.parse(data)}catch(ex){return}if(hasSubmitted)return;var why="";if(result.length>0){why=result[0]["why"]}if(why=="reallypast"){$submitWarning.find(".submit-warning-message").text("The appointment time is in the past");$submitWarning.addClass("alert alert-warning")}else if(why=="conflicts"){$submitWarning.find(".submit-warning-message").html('<i class="icon-warning-sign"></i> The time conflicts with another appointment or is outside of your hours. <br /><a href="/appointments.php?view=day&day='+date+'" target="_blank" class="body-italic-small">View Day &raquo;</a>');$submitWarning.addClass(alertClass)}else if(why=="resources"){$submitWarning.find(".submit-warning-message").html('<i class="icon-warning-sign"></i> Not enough rooms/resources are available for this appointment');$submitWarning.addClass(alertClass)}else{$submitWarning.removeClass(alertClass).find(".submit-warning-message").text("")}}).fail(function(){$submitWarning.removeClass(alertClass).find(".submit-warning-message").text("")})},300)}else{$submitWarning.removeClass("alert alert-warning alert-overbooking")}$(".schedule-btn-group input, .schedule-btn-group .dropdown-toggle").prop("disabled",missingRequired)}this.enableSubmit=enableSubmit;function showTimes(){var date=$("#date").val();if(!date){$("#times").html("");$("#schedule-time-toggle").text("Date & Time");return}var type=$("#appointmentType").val();var calendar=$("#calendar-list").val();$(".group-quantity-container").hide();var extraData={};$(".addons-list input:checked").each(function(i){extraData["addons["+i+"]"]=$(this).val()});Calendar.showTimes(date,type,calendar,"",extraData)}Calendar.setupDatePickerEvents(showTimes);var _lastShowCalendar={};function showCalendar(month){var type=$("#appointmentType").val();var calendar=$("#calendar-list").val();$("#times").html('<span class="need-to-pick-date"><i class="icon-chevron-left"></i> Choose a date</span>');$("#schedule-time-toggle").text("Date & Time");if(!type||!calendar){$("#date-picker").text("Select date and calendar first");return}var extraData={};$(".addons-list input:checked").each(function(i){extraData["addons["+i+"]"]=$(this).val()});var thisShowCalendar={type:type,calendar:calendar,month:month,extraData:extraData};if(_lastShowCalendar.type==thisShowCalendar.type&&_lastShowCalendar.calendar==thisShowCalendar.calendar&&_lastShowCalendar.month==thisShowCalendar.month&&_lastShowCalendar.extraData.length==thisShowCalendar.extraData.length){return}_lastShowCalendar=thisShowCalendar;setTimeout(function(){Calendar.loadCalendar(type,calendar,month,extraData)},5)}self.showCalendar=showCalendar;$("#custom-time").on("click",function(ev){Calendar.toggleCustomTime();enableSubmit();$(".always-date-custom").removeClass("always-date-custom");if(!$("#custom-date-options").is(":visible")){showCalendar();$("#appt-custom").val("")}});$("#schedule-appointment").on("hidden.bs.collapse",function(ev){enableSubmit();if(ev.target.id=="schedule-name"){toggleScheduleName()}if(ev.target.id=="schedule-type"){toggleScheduleType()}if(ev.target.id=="schedule-time"){toggleScheduleTime()}$("#"+ev.target.id+"-toggle").addClass("collapsed")});$("#schedule-appointment").on("show.bs.collapse",function(ev){if(ev.target.id=="schedule-time"&&!$(dateSelector).last().val()){showCalendar()}$("#"+ev.target.id+"-toggle").removeClass("collapsed")});$("#appointmentType").on("change",function(){var type=$("#appointmentType").val();enableRecurring();enableSubmit();if(type){var numCalendars=updateCalendars();$("#extra-times").html("");if(numCalendars<=1){toggleScheduleType()}showIntakeForms()}else{$("#forms-container").html("")}});$("#calendar-list").on("change",function(){var id=$("#calendar-list").val();if(id){$("#extra-times").html("");toggleScheduleType()}enableSubmit()});$("#appointmentType, #calendar-list").change(function(ev){if($("#date-picker").is(":visible")){showCalendar()}});$("#appointmentType").change(function(ev){$("#addons-container").html("");$.get("/schedule.php",{type:$("#appointmentType").val(),action:"getAddonsPartial"},function(data){$("#addons-container").html('<div class="addons-list">'+data+"</div>")});enableSubmit()});$("#addons-container").change(enableSubmit);var enableTimer=null;$("#appt-custom, #schedule-name input").on("keyup change click",function(){if(enableTimer)clearTimeout(enableTimer);enableTimer=setTimeout(function(){enableSubmit()},200)});$("#times").on("change","#time-select",enableSubmit);$("#times").on("change",".time-selection",enableSubmit);$("#schedule-appointment form").submit(function(){Progress.done();$('.schedule-btn-group input[type="submit"]').button("loading");Progress.start();hasSubmitted=true});$("#change-timezone").click(function(ev){ev.preventDefault();$("#change-timezone-content, #change-timezone-label").toggle()});$('#schedule-appointment [name="no-email"]').click(function(ev){$("#schedule-appointment form").append('<input type="hidden" name="no-email" value="1" />')});$(".schedule-btn-group").on("mousedown touchstart",function(ev){enableSubmit();var missingRequired=false;var missingNames="";var numMissing=0;for(var i=0;i<required.length;++i){if(!$(required[i]).last().val()||$(required[i]).last().val()=="-1"){missingRequired=true;numMissing+=1;if(missingNames)missingNames+=", ";missingNames+=requiredNames[i]}}if(missingNames&&numMissing>=1){$("#submit-error").text("Required: "+missingNames);$("#submit-error").show(0)}else{$("#submit-error").hide(0)}});scheduleAppointmentAutocomplete($,this);if($("#appointmentType").val()){showIntakeForms()}updateCalendars();toggleScheduleType();toggleScheduleTime();toggleScheduleName();enableSubmit()};Acuity.addController("#schedule-appointment",scheduleAppointmentController);Acuity.addController(".global-search-container",function($){var $searchInput=$('.global-search-container input[name="search"]');var $searchResults=$(".global-search-results");
function hideResults(){$('.global-search-container input[name="search"]').val("");$(".global-search-results").html("").addClass("hidden")}var lastSearch="";function doSearch(){var search=$searchInput.val().toLowerCase().replace(/\\/g,"");if(lastSearch==search&&!$searchResults.hasClass("hidden")){return}else{lastSearch=search}if(search){$searchResults.html(Acuity.loadingHtml).removeClass("hidden");$.get("/search.php?action=search&ajax=1&q="+encodeURIComponent(search),function(data){$searchResults.html(data)})}else{hideResults()}}var debouncedSearch=debounce(doSearch,500);$searchInput.keyup(function(ev){if(ev.keyCode==27){hideResults();return}else if(ev.keyCode==13){return}debouncedSearch()});$(".global-search-container .icon-search").click(function(ev){$searchInput.focus();doSearch()});$searchInput.focus(function(ev){$(".global-search-container").addClass("focused")});$searchInput.blur(function(ev){$(".global-search-container").removeClass("focused")});$searchResults.on("click",".detail-nav-link",function(ev){ev.preventDefault();Details.loadUri($(this).attr("href"));if($(".preferences-container").length){hideResults()}});$searchResults.on("click",".close-results",function(ev){hideResults()});$(".global-search-container form").submit(function(ev){ev.preventDefault();doSearch()});if(!document.initedGlobalSearchResultsDismiss){document.initedGlobalSearchResultsDismiss=true;$("body").click(function(ev){var $target=$(ev.target);if($target.closest(".global-search-container").length==0&&$target.closest(".detail-nav").length==0){hideResults()}});$(document).on("acuity:detailsClosed",function(ev){hideResults()})}});Acuity.addController("#subscriptions-page",function($){$(".btn-view-subscription").click(function(ev){ev.preventDefault();Details.loadUri($(this).attr("href"))})});Acuity.addController(".view-subscription-container",function($){var $form=$(".view-subscription-container form");$(".btn-edit-subscription").click(function(ev){$form.removeClass("form-hidden")});$(".btn-cancel-edit-subscription").click(function(ev){$form.addClass("form-hidden")});$(".btn-focus-next-payment").click(function(ev){$('[name="overrideRenew"]').focus()})});Acuity.addController(".subscription-change-card-container",function($){SquarePayments.init();$(".subscription-change-card-container form").submit(function(ev){if(!SquarePayments.isSquareNonceSet()){SquarePayments.requestCardNonce();ev.preventDefault();return}$('.subscription-change-card-container input[type="submit"]').button("loading")})});Acuity.addController("form.warn-if-changed",function($){var defaultPrompt='You have unsaved changes! Click "Save" to save your settings.\n\nAre you sure you want to abandon your changes?';var formHasChanged=false;var formChangedPrompt=defaultPrompt;var $formChangedElement=null;var $forms=$("form.warn-if-changed");var lastSubmit=null;$forms.change(function(ev){var now=new Date;if(now-lastSubmit<500){return}if($(ev.target).closest("[data-ignore-warn-if-changed]").length||$(ev.target).is("[data-ignore-warn-if-changed]")){return}formHasChanged=true;$formChangedElement=$(ev.currentTarget);formChangedPrompt=$(ev.currentTarget).attr("data-warn-prompt");if(!formChangedPrompt){formChangedPrompt=defaultPrompt}}).submit(function(){lastSubmit=new Date;formHasChanged=false});window.Acuity.onbeforeunload(function(){if(formHasChanged&&$formChangedElement.is(":visible")){if(confirm(formChangedPrompt.replace(/\\n/g,"\n"))){formHasChanged=false;return true}else{return false}}else{return true}});window.onbeforeunload=function(){if(formHasChanged&&$formChangedElement.is(":visible")){return formChangedPrompt.replace(/\\n/g,"\n")}else{return}}});(function(factory){if(typeof module==="function"){module.exports=factory(this.jQuery||require("jquery"))}else{this.NProgress=factory(this.jQuery)}})(function($){var NProgress={};NProgress.version="0.1.2";var Settings=NProgress.settings={minimum:.08,easing:"ease",positionUsing:"",speed:200,trickle:true,trickleRate:.02,trickleSpeed:800,showSpinner:true,template:'<div class="bar" role="bar"><div class="peg"></div></div><div class="spinner" role="spinner"><div class="spinner-icon"></div></div>'};NProgress.configure=function(options){$.extend(Settings,options);return this};NProgress.status=null;NProgress.set=function(n){var started=NProgress.isStarted();n=clamp(n,Settings.minimum,1);NProgress.status=n===1?null:n;var $progress=NProgress.render(!started),$bar=$progress.find('[role="bar"]'),speed=Settings.speed,ease=Settings.easing;$progress[0].offsetWidth;$progress.queue(function(next){if(Settings.positionUsing==="")Settings.positionUsing=NProgress.getPositioningCSS();$bar.css(barPositionCSS(n,speed,ease));if(n===1){$progress.css({transition:"none",opacity:1});$progress[0].offsetWidth;setTimeout(function(){$progress.css({transition:"all "+speed+"ms linear",opacity:0});setTimeout(function(){NProgress.remove();next()},speed)},speed)}else{setTimeout(next,speed)}});return this};NProgress.isStarted=function(){return typeof NProgress.status==="number"};NProgress.start=function(){if(!NProgress.status)NProgress.set(0);var work=function(){setTimeout(function(){if(!NProgress.status)return;NProgress.trickle();work()},Settings.trickleSpeed)};if(Settings.trickle)work();return this};NProgress.done=function(force){if(!force&&!NProgress.status)return this;return NProgress.inc(.3+.5*Math.random()).set(1)};NProgress.inc=function(amount){var n=NProgress.status;if(!n){return NProgress.start()}else{if(typeof amount!=="number"){amount=(1-n)*clamp(Math.random()*n,.1,.95)}n=clamp(n+amount,0,.994);return NProgress.set(n)}};NProgress.trickle=function(){return NProgress.inc(Math.random()*Settings.trickleRate)};NProgress.render=function(fromStart){if(NProgress.isRendered())return $("#nprogress");$("html").addClass("nprogress-busy");var $el=$("<div id='nprogress'>").html(Settings.template);var perc=fromStart?"-100":toBarPerc(NProgress.status||0);$el.find('[role="bar"]').css({transition:"all 0 linear",transform:"translate3d("+perc+"%,0,0)"});if(!Settings.showSpinner)$el.find('[role="spinner"]').remove();$el.appendTo(document.body);return $el};NProgress.remove=function(){$("html").removeClass("nprogress-busy");$("#nprogress").remove()};NProgress.isRendered=function(){return $("#nprogress").length>0};NProgress.getPositioningCSS=function(){var bodyStyle=document.body.style;var vendorPrefix="WebkitTransform"in bodyStyle?"Webkit":"MozTransform"in bodyStyle?"Moz":"msTransform"in bodyStyle?"ms":"OTransform"in bodyStyle?"O":"";if(vendorPrefix+"Perspective"in bodyStyle){return"translate3d"}else if(vendorPrefix+"Transform"in bodyStyle){return"translate"}else{return"margin"}};function clamp(n,min,max){if(n<min)return min;if(n>max)return max;return n}function toBarPerc(n){return(-1+n)*100}function barPositionCSS(n,speed,ease){var barCSS;if(Settings.positionUsing==="translate3d"){barCSS={transform:"translate3d("+toBarPerc(n)+"%,0,0)"}}else if(Settings.positionUsing==="translate"){barCSS={transform:"translate("+toBarPerc(n)+"%,0)"}}else{barCSS={"margin-left":toBarPerc(n)+"%"}}barCSS.transition="all "+speed+"ms "+ease;return barCSS}return NProgress});function strtotime(text,now){var parsed,match,year,date,days,ranges,len,times,regex,i;if(!text){return null}text=text.replace(/^\s+|\s+$/g,"").replace(/\s{2,}/g," ").replace(/[\t\r\n]/g,"").toLowerCase();if(text==="now"){return now===null||isNaN(now)?(new Date).getTime()/1e3|0:now|0}match=text.match(/^(\d{2,4})-(\d{1,2})-(\d{1,2})(?:\s(\d{1,2}):(\d{2})(?::\d{2})?)?(?:\.(\d+)?)?$/);if(match){year=match[1]>=0&&match[1]<=69?+match[1]+2e3:match[1];return new Date(year,parseInt(match[2],10)-1,match[3],match[4]||0,match[5]||0,match[6]||0,match[7]||0)/1e3|0}date=now?new Date(now*1e3):new Date;days={sun:0,mon:1,tue:2,wed:3,thu:4,fri:5,sat:6};ranges={yea:"FullYear",mon:"Month",day:"Date",hou:"Hours",min:"Minutes",sec:"Seconds"};function lastNext(type,range,modifier){var diff,day=days[range];if(typeof day!=="undefined"){diff=day-date.getDay();if(diff===0){diff=7*modifier}else if(diff>0&&type==="last"){diff-=7}else if(diff<0&&type==="next"){diff+=7}date.setDate(date.getDate()+diff)}}function process(val){var splt=val.split(" "),type=splt[0],range=splt[1].substring(0,3),typeIsNumber=/\d+/.test(type),ago=splt[2]==="ago",num=(type==="last"?-1:1)*(ago?-1:1);if(typeIsNumber){num*=parseInt(type,10)}if(ranges.hasOwnProperty(range)&&!splt[1].match(/^mon(day|\.)?$/i)){return date["set"+ranges[range]](date["get"+ranges[range]]()+num)}if(range==="wee"){return date.setDate(date.getDate()+num*7)}if(type==="next"||type==="last"){lastNext(type,range,num)}else if(!typeIsNumber){return false}return true}times="(years?|months?|weeks?|days?|hours?|minutes?|min|seconds?|sec"+"|sunday|sun\\.?|monday|mon\\.?|tuesday|tue\\.?|wednesday|wed\\.?"+"|thursday|thu\\.?|friday|fri\\.?|saturday|sat\\.?)";regex="([+-]?\\d+\\s"+times+"|"+"(last|next)\\s"+times+")(\\sago)?";match=text.match(new RegExp(regex,"gi"));if(!match){return false}for(i=0,len=match.length;i<len;i++){if(!process(match[i])){return false}}return date.getTime()/1e3|0}function validate(form){var errorList="";var isError=false;$(".has-error").removeClass("has-error");$(".required:visible",$(form)).each(function(){var $formGroup=$(this).closest(".form-group");if(!$(this).val()){var name="";if($(this).attr("label")){name=$(item).attr("label")}else{name=$(this).get(0).id}$formGroup.addClass("has-error");isError=true}});return!isError}